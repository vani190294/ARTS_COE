<?php

namespace app\controllers;
use yii\helpers\Url;
use Yii;
use app\models\CurriculumSubject;
use app\models\CurriculumSubjectSearch;
use yii\web\Controller;
use yii\web\NotFoundHttpException;
use yii\filters\VerbFilter;
use app\models\Department;
use yii\db\Query;
use app\models\SubjectPrefix;
use app\models\LTP;
use app\models\Batch;
use app\models\Degree;
use app\models\Regulation;
use app\models\Servicesubjecttodept;
use app\models\SubjectsMapping;
use app\components\ConfigConstants;
use app\components\ConfigUtilities;
use app\models\Subjects;
use kartik\mpdf\Pdf;
use yii\helpers\Json;
use PHPExcel;
use PHPExcel_IOFactory;
use PHPExcel_Cell;
use PHPExcel_Style_Fill;
use PHPExcel_Style_Alignment;
use app\models\CoeBatDegReg;
use app\models\Nominal;
use app\models\StuInfo;
error_reporting(0);
/**
 * CurriculumSubjectController implements the CRUD actions for CurriculumSubject model.
 */
class CurriculumSubjectController extends Controller
{
    /**
     * @inheritdoc
     */
    public function behaviors()
    {
        return [
            'verbs' => [
                'class' => VerbFilter::className(),
                'actions' => [
                    'delete' => ['POST'],
                ],
            ],
        ];
    }

    /**
     * Lists all CurriculumSubject models.
     * @return mixed
     */
    public function actionIndex()
    {
        $searchModel = new CurriculumSubjectSearch();

        $_SESSION['coresubject']='All';
       
        $dataProvider = $searchModel->search(Yii::$app->request->queryParams);
        
        return $this->render('index', [
            'searchModel' => $searchModel,
            'dataProvider' => $dataProvider,
        ]);
    }
    /**
     * Displays a single CurriculumSubject model.
     * @param integer $id
     * @return mixed
     */
    public function actionView($id)
    {
        return $this->render('view', [
            'model' => $this->findModel($id),
        ]);
    }

    /**
     * Creates a new CurriculumSubject model.
     * If creation is successful, the browser will be redirected to the 'view' page.
     * @return mixed
     */
    public function actionCreate()
    {
        $model = new CurriculumSubject();
        $servicemodel = new Servicesubjecttodept();

        if ($model->load(Yii::$app->request->post())) 
        {
            $subject_code=strtoupper($_POST['subject_prefix']).strtoupper($model->subject_code);

            $coe_batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".$model->coe_regulation_id)->queryScalar();

            $query = new Query();           
            $query->select('subject_name')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code, 'coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['!=','subject_type_id',123])->andWhere(['!=','subject_name','Mini Project'])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata = $query->createCommand()->queryAll();

            $query1 = new Query();           
            $query1->select('subject_code,subject_name')->from('cur_curriculum_subject')->where(['!=','subject_type_id',123])->andWhere(['!=','subject_name','Mini Project'])->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata1 = $query1->createCommand()->queryAll();

            $query2 = new Query();           
            $query2->select('subject_code,subject_name')->from('cur_elective_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id])->andWhere(['degree_type'=>$model->degree_type])->andWhere(['<>','coe_elective_option',203]);
            $pgmdata2 = $query2->createCommand()->queryAll();

            $subjmerge=array_merge($pgmdata1,$pgmdata2);
            $checksubject_name=0;
            foreach ($subjmerge as $value) 
            {
                $existname = str_replace(' ', '-', strtolower($value['subject_name']));
                $newname = str_replace(' ', '-', strtolower($model->subject_name));
                $existname=preg_replace('/[^A-Za-z\-]/', '',$existname);
                $newname=preg_replace('/[^A-Za-z\-]/', '',$newname );
                if($existname==$newname)
                {
                    $checksubject_name=1;

                }
            }

            $query = new Query();           
            $query->select('subject_name')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code, 'coe_regulation_id'=>$model->coe_regulation_id])->andWhere(['!=','coe_batch_id',$coe_batch_id])->andWhere(['!=','subject_type_id',123])->andWhere(['!=','subject_name','Mini Project'])->andWhere(['degree_type'=>$model->degree_type]);

            $checkexname = $query->createCommand()->queryScalar();

            //print_r($checkexname); exit;
            $ckexistname = str_replace(' ', '-', strtolower($checkexname));
            $newsubname = str_replace(' ', '-', strtolower($model->subject_name));
            $ckexistname1=preg_replace('/[^A-Za-z\-]/', '',$ckexistname);
            $newsubname=preg_replace('/[^A-Za-z\-]/', '',$newsubname);

            //echo $ckexistname1."!=".$newsubname; exit;
            $ckexitone=0;
            if($ckexistname!=$newsubname && $checkexname!='')
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Name Different From Previous Batch Please Change Course Code!");
                return $this->redirect(['create']);
            }
            else if(empty($pgmdata) && $checksubject_name==0)
            { 
                $created_at = date("Y-m-d H:i:s");
                $userid = Yii::$app->user->getId(); 
                $model->coe_dept_id=$_POST['coe_dept_id'];
                $model->subject_type_id=$_POST['subject_type_id'];
                $model->subject_category_type_id=$_POST['subject_category_type_id'];
                $model->coe_batch_id=$coe_batch_id;
                $model->subject_code=$subject_code;               
                $model->created_at=$created_at;
                $model->created_by=$userid;

                //print_r($model); exit;
                if($model->save(false))
                {
                    
                    Yii::$app->ShowFlashMessages->setMsg('Success', "Course Added successfully..");
                    return $this->redirect(['index']);
                   
                    
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Insert Error! Please Check");
                    return $this->redirect(['create']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Code or Course Name Already Exist! Please Enter New One");
                return $this->redirect(['create']);
            }
            
        } else {
            return $this->render('create', [
                'model' => $model,
                'servicemodel'=>$servicemodel
            ]);
        }
    }

   
    
    public function actionSerivceIndex()
    {
        $searchModel = new CurriculumSubjectSearch();
        $_SESSION['coresubject']='8';
       
        $dataProvider = $searchModel->search(Yii::$app->request->queryParams);

        return $this->render('service-index', [
            'searchModel' => $searchModel,
            'dataProvider' => $dataProvider,
        ]);
    }



    public function actionCreateSerivce()
    {
        $model = new CurriculumSubject();
        $servicemodel = new Servicesubjecttodept();

        if($model->load(Yii::$app->request->post())) 
        {
            $subject_code=strtoupper($_POST['subject_prefix']).strtoupper($model->subject_code);

            $coe_batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".$model->coe_regulation_id)->queryScalar();

            $query = new Query();           
            $query->select('coe_cur_id')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code])->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata = $query->createCommand()->queryAll();

            $query1 = new Query();           
            $query1->select('*')->from('cur_curriculum_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata1 = $query1->createCommand()->queryAll();

            $query2 = new Query();           
            $query2->select('*')->from('cur_elective_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata2 = $query2->createCommand()->queryAll();

            $subjmerge=array_merge($pgmdata1,$pgmdata2);
            $checksubject_name=0;
            foreach ($subjmerge as $value) 
            {
                $existname = str_replace(' ', '-', strtolower($value['subject_name']));
                $newname = str_replace(' ', '-', strtolower($model->subject_name));
                $existname=preg_replace('/[^A-Za-z\-]/', '',$existname);
                $newname=preg_replace('/[^A-Za-z\-]/', '',$newname );
                if($existname==$newname)
                {
                    $checksubject_name=1;

                }
            }

            $query = new Query();           
            $query->select('subject_name')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code, 'coe_regulation_id'=>$model->coe_regulation_id])->andWhere(['!=','coe_batch_id',$coe_batch_id])->andWhere(['degree_type'=>$model->degree_type ]);

            $checkexname = $query->createCommand()->queryScalar();

            $ckexistname = str_replace(' ', '-', strtolower($checkexname));
            $newsubname = str_replace(' ', '-', strtolower($model->subject_name));
            $ckexistname=preg_replace('/[^A-Za-z\-]/', '',$ckexistname);
            $newsubname=preg_replace('/[^A-Za-z\-]/', '',$newsubname );
            $ckexitone=0;
            if($ckexistname!=$newsubname && $checkexname!='')
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Name Different From Previous Batch Please Change Course Code!");
                return $this->redirect(['create-service']);
            }
            else if(empty($pgmdata) && $checksubject_name==0)
            {
                $created_at = date("Y-m-d H:i:s");
                $userid = Yii::$app->user->getId(); 
                $model->coe_batch_id=$coe_batch_id;
                $model->coe_dept_id=$_POST['coe_dept_id'];
                $model->subject_type_id=$_POST['subject_type_id'];
                $model->subject_category_type_id=$_POST['subject_category_type_id'];
                $model->coe_batch_id=$coe_batch_id;
                $model->subject_code=$subject_code;
                $model->created_at=$created_at;
                $model->created_by=$userid;

                $coe_dept_ids=implode(",",$_POST['coe_dept_ids']); 
                $model->coe_dept_ids=$coe_dept_ids;

                if($model->save(false))
                {
                    //print_r($model); exit();
                    $success=0;
                    $checkservicemodel = Servicesubjecttodept::findone(['coe_cur_subid'=>$model->coe_cur_id,'semester'=>$model->semester]);
                    if(empty($checkservicemodel))
                    {
                        $coe_dept_ids=$_POST['coe_dept_ids'];
                           
                        for ($i=0; $i <count($coe_dept_ids) ; $i++) 
                        {      
                            $servicemodel = new Servicesubjecttodept();
                            $servicemodel->coe_dept_id=8;                      
                            $servicemodel->degree_type=$model->degree_type;
                            $servicemodel->coe_cur_subid=$model->coe_cur_id;
                            $servicemodel->coe_regulation_id=$model->coe_regulation_id;                   
                            $servicemodel->semester=$model->semester;                   
                            $servicemodel->coe_dept_ids=$coe_dept_ids[$i];
                            $servicemodel->created_at=$created_at;
                            $servicemodel->created_by=$userid;
                            if($servicemodel->save(false))
                            {
                                $success++;
                            }
                        }

                        if($success>0)
                        {
                            Yii::$app->ShowFlashMessages->setMsg('Success', "Course Added successfully..");
                            return $this->redirect(['serivce-index']);
                        }
                        else
                        {
                            Yii::$app->ShowFlashMessages->setMsg('Error', "Course Added successfully but Assign to Dept. Not successful");
                            return $this->redirect(['serivce-index']);
                        }  
                    }
                    else
                    {
                        Yii::$app->ShowFlashMessages->setMsg('Error', "Course Added successfully but Already Assign to Dept. Please Check");
                        return $this->redirect(['serivce-index']);
                    }                
                    
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Insert Error! Please Check");
                    return $this->redirect(['create-serivce']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Already Added! Please Check");
                return $this->redirect(['create-serivce']);
            }
            
        } else {
            return $this->render('createservice', [
                'model' => $model,
                'servicemodel'=>$servicemodel
            ]);
        }
    }

    public function actionOtherIndex()
    {
        $searchModel = new CurriculumSubjectSearch();
        $_SESSION['coresubject']='otherindex';
       
        $dataProvider = $searchModel->search(Yii::$app->request->queryParams);

        return $this->render('other-index', [
            'searchModel' => $searchModel,
            'dataProvider' => $dataProvider,
        ]);
    }

    public function actionCreateOther()
    {
        $model = new CurriculumSubject();
        $servicemodel = new Servicesubjecttodept();

        if($model->load(Yii::$app->request->post())) 
        {
            $subject_code=strtoupper($_POST['subject_prefix']).strtoupper($model->subject_code);

            $coe_batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".$model->coe_regulation_id)->queryScalar();

            $query = new Query();           
            $query->select('coe_cur_id')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code])->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata = $query->createCommand()->queryAll();

            $query1 = new Query();           
            $query1->select('subject_name')->from('cur_curriculum_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata1 = $query1->createCommand()->queryAll();

            $query2 = new Query();           
            $query2->select('subject_name')->from('cur_elective_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata2 = $query2->createCommand()->queryAll();

            $subjmerge=array_merge($pgmdata1,$pgmdata2);
            $checksubject_name=0;
            foreach ($subjmerge as $value) 
            {
                $existname = str_replace(' ', '-', strtolower($value['subject_name']));
                $newname = str_replace(' ', '-', strtolower($model->subject_name));
                $existname=preg_replace('/[^A-Za-z\-]/', '',$existname);
                $newname=preg_replace('/[^A-Za-z\-]/', '',$newname );
                if($existname==$newname)
                {
                    $checksubject_name=1;

                }
            }

            $query = new Query();           
            $query->select('subject_name')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code, 'coe_regulation_id'=>$model->coe_regulation_id])->andWhere(['!=','coe_batch_id',$coe_batch_id])->andWhere(['degree_type'=>$model->degree_type ]);

            $checkexname = $query->createCommand()->queryScalar();

            $ckexistname = str_replace(' ', '-', strtolower($checkexname));
            $newsubname = str_replace(' ', '-', strtolower($model->subject_name));
            $ckexistname=preg_replace('/[^A-Za-z\-]/', '',$ckexistname);
            $newsubname=preg_replace('/[^A-Za-z\-]/', '',$newsubname );
            $ckexitone=0;
            if($ckexistname!=$newsubname && $checkexname!='')
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Name Different From Previous Batch Please Change Course Code!");
                return $this->redirect(['create-other']);
            }
            else if(empty($pgmdata) && $checksubject_name==0)
            {
                $created_at = date("Y-m-d H:i:s");
                $userid = Yii::$app->user->getId(); 
                 $model->coe_batch_id=$coe_batch_id;
                $model->coe_dept_id=0;//$_POST['coe_dept_id'];
                $model->subject_type_id=$_POST['subject_type_id'];
                $model->subject_category_type_id=$_POST['subject_category_type_id'];
                $model->coe_batch_id=$coe_batch_id;
                $model->subject_code=$subject_code;
                $model->created_at=$created_at;
                $model->created_by=$userid;

                $coe_dept_ids=implode(",",$_POST['coe_dept_ids']); 
                $model->coe_dept_ids=$coe_dept_ids;

                if($model->save(false))
                {
                    //print_r($model); exit();
                    $success=0;
                    $checkservicemodel = Servicesubjecttodept::findone(['coe_cur_subid'=>$model->coe_cur_id,'semester'=>$model->semester]);
                    if(empty($checkservicemodel))
                    {
                        $coe_dept_ids=$_POST['coe_dept_ids'];
                           
                        for ($i=0; $i <count($coe_dept_ids) ; $i++) 
                        {      
                            $servicemodel = new Servicesubjecttodept();
                            $servicemodel->coe_dept_id=0;                      
                            $servicemodel->degree_type=$model->degree_type;
                            $servicemodel->coe_cur_subid=$model->coe_cur_id;
                            $servicemodel->coe_regulation_id=$model->coe_regulation_id;                   
                            $servicemodel->semester=$model->semester;                   
                            $servicemodel->coe_dept_ids=$coe_dept_ids[$i];
                            $servicemodel->created_at=$created_at;
                            $servicemodel->created_by=$userid;
                            if($servicemodel->save(false))
                            {
                                $success++;
                            }
                        }

                        if($success>0)
                        {
                            Yii::$app->ShowFlashMessages->setMsg('Success', "Course Added successfully..");
                            return $this->redirect(['other-index']);
                        }
                        else
                        {
                            Yii::$app->ShowFlashMessages->setMsg('Error', "Course Added successfully but Assign to Dept. Not successful");
                            return $this->redirect(['other-index']);
                        }  
                    }
                    else
                    {
                        Yii::$app->ShowFlashMessages->setMsg('Error', "Course Added successfully but Already Assign to Dept. Please Check");
                        return $this->redirect(['other-index']);
                    }                
                    
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Insert Error! Please Check");
                    return $this->redirect(['create-other']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Already Added! Please Check");
                return $this->redirect(['create-other']);
            }
            
        } else {
            return $this->render('create-other', [
                'model' => $model,
                'servicemodel'=>$servicemodel
            ]);
        }
    }

     public function actionMcIndex()
    {
        $searchModel = new CurriculumSubjectSearch();
        $_SESSION['coresubject']='mc';
       
        $dataProvider = $searchModel->search(Yii::$app->request->queryParams);

        return $this->render('mc-index', [
            'searchModel' => $searchModel,
            'dataProvider' => $dataProvider,
        ]);
    }


    public function actionCreateMc()
    {
        $model = new CurriculumSubject();
        $servicemodel = new Servicesubjecttodept();

        if($model->load(Yii::$app->request->post())) 
        {
            $subject_code=strtoupper($_POST['subject_prefix']).strtoupper($model->subject_code);

            $coe_batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".$model->coe_regulation_id)->queryScalar();

            $query = new Query();           
            $query->select('coe_cur_id')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code])->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata = $query->createCommand()->queryAll();

            $query1 = new Query();           
            $query1->select('subject_name')->from('cur_curriculum_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata1 = $query1->createCommand()->queryAll();

            $query2 = new Query();           
            $query2->select('subject_name')->from('cur_elective_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
            $pgmdata2 = $query2->createCommand()->queryAll();

            $subjmerge=array_merge($pgmdata1,$pgmdata2);
            $checksubject_name=0;
            foreach ($subjmerge as $value) 
            {
                $existname = str_replace(' ', '-', strtolower($value['subject_name']));
                $newname = str_replace(' ', '-', strtolower($model->subject_name));
                $existname=preg_replace('/[^A-Za-z\-]/', '',$existname);
                $newname=preg_replace('/[^A-Za-z\-]/', '',$newname );
                if($existname==$newname)
                {
                    $checksubject_name=1;

                }
            }

            $query = new Query();           
            $query->select('subject_name')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code, 'coe_regulation_id'=>$model->coe_regulation_id])->andWhere(['!=','coe_batch_id',$coe_batch_id])->andWhere(['degree_type'=>$model->degree_type ]);

            $checkexname = $query->createCommand()->queryScalar();

            $ckexistname = str_replace(' ', '-', strtolower($checkexname));
            $newsubname = str_replace(' ', '-', strtolower($model->subject_name));
            $ckexistname=preg_replace('/[^A-Za-z\-]/', '',$ckexistname);
            $newsubname=preg_replace('/[^A-Za-z\-]/', '',$newsubname );
            $ckexitone=0;
            if($ckexistname!=$newsubname && $checkexname!='')
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Name Different From Previous Batch Please Change Course Code!");
                return $this->redirect(['create-mc']);
            }
            else if(empty($pgmdata) && $checksubject_name==0)
            {
                $created_at = date("Y-m-d H:i:s");
                $userid = Yii::$app->user->getId();
                $model->coe_dept_id=$_POST['coe_dept_id'];
                $model->subject_type_id=$_POST['subject_type_id'];
                $model->subject_category_type_id=$_POST['subject_category_type_id'];
                $model->coe_batch_id=$coe_batch_id;
                $model->subject_code=$subject_code;
                $model->created_at=$created_at;
                $model->semester=0;
                $model->created_by=$userid;

                $model->coe_dept_ids='';

                if($model->save(false))
                {
                    
                    Yii::$app->ShowFlashMessages->setMsg('Success', "Course Added successfully");
                    return $this->redirect(['mc-index']);
                                   
                    
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Insert Error! Please Check");
                    return $this->redirect(['create-mc']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Already Added! Please Check");
                return $this->redirect(['create-mc']);
            }
            
        } else {
            return $this->render('create-mc', [
                'model' => $model,
                'servicemodel'=>$servicemodel
            ]);
        }
    }

     public function actionAcIndex()
    {
        $searchModel = new CurriculumSubjectSearch();
        $_SESSION['coresubject']='ac';
       
        $dataProvider = $searchModel->search(Yii::$app->request->queryParams);

        return $this->render('ac-index', [
            'searchModel' => $searchModel,
            'dataProvider' => $dataProvider,
        ]);
    }

    public function actionCreateAc()
    {
        $model = new CurriculumSubject();
        $servicemodel = new Servicesubjecttodept();

        if($model->load(Yii::$app->request->post())) 
        {
            if($model->degree_type=='PG')
            {
                $subject_code=strtoupper($_POST['subject_prefix']).strtoupper($model->subject_code);

                $coe_batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".$model->coe_regulation_id)->queryScalar();

                $query = new Query();           
                $query->select('coe_cur_id')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code])->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
                $pgmdata = $query->createCommand()->queryAll();

                $query1 = new Query();           
                $query1->select('*')->from('cur_curriculum_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
                $pgmdata1 = $query1->createCommand()->queryAll();

                $query2 = new Query();           
                $query2->select('*')->from('cur_elective_subject')->andWhere(['coe_regulation_id'=>$model->coe_regulation_id, 'coe_batch_id'=>$coe_batch_id ])->andWhere(['degree_type'=>$model->degree_type ]);
                $pgmdata2 = $query2->createCommand()->queryAll();

                $subjmerge=array_merge($pgmdata1,$pgmdata2);
                $checksubject_name=0;
                foreach ($subjmerge as $value) 
                {
                    $existname = str_replace(' ', '-', strtolower($value['subject_name']));
                    $newname = str_replace(' ', '-', strtolower($model->subject_name));
                    $existname=preg_replace('/[^A-Za-z\-]/', '',$existname);
                    $newname=preg_replace('/[^A-Za-z\-]/', '',$newname );
                    if($existname==$newname)
                    {
                        $checksubject_name=1;

                    }
                }

                $query = new Query();           
                $query->select('subject_name')->from('cur_elective_subject')->where(['subject_code' =>$subject_code, 'coe_regulation_id'=>$model->coe_regulation_id])->andWhere(['!=','coe_batch_id',$coe_batch_id])->andWhere(['degree_type'=>$model->degree_type ]);

                $checkexname = $query->createCommand()->queryScalar();

                $ckexistname = str_replace(' ', '-', strtolower($checkexname));
                $newsubname = str_replace(' ', '-', strtolower($model->subject_name));
                $ckexistname=preg_replace('/[^A-Za-z\-]/', '',$ckexistname);
                $newsubname=preg_replace('/[^A-Za-z\-]/', '',$newsubname );
                $ckexitone=0;
                if($ckexistname!=$newsubname && $checkexname!='')
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Course Name Different From Previous Batch Please Change Course Code!");
                    return $this->redirect(['create-minordeg']);
                }
                else if(empty($pgmdata) && $checksubject_name==0)
                {
                    $created_at = date("Y-m-d H:i:s");
                    $userid = Yii::$app->user->getId(); 
                    $model->coe_dept_id=$_POST['coe_dept_id'];
                    $model->subject_type_id=$_POST['subject_type_id'];
                    $model->subject_category_type_id=$_POST['subject_category_type_id'];
                    $model->coe_batch_id=$coe_batch_id;
                    $model->subject_code=$subject_code;
                    $model->created_at=$created_at;
                    $model->semester=0;
                    $model->created_by=$userid;

                    $model->coe_dept_ids='';

                    if($model->save(false))
                    {
                        
                        Yii::$app->ShowFlashMessages->setMsg('Success', "Course Added successfully");
                        return $this->redirect(['ac-index']);
                                       
                        
                    }
                    else
                    {
                        Yii::$app->ShowFlashMessages->setMsg('Error', "Insert Error! Please Check");
                        return $this->redirect(['create-ac']);
                    }
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Course Already Added! Please Check");
                    return $this->redirect(['create-ac']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "PG Only Allowed for Create Audit and Mandatory Course! Please Check");
                return $this->redirect(['create-ac']);
            }
            
        } else {
            return $this->render('create-ac', [
                'model' => $model,
                'servicemodel'=>$servicemodel
            ]);
        }
    }


    public function actionApproveReportCurriculum()
    {
        $model = new CurriculumSubject();
       
        return $this->render('approvereportcurriculum', [
                'model' => $model,
            ]);

    }

    public function actionApproveCurriculum()
    {
        $model = new CurriculumSubject();
        $cursubdata ='';
        if(Yii::$app->request->post())
        {
            //$cursub=$_POST['cursub'];

            $coe_regulation_id=$_POST['coe_regulation_id'];
            $coe_dept_id=$_POST['coe_dept_id'];
            $degree_type=$_POST['degree_type'];
            
            $successful=0;

            if($coe_regulation_id!='' && $degree_type!='' && $coe_dept_id!='')
            {

                if($degree_type=='UG' && $coe_dept_id==26)
                {
                    for ($i=0; $i <count($cursub) ; $i++) 
                    { 
                        $approved_elective = Yii::$app->db->createCommand("UPDATE cur_elective_subject SET approve_status  ='1' WHERE coe_elective_id='" . $cursub[$i] . "'")->execute();
                        if($approved_elective)
                        {
                            $successful++;
                        }
                    }
                   
                    $approved_elective_assign = Yii::$app->db->createCommand("UPDATE cur_electivetodept SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();
                    
                }
                else
                {
                    $approved_core = Yii::$app->db->createCommand("UPDATE cur_curriculum_subject SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND coe_dept_id!=8")->execute();

                    $approved_elective = Yii::$app->db->createCommand("UPDATE cur_elective_subject SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND coe_dept_id!=8")->execute();

                    $approved_elective_assign = Yii::$app->db->createCommand("UPDATE cur_electivetodept SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                    $approved_credit = Yii::$app->db->createCommand("UPDATE cur_credit_distribution_sem SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                    $approved_verticalstream = Yii::$app->db->createCommand("UPDATE cur_vertical_stream SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND vertical_type!=205")->execute();

                    $approved_elective_count = Yii::$app->db->createCommand("UPDATE cur_elective_count SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                    //$approved_service_count = Yii::$app->db->createCommand("UPDATE cur_service_count SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                     $approved_dept_pso= Yii::$app->db->createCommand("UPDATE cur_dept_pso SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                    if($approved_core)
                    {
                        if($approved_elective)
                        {
                            $successful++;
                        }
                        else
                        {
                            $successful++;
                        }
                    }
                }
                    
                if($successful>0)
                {
                    Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully approved");
                    return $this->redirect(['approve-curriculum']);
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Something missing for Approve! Please Check");
                    return $this->redirect(['approve-curriculum']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Something error! Please Check");
                    return $this->redirect(['approve-curriculum']);
            }

        } else {
            return $this->render('approvecurriculum', [
                'model' => $model,
                'cursubdata'=>$cursubdata
            ]);
        }


    }

    public function actionApproveServiceCurriculum()
    {
        $model = new CurriculumSubject();
        $cursubdata ='';
        if(Yii::$app->request->post())
        {
            $cursub=$_POST['cursub'];

            $coe_regulation_id=$_POST['coe_regulation_id'];
            $coe_dept_id=8;
            $degree_type=$_POST['degree_type'];

            $successful=0;

            if(count($cursub)>0)
            {
                $approved_core = Yii::$app->db->createCommand("UPDATE cur_curriculum_subject SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND coe_dept_id=8")->execute();                   

                $approved_SandH = Yii::$app->db->createCommand("UPDATE cur_servicesubtodept SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "'")->execute();

                if($approved_core)
                {
                    
                    $successful++;
                    
                }

                if($approved_SandH)
                {
                    
                    $successful++;
                    
                }
                   
                $approved_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_servicesubtodept WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND approve_status  ='1'")->queryScalar();
                
                if($successful>0)
                {
                    Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully approved");
                    return $this->redirect(['approve-service-curriculum']);
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Something missing for Approve! Please Check");
                    return $this->redirect(['approve-service-curriculum']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Something error! Please Check");
                    return $this->redirect(['approve-service-curriculum']);
            }

        } else {
            return $this->render('approveservicecurriculum', [
                'model' => $model,
                'cursubdata'=>$cursubdata
            ]);
        }


    }
  

    public function actionCurriculumApprovePdf()
    {
        require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
        $content = $_SESSION['curriculumdatasession'];
       
        $checkservice = Yii::$app->db->createCommand("SELECT count(*) FROM cur_service_count C JOIN cur_department B ON B.coe_dept_id=C.to_dept_id WHERE C.to_dept_id='".$_SESSION['logindeptid']."' AND C.coe_regulation_id=".$_SESSION['loginregulation_id']." AND C.degree_type='".$_SESSION['logindegree']."' AND approve_status=0")->queryScalar(); //exit;

        $watermark=''; $footer='';
        if($_SESSION['recommendcurriculum']=='approved' && $checkservice==0)
        {
            $watermark='SUBMITTED';
            $footer='CURRICULUM COURSE LIST PRINTED ON : {DATE d-m-Y H:i:s:A}#  PAGE :{PAGENO}';
        }
        else
        {
            $watermark='DRAFT';
            $footer='CURRICULUM COURSE LIST PRINTED ON : {DATE d-m-Y H:i:s:A}*  PAGE :{PAGENO}';
        }

        $filename=$_SESSION['cdc_Deptname'].".pdf";
        $SetHeader=$_SESSION['cdc_Deptname'];
        $pdf = new Pdf([
            'mode' => Pdf::DEST_BROWSER,
            'filename' => $filename,   
            'format' => Pdf::FORMAT_A4,
            'orientation' => Pdf::ORIENT_PORTRAIT,
            'content' => $content,
            //'cssFile' => '@vendor/kartik-v/yii2-mpdf/assets/kv-mpdf-bootstrap.min.css',
            'cssInline' => ' @media all{
                        table{border-collapse: collapse;  text-align: center;  font-family:"Roboto, sans-serif"; width:100%; font-size: 13px; } 
                        
                        table td{
                            border: 1px solid #000;                            
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: center;
                            font-family:"tamil"; 
                        }
                        table th{
                            border: 1px solid #000;
                           
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: center;
                           
                        }
                    }   
                ',
            'options' => ['title' => 'Curriculum Course List','showWatermarkText' => true,],
            'methods' => [ 
                    'SetHeader'=>[$SetHeader], 
                    'SetFooter'=>[$footer],
                    'SetWatermarkText' => [$watermark],
                ],
        ]);

         Yii::$app->response->format = \yii\web\Response::FORMAT_RAW;
        $headers = Yii::$app->response->headers;
        $headers->add('Content-Type', 'application/pdf');
        //$save_folder = Yii::getAlias('@webroot').'/resources/'.$filename; //exit();
        //$pdf->render();
        //$pdf->Output($content,$filename,true,$_SESSION['cdc_Deptname'],$footer);
        //readfile($filename);

       
        return $pdf->render();
    }

    /**
     * Deletes an existing CurriculumSubject model.
     * If deletion is successful, the browser will be redirected to the 'index' page.
     * @param integer $id
     * @return mixed
     */
    public function actionDeleteCore($id)
    {
        $checksubject = Yii::$app->db->createCommand("SELECT subject_code FROM  cur_curriculum_subject WHERE coe_cur_id=".$id)->queryScalar();

         $coe_batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM  cur_curriculum_subject WHERE coe_cur_id=".$id)->queryScalar();

        $checkelective = Yii::$app->db->createCommand("SELECT count(*) FROM  cur_electivetodept WHERE subject_code='".$checksubject."'")->queryScalar();

        $checksyllabus = Yii::$app->db->createCommand("SELECT count(*) FROM  cur_syllabus WHERE subject_code='".$checksubject."' AND coe_batch_id=".$coe_batch_id)->queryScalar();
       
        if($checkelective==0 && $checksyllabus ==0 && !empty($coe_batch_id))
        {
             $this->findModel($id)->delete();
             Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully Deleted..");

            return $this->redirect(['index']);
        }
        else
        {
            Yii::$app->ShowFlashMessages->setMsg('Error', "Course can't Delete! Course Assigned to other Dept. or Syllabus Created! Please Check..");

            return $this->redirect(['index']);
        }
       
    }

    public function actionDeleteService($id)
    {
        $checkelective = Yii::$app->db->createCommand("SELECT count(coe_cur_subid) FROM  cur_servicesubtodept WHERE coe_cur_subid=".$id)->queryScalar();

        if($checkelective==0)
        {
            $this->findModel($id)->delete();
            Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully Deleted..");
            return $this->redirect(['serivce-index']);
        }
        else
        {
            Yii::$app->ShowFlashMessages->setMsg('Error', "Course can't Delete! Course Assigned to other Dept.! Please Check");

            return $this->redirect(['serivce-index']);
        }
    }

    public function actionDeleteMc($id)
    {
        $this->findModel($id)->delete();
        Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully Deleted..");
        return $this->redirect(['mc-index']);
    }

    public function actionDeleteAc($id)
    {
        $this->findModel($id)->delete();
        Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully Deleted..");
        return $this->redirect(['ac-index']);
    }

     public function actionDeleteOther($id)
    {
        $checkelective = Yii::$app->db->createCommand("SELECT count(coe_cur_subid) FROM  cur_servicesubtodept WHERE approve_status=1 AND coe_cur_subid=".$id)->queryScalar();

        if($checkelective==0)
        {
            Yii::$app->db->createCommand('DELETE FROM cur_servicesubtodept WHERE approve_status=0 AND coe_cur_subid='.$id)->execute();

            $this->findModel($id)->delete();
            Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully Deleted..");
            return $this->redirect(['other-index']);
        }
        else
        {
            Yii::$app->ShowFlashMessages->setMsg('Error', "Course can't Delete! Course Assigned to other Dept.! Please Check");

            return $this->redirect(['other-index']);
        }
    }

    /**
     * Finds the CurriculumSubject model based on its primary key value.
     * If the model is not found, a 404 HTTP exception will be thrown.
     * @param integer $id
     * @return CurriculumSubject the loaded model
     * @throws NotFoundHttpException if the model cannot be found
     */
    protected function findModel($id)
    {
        if (($model = CurriculumSubject::findOne($id)) !== null) {
            return $model;
        } else {
            throw new NotFoundHttpException('The requested page does not exist.');
        }
    }

     public function actionCdcFinalreport()
    {
        $model = new CurriculumSubject();

        if(Yii::$app->request->post())
        {
            //echo "for approve"; exit;
            $coe_regulation_id=$_POST['coe_regulation_id'];
            $coe_dept_id=$_POST['coe_dept_id'];
            $degree_type=$_POST['degree_type'];

            $successful=0;

            if($coe_regulation_id!='' && $coe_dept_id!='' &&$degree_type!='')
            {
                $approved_credit = Yii::$app->db->createCommand("UPDATE cur_credit_distribution_sem SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                $approved_verticalstream = Yii::$app->db->createCommand("UPDATE cur_vertical_stream SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND vertical_type!=205")->execute();

                $approved_elective_count = Yii::$app->db->createCommand("UPDATE cur_elective_count SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                 $approved_dept_pso= Yii::$app->db->createCommand("UPDATE cur_dept_pso SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                $approved_core = Yii::$app->db->createCommand("UPDATE cur_curriculum_subject SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND coe_dept_id!=8")->execute();

                $approved_elective = Yii::$app->db->createCommand("UPDATE cur_elective_subject SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND coe_dept_id!=8")->execute();

                $approved_elective_assign = Yii::$app->db->createCommand("UPDATE cur_electivetodept SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();

                $approved_syllabus = Yii::$app->db->createCommand("UPDATE cur_syllabus SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND coe_dept_id!=8")->execute();

                if($approved_syllabus)
                {
                    $successful++;
                }
                else if($approved_syllabus)
                {
                    $successful++;
                }

                $cur_bos = Yii::$app->db->createCommand("UPDATE cur_bos SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "'")->execute();
                
                if($cur_bos)
                {
                    $successful++;
                }
                
                if($successful>0)
                {
                    Yii::$app->ShowFlashMessages->setMsg('Success', "Successfully approved");
                    return $this->redirect(['cdc-finalreport']);
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Something missing for Approve! Please Check");
                    return $this->redirect(['cdc-finalreport']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Something error! Please Check");
                    return $this->redirect(['cdc-finalreport']);
            }

        }
        else
        {
             return $this->render('cdc_finalreport', [
                'model' => $model,
            ]);
        }
       

    }


    public function actionCdcfinalreportdata()
    {
        $semester=Yii::$app->request->post('semester');

        $sem_num=''; $semend=0;
        if(!empty($semester)) 
        {
            

            if($semester=='All')
            {
                 $sem_num=" AND (A.semester >=1 AND A.semester<=8)";

                 $semend=8;
            }
            else
            {
                $sem=explode("-",  Yii::$app->request->post('semester'));
                 $sem_num=" AND (A.semester >= 1 AND A.semester<=".$sem[1].")";

                 $semend=$sem[1];
            }



            $sem=explode("-",  Yii::$app->request->post('semester'));
        }
        //print_r($sem); exit;
        $deptid=Yii::$app->request->post('coe_dept_id');

        $degreetype = Yii::$app->db->createCommand("SELECT degree_type FROM cur_department WHERE coe_dept_id=".$deptid)->queryScalar();

        $roman = ['1'=>'I','2'=>'II','3'=>'III','4'=>'IV','5'=>'V','6'=>'VI','7'=>'VII','8'=>'VIII','9'=>'IX','10'=>'X'];

        $_SESSION['logindeptid1']=$deptid;
        $_SESSION['loginregulation_id1']=Yii::$app->request->post('coe_regulation_id');
        $_SESSION['logindegree1']=$degreetype;
        $_SESSION['logindegree']=$degreetype;
        $_SESSION['cdcsemester']=$semester;
        $_SESSION['logindeptid']=$deptid;
        $_SESSION['loginregulation_id']=Yii::$app->request->post('coe_regulation_id');
        $_SESSION['semender']='SEMESTER I - '.$roman[$semend];
        $_SESSION['matrixavg']='';
        $header =$curriculumdata=''; $overallhrtot=$overallextinttot=$overllcredittot=0;

        $service_countdata='';$checkservicematch=0; $servicecourseapprove=0;

        if(Yii::$app->request->post('degree_type')=='UG' && $degreetype == 'UG')
        {
            
            $checkcurriculumdata = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='1'")->queryAll();

            $checkcurriculumdata1 = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='0'")->queryAll();

            $checksh_curriculumdata = Yii::$app->db->createCommand("SELECT count(*) FROM cur_curriculum_subject WHERE coe_dept_id='8' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='0'")->queryScalar();

            $check_bos = Yii::$app->db->createCommand("SELECT count(*) FROM cur_bos WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND bos_min_file!='' AND bos_attendance_file!='' AND semester='".$semester."'")->queryScalar();

             $streamdata = Yii::$app->db->createCommand("SELECT *,A.coe_dept_id FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.stream_name IN ('PEC','OEC','EEC') AND A.approve_status  ='1'")->queryAll();

             $streamdata_mc = Yii::$app->db->createCommand("SELECT *,A.coe_dept_id FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.stream_name IN ('MC')")->queryAll();

             $corefromotherdept = Yii::$app->db->createCommand("SELECT A.* FROM cur_curriculum_subject A JOIN cur_electivetodept B ON B.coe_subject_id=A.coe_cur_id AND B.coe_regulation_id=A.coe_regulation_id WHERE B.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.approve_status  ='1'")->queryAll();

             $checkcurriculumdata=array_merge($checkcurriculumdata,$corefromotherdept);

            $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

            $batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();


             $coe_programme_id = Yii::$app->db->createCommand("SELECT A.coe_programme_id FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname  WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id)->queryScalar();

             $Deptname = Yii::$app->db->createCommand("SELECT concat(C.degree_code,' ',dept_name) as dept_name FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname JOIN coe_degree C ON C.coe_degree_id=A.coe_degree_id WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id." AND A.coe_programme_id=".$coe_programme_id)->queryScalar();

            //print_r($checkcurriculumdata); exit();

            $output = substr($regulationyear, 2, 3);

            
            $electcreditpoint=3; // credit point elective per paper

            
            require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
            if(!empty($checkcurriculumdata))
            {
                $coresubjects=array();
                if(!empty($checkcurriculumdata)) //cdc start
                {
                    //$checkcurriculumdata=$approvedcurriculumdata;
                    $loop_pec=$loop_eec=$loop_oec=1; $mcloop=0; $semloop=1; $curriculumdataset='';

                    $cdcdatacoreservice='';

                    for ($s=1; $s <=8 ; $s++) 
                    { 
                        $semcredittot=$semhrtot=$semextint=0;   

                        $ssqry="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id,SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G ON G.coe_cur_subid=A.coe_cur_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND G.semester=".$s." AND F.stream_name!='MC' GROUP BY A.subject_code, G.semester ORDER BY A.subject_code, A.subject_type_id";

                        $curriculumdataset = Yii::$app->db->createCommand($ssqry)->queryAll(); //s&h

                         $coreservice_fromotherdept= Yii::$app->db->createCommand("SELECT A.coe_elective_id as coe_cur_id, G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND G.semester=".$s." AND G.coe_elective_option IN (200,202,225) GROUP BY G.subject_code,G.semester ORDER BY G.subject_code_new, A.subject_type_id")->queryAll();

                        if(!empty($coreservice_fromotherdept)) //service from other dept1
                        {
                            $curriculumdataset=array_merge($curriculumdataset,$coreservice_fromotherdept); 
                        }

                        $coreservice_fromotherdept1= Yii::$app->db->createCommand("SELECT A.coe_elective_id as coe_cur_id, G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='MBA' AND G.semester=".$s." AND G.coe_elective_option IN (216) GROUP BY G.subject_code,G.semester ORDER BY G.subject_code_new, A.subject_type_id")->queryAll();

                        if(!empty($coreservice_fromotherdept1)) //service from other dept2
                        {
                            $curriculumdataset=array_merge($curriculumdataset,$coreservice_fromotherdept1);

                        }
      
                        
                        $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id,A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND semester=".$s." AND F.stream_name!='MC' GROUP BY A.subject_code, A.semester ORDER BY A.subject_code, A.subject_type_id")->queryAll();


                        if(!empty($curriculumsemdata)) //core subject
                        {

                            $curriculumdataset=array_merge($curriculumdataset,$curriculumsemdata);
                        }     

                        $corefromotherdeptdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_cur_id AND G.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND G.semester=".$s."  GROUP BY G.subject_code,G.semester ORDER BY G.subject_code_new, A.subject_type_id")->queryAll();

                        if(!empty($corefromotherdeptdata))
                        {
                            $curriculumdataset=array_merge($curriculumdataset,$corefromotherdeptdata);
                        }

                        

                        $mcqry1="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id,SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G  ON G.coe_cur_subid=A.coe_cur_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND G.semester=".$s." AND F.stream_name='MC' GROUP BY A.subject_code, G.semester ORDER BY A.subject_code, A.subject_type_id";

                        $servicecoursedeptdata_mc = Yii::$app->db->createCommand($mcqry1)->queryAll();


                        if(!empty($servicecoursedeptdata_mc))
                        {
                            $curriculumdataset=array_merge($curriculumdataset,$servicecoursedeptdata_mc);
                        }          

                         $ipcoredata = Yii::$app->db->createCommand("SELECT A.coe_cur_id, A.subject_code, A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP, B.contact_hrsperweek, B.credit_point, B.internal_mark,B.external_mark, concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, C.type_order, C.type_order as subject_order FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE SUBSTRING(A.subject_code, 3, 2) ='IP' AND A.coe_dept_id = '0' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.semester=".$s."  GROUP BY A.subject_code,A.semester ORDER BY A.subject_code, A.subject_type_id")->queryAll();

                        if(!empty($ipcoredata))
                        {
                            $curriculumdataset=array_merge($curriculumdataset,$ipcoredata);
                        }

                        //print_r($servicecoursedeptdata); exit;

                        //array_multisort(array_column($curriculumdataset, 'subject_order'),  SORT_ASC, $curriculumdataset);
                        
                        //print_r($curriculumdataset); exit;
                        if(!empty($curriculumdataset))
                        {
                            $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th align=center colspan=9 style='text-align:center !important;'>Semester ".$roman[$s]."</th>";
                            $curriculumdata.="</tr>";

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Category</th>";
                            $curriculumdata.="</tr>";

                            $sl=1;
                            foreach ($curriculumdataset as $value)  //theory
                            {
                                if($value['type_order']==1)
                                {
                                    if($s<=$semend)
                                    {
                                        $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }
                                   
                                        
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";
                                    
                                    $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                               
                                        
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    
                                    
                                    $sl++;
                                }
                                   
                                
                            }

                            foreach ($curriculumdataset as $value) //th with pract
                            {
                                if($value['type_order']==2)
                                {
                                    
                                    if($s<=$semend)
                                    {
                                         $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }  
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";
                                    
                                    $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    
                                    $sl++;
                                }
                                   
                                
                            }

                           
                            $semstream="sem".$s;

                            $sc = Yii::$app->db->createCommand("SELECT prefix_name FROM cur_subject_prefix WHERE `coe_dept_id`='".Yii::$app->request->post('coe_dept_id')."' ORDER BY coe_prefix_id ASC ")->queryScalar(); 
                            
                            $pltphrs=$eltphrs=$oltphrs=array();
                            
                            foreach ($streamdata as $value) 
                            {
                                $electcreditpoint=3;
                                $credit=round($value[$semstream]/$electcreditpoint);

                                $intpart = floor( ($value[$semstream]/$electcreditpoint) );   // results in 3
                                $fraction =($value[$semstream]/$electcreditpoint)- $intpart; // results in 0.75

                                if($fraction>0)
                                {
                                    $electcreditpoint=$value[$semstream];
                                }

                               
                                for ($st=0; $st < $credit; $st++) 
                                { 
                                    $subject_type=''; $ltpall='';
                                    if($value['stream_name']=='PEC')
                                    {
                                        if($value['coe_dept_id']>=10 && $value['coe_dept_id']<=14)
                                        {
                                            $ltp = Yii::$app->db->createCommand("SELECT concat(L,'-',T,'-',P) as LTP, contact_hrsperweek, concat(internal_mark,'/',external_mark) as intext_mark, internal_mark, external_mark, subject_type_id, credit_point FROM cur_ltp WHERE credit_point=".$electcreditpoint."  AND subject_category_type_id=143")->queryOne();  

                                            $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar(); 
                                        }
                                        else
                                        {
                                            $ltp = Yii::$app->db->createCommand("SELECT concat(L,'-',T,'-',P) as LTP, contact_hrsperweek, concat(internal_mark,'/',external_mark) as intext_mark, internal_mark, external_mark, subject_type_id, credit_point FROM cur_ltp WHERE credit_point=".$electcreditpoint." AND subject_category_type_id=144")->queryOne();  
                                            
                                            $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar();
                                           
                                              
                                        }

                   
                                    }
                                    else
                                    {
                                        $ltp = Yii::$app->db->createCommand("SELECT concat(L,'-',T,'-',P) as LTP, contact_hrsperweek, concat(internal_mark,'/',external_mark) as intext_mark, internal_mark, external_mark, subject_type_id, credit_point FROM cur_ltp WHERE credit_point=".$electcreditpoint."  AND subject_category_type_id=143")->queryOne();  

                                        $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar();  
                                    }
                                    
                                       
                                    $curriculumdata.="<tr>";
                                        
                                        
                                    if($value['stream_name']=='PEC')
                                    {
                                        
                                        $ltpall1 = Yii::$app->db->createCommand("SELECT concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.coe_elective_option='192' GROUP BY A.coe_ltp_id")->queryAll();

                                        $ltpall_22 = Yii::$app->db->createCommand("SELECT concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept ED ON ED.subject_code=A.subject_code WHERE ED.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND ED.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND ED.degree_type='".Yii::$app->request->post('degree_type')."' AND ED.coe_elective_option='192' GROUP BY A.coe_ltp_id")->queryAll();


                                        if(!empty($ltpall_22))
                                        {
                                            $ltpall1=array_merge($ltpall1,$ltpall_22);
                                        }
                                       
                                             

                                        if(!empty($ltpall1))
                                        {
                                           
                                            $loopn1=count($ltpall1);
                                            
                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";                               
                                            $curriculumdata.="<td style='text-align:center !important;'>".$output."XX"."EXX</td>";
                                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['stream_fullname'])." - ".$roman[$loop_pec]."</td>";

                                            $subjecttypes=$ltpdisp=$ltphrs=$ltpcrdit=$ltpintext_mark=[];
                                            foreach ($ltpall1 as $ltpvalue) 
                                            {
                                                if(!in_array($ltpvalue['LTP'], $ltpdisp)) 
                                                {
                                                    $ltpdisp[]=$ltpvalue['LTP'];
                                                    $ltphrs[]=$ltpvalue['contact_hrsperweek'];
                                                    $ltpcrdit[]=$ltpvalue['credit_point'];
                                                    $ltpintext_mark[]=$ltpvalue['intext_mark'];
                                                    $subjecttypes[]=$ltpvalue['subjecttype'];
                                                }
                                            }
                                            //print_r($ltpdisp); exit; 
                                            if(!empty($ltpdisp))
                                            {
                                                $ltpdisp=implode("/ ", $ltpdisp);
                                                $ltphrs=implode("/", $ltphrs);
                                                $ltpcrdit=$ltp['credit_point'];
                                                $ltpintext_mark=implode(", ", $ltpintext_mark);
                                                $subjecttypes=implode(", ", $subjecttypes);

                                                $pltphrs[]=$ltphrs;
                                            }

                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltpdisp."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltphrs."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$ltpcrdit."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltpintext_mark."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subjecttypes."</td>";
                                            
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";

                                              $loop_pec++;
                                        }
                                        else if(empty($ltpall1))
                                        {  
                                            

                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";                               
                                            $curriculumdata.="<td style='text-align:center !important;'>".$output."XX"."EXX</td>";
                                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['stream_fullname'])." - ".$roman[$loop_pec]."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$electcreditpoint."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";

                                             $loop_pec++;
                                        }
                                    }

                                    if($value['stream_name']=='EEC')
                                    {

                                        $ltpall2 = Yii::$app->db->createCommand("SELECT concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.coe_elective_option='193' GROUP BY A.coe_ltp_id")->queryAll();
                                            
                                        //print_r($ltpall2); exit;

                                        if(!empty($ltpall2))
                                        {
                                            $loopn2=count($ltpall2);
                                            
                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";                               
                                            $curriculumdata.="<td style='text-align:center !important;'>".$output."XX"."OXX</td>";
                                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['stream_fullname'])." - ".$roman[$loop_eec]."</td>";

                                            $subjecttypes=$ltpdisp=$ltphrs=$ltpcrdit=$ltpintext_mark='';
                                            foreach ($ltpall2 as $ltpvalue) 
                                            {
                                                 $ltpdisp[]=$ltpvalue['LTP'];
                                                $ltphrs[]=$ltpvalue['contact_hrsperweek'];
                                                $ltpcrdit[]=$ltpvalue['credit_point'];
                                                $ltpintext_mark[]=$ltpvalue['intext_mark'];
                                                $subjecttypes[]=$ltpvalue['subjecttype'];
                                            }

                                            if(!empty($ltpdisp))
                                            {
                                                $ltpdisp=implode("/ ", $ltpdisp);
                                                $ltphrs=implode("/", $ltphrs);
                                                $ltpcrdit=$ltp['credit_point'];
                                                $ltpintext_mark=implode(", ", $ltpintext_mark);
                                                $subjecttypes=implode(", ", $subjecttypes);

                                                 $eltphrs[]=$ltphrs;
                                            }

                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltpdisp."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltphrs."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$ltpcrdit."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltpintext_mark."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subjecttypes."</td>";
                                            
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                            $loop_eec++;
                                        }
                                        else if(empty($ltpall2))
                                        {          

                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                       
                                             $curriculumdata.="<td style='text-align:center !important;'>".$output."XX"."OXX</td>";
                                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['stream_fullname'])." - ".$roman[$loop_eec]."</td>";
                                            
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$electcreditpoint."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                            $loop_eec++;
                                        }

                                        

                                    }

                                    if($value['stream_name']=='OEC')
                                    {
                                        $ltpalll = Yii::$app->db->createCommand("SELECT concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.coe_elective_option='191' AND A.subject_code NOT IN (SELECT subject_code FROM cur_electivetodept WHERE coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."') GROUP BY A.coe_ltp_id")->queryAll();

                                        $oec_cource_to_otherdept1 = Yii::$app->db->createCommand("SELECT concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept ED ON ED.subject_code=A.subject_code WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND  ED.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND ED.degree_type='".Yii::$app->request->post('degree_type')."' AND ED.coe_elective_option IN ('191') AND A.subject_code NOT IN (SELECT subject_code FROM cur_electivetodept WHERE coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."') GROUP BY  A.coe_ltp_id")->queryAll();

                                        $oec_cource_to_otherdept2 = Yii::$app->db->createCommand("SELECT concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept ED ON ED.subject_code=A.subject_code WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND ED.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND ED.degree_type='".Yii::$app->request->post('degree_type')."' AND ED.coe_elective_option IN ('191') AND service_paper=0 AND A.subject_code NOT IN (SELECT subject_code FROM cur_electivetodept WHERE coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."') GROUP BY A.coe_ltp_id")->queryAll();

                                            if(!empty($oec_cource_to_otherdept1))
                                            {
                                                $ltpalll=array_merge($ltpalll,$oec_cource_to_otherdept1);
                                            }

                                            if(!empty($oec_cource_to_otherdept2))
                                            {
                                                $ltpalll=array_merge($ltpalll,$oec_cource_to_otherdept2);
                                            }

                                       

                                        if(!empty($ltpalll))
                                        {
                                            $loopn3=count($ltpalll);
                                            
                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";                               
                                            $curriculumdata.="<td style='text-align:center !important;'>".$output."XX"."OXX</td>";
                                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['stream_fullname'])." - ".$roman[$loop_oec]."</td>";

                                            $subjecttypes=$ltpdisp=$ltphrs=$ltpcrdit=$ltpintext_mark=[];
                                            foreach ($ltpalll as $ltpvalue) 
                                            {
                                                if (!in_array($ltpvalue['LTP'], $ltpdisp)) 
                                                {
                                                    $ltpdisp[]=$ltpvalue['LTP'];
                                                    $ltphrs[]=$ltpvalue['contact_hrsperweek'];
                                                    $ltpcrdit[]=$ltpvalue['credit_point'];
                                                    $ltpintext_mark[]=$ltpvalue['intext_mark'];
                                                    $subjecttypes[]=$ltpvalue['subjecttype'];
                                                }
                                            }
                                            // print_r($ltpdisp); exit;
                                            if(!empty($ltpdisp))
                                            {
                                                $ltpdisp=implode("/ ", $ltpdisp);
                                                $ltphrs=implode("/", $ltphrs);
                                                $ltpcrdit=$ltp['credit_point'];
                                                $ltpintext_mark=implode(", ", $ltpintext_mark);
                                                $subjecttypes=implode(", ", $subjecttypes);

                                                 $oltphrs[]=$ltphrs;
                                            }

                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltpdisp."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltphrs."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$ltpcrdit."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltpintext_mark."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subjecttypes."</td>";
                                            
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";

                                             $loop_oec++;

                                        }
                                        else 
                                        { 
                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                       
                                             $curriculumdata.="<td style='text-align:center !important;'>".$output."XXOXX</td>";
                                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['stream_fullname'])." - ".$roman[$loop_oec]."</td>";
                                            
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$electcreditpoint."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                             $loop_oec++;
                                        }

                                        

                                    }

                                    $curriculumdata.="</tr>";


                                    $semcredittot=$semcredittot+$electcreditpoint;
                                    $semhrtot=$semhrtot;
                                    $semextint=$semextint+($ltp['external_mark']+$ltp['internal_mark']);

                                    
                                    //$loop++;
                                    $sl++;
                                }
                               
                            }

                            foreach ($curriculumdataset as $value) 
                            {
                                if($value['type_order']>2 && $value['type_order']<6)
                                {
                                     if($s<=$semend)
                                    {
                                         $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }

                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";
                                    
                                    $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    
                                    $sl++;
                                }
                                   
                                
                            }

                            foreach ($curriculumdataset as $value) 
                            {
                                $output1 = substr($value['subject_code'], 2,5); //exit;
                                
                                if($output1=='MC001')
                                {
                                    if($s<=$semend)
                                    {
                                         $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>MANDATORY COURSE - I: ".strtoupper($value['subject_name'])."</td>";
                                    //$curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' colspan=3> 3 Weeks</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;' colspan=1>-</td>";
                                     $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";
                                     $semextint=$semextint;//+($value['external_mark']+$value['internal_mark']);
                                     $mcloop++;
                                    $sl++;
                                }
                                else if($value['type_order']>=6 && $value['type_order']<=7)
                                {
                                    $output2 = substr($value['subject_code'], 2,2);

                                    if($s<=$semend)
                                    {
                                         $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }
                                    
                                    if($value['subject_type_id']==105 && $output2=='IP')
                                    {
                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;' colspan=2>4 Weeks</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>Internship</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";

                                        $semcredittot=$semcredittot+$value['credit_point'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    $sl++;
                                    }
                                    else
                                    {
                                        if($output2=='MC' && (Yii::$app->request->post('coe_regulation_id')==81))
                                        {
                                            $curriculumdata.="<tr>";
                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>-</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                            $curriculumdata.="</tr>";
                                        }
                                        else
                                        {
                                            $curriculumdata.="<tr>";
                                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";

                                            if($output2=='MC')
                                            {
                                                $curriculumdata.="<td style='text-align:center !important;' width=25%>MANDATORY COURSE - II: ".strtoupper($value['subject_name'])."</td>";
                                            }
                                            else
                                            {
                                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                            }

                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                            $curriculumdata.="</tr>";  
                                        }
                                        
                                        
                                        $semcredittot=$semcredittot+$value['credit_point'];
                                        $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    
                                    
                                        $sl++;
                                    }

                                        
                                    
                                }
                                   
                                
                            }

                            foreach ($streamdata_mc as $value) 
                            {
                                
                                if($value['stream_name']=='MC' && (($s<=2 && Yii::$app->request->post('coe_regulation_id')>88) || ($s==1 && Yii::$app->request->post('coe_regulation_id')==81) || ($s==1 && Yii::$app->request->post('coe_regulation_id')==88)))
                                {
                                    $mcloop++;
                                }
                                else if($value['stream_name']=='MC' && $value[$semstream]==0  && $value[$semstream]!='')
                                {
                                    $mccqey="SELECT count(*) FROM cur_curriculum_subject A JOIN cur_servicesubtodept G  ON G.coe_cur_subid=A.coe_cur_id WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND G.semester=".$s." AND A.subject_type_id='106'";

                                    $ch_mc = Yii::$app->db->createCommand($mccqey)->queryScalar();

                                    if($ch_mc==1)
                                    {
                                        //$mcloop++;
                                    }
                                    else if(Yii::$app->request->post('coe_regulation_id')==81)
                                    {

                                        $ltp = Yii::$app->db->createCommand("SELECT concat(A.L,'-',A.T,'-',A.P) as LTP, A.contact_hrsperweek, concat(A.internal_mark,'/',A.external_mark) as intext_mark, A.internal_mark, A.external_mark, A.subject_type_id,A.credit_point FROM cur_ltp A JOIN cur_curriculum_subject B ON B.coe_ltp_id=A.coe_ltp_id WHERE A.credit_point=0 AND A.L=1 AND A.internal_mark=100 AND A.subject_type_id=106")->queryOne();  

                                        $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar(); 

                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$output."MCXXX</td>";
                                        $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['stream_fullname'])." - ".$roman[$mcloop]."</td>";
                                       
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$ltp['credit_point']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>-</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";
                                       

                                       //  $semcredittot=$semcredittot+$ltp['credit_point'];
                                        $semhrtot=$semhrtot+$ltp['contact_hrsperweek'];
                                        $semextint=$semextint;//+($ltp['external_mark']+$ltp['internal_mark']);

                                        $mcloop++;

                                        $sl++;
                                    }
                                    else
                                    {
                                        $ltp = Yii::$app->db->createCommand("SELECT concat(A.L,'-',A.T,'-',A.P) as LTP, A.contact_hrsperweek, concat(A.internal_mark,'/',A.external_mark) as intext_mark, A.internal_mark, A.external_mark, A.subject_type_id,A.credit_point FROM cur_ltp A JOIN cur_curriculum_subject B ON B.coe_ltp_id=A.coe_ltp_id WHERE A.credit_point=0 AND A.L=1 AND A.internal_mark=100 AND A.subject_type_id=106")->queryOne();  

                                        $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar(); 

                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$output."MCXXX</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['stream_fullname'])." - ".$roman[$mcloop]."</td>";
                                       
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$ltp['credit_point']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";
                                       

                                       //  $semcredittot=$semcredittot+$ltp['credit_point'];
                                        $semhrtot=$semhrtot+$ltp['contact_hrsperweek'];
                                        $semextint=$semextint+($ltp['external_mark']+$ltp['internal_mark']);

                                        $mcloop++;

                                        $sl++;
                                    }
                                }

                                
                            }

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td  align=center  colspan=4 style='text-align:center !important;'><b>Total</b> </td>";

                            $pecsubtot=$oecsubtot=$eecsubtot=0;

                            
                            $arrlop=array();$temparr=array();
                            if(!empty($pltphrs))
                            {   
                               
                                for ($pec=0; $pec<count($pltphrs); $pec++) 
                                { 
                                    $pecsubtot = explode("/",$pltphrs[$pec]);
                                    sort($pecsubtot); 
                                     
                                    for ($tott=0; $tott < count($pecsubtot); $tott++) 
                                    { 
                                        if($pec==0)
                                        {
                                            $arrlop[]=$semhrtot+$pecsubtot[$tott];
                                        }
                                        else
                                        {
                                            $arrlop[$tott]=$arrlop[$tott]+$pecsubtot[$tott];
                                        }
                                                                                 
                                    }
                                  
                                }
                                
                                if($s==6)
                                {
                                  // print_r($arrlop); //exit;
                                }
                            }

                        
                             $temparr=array();
                            if(!empty($oltphrs))
                            {   
                                for ($pec=0; $pec<count($oltphrs); $pec++) 
                                { 
                                    $pecsubtot = explode("/",$oltphrs[$pec]);
                                    sort($pecsubtot); 
                                        //print_r($pecsubtot);
                                    for ($tott=0; $tott < count($pecsubtot); $tott++) 
                                    { 
                                        $temparr[]=$pecsubtot[$tott];                                                   
                                    }
                                  
                                }

                                
                                if(count($arrlop)>0)
                                {
                                    $ann=count($arrlop)-1;
                                    if(count($temparr)>0)
                                    {
                                        $nn=count($temparr)-1;
                                        if(count($arrlop)==1 && count($oltphrs)==1)
                                        {   //echo "string";
                                            $v=$arrlop[0];
                                            $arrlop[0]=$v+$temparr[0];
                                            $arrlop[]=$v+$temparr[$nn];
                                        }
                                        else if(count($arrlop)==1 && count($oltphrs)>1)
                                        {
                                            $v=$arrlop[0];
                                            for ($pec=0; $pec<count($oltphrs); $pec++) 
                                            { 
                                                $pecsubtot = explode("/",$oltphrs[$pec]);
                                                sort($pecsubtot); 
                                                for ($tott=0; $tott < count($pecsubtot); $tott++) 
                                                { 
                                                    if($tott<count($arrlop))
                                                    {
                                                       $arrlop[$tott]=$arrlop[$tott]+$pecsubtot[$tott];
                                                    }
                                                    else
                                                    {
                                                        $arrlop[]=$v+$temparr[$nn];
                                                        
                                                    }
                                                                                             
                                                }
                                              
                                            } 

                                            if($s==6)
                                            {
                                               //print_r($arrlop); exit;
                                            }
                                        }
                                        else
                                        {
                                            $arrlop[0]=$arrlop[0]+$temparr[0];
                                            $arrlop[$ann]=$arrlop[$ann]+$temparr[$nn];
                                        }
                                        
                                    }
                                    else
                                    {
                                        $arrlop[0]=$arrlop[0]+$temparr[0];
                                        $arrlop[$ann]=$arrlop[$ann]+$temparr[0];
                                    }
                                    
                                }
                                else
                                {
                                    for ($pec=0; $pec<count($oltphrs); $pec++) 
                                    { 
                                        $pecsubtot = explode("/",$oltphrs[$pec]);
                                        sort($pecsubtot); 
                                        for ($tott=0; $tott < count($pecsubtot); $tott++) 
                                        { 
                                            if($pec==0)
                                            {
                                                $arrlop[]=$semhrtot+$pecsubtot[$tott];
                                            }
                                            else
                                            {
                                                $arrlop[$tott]=$arrlop[$tott]+$pecsubtot[$tott];
                                            }
                                                                                     
                                        }
                                      
                                    }
                                }

                                if($s==6)
                                {
                                    //echo "hi";
                                    //print_r($arrlop); //exit;
                                }
                               
                            }

                            $temparr=array();
                            if(!empty($eltphrs))
                            {   
                                for ($pec=0; $pec<count($eltphrs); $pec++) 
                                { 
                                    $pecsubtot = explode("/",$eltphrs[$pec]);
                                    sort($pecsubtot); 
                                    for ($tott=0; $tott < count($pecsubtot); $tott++) 
                                    { 
                                        $temparr[]=$pecsubtot[$tott];
                                    }
                                  
                                }

                                if(count($arrlop)>0)
                                {
                                    $ann=count($arrlop)-1;
                                    if(count($temparr)==1 && count($arrlop)==1)
                                    {
                                        $arrlop[0]=$arrlop[0]+$temparr[0];
                                    }
                                    else if(count($temparr)>1)
                                    {
                                        $nn=count($temparr)-1;

                                        if($temparr[0]==$temparr[$nn])
                                        {
                                            $arrlop[0]=$arrlop[0]+$temparr[0]+$temparr[$nn];
                                            $arrlop[$ann]=$arrlop[$ann]+$temparr[$nn]+$temparr[0];
                                        }
                                        else
                                        {
                                            $arrlop[0]=$arrlop[0]+$temparr[0];
                                            $arrlop[$ann]=$arrlop[$ann]+$temparr[$nn];
                                        }
                                        
                                        
                                    }                                 
                                    else
                                    {
                                        $arrlop[0]=$arrlop[0]+$temparr[0];
                                        $arrlop[$ann]=$arrlop[$ann]+$temparr[0];
                                    }
                                    
                                }
                                else
                                {
                                    $arrlop[]=$semhrtot+$temparr[0];
                                }
                            }

                            if(!empty($arrlop))
                            {
                                $n=count($arrlop)-1;
                                if($arrlop[0]!=$arrlop[$n])
                                {
                                    $semhrtot=$arrlop[0]."-".$arrlop[$n];
                                }
                                else
                                {
                                    $semhrtot=$arrlop[0];
                                }
                               
                            }
                            else
                            {
                                $semhrtot=$semhrtot;
                            }


                            if($s==6)
                            {
                                //print_r($arrlop); exit;
                            }

                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$semhrtot."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$semcredittot."</td>";
                            
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$semextint."</td>";
                            $curriculumdata.="<td align=center colspan=2></td>";
                            $curriculumdata.="</tr>";

                            $overallhrtot=$overallhrtot+$semhrtot;
                            $overallextinttot=$overallextinttot+$semextint;
                            $overllcredittot=$overllcredittot+$semcredittot;
                            
                        

                            $curriculumdata.="</table><br>";
                           
                        }
                    }
                   
                    $streamdata = Yii::$app->db->createCommand("SELECT * FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.stream_name IN ('HSMC','BSC','ESC','PCC') ORDER BY B.cur_an_id ASC")->queryAll();
                     $curriculumdata.="<pagebreak>";
                    foreach ($streamdata as $stream) 
                    {
                        $check_stream_credit = Yii::$app->db->createCommand("SELECT total_credit FROM cur_credit_distribution_sem  WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND cur_stream_id='".$stream['cur_stream_id']."'")->queryScalar(); 

                        $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.semester FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='".$stream['stream_name']."' AND F.stream_name!='MC' GROUP BY A.subject_code, F.stream_name")->queryAll();

                         
                         $servicecoursedeptdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,G.semester FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G  ON G.coe_cur_subid=A.coe_cur_id WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='".$stream['stream_name']."' GROUP BY A.subject_code, F.stream_name")->queryAll();

                        if(!empty($servicecoursedeptdata))
                        {
                            $curriculumsemdata=array_merge($curriculumsemdata,$servicecoursedeptdata);
                        }

                        
                        $cqry="SELECT A.coe_cur_id,G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id,G.semester FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_cur_id AND G.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND D.category_type='".$stream['stream_name']."' GROUP BY G.subject_code_new,D.category_type";

                        $corefromotherdeptdata = Yii::$app->db->createCommand($cqry)->queryAll();

                        if(!empty($corefromotherdeptdata))
                        {
                            $curriculumsemdata=array_merge($curriculumsemdata,$corefromotherdeptdata);
                        }


                         $coreservice_fromotherdept= Yii::$app->db->createCommand("SELECT A.coe_elective_id as coe_cur_id, G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,G.semester FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND D.category_type='".$stream['stream_name']."' AND G.coe_elective_option IN (200,202,225) GROUP BY G.subject_code, D.category_type")->queryAll();

                        if(!empty($coreservice_fromotherdept))
                        {
                            $curriculumsemdata=array_merge($curriculumsemdata,$coreservice_fromotherdept);
                        }

                         $coreservice_fromotherdept1= Yii::$app->db->createCommand("SELECT A.coe_elective_id as coe_cur_id, G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,G.semester FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='MBA' AND D.category_type='".$stream['stream_name']."' AND G.coe_elective_option IN (216) GROUP BY G.subject_code, D.category_type")->queryAll();

                        if(!empty($coreservice_fromotherdept1))
                        {
                            $curriculumsemdata=array_merge($curriculumsemdata,$coreservice_fromotherdept1);
                        }

                        array_multisort(array_column($curriculumsemdata, 'semester'),  SORT_ASC, $curriculumsemdata);
                       
                        if(!empty($curriculumsemdata))
                        {
                            $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> ".$stream['stream_fullname']." (".$stream['stream_name'].")  Credit (".$check_stream_credit.")</th>";
                            $curriculumdata.="</tr>";

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                            $curriculumdata.="</tr>";

                            $sl=1; $semcredittot=0;
                            foreach ($curriculumsemdata as $value) 
                            {
                               
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="</tr>";
                                
                                   

                                $semcredittot=$semcredittot+$value['credit_point'];
                                //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                //$semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                $sl++;
                            }

                            if($semcredittot!=$check_stream_credit)
                            {
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>".$stream['stream_name']." Credit Mismatch (Current Credit Total: ".$semcredittot.")</b> </td></tr>";
                            }
                            

                            $curriculumdata.="</table><br>";
                        }
                    }

                    //pec start

                    $vertical_stream1 = Yii::$app->db->createCommand("SELECT A.* FROM cur_vertical_stream A JOIN cur_elective_subject B ON B.cur_vs_id=A.cur_vs_id WHERE B.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option IN ('192') AND service_paper=0 GROUP BY B.cur_vs_id ORDER BY B.cur_vs_id ASC")->queryAll();

                    $vertical_stream_from_otherdept = Yii::$app->db->createCommand("SELECT G.* FROM cur_vertical_stream G JOIN cur_electivetodept C ON C.cur_vs_id=G.cur_vs_id WHERE C.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND C.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND C.degree_type='".Yii::$app->request->post('degree_type')."' AND C.coe_elective_option IN ('192') GROUP BY C.cur_vs_id ORDER BY G.cur_vs_id ASC")->queryAll();

                    if(!empty($vertical_stream_from_otherdept))
                    {
                        $vertical_stream1=array_merge($vertical_stream1,$vertical_stream_from_otherdept);
                    }

                    $vertical_stream = array();

                      foreach($vertical_stream1 as $clm) {
                        $niddle = $clm['cur_vs_id'];
                        if(array_key_exists($niddle, $vertical_stream)) continue;
                        $vertical_stream[$niddle] = $clm;
                      }

                    //print_r($vertical_stream); exit();
                    if(!empty($vertical_stream))
                    {
                        //$curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> PROFESSIONAL ELECTIVE COURSES (PEC) </th>";
                        $curriculumdata.="</tr>";

                        
                        foreach ($vertical_stream as $stream) 
                        {
                            $pec_count = Yii::$app->db->createCommand("SELECT vertical_count FROM cur_vertical_stream A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND vertical_type=206 AND A.cur_vs_id=".$stream['cur_vs_id'])->queryScalar();

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> ".$stream['vertical_name']." </th>";
                            $curriculumdata.="</tr>";

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                            $curriculumdata.="</tr>";

                            $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_vertical_stream F ON F.cur_vs_id=A.cur_vs_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.cur_vs_id='".$stream['cur_vs_id']."' GROUP BY A.subject_code, F.cur_vs_id")->queryAll();

                            $sl=1; $electcount=0;
                            foreach ($curriculumsemdata as $value) 
                            {
                                
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                $curriculumdata.="</tr>";
                               
                                $electcount=$electcount+1;
                                $sl++;
                            }

                            $pec_from_otherdept1 = Yii::$app->db->createCommand("SELECT C.subject_code, C.subject_code_new FROM cur_elective_subject G JOIN cur_electivetodept C ON C.coe_subject_id=G.coe_elective_id AND C.subject_code=G.subject_code JOIN cur_vertical_stream A ON A.cur_vs_id=C.cur_vs_id WHERE C.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND C.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND C.degree_type='".Yii::$app->request->post('degree_type')."' AND C.coe_elective_option IN ('192') AND C.cur_vs_id='".$stream['cur_vs_id']."' GROUP BY C.subject_code_new, C.cur_vs_id")->queryAll();

                            $pec_from_otherdept2 = Yii::$app->db->createCommand("SELECT C.subject_code, C.subject_code_new FROM cur_curriculum_subject G JOIN cur_electivetodept C ON C.coe_subject_id=G.coe_cur_id AND C.subject_code=G.subject_code JOIN cur_vertical_stream A ON A.cur_vs_id=C.cur_vs_id  WHERE C.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND C.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND C.degree_type='".Yii::$app->request->post('degree_type')."' AND C.coe_elective_option IN ('192') AND C.cur_vs_id='".$stream['cur_vs_id']."' GROUP BY C.subject_code_new, C.cur_vs_id")->queryAll();

                            if(!empty($pec_from_otherdept2))
                            {
                                
                                $pec_from_otherdept1=array_merge($pec_from_otherdept1,$pec_from_otherdept2);
                            }

                            
                            foreach ($pec_from_otherdept1 as $value) 
                            {
                                $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();

                                if(empty($cource_infor))
                                {
                                     $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();
                                }

                                if(!empty($cource_infor))
                                {

                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code_new']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($cource_infor['subject_name'])."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['credit_point']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjecttype']."</td>";
                                    $curriculumdata.="</tr>";
                                   
                                    $electcount=$electcount+1;
                                    $sl++;
                                }
                            }

                            if($electcount!=$pec_count)
                            {
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>PEC Count Mismatch (Created Count: ".$pec_count.", Current Count Total: ".$electcount.")</b> </td></tr>";
                            }  

                        }

                          

                        $curriculumdata.="</table><br>";

                    }          

                    $eec_count = Yii::$app->db->createCommand("SELECT elective_count FROM cur_elective_count  WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND elective_type='193'")->queryScalar();

                    $eec_data = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.coe_elective_option IN ('193') AND A.service_paper=0 GROUP BY A.subject_code")->queryAll();
                    $electcount=0;
                    if(!empty($eec_data))
                    {
                        //$curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> EMERGING ELECTIVE COURSES (EEC) </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; 
                        foreach ($eec_data as $value) 
                        {
                            
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['credit_point']."</td>";
                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                            $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="</tr>";
                           
                            $electcount=$electcount+1;
                             $sl++;
                        }

                       
                    }
                    
                    $eec_from_otherdept = Yii::$app->db->createCommand("SELECT G.subject_code, G.subject_code_new FROM cur_electivetodept G WHERE G.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND G.coe_elective_option IN ('193') GROUP BY G.subject_code_new")->queryAll();
                    
                    if(empty($eec_data))
                    {

                        //$curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> EMERGING ELECTIVE COURSES (EEC) </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; 
                        foreach ($eec_from_otherdept as $value) 
                        {
                             $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();

                            if(empty($cource_infor))
                            {
                                 $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();
                            }

                            if(!empty($cource_infor))
                            {

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code_new']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($cource_infor['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['LTP']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['credit_point']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjecttype']."</td>";
                                $curriculumdata.="</tr>";
                               
                                $electcount=$electcount+1;
                                $semcredittot=$semcredittot+$cource_infor['credit_point'];
                                $semhrtot=$semhrtot+$cource_infor['contact_hrsperweek'];
                                $semextint=$semextint+($cource_infor['external_mark']+$cource_infor['internal_mark']);
                                $sl++;
                            }
                        }

                         if($electcount!=$eec_count)
                        {
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>EEC Count Mismatch (Current Count Total: ".$electcount.")</b> </td></tr>";
                        }

                        $curriculumdata.="</table><br>";
                    }    
                    else if(!empty($eec_from_otherdept))
                    {
                       
                        foreach ($eec_from_otherdept as $value) 
                        {
                             $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();

                            if(empty($cource_infor))
                            {
                                 $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();
                            }

                            if(!empty($cource_infor))
                            {

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code_new']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($cource_infor['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['LTP']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['credit_point']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjecttype']."</td>";
                                $curriculumdata.="</tr>";
                               
                                $electcount=$electcount+1;
                                $semcredittot=$semcredittot+$cource_infor['credit_point'];
                                $semhrtot=$semhrtot+$cource_infor['contact_hrsperweek'];
                                $semextint=$semextint+($cource_infor['external_mark']+$cource_infor['internal_mark']);
                                $sl++;
                            }
                        }


                         if($electcount!=$eec_count)
                        {
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>EEC Count Mismatch (Current Count Total: ".$electcount.")</b> </td></tr>";
                        }

                        $curriculumdata.="</table><br>";
                    }
                    else
                    {


                        if($electcount!=$eec_count)
                        {
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>EEC Count Mismatch (Current Count Total: ".$electcount.")</b> </td></tr>";
                        }

                        $curriculumdata.="</table><br>";
                    }

                    $pwc_courses = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='PWC' GROUP BY A.subject_code, A.semester")->queryAll();
                    //print_r($pwc_courses[0]['stream_id']); exit();
                    if(!empty($pwc_courses))
                    {
                        //$curriculumdata='';

                        $ssqry="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G  ON G.coe_cur_subid=A.coe_cur_id WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='PWC' GROUP BY A.subject_code, G.semester";

                        $servicecoursedeptdata = Yii::$app->db->createCommand($ssqry)->queryAll();

                        if(!empty($servicecoursedeptdata))
                        {
                            $pwc_courses=array_merge($pwc_courses,$servicecoursedeptdata);
                        }

                        //print_r($pwc_courses); exit;

                        $check_stream_credit = Yii::$app->db->createCommand("SELECT total_credit FROM cur_credit_distribution_sem  WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND cur_stream_id='".$pwc_courses[0]['stream_id']."'")->queryScalar(); //exit;

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> PROJECT WORK COURSES (PWC)  Credit (".$check_stream_credit.")</th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; $semcredittot=0;
                        foreach ($pwc_courses as $value) 
                        {
                            if($value['subject_type_id']==105)
                            {
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' colspan=2>4 Weeks</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>Internship</td>";
                                $curriculumdata.="</tr>";
                            }
                            else
                            {
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                $curriculumdata.="</tr>";
                            }
                               

                            $semcredittot=$semcredittot+$value['credit_point'];
                            //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                            //$semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                            $sl++;
                        }

                        if($semcredittot!=$check_stream_credit)
                        {
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>PWC Credit Mismatch (Current Credit Total: ".$semcredittot.")</b> </td></tr>";
                        }

                        $curriculumdata.="</table><br>";
                    }

                    $mcqry="SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,A.internal_mark,A.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='MC' GROUP BY A.subject_code";
                    $mc_courses = Yii::$app->db->createCommand($mcqry)->queryAll();

                    if(!empty($mc_courses))
                    {
                        //$curriculumdata='';
                        //$curriculumdata.= '<pagebreak>';
                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=7 style='text-align:center !important;'> MANDATORY COURSES (MC) (Non-Credits)</th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1;
                        foreach ($mc_courses as $value) 
                        {
                            $output = substr($value['subject_code'], 2,5); //exit;
                                if($output=='MC001')
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' colspan=2> 3 Weeks</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;' colspan=1>-</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="</tr>";
                                }
                                else if($value['internal_mark']=='100')
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                   
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                
                                     $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                   
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="</tr>";
                                }
                                else
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                   
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    
                                    $curriculumdata.="<td style='text-align:center !important;' colspan=1>-</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="</tr>";
                                }
                                                 
                            $sl++;
                        }

                        $curriculumdata.="</table><br>";
                    }

                    

                    $oec_cource_to_otherdept = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.coe_elective_option IN ('191') GROUP BY A.subject_code")->queryAll();

                    $oec_cource_to_otherdept1 = Yii::$app->db->createCommand("SELECT ED.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept ED ON ED.subject_code=A.subject_code WHERE ED.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND ED.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND ED.degree_type='".Yii::$app->request->post('degree_type')."' AND ED.coe_elective_option IN ('191') GROUP BY ED.subject_code")->queryAll();

                    $oec_cource_to_otherdept2 = Yii::$app->db->createCommand("SELECT ED.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept ED ON ED.subject_code=A.subject_code WHERE ED.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND ED.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND ED.degree_type='".Yii::$app->request->post('degree_type')."' AND ED.coe_elective_option IN ('191') AND service_paper=0 GROUP BY A.subject_code")->queryAll();

                    if(!empty($oec_cource_to_otherdept1))
                    {
                        $oec_cource_to_otherdept=array_merge($oec_cource_to_otherdept,$oec_cource_to_otherdept1);
                    }

                    if(!empty($oec_cource_to_otherdept2))
                    {
                        $oec_cource_to_otherdept=array_merge($oec_cource_to_otherdept,$oec_cource_to_otherdept2);
                    }

                    $oecelctcount=0;
                    if(!empty($oec_cource_to_otherdept))
                    {
                        //$curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> OPEN ELECTIVE COURSES (OEC) TO OTHER DEPT. </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; 
                        foreach ($oec_cource_to_otherdept as $value) 
                        {
                            
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="</tr>";
                            $oecelctcount=$oecelctcount+1;
                            $sl++;
                        }

                        $oec_count = Yii::$app->db->createCommand("SELECT elective_count FROM cur_elective_count  WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND elective_type='191'")->queryScalar();
                        
                       if($oecelctcount!=$oec_count)
                        {
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>OEC Count Mismatch (Current Count Total: ".$oecelctcount.")</b> </td></tr>";
                        }

                        $curriculumdata.="</table><br>";
                    }

                   

                    $oec_from_otherdept1 = Yii::$app->db->createCommand("SELECT G.subject_code, G.subject_code as subject_code_new FROM cur_elective_subject G WHERE  G.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND G.coe_elective_option IN (191) GROUP BY G.subject_code ORDER BY G.coe_dept_id")->queryAll();

                    $oec_from_otherdept2 = Yii::$app->db->createCommand("SELECT A.subject_code, G.subject_code_new FROM cur_curriculum_subject A JOIN cur_electivetodept G ON G.subject_code=A.subject_code  WHERE  G.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_dept_ids='0' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND G.coe_elective_option IN (191)  AND A.subject_code NOT IN (SELECT subject_code FROM cur_electivetodept WHERE coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."') ORDER BY G.coe_dept_id")->queryAll();

                    if(!empty($oec_from_otherdept2))
                    {
                        $oec_from_otherdept1=array_merge($oec_from_otherdept1,$oec_from_otherdept2);
                    }

                    $oec_from_otherdept3 = Yii::$app->db->createCommand("SELECT A.subject_code, G.subject_code_new FROM cur_elective_subject A JOIN cur_electivetodept G ON G.subject_code=A.subject_code  WHERE  G.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND  G.coe_dept_ids='0' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND G.coe_elective_option IN (191) ORDER BY G.coe_dept_id")->queryAll();

                    if(!empty($oec_from_otherdept3))
                    {
                        $oec_from_otherdept1=array_merge($oec_from_otherdept1,$oec_from_otherdept3);
                    }

                  
                    if(!empty($oec_from_otherdept1))
                    {
                        //$curriculumdata.='<pagebreak>';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> OPEN ELECTIVE COURSES (OEC) FROM OTHER DEPT. </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; 
                        foreach ($oec_from_otherdept1 as $value) 
                        {
                            $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();

                            if(empty($cource_infor))
                            {
                                $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();
                            }


                            if(!empty($cource_infor))
                            {

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code_new']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($cource_infor['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['LTP']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['credit_point']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjecttype']."</td>";                        
                                $curriculumdata.="</tr>";
                               

                                $semcredittot=$semcredittot+$cource_infor['credit_point'];
                                $semhrtot=$semhrtot+$cource_infor['contact_hrsperweek'];
                                $semextint=$semextint+($cource_infor['external_mark']+$cource_infor['internal_mark']);
                                $sl++;
                            }
                        }

                        $curriculumdata.="</table><br>";
                    }

                    $service_to_otherdept = Yii::$app->db->createCommand("SELECT G.subject_code, G.subject_code_new, G.coe_dept_ids FROM cur_electivetodept G JOIN cur_elective_subject C ON C.subject_code=G.subject_code WHERE C.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND C.coe_elective_option IN (200,202) GROUP BY G.subject_code_new")->queryAll();

                    $service_to_otherdept1 = Yii::$app->db->createCommand("SELECT G.subject_code, G.subject_code_new, G.coe_dept_ids FROM cur_electivetodept G JOIN cur_curriculum_subject C ON C.subject_code=G.subject_code WHERE G.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND G.coe_elective_option IN (200,202) GROUP BY G.subject_code_new")->queryAll();

                     $service_to_otherdept2 = Yii::$app->db->createCommand("SELECT G.subject_code, G.subject_code_new, G.coe_dept_ids FROM cur_electivetodept G JOIN cur_elective_subject C ON C.subject_code=G.subject_code WHERE C.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND C.coe_elective_option IN (191,192,193) AND service_paper=1 GROUP BY G.subject_code_new")->queryAll();

                        if(!empty($service_to_otherdept1))
                        {
                            $service_to_otherdept=array_merge($service_to_otherdept,$service_to_otherdept1);
                        }

                         if(!empty($service_to_otherdept2))
                        {
                            $service_to_otherdept=array_merge($service_to_otherdept,$service_to_otherdept2);
                        }

                    //print_r($service_to_otherdept); exit();
                    if(!empty($service_to_otherdept))
                    {
                        //$curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=9 style='text-align:center !important;'> SERVICE COURSES TO OTHER DEPT. </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; 
                        foreach ($service_to_otherdept as $value) 
                        {
                            $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as stream_name, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=A.coe_elective_option WHERE A.subject_code='".$value['subject_code']."'")->queryOne();

                            if(empty($cource_infor))
                            {
                                $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, F.stream_name, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();
                            }

                            if(!empty($cource_infor))
                            {

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code_new']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($cource_infor['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['LTP']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['credit_point']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjecttype']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['stream_name']."</td>";
                                $curriculumdata.="</tr>";
                               

                                $semcredittot=$semcredittot+$cource_infor['credit_point'];
                                $semhrtot=$semhrtot+$cource_infor['contact_hrsperweek'];
                                $semextint=$semextint+($cource_infor['external_mark']+$cource_infor['internal_mark']);
                                $sl++;
                            }
                        }

                        $curriculumdata.="</table><br>";
                    }

                    $service_countdata = Yii::$app->db->createCommand("SELECT * FROM cur_service_count_details C JOIN cur_department B ON B.coe_dept_id=C.coe_dept_id WHERE C.to_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND C.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND C.degree_type='".Yii::$app->request->post('degree_type')."'")->queryAll();
                     $servicematch='';
                    if(!empty($service_countdata))
                    {   
                        $streamdata=explode(",",$service_countdata[0]['service_type']);
                        //$curriculumdata='';
                        $servicematch.='<pagebreak>';
                        $servicematch.="<table width=100% border=1 style='color:#F00; text-align:center !important;'>";
                        $servicematch.="<tr>";
                        $servicematch.="<th align=center colspan=14 style='text-align:center !important;'>Service Course to Other Dept. Count Check</th>";
                         $servicematch.="</tr>";
                         $servicematch.="<tr>
                         <th align=center rowspan=2 style='text-align:center !important;'>Dept. / Stream</th>";
                        
                        for ($i=0; $i <count($streamdata) ; $i++)                    
                        {
                            $servicematch.="<th colspan=2 align=center style='text-align:center !important;'>".$streamdata[$i]."</th>";
                        }
                        $servicematch.="</tr>";
                        $servicematch.="<tr>";
                        for ($i=0; $i <count($streamdata) ; $i++)                    
                        {
                            $servicematch.="<th align=center style='text-align:center !important;'>Count</th>";
                            $servicematch.="<th align=center style='text-align:center !important;'>Assigned</th>";
                        }

                        $servicematch.="</tr>";

                        foreach ($service_countdata as $value) 
                        {
                            $service_type=explode(",",$value['service_type']);
                            $service_count=explode(",",$value['service_count']);

                            $servicematch.=" <tr>
                            <td  style='text-align: center;'>".$value['dept_code']."</td>";

                            for ($i=0; $i <count($service_type) ; $i++) 
                            { 
                              
                                $checkcount = Yii::$app->db->createCommand("SELECT count(G.coe_dept_ids) FROM cur_electivetodept G JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids= '".$value['coe_dept_id']."' AND  G.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND D.category_id=27 AND D.description='".$service_type[$i]."'")->queryScalar();

                                $servicematch.="<td  style='text-align: center;'>".($service_count[$i])."</td>";
                                $servicematch.="<td  style='text-align: center;'>".$checkcount."</td>";
                                
                                if(($service_count[$i]-$checkcount)!=0)
                                {
                                    $checkservicematch=$checkservicematch+1;
                                }
                            }

                             $servicematch.="</tr>";
                        }

                        $servicematch.="</table>";
                    }

                    if($checkservicematch>0)
                    {
                        $curriculumdata.= $servicematch;
                    }

                    $minordegreecourse = Yii::$app->db->createCommand("SELECT * FROM cur_vertical_stream A JOIN cur_elective_subject B ON B.cur_vs_id=A.cur_vs_id WHERE B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')."  AND B.coe_elective_option IN ('203') GROUP BY A.vertical_name ORDER BY A.cur_vs_id ASC")->queryAll(); //AND B.degree_type='".Yii::$app->request->post('degree_type')."'

                    //print_r($minordegreecourse); exit;
                    if(!empty($minordegreecourse))
                    {
                       //$curriculumdata='';
                        //$curriculumdata.='<pagebreak>';
                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> MINOR DEGREE COURSES </th>";
                        $curriculumdata.="</tr>";

                        $tempname=''; $streamname='';
                        foreach ($minordegreecourse as $stream) 
                        {
                            $minor_count = Yii::$app->db->createCommand("SELECT sum(vertical_count) FROM cur_vertical_stream  WHERE vertical_name='".$stream['vertical_name']."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."'")->queryScalar();

                            if($tempname!=$stream['vertical_name'])
                            {
                                
                                $streamname=$stream['vertical_name'];

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> ".$stream['vertical_name']." </th>";
                                $curriculumdata.="</tr>";

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                                $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                                $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                                $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                                $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                                $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                                $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                                $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                                $curriculumdata.="</tr>";
                                 $sl=1;
                            }
                            
                            $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_vertical_stream F ON F.cur_vs_id=A.cur_vs_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND F.vertical_name='".$stream['vertical_name']."' GROUP BY A.subject_code, F.cur_vs_id")->queryAll(); // AND A.degree_type='".Yii::$app->request->post('degree_type')."' 

                            $electcount=0;
                            foreach ($curriculumsemdata as $value) 
                            {
                                
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;' width=25%>".strtoupper($value['subject_name'])."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                $curriculumdata.="</tr>";
                               
                                $electcount=$electcount+1;
                                $sl++;
                            }

                            if($electcount!=$minor_count)
                            {
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>".$streamname." Count Mismatch (Current Count Total: ".$electcount.")</b> </td></tr>";
                            }

                        $tempname=$stream['vertical_name'];
                        }

                        $curriculumdata.="</table>";

                    }


                    $curi_streamdata=Yii::$app->db->createCommand("SELECT A.*,B.stream_fullname,A.aicte_norms FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' ORDER BY B.cur_an_id ASC ")->queryAll();

                    $curi_stream='';

                    if(!empty($curi_streamdata))
                    {
                        $curi_stream.= '<pagebreak>';
                         $curi_stream.= '<div align=center> <b>CREDIT DISTRIBUTION – SUMMARY</b><br><br></div>';
                         $curi_stream.= '<table class="table table-responsive table-hover" width=100% border=1>
                         <thead>
                            <tr>
                                <th  align=center style="text-align: center;">S.No.</th>
                                <th  align=center style="text-align: center;">Stream</th>';
                            for ($i=1; $i <=8 ; $i++) 
                            { 
                                 $curi_stream.= '<th  style="text-align: center;">Sem '.$i.'</th>';
                           }
                             $curi_stream.= ' <th  align=center style="text-align: center;">Total Credit</th>
                                
                            </tr>
                        </thead><tbody>';

                        $sl=1; $total_credit= $total_aicte_norms=0;
                        foreach ($curi_streamdata as $value) 
                        {
                            $curi_stream.= '<tr>
                            <td  align=center style="text-align: center;">'.$sl.'</td>
                            <td  align=center style="text-align: center;">'. $value['stream_fullname'].'</td>';
                            
                            for ($s=1; $s <=8 ; $s++) 
                            { 
                                $name="sem".$s;
                                $values=$value[$name];
                            
                                $curi_stream.= '<td  align=center style="text-align: center;">'. $values.'</td>';
                            }
                            $curi_stream.= '<td  align=center style="text-align: center;">'. $value['total_credit'].'</td>
                           
                            </tr>';
                        
                            $total_aicte_norms=$total_aicte_norms+$value['aicte_norms'];
                            $total_credit=$total_credit+$value['total_credit'];
                             $sl++;
                        }

                        $curi_stream.='<tr>
                            <td align=center colspan="2" align="right"><b>Total</b></td>';
                            
                            for ($s=1; $s <=8 ; $s++) 
                            { 
                                $semtot=0;
                                $name="sem".$s;
                                foreach ($curi_streamdata as $value) 
                                {
                                    $semtot=$semtot+$value[$name];
                                }
                            $curi_stream.='<td align=center style="text-align: center;">'. $semtot.'</td>';
                            }
                            $curi_stream.='<td align=center style="text-align: center;">'. $total_credit.'</td>
                            
                            </tr>';

                         $curi_stream.='</table>';
                    }

                    $curriculumdata=$curriculumdata.$curi_stream;    
                
                }   

                //cdc end
                
                //syllabus start

                $curriculumdata.='<pagebreak>';
                $curriculumdata.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>SYLLABUS</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $curriculumdata.='<pagebreak>';
                
                //print_r($coresubjects); exit();
                // $curriculumdata='';
                $dupplicate=$tempsem=0; $matrixavg=''; 
                for ($ei=0; $ei <count($coresubjects) ; $ei++) 
                { 
                    if($tempsem!=$coresubjects[$ei]['sem'])
                    {
                        $curriculumdata.='<table class="table oectable" width="100%">
                                            <tr>
                                                <td>
                                                    <h2><b>SEMESTER '.$roman[$coresubjects[$ei]['sem']].'</b></h2>
                                                </td>
                                            <tr>
                                            </table>';
                        $curriculumdata.='<pagebreak>';
                    }

                    $subjectscodes=Yii::$app->db->createCommand("SELECT subject_code FROM cur_electivetodept WHERE semester='".$coresubjects[$ei]['sem']."' AND subject_code_new='".$coresubjects[$ei]['subject_code']."' AND coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."'")->queryScalar();
                    if(!empty($subjectscodes))
                    {
                        $subjectscode=$subjectscodes;
                    }
                    else
                    {
                       $subjectscode=$coresubjects[$ei]['subject_code']; 
                    }
                    
                    if(!empty($subjectscode))
                    {
                        $html='';

                       
                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$subjectscode."' AND B.subject_type_id!=106")->queryOne();        
                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                        $ltot=0;
                        $ttot=0;
                        $ptot=0;
                        if(empty($codatalist))
                        {
                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$subjectscode."' AND B.subject_type_id!=106")->queryOne();

                            if(empty($codatalist))
                            {
                               
                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,ED.subject_code_new as subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, ED.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_electivetodept ED ON ED.subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=ED.subject_code JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE ED.subject_code_new='".$subjectscode."' AND B.subject_type_id!=106")->queryOne();

                                if(empty($codatalist)) // regulation existing syllabus
                                {
                                   
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code
                                        JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$subjectscode."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                    
                                    if(empty($codatalist)) // regulation existing syllabus
                                    {     
                                        $qq = "SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code
                                            JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$subjectscode."' AND SE.mapping_type=1 AND B.subject_type_id!=106";

                                        $codatalist = Yii::$app->db->createCommand($qq)->queryOne();
                                        
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                    else
                                    {
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {
                                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                            }
                            else
                            {
                                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                $ltot=($codatalist['L'])*15;
                                $ttot=($codatalist['T'])*15;
                                $ptot=($codatalist['P'])*15;
                            }
                        }
                        else
                        {
                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;
                        }
                        
                        if(!empty($codatalist)) 
                        {
                            $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                            $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                            
                            $com=1;   
                            if(empty($co_matrix))
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                $com=2;
                            }

                            $course_categorytype='';
                            

                            if($codatalist['subject_category_type_id']=='140') //type1
                            {

                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='141') //type 2
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='142') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                            } 
                            else if($codatalist['subject_category_type_id']=='144') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                            }    
                            else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                            } 
                            else 
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                            }  

                            $mappedsubject = Yii::$app->db->createCommand("SELECT B.subject_code,B.subject_name FROM  cur_curriculum_subject B JOIN cur_syllabus_existing C ON C.to_subject_code=B.subject_code WHERE B.subject_code='".$subjectscode."'")->queryOne();
                            
                            if(empty($mappedsubject))
                            {
                                $mappedsubject = Yii::$app->db->createCommand("SELECT B.subject_code,B.subject_name FROM  cur_elective_subject B JOIN cur_syllabus_existing C ON C.to_subject_code=B.subject_code WHERE B.subject_code='".$subjectscode."'")->queryOne();
                            }
                            

                            $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE A.subject_code='".$codatalist["subject_code"]."' AND A.subject_code_new!='".$codatalist["subject_code"]."'")->queryOne();               
                            
                            $sysubject_name=$sysubject_code='';
                            if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                            {                               

                                if(!empty($mappedsubject))
                                {
                                    $sysubject_code=$samesubjectcode['subject_code_new']."/ ".$samesubjectcode['subject_code'];
                                    $sysubject_name=$mappedsubject["subject_name"];
                                }
                                else
                                {
                                    $sysubject_code=$samesubjectcode['subject_code_new']."/ ".$samesubjectcode['subject_code'];
                                    $sysubject_name=$codatalist["subject_name"];
                                }
                            }
                            else
                            {
                                if(!empty($mappedsubject))
                                {
                                    $sysubject_code=$mappedsubject["subject_code"];
                                    $sysubject_name=$mappedsubject["subject_name"];
                                }
                                else
                                {
                                    $sysubject_code=$codatalist["subject_code"];
                                    $sysubject_name=$codatalist["subject_name"];
                                }
                                
                            }

                            $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];

                            $html.='<table class="table" width="100%">
                                <tr>
                                    <td width="15%">
                                        <b>'.$sysubject_code.'</b>
                                    </td>
                                    <td width="70%" colspan="2" align=center>';
                            
                                    $html.='<b>'.strtoupper($sysubject_name).'</b>';
                                        
                                 $html.='    </td>
                                    <td width="15%" align=center>
                                        <b>'.$codatalist["ltp"].'/'.$codatalist["credit_point"].'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <b>Pre-requisite(s):'.($prerequisties).'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Course Objectives:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_objectives'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                

                               $html.=' <tr>
                                    <td colspan="4">
                                        <b>Course Outcomes:<br>
                                        Upon completion of the course, students shall have ability to
                                        </b>

                                    </td>
                                </tr>';

                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_outcomes'.$l;
                                        $rpt='rpt'.$l;
                                        if($codatalist[$cot]!='')
                                        {
                                            $rptdta ='';
                                            if($codatalist[$rpt]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                            }

                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>CO'.$l.'</td>';
                                            $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                            $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                            
                                $html.=' </table><table class="table" width="100%">';
                               
                                 
                                if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                {
                                     $html.='   <tr>
                                        <td colspan="4">
                                            <b>Course Content:</b>
                                        </td>
                                    </tr>';
                                    for($l=1;$l<=3;$l++)
                                    {
                                        $module_title='module_title'.$l;
                                        $module_hr='module_hr'.$l;
                                        $module_content='cource_content_mod'.$l;
                                        if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                        {

                                            $html.='<tr>';
                                            $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                            $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                            $html.='</tr>';

                                            $html.='<tr>';
                                            $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                            $html.='</tr>';

                                           
                                        }
                                    }
                                }

                                if($ltot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(L):</b>
                                        </td>
                                        <td>
                                            <b>'.$ltot.'</b>
                                        </td>
                                    </tr>';
                                }

                                if($ttot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(T):</b>
                                        </td>
                                        <td>
                                            <b>'.$ttot.'</b>
                                        </td>
                                    </tr>';

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(LT):</b>
                                            </td>
                                            <td>
                                                <b>'.($ttot+$ltot).'</b>
                                            </td>
                                        </tr>';
                                    }
                                }
                                
                                if(!empty($colablist)) 
                                {

                                  $html.='   <tr>
                                        <th colspan="4">
                                            <b>Lab Components:</b>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>List of Experiments</th>
                                        <th>CO Mapping</th>
                                        <th>RBT</th>
                                    </tr>';

                                    $s=1;
                                    foreach ($colablist as $value1) 
                                    {
                                        $cout=ltrim($value1['cource_outcome'],",");
                                        $html.='<tr>';
                                        $html.='<td width=10% align=center>'.$s.'</td>';
                                        $html.='<td width=60%>'.$value1['experiment_title'].'</td>';
                                        $html.='<td width=15% align=center>'.$cout.'</td>';
                                        $html.='<td width=15% align=center>'.$value1['rpt'].'</td>';
                                        $html.='</tr>';
                                        $s++;
                                    }

                                     $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(P):</b>
                                        </td>
                                        <td>
                                            <b>'.$ptot.'</b>
                                        </td>
                                    </tr>';
                                }
                               
                                $html.=' <tr>
                                    <td colspan="4">
                                        <b>Text Books:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=4;$l++)
                                    {
                                        $cot='text_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                
                               
                                 $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Books:</b>
                                    </td>
                                </tr>';
                               
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='reference_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               
                               
                                if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                {
                                      $html.='  <tr>
                                            <td colspan="4">
                                                <b>Web References:</b>
                                            </td>
                                        </tr>';

                                    for($l=1;$l<=3;$l++)
                                    {
                                        $cot='web_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               

                                $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                //print_r($online_reference1); exit();
                                if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                {
                                    
                                     $html.=' <tr>
                                        <td colspan="4">
                                            <b>Online References:</b>
                                        </td>
                                    </tr>';

                                    for($l=1;$l<=2;$l++)
                                    {
                                        $cot='online_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }                    
                                 $html.=' </table> ';
                                if(!empty($co_matrix))
                                {
                                    $psoavg_1= $psoavg_2= $psoavg_3=array();
                                    
                                    //print_r($co_matrix); exit();
                                    $colspan=$co_matrix[0]['pso_count'];

                                    $html.=' 

                                    <table border="1" width="100%">
                                    <tr>
                                        <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                         <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                          <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                    </tr>
                           
                                    <tr>';
                                    
                                    for ($i=1; $i <=12 ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    } 
                                    for ($i=1; $i <=$colspan ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    }
                                    $html.= "</tr>";

                                    if(!empty($co_matrix))
                                    {
                                        foreach ($co_matrix as $value2) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $po='po'.$i;
                                                if($value2[$po]==0)
                                                {
                                                    $html.='<td style="text-align: center;">-</td>';
                                                }
                                                else
                                                {
                                                    $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                }
                                            }

                                            $pso_value=explode(",", $value2['pso_value']);
                                            for ($p=0; $p <$colspan ; $p++) 
                                            { 
                                                if($pso_value[$p]==0)
                                                {
                                                    $html.='<td style="text-align: center;">-</td>';
                                                }
                                                else
                                                {
                                                     $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                }
                                               

                                                if($p==0)
                                                {
                                                    $psoavg_1[]=$pso_value[$p];
                                                }
                                                if($p==1)
                                                {
                                                    $psoavg_2[]=$pso_value[$p];
                                                }
                                                if($p==2)
                                                {
                                                    $psoavg_3[]=$pso_value[$p];
                                                }
                                            }
                                            
                                            $html.='</tr>';

                                        }
                                    }

                                    $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';

                                    if($tempsem!=$coresubjects[$ei]['sem'])
                                    {
                                        if($tempsem>0)
                                        {
                                            $matrixavg.= "</table><br>";
                                        }
                                        $colspans=$colspan+14;
                                        $matrixavg.='<table class="table" width="100%">
                                                    <tr>
                                                        <th colspan="'.$colspans.'" >SEMESTER '.$roman[$coresubjects[$ei]['sem']].'
                                                        </th>
                                                    <tr>';
                                        $matrixavg.='
                                        <tr>
                                            <th rowspan="2" width="10%" style="text-align: center;">COURSE CODE </th>
                                            <th rowspan="2" width="30%" style="text-align: center;">COURSE NAME </th>
                                             <th colspan="12" width="50%" style="text-align: center;">PO</th>
                                              <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                        </tr>
                               
                                        <tr>';

                                        for ($i=1; $i <=12 ; $i++) 
                                        { 
                                            $matrixavg.= "<th style='text-align: center;'>".$i."</th>";
                                        } 
                                        for ($i=1; $i <=$colspan ; $i++) 
                                        { 
                                            $matrixavg.= "<th style='text-align: center;'>".$i."</th>";
                                        }
                                        $matrixavg.= "</tr>";
                                    }
                                    
                                        
                                   
                                    $co_matrixavg = Yii::$app->db->createCommand("SELECT sum(po1)/count(po1) as po1avg, sum(po2)/count(po2) as po2avg, sum(po3)/count(po3) as po3avg, sum(po4)/count(po4) as po4avg, sum(po5)/count(po5) as po5avg, sum(po6)/count(po6) as po6avg, sum(po7)/count(po7) as po7avg, sum(po8)/count(po8) as po8avg, sum(po9)/count(po9) as po9avg, sum(po10)/count(po10) as po10avg, sum(po11)/count(po11) as po11avg, sum(po12)/count(po1) as po12avg FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryOne();
                                
                                    if($com==2)
                                    {
                                        $co_matrixavg = Yii::$app->db->createCommand("SELECT sum(po1)/count(po1) as po1avg, sum(po2)/count(po2) as po2avg, sum(po3)/count(po3) as po3avg, sum(po4)/count(po4) as po4avg, sum(po5)/count(po5) as po5avg, sum(po6)/count(po6) as po6avg, sum(po7)/count(po7) as po7avg, sum(po8)/count(po8) as po8avg, sum(po9)/count(po9) as po9avg, sum(po10)/count(po10) as po10avg, sum(po11)/count(po11) as po11avg, sum(po12)/count(po1) as po12avg FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryOne();
                                    }
                                    //print_r($co_matrixavg); exit();
                                   

                                    if(!empty($co_matrixavg))
                                    {
                                         $matrixavg.= "<tr>";
                                        $matrixavg.='<td style="text-align: center;" width=10%>'.$sysubject_code.'</td>';
                                        $matrixavg.='<td style="text-align: left;" width=30%>'.strtoupper($sysubject_name).'</td>';
                                        for ($i=1; $i <=12 ; $i++) 
                                        {
                                            $avgval='po'.$i.'avg';
                                            $matrixavg.='<td style="text-align: center;">'.round($co_matrixavg[$avgval]).'</td>';
                                        }

                                        if(!empty($psoavg_1))
                                        {
                                            $matrixavg.= "<td style='text-align: center;'>".round(array_sum($psoavg_1)/count($psoavg_1))."</td>";
                                        }
                                        if(!empty($psoavg_2))
                                        {
                                            $matrixavg.= "<td style='text-align: center;'>".round(array_sum($psoavg_2)/count($psoavg_2))."</td>";
                                        }
                                        if(!empty($psoavg_3))
                                        {
                                            $matrixavg.= "<td style='text-align: center;'>".round(array_sum($psoavg_3)/count($psoavg_3))."</td>";
                                        }

                                        $matrixavg.='</tr>';
                                    }

                                    
                                }
                                
                                    //$html.=' </table>';
                                    $html.=' <pagebreak>';
                               $curriculumdata.=$html;
                        }
                        else
                        {
                            //$curriculumdata='';
                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$subjectscode."' AND B.subject_type_id=106")->queryOne();        
                            
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];

                            if(!empty($codatalist)) 
                            {
                                $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                
                                 $com=1;
                                if(empty($co_matrix))
                                {
                                    $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();

                                     $com=2;
                                }

                                $course_categorytype='('.$codatalist['intext_mark'].")";

                                $html.='<table class="table" width="100%">
                                    <tr>
                                        <td width="15%">
                                            <b>'.$codatalist["subject_code"].'</b>
                                        </td>
                                        <td width="70%" colspan="2" align=center>';
                                
                                        $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                            
                                     $html.='    </td>
                                        <td width="15%" align=center>
                                            <b>'.$codatalist["ltp"].'/0</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Nature of the Course: </b>'.$codatalist['subject_type'].' '.$course_categorytype.'
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4">
                                            <b>Pre-requisite(s):Nil</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Course Objectives:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_objectives'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    

                                   $html.=' <tr>
                                        <td colspan="4">
                                            <b>Course Outcomes:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_outcomes'.$l;
                                            $rpt='rpt'.$l;
                                            if($codatalist[$cot]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                
                                    $html.=' </table><table class="table" width="100%">';
                                   
                                     
                                    if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                    {
                                         $html.='   <tr>
                                            <td colspan="4">
                                                <b>Course Content:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $output1 = substr($codatalist['subject_code'], 2,5); //exit;
                                            if($output1=='MC001')
                                            {
                                                 $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4><b>Module '.$l.': </b> '.$codatalist[$module_title].'</td>';
                                                    //$html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4><b>Module Content: </b><br>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                            else
                                            {
                                                $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {

                                                    $html.='<tr>';
                                                    $html.='<td width=80% colspan=2><b>Module '.$l.': </b> '.$codatalist[$module_title].'</td>';
                                                    $html.='<td width=20% colspan=2><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4><b>Module Content: </b><br>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                        }
                                    }
                                    
                                    if(!empty($colablist)) 
                                    {

                                      $html.='   <tr>
                                            <th colspan="4">
                                                <b>Lab Components:</b>
                                            </th>
                                        </tr>
                                        <tr>
                                            <th>S.No.</th>
                                            <th>List of Experiments</th>
                                            <th>CO Mapping</th>
                                            <th>RBT</th>
                                        </tr>';

                                        $s=1;
                                        foreach ($colablist as $value1) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$s.'</td>';
                                            $html.='<td width=60%>'.$value1['experiment_title'].'</td>';
                                            $html.='<td width=15%>'.$value1['cource_outcome'].'</td>';
                                            $html.='<td width=15%>'.$value1['rpt'].'</td>';
                                            $html.='</tr>';
                                            $s++;
                                        }

                                    }
                                   
                                    
                                    if(!empty($codatalist['text_book1']) && $codatalist['text_book1']!=' ' && $codatalist['text_book1']!='NA' )  
                                    {
                                        $html.=' <tr>
                                                <td colspan="4">
                                                    <b>Text Books:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='text_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                    if(!empty($codatalist['reference_book1']) && $codatalist['reference_book1']!=' ' && $codatalist['reference_book1']!='NA' ) 
                                    {
                                          $html.='<tr>
                                            <td colspan="4">
                                                <b>Reference Books:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='reference_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                   
                                    if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='NA' ) 
                                    {
                                          $html.='  <tr>
                                                <td colspan="4">
                                                    <b>Web References:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='web_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   

                                    $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                    //print_r($online_reference1); exit();
                                    if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                    {
                                        
                                         $html.=' <tr>
                                            <td colspan="4">
                                                <b>Online References:</b>
                                            </td>
                                        </tr>';

                                        for($l=1;$l<=2;$l++)
                                        {
                                            $cot='online_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }                    
                                     $html.=' </table> ';
                                    if(!empty($co_matrix))
                                    {
                                        $colspan=$co_matrix[0]['pso_count'];

                                        $html.=' 

                                        <table border="1" width="100%">
                                        <tr>
                                            <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                             <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                              <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                        </tr>
                               
                                        <tr>';
                                        
                                        for ($i=1; $i <=12 ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        } 
                                        for ($i=1; $i <=$colspan ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        }
                                        $html.= "</tr>";
                                        $psoavg_1= $psoavg_2= $psoavg_3=array();
                                        if(!empty($co_matrix))
                                        {
                                            foreach ($co_matrix as $value2) 
                                            {
                                                $html.='<tr>';
                                                $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                                for ($i=1; $i <=12 ; $i++) 
                                                { 
                                                    $po='po'.$i;
                                                    if($value2[$po]==0)
                                                    {
                                                        $html.='<td style="text-align: center;">-</td>';
                                                    }
                                                    else
                                                    {
                                                        $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                    }
                                                }

                                                $pso_value=explode(",", $value2['pso_value']);
                                                for ($p=0; $p <$colspan ; $p++) 
                                                { 
                                                    if($pso_value[$p]==0)
                                                    {
                                                        $html.='<td style="text-align: center;">-</td>';
                                                    }
                                                    else
                                                    {
                                                         $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                    }

                                                    if($p==0)
                                                    {
                                                        $psoavg_1[]=$pso_value[$p];
                                                    }
                                                    if($p==1)
                                                    {
                                                        $psoavg_2[]=$pso_value[$p];
                                                    }
                                                    if($p==2)
                                                    {
                                                        $psoavg_3[]=$pso_value[$p];
                                                    }
                                                }
                                                
                                                $html.='</tr>';

                                            }
                                        }

                                        
                                        $co_matrixavg = Yii::$app->db->createCommand("SELECT sum(po1)/count(po1) as po1avg, sum(po2)/count(po2) as po2avg, sum(po3)/count(po3) as po3avg, sum(po4)/count(po4) as po4avg, sum(po5)/count(po5) as po5avg, sum(po6)/count(po6) as po6avg, sum(po7)/count(po7) as po7avg, sum(po8)/count(po8) as po8avg, sum(po9)/count(po9) as po9avg, sum(po10)/count(po10) as po10avg, sum(po11)/count(po11) as po11avg, sum(po12)/count(po1) as po12avg FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryOne();
                                    
                                        if($com==2)
                                        {
                                            $co_matrixavg = Yii::$app->db->createCommand("SELECT sum(po1)/count(po1) as po1avg, sum(po2)/count(po2) as po2avg, sum(po3)/count(po3) as po3avg, sum(po4)/count(po4) as po4avg, sum(po5)/count(po5) as po5avg, sum(po6)/count(po6) as po6avg, sum(po7)/count(po7) as po7avg, sum(po8)/count(po8) as po8avg, sum(po9)/count(po9) as po9avg, sum(po10)/count(po10) as po10avg, sum(po11)/count(po11) as po11avg, sum(po12)/count(po1) as po12avg FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryOne();
                                        }
                                        //print_r($co_matrixavg); exit();
                                        

                                        // if(!empty($co_matrixavg))
                                        // {
                                        //     $matrixavg.= "<tr>";

                                        //     $matrixavg.='<td style="text-align: center;" width=10%>'.$sysubject_code.'</td>';
                                        //     $matrixavg.='<td style="text-align: left;" width=30%>'.strtoupper($sysubject_name).'</td>';

                                        //     for ($i=1; $i <=12 ; $i++) 
                                        //     {
                                        //         $avgval='po'.$i.'avg';
                                        //         $matrixavg.='<td style="text-align: center;">'.round($co_matrixavg[$avgval]).'</td>';
                                        //     }

                                        //     if(!empty($psoavg_1))
                                        //     {
                                        //         $matrixavg.= "<td style='text-align: center;'>".round(array_sum($psoavg_1)/count($psoavg_1))."</td>";
                                        //     }
                                        //     if(!empty($psoavg_2))
                                        //     {
                                        //         $matrixavg.= "<td style='text-align: center;'>".round(array_sum($psoavg_2)/count($psoavg_2))."</td>";
                                        //     }
                                        //     if(!empty($psoavg_3))
                                        //     {
                                        //         $matrixavg.= "<td style='text-align: center;'>".round(array_sum($psoavg_3)/count($psoavg_3))."</td>";
                                        //     }

                                        //      $matrixavg.='</tr>';
                                        // }

                                       

                                         $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                    }
                                    
                                       
                                        $html.=' <pagebreak>';

                                   $curriculumdata.=$html;
                            }
                        }
                    }

                    $tempsem=$coresubjects[$ei]['sem'];
                }
                //echo $dupplicate; exit()
                //$curriculumdata='';


                $semcredit='';
                
                $semcolumn='';

                $semcreditmc='';
                //echo $sem[1]; exit();
                if(count($sem)>1)
                {
                    for ($ss=1; $ss <=$sem[1] ; $ss++) 
                    { 
                        
                        $semm=" AND sem".$ss."!='0'";
                       
                        $checksemdata = Yii::$app->db->createCommand("SELECT A.* FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('PEC','OEC','EEC')".$semm)->queryAll();

                        if(!empty($checksemdata))
                        {
                            if($semcredit=='')
                            {
                                $semcredit.=" AND (sem".$ss."!=''";
                            }
                            else if($semcredit!='')
                            {
                                $semcredit.=" OR sem".$ss."!=''";
                            }

                             $semcolumn.="sem".$ss;
                        }
                        
                        
                    }

                    for ($sss=1; $sss <=$semend ; $sss++) 
                    { 
                        
                        $semms=" AND sem".$sss."='0'";
                       
                        $checksemdata = Yii::$app->db->createCommand("SELECT A.* FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('MC')".$semms)->queryAll();

                        if(!empty($checksemdata))
                        {
                            if($semcreditmc=='')
                            {
                                $semcreditmc.=" AND (sem".$sss."!=''";
                            }
                            else if($semcreditmc!='')
                            {
                                $semcreditmc.=" OR sem".$sss."!=''";
                            }
                            
                             $semcolumn.="sem".$sss;
                        }
                        
                        
                    }


                }
                else
                {
                    $semcredit=" AND sem".$sem[0]."!=''";
                }
                     
                if($semcredit!='' && (count($sem)>1))          
                {
                    $semcredit=$semcredit.") ";
                }
                $matrixavg1='';
                if(!empty($semcredit)) // elective
                {
                    $getsemcredit = Yii::$app->db->createCommand("SELECT B.stream_name FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('PEC','OEC','EEC')".$semcredit)->queryAll();
                    //print_r($semcolumn); exit();
                    if(!empty($getsemcredit))
                    {
                    
                        $streamsdata=array();
                        foreach ($getsemcredit as $key => $stvalue) 
                        {
                            $streamsdata[]=$stvalue['stream_name']; //exit();
                        }                    

                        if(in_array('PEC',$streamsdata))
                        {
                            $curriculumdata.='<pagebreak>';

                            $curriculumdata.='<table class="table oectable" width="100%">
                                            <tr>
                                                <td>
                                                    <h2><b>PROFESSIONAL ELECTIVE COURSES</b></h2>
                                                </td>
                                            <tr>
                                            </table>';
                            $curriculumdata.='<pagebreak>';

                            $matrixavg1.='<pagebreak>';
                            $matrixavg1.='<table class="table" width="100%">
                                        <tr>
                                            <td><b>PROFESSIONAL ELECTIVE COURSES</b></td>
                                        <tr>
                                        </table><table class="table" width="100%">';

                            $matrixavg1.=' <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">COURSE CODE </th>
                                                <th rowspan="2" width="30%" style="text-align: center;">COURSE NAME </th>
                                                 <th colspan="12" width="50%" style="text-align: center;">PO</th>
                                                  <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                            </tr>
                                   
                                            <tr>';

                            for ($i=1; $i <=12 ; $i++) 
                            { 
                                $matrixavg1.= "<th style='text-align: center;'>".$i."</th>";
                            } 
                            for ($i=1; $i <=$colspan ; $i++) 
                            { 
                                $matrixavg1.= "<th style='text-align: center;'>".$i."</th>";
                            }
                            $matrixavg1.= "</tr>";

                            //$curriculumdata='';
                            $electivesubject = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option IN (192) AND coe_elective_option NOT IN (191,193)")->queryAll();

                            $coreelectivesubject = Yii::$app->db->createCommand("SELECT A.subject_code as subject_code FROM  cur_electivetodept A  WHERE A.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option IN (192) AND coe_elective_option NOT IN (191,193)")->queryAll();
                        
                            if(!empty($coreelectivesubject))
                            {
                                $electivesubject=array_merge($electivesubject,$coreelectivesubject);
                            }

                            foreach ($electivesubject as $value) 
                            {
                                $html='';

                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();        
                                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                $ltot=0;
                                $ttot=0;
                                $ptot=0;
                                if(empty($codatalist))
                                {
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                                    if(empty($codatalist)) // regulation existing syllabus
                                    {
                                       
                                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                        
                                        if(empty($codatalist)) // regulation existing syllabus
                                        {         
                                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                            
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15;
                                        }
                                        else
                                        {
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15;
                                        }
                                    }
                                    else
                                    {
                                        $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {
                                    $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                                
                                if(!empty($codatalist)) 
                                {
                                    $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                    $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll(); 

                                    $course_categorytype='';
                                    

                                    if($codatalist['subject_category_type_id']=='140') //type1
                                    {

                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='141') //type 2
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='142') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                                    } 
                                    else if($codatalist['subject_category_type_id']=='144') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                                    }    
                                    else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                                    } 
                                    else 
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                                    }                 
                                
                                    $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE (A.subject_code='".$value["subject_code"]."' AND A.subject_code_new!='".$value["subject_code"]."')")->queryOne();               
                                    
                                    $sysubject_code='';
                                    if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                                    {
                                        $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                                    }
                                    else
                                    {
                                        $sysubject_code=$value["subject_code"];
                                    }
                                    
                                    $sysubject_name=$codatalist["subject_name"];

                                    $html.='<table class="table" width="100%">
                                        <tr>
                                            <td width="15%">
                                                <b>'.$sysubject_code.'</b>
                                            </td>
                                            <td width="70%" colspan="2" align=center>';
                                    
                                            $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                                
                                         $html.='    </td>
                                            <td width="15%" align=center>
                                                <b>'.$codatalist["ltp"].'/'.$codatalist["credit_point"].'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="4">
                                                <b>Pre-requisite(s):'.($prerequisties).'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Course Objectives:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_objectives'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        

                                       $html.=' <tr>
                                            <td colspan="4">
                                                <b>Course Outcomes:<br>
                                                Upon completion of the course, students shall have ability to
                                                </b>

                                            </td>
                                        </tr>';

                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_outcomes'.$l;
                                                $rpt='rpt'.$l;
                                                if($codatalist[$cot]!='')
                                                {
                                                    $rptdta ='';
                                                    if($codatalist[$rpt]!='')
                                                    {
                                                        $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                    }
                                                    
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                    $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                    $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                    
                                        $html.=' </table><table class="table" width="100%">';
                                       
                                         
                                        if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                        {
                                             $html.='   <tr>
                                                <td colspan="4">
                                                    <b>Course Content:</b>
                                                </td>
                                            </tr>';
                                            for($l=1;$l<=3;$l++)
                                            {
                                                $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {
                                                    //$module_title=trim($codatalist[$module_title],"'");
                                                    $html.='<tr>';
                                                    $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                    $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                        }

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(L):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ltot.'</b>
                                                </td>
                                            </tr>';
                                        }

                                        if($ttot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(T):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ttot.'</b>
                                                </td>
                                            </tr>';

                                            if($ltot!=0)
                                            {
                                                $html.='   <tr>
                                                    <td colspan="3" align=right>
                                                        <b>Total Hours(LT):</b>
                                                    </td>
                                                    <td>
                                                        <b>'.($ttot+$ltot).'</b>
                                                    </td>
                                                </tr>';
                                            }
                                        }
                                        
                                        if(!empty($colablist)) 
                                        {

                                          $html.='   <tr>
                                                <th colspan="4">
                                                    <b>Lab Components:</b>
                                                </th>
                                            </tr>
                                            <tr>
                                                <th>S.No.</th>
                                                <th>List of Experiments</th>
                                                <th>CO Mapping</th>
                                                <th>RBT</th>
                                            </tr>';

                                            $s=1;
                                            foreach ($colablist as $value) 
                                            {
                                                $cout=ltrim($value['cource_outcome'],",");
                                                $html.='<tr>';
                                                $html.='<td width=10% align=center>'.$s.'</td>';
                                                $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                                $html.='<td width=15% align=center>'.$cout.'</td>';
                                                $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                                $html.='</tr>';
                                                $s++;
                                            }

                                             $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(P):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ptot.'</b>
                                                </td>
                                            </tr>';
                                        }
                                       
                                        $html.=' <tr>
                                            <td colspan="4">
                                                <b>Text Books:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=4;$l++)
                                            {
                                                $cot='text_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        
                                       
                                         $html.='<tr>
                                            <td colspan="4">
                                                <b>Reference Books:</b>
                                            </td>
                                        </tr>';
                                       
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='reference_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       
                                       
                                        if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                        {
                                              $html.='  <tr>
                                                    <td colspan="4">
                                                        <b>Web References:</b>
                                                    </td>
                                                </tr>';

                                            for($l=1;$l<=3;$l++)
                                            {
                                                $cot='web_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       

                                        $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                        //print_r($online_reference1); exit();
                                        if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                        {
                                            
                                             $html.=' <tr>
                                                <td colspan="4">
                                                    <b>Online References:</b>
                                                </td>
                                            </tr>';

                                            for($l=1;$l<=2;$l++)
                                            {
                                                $cot='online_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }                    
                                         $html.=' </table> ';
                                        if(!empty($co_matrix))
                                        {
                                            $psoavg_1= $psoavg_2= $psoavg_3=array();
                                            $colspan=$co_matrix[0]['pso_count'];

                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                 <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                  <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 
                                            for ($i=1; $i <=$colspan ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            }
                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value2) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                                    for ($i=1; $i <=12 ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        if($value2[$po]==0)
                                                        {
                                                            $html.='<td style="text-align: center;">-</td>';
                                                        }
                                                        else
                                                        {
                                                            $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                        }
                                                    }

                                                    $pso_value=explode(",", $value2['pso_value']);
                                                    for ($p=0; $p <$colspan ; $p++) 
                                                    { 
                                                        if($pso_value[$p]==0)
                                                        {
                                                            $html.='<td style="text-align: center;">-</td>';
                                                        }
                                                        else
                                                        {
                                                             $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                        }

                                                        if($p==0)
                                                        {
                                                            $psoavg_1[]=$pso_value[$p];
                                                        }
                                                        if($p==1)
                                                        {
                                                            $psoavg_2[]=$pso_value[$p];
                                                        }
                                                        if($p==2)
                                                        {
                                                            $psoavg_3[]=$pso_value[$p];
                                                        }
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }
                                           

                                            $matrixavg1.= "<tr>";
                                            $co_matrixavg = Yii::$app->db->createCommand("SELECT sum(po1)/count(po1) as po1avg, sum(po2)/count(po2) as po2avg, sum(po3)/count(po3) as po3avg, sum(po4)/count(po4) as po4avg, sum(po5)/count(po5) as po5avg, sum(po6)/count(po6) as po6avg, sum(po7)/count(po7) as po7avg, sum(po8)/count(po8) as po8avg, sum(po9)/count(po9) as po9avg, sum(po10)/count(po10) as po10avg, sum(po11)/count(po11) as po11avg, sum(po12)/count(po1) as po12avg FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryOne();
                                            
                                            //print_r($co_matrixavg); exit();
                                            $matrixavg1.='<td style="text-align: center;" width=10%>'.$sysubject_code.'</td>';
                                            $matrixavg1.='<td style="text-align: left;" width=30%>'.strtoupper($sysubject_name).'</td>';

                                            if(!empty($co_matrixavg))
                                            {
                                                for ($i=1; $i <=12 ; $i++) 
                                                {
                                                    $avgval='po'.$i.'avg';
                                                    $matrixavg1.='<td style="text-align: center;">'.round($co_matrixavg[$avgval]).'</td>';
                                                }

                                                if(!empty($psoavg_1))
                                                {
                                                    $matrixavg1.= "<td style='text-align: center;'>".round(array_sum($psoavg_1)/count($psoavg_1))."</td>";
                                                }
                                                if(!empty($psoavg_2))
                                                {
                                                    $matrixavg1.= "<td style='text-align: center;'>".round(array_sum($psoavg_2)/count($psoavg_2))."</td>";
                                                }
                                                if(!empty($psoavg_3))
                                                {
                                                    $matrixavg1.= "<td style='text-align: center;'>".round(array_sum($psoavg_3)/count($psoavg_3))."</td>";
                                                }
                                            }

                                            $matrixavg1.='</tr>';

                                            $html.=' </table><br>';
                                                 $html.=' <table border="1" width="100%"><tr>
                                                    <td width="50%" style="text-align: left;">
                                                    CO - Course Outcome<br>
                                                    PO - Programme Outcome<br>
                                                    PSO - Programme Specific Outcomes
                                                    </td>
                                                     <td width="50%" style="text-align: left;">
                                                    1 - Reasonably Agreed<br>
                                                    2 - Moderately Agreed<br>
                                                    3 - Strongly Agreed
                                                    </td>
                                                </tr></table>';
                                        }
                                        
                                            //$html.=' </table>';
                                            $html.=' <pagebreak>';
                                       $curriculumdata.=$html;
                                }
                                
                            }

                            $matrixavg1.='</table>';
                        }

                        if(in_array('EEC',$streamsdata))
                        {
                            $curriculumdata.='<pagebreak>';
                            //$curriculumdata='';

                            $curriculumdata.='<table class="table oectable" width="100%">
                                            <tr>
                                                <td>
                                                    <h2><b>EMERGING ELECTIVE COURSES</b></h2>
                                                </td>
                                            <tr>
                                            </table>';
                            $curriculumdata.='<pagebreak>';

                            $electivesubject = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option IN (193) AND coe_elective_option NOT IN (191,192)")->queryAll();

                            $coreelectivesubject = Yii::$app->db->createCommand("SELECT A.subject_code_new as subject_code FROM  cur_electivetodept A  WHERE A.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option IN (193) AND coe_elective_option NOT IN (191,192)")->queryAll();
                        
                            if(!empty($coreelectivesubject))
                            {
                                $electivesubject=array_merge($electivesubject,$coreelectivesubject);
                            }

                            foreach ($electivesubject as $value) 
                            {
                                $html='';

                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();        
                                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                $ltot=0;
                                $ttot=0;
                                $ptot=0;
                                if(empty($codatalist))
                                {
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                                    if(empty($codatalist)) // regulation existing syllabus
                                    {
                                       
                                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                        
                                        if(empty($codatalist)) // regulation existing syllabus
                                        {         
                                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                            
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15;
                                        }
                                        else
                                        {
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15;
                                        }
                                    }
                                    else
                                    {
                                        $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {
                                    $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                                
                                if(!empty($codatalist)) 
                                {
                                    $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                    $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                        
                                    if(empty($co_matrix))
                                    {
                                        $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                    }

                                    $course_categorytype='';
                                    

                                    if($codatalist['subject_category_type_id']=='140') //type1
                                    {

                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='141') //type 2
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='142') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                                    } 
                                    else if($codatalist['subject_category_type_id']=='144') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                                    }    
                                    else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                                    } 
                                    else 
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                                    }                 
                                
                                    $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE A.subject_code='".$value["subject_code"]."' OR A.subject_code_new='".$value["subject_code"]."'")->queryOne();               
                                    
                                    $sysubject_code='';
                                    if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                                    {
                                        $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                                    }
                                    else
                                    {
                                        $sysubject_code=$value["subject_code"];
                                    }
                                    

                                    $html.='<table class="table" width="100%">
                                        <tr>
                                            <td width="15%">
                                                <b>'.$sysubject_code.'</b>
                                            </td>
                                            <td width="70%" colspan="2" align=center>';
                                    
                                            $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                                
                                         $html.='    </td>
                                            <td width="15%" align=center>
                                                <b>'.$codatalist["ltp"].'/'.$codatalist["credit_point"].'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="4">
                                                <b>Pre-requisite(s):'.($prerequisties).'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Course Objectives:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_objectives'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        

                                       $html.=' <tr>
                                            <td colspan="4">
                                                <b>Course Outcomes:<br>
                                                Upon completion of the course, students shall have ability to
                                                </b>

                                            </td>
                                        </tr>';

                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_outcomes'.$l;
                                                $rpt='rpt'.$l;
                                                if($codatalist[$cot]!='')
                                                {
                                                    $rptdta ='';
                                                    if($codatalist[$rpt]!='')
                                                    {
                                                        $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                    }
                                                    
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                    $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                    $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                    
                                        $html.=' </table><table class="table" width="100%">';
                                       
                                         
                                        if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                        {
                                             $html.='   <tr>
                                                <td colspan="4">
                                                    <b>Course Content:</b>
                                                </td>
                                            </tr>';
                                            for($l=1;$l<=3;$l++)
                                            {
                                                $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {
                                                    //$module_title=trim($codatalist[$module_title],"'");
                                                    $html.='<tr>';
                                                    $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                    $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                        }

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(L):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ltot.'</b>
                                                </td>
                                            </tr>';
                                        }

                                        if($ttot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(T):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ttot.'</b>
                                                </td>
                                            </tr>';

                                            if($ltot!=0)
                                            {
                                                $html.='   <tr>
                                                    <td colspan="3" align=right>
                                                        <b>Total Hours(LT):</b>
                                                    </td>
                                                    <td>
                                                        <b>'.($ttot+$ltot).'</b>
                                                    </td>
                                                </tr>';
                                            }
                                        }
                                        
                                        if(!empty($colablist)) 
                                        {

                                          $html.='   <tr>
                                                <th colspan="4">
                                                    <b>Lab Components:</b>
                                                </th>
                                            </tr>
                                            <tr>
                                                <th>S.No.</th>
                                                <th>List of Experiments</th>
                                                <th>CO Mapping</th>
                                                <th>RBT</th>
                                            </tr>';

                                            $s=1;
                                            foreach ($colablist as $value) 
                                            {
                                                $cout=ltrim($value['cource_outcome'],",");
                                                $html.='<tr>';
                                                $html.='<td width=10% align=center>'.$s.'</td>';
                                                $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                                $html.='<td width=15% align=center>'.$cout.'</td>';
                                                $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                                $html.='</tr>';
                                                $s++;
                                            }

                                             $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(P):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ptot.'</b>
                                                </td>
                                            </tr>';
                                        }
                                       
                                        $html.=' <tr>
                                            <td colspan="4">
                                                <b>Text Books:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=4;$l++)
                                            {
                                                $cot='text_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        
                                       
                                         $html.='<tr>
                                            <td colspan="4">
                                                <b>Reference Books:</b>
                                            </td>
                                        </tr>';
                                       
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='reference_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       
                                       
                                        if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                        {
                                              $html.='  <tr>
                                                    <td colspan="4">
                                                        <b>Web References:</b>
                                                    </td>
                                                </tr>';

                                            for($l=1;$l<=3;$l++)
                                            {
                                                $cot='web_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       

                                        $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                        //print_r($online_reference1); exit();
                                        if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                        {
                                            
                                             $html.=' <tr>
                                                <td colspan="4">
                                                    <b>Online References:</b>
                                                </td>
                                            </tr>';

                                            for($l=1;$l<=2;$l++)
                                            {
                                                $cot='online_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }                    
                                         $html.=' </table> ';
                                        if(!empty($co_matrix))
                                        {
                                            //print_r($co_matrix); exit();
                                            $colspan=$co_matrix[0]['pso_count'];

                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                 <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                  <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 
                                            for ($i=1; $i <=$colspan ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            }
                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value2) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                                    for ($i=1; $i <=12 ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        if($value2[$po]==0)
                                                        {
                                                            $html.='<td style="text-align: center;">-</td>';
                                                        }
                                                        else
                                                        {
                                                            $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                        }
                                                    }

                                                    $pso_value=explode(",", $value2['pso_value']);
                                                    for ($p=0; $p <$colspan ; $p++) 
                                                    { 
                                                        if($pso_value[$p]==0)
                                                        {
                                                            $html.='<td width=5% style="text-align: center;">-</td>';
                                                        }
                                                        else
                                                        {
                                                             $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                        }
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                            $html.=' </table><br>';
                                                 $html.=' <table border="1" width="100%"><tr>
                                                    <td width="50%" style="text-align: left;">
                                                    CO - Course Outcome<br>
                                                    PO - Programme Outcome<br>
                                                    PSO - Programme Specific Outcomes
                                                    </td>
                                                     <td width="50%" style="text-align: left;">
                                                    1 - Reasonably Agreed<br>
                                                    2 - Moderately Agreed<br>
                                                    3 - Strongly Agreed
                                                    </td>
                                                </tr></table>';
                                        }
                                        
                                            //$html.=' </table>';
                                            $html.=' <pagebreak>';
                                       $curriculumdata.=$html;
                                }
                                
                            }

                        }

                        if(in_array('OEC',$streamsdata))
                        {
                            $curriculumdata.='<pagebreak>';
                            //$curriculumdata='';
                            $curriculumdata.='<table class="table oectable" width="100%">
                                            <tr>
                                                <td>
                                                    <h2><b>OPEN ELECTIVE COURSES</b></h2>
                                                </td>
                                            <tr>
                                            </table>';
                            $curriculumdata.='<pagebreak>';

                            $electivesubject3 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option NOT IN (192,193) AND coe_elective_option IN (191)")->queryAll();

                            $electivesubject4 = Yii::$app->db->createCommand("SELECT B.subject_code_new as subject_code FROM cur_curriculum_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_dept_ids=0 AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option NOT IN (192,193) AND B.coe_elective_option IN (191) AND B.subject_code NOT IN (SELECT subject_code FROM cur_electivetodept WHERE coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND coe_dept_ids!=0 AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."')")->queryAll();

                            if(!empty($electivesubject3))
                            {
                                $electivesubject3=array_merge($electivesubject3,$electivesubject4);
                            }

                            $electivesubject5 = Yii::$app->db->createCommand("SELECT B.subject_code_new as subject_code FROM cur_elective_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_dept_ids=0 AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option NOT IN (192,193) AND B.coe_elective_option IN (191)")->queryAll();

                            if(!empty($electivesubject5))
                            {
                                $electivesubject3=array_merge($electivesubject3,$electivesubject5);
                            }

                            //print_r($electivesubject4); exit();
                            foreach ($electivesubject3 as $value) 
                            {
                                $html='';

                                $ltot=0;
                                $ttot=0;
                                $ptot=0;
                                
                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                                if(empty($codatalist)) // regulation existing syllabus
                                {
                                  
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code=B.subject_code WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                 
                                    if(empty($codatalist)) // regulation existing syllabus
                                    {   

                                    
                                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                        
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;

                                        if(empty($codatalist)) // syllabus from mapped elective
                                        {         
                                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code=B.subject_code WHERE G.subject_code_new='".$value['subject_code']."'")->queryOne();
                                            
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15; //exit;

                                            if(empty($codatalist)) // syllabus from core subject to elective
                                            {         
                                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code=B.subject_code WHERE G.subject_code_new='".$value['subject_code']."'")->queryOne();
                                                
                                                $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                                $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                                $ltot=($codatalist['L'])*15;
                                                $ttot=($codatalist['T'])*15;
                                                $ptot=($codatalist['P'])*15; //exit;
                                            }
                                        }
                                    }
                                    else
                                    {
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {

                                    $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                               
                                
                                if(!empty($codatalist)) 
                                {
                                    $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                    $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".$codatalist['coe_dept_id'])->queryAll();

                                    $course_categorytype='';
                                    

                                    if($codatalist['subject_category_type_id']=='140') //type1
                                    {

                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='141') //type 2
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='142') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                                    } 
                                    else if($codatalist['subject_category_type_id']=='144') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                                    }    
                                    else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                                    } 
                                    else 
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                                    }                 
                                
                                    $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE (A.subject_code='".$value["subject_code"]."' OR A.subject_code_new='".$value["subject_code"]."') AND coe_elective_option IN (191)")->queryOne();               
                                   
                                    $sysubject_code='';
                                    if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                                    {
                                        $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                                    }
                                    else
                                    {
                                        $sysubject_code=$value["subject_code"];
                                    }
                                    

                                    $html.='<table class="table" width="100%">
                                        <tr>
                                            <td width="15%">
                                                <b>'.$sysubject_code.'</b>
                                            </td>
                                            <td width="70%" colspan="2" align=center>';
                                    
                                            $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                                
                                         $html.='    </td>
                                            <td width="15%" align=center>
                                                <b>'.$codatalist["ltp"] .'/'.$codatalist["credit_point"]  .'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="4">
                                                <b>Pre-requisite(s):'.($prerequisties).'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Course Objectives:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_objectives'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        

                                       $html.=' <tr>
                                            <td colspan="4">
                                                <b>Course Outcomes:<br>
                                                Upon completion of the course, students shall have ability to
                                                </b>

                                            </td>
                                        </tr>';

                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_outcomes'.$l;
                                                $rpt='rpt'.$l;
                                                if($codatalist[$cot]!='')
                                                {
                                                    $rptdta ='';
                                                    if($codatalist[$rpt]!='')
                                                    {
                                                        $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                    }
                                                    
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                    $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                    $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                    
                                        $html.=' </table><table class="table" width="100%">';
                                       
                                         
                                        if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                        {
                                             $html.='   <tr>
                                                <td colspan="4">
                                                    <b>Course Content:</b>
                                                </td>
                                            </tr>';
                                            for($l=1;$l<=3;$l++)
                                            {
                                                $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {
                                                    //$module_title=trim($codatalist[$module_title],"'");
                                                    $html.='<tr>';
                                                    $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                    $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                        }

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(L):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ltot.'</b>
                                                </td>
                                            </tr>';
                                        }

                                        if($ttot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(T):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ttot.'</b>
                                                </td>
                                            </tr>';

                                            if($ltot!=0)
                                            {
                                                $html.='   <tr>
                                                    <td colspan="3" align=right>
                                                        <b>Total Hours(LT):</b>
                                                    </td>
                                                    <td>
                                                        <b>'.($ttot+$ltot).'</b>
                                                    </td>
                                                </tr>';
                                            }
                                        }
                                        
                                        if(!empty($colablist)) 
                                        {

                                          $html.='   <tr>
                                                <th colspan="4">
                                                    <b>Lab Components:</b>
                                                </th>
                                            </tr>
                                            <tr>
                                                <th>S.No.</th>
                                                <th>List of Experiments</th>
                                                <th>CO Mapping</th>
                                                <th>RBT</th>
                                            </tr>';

                                            $s=1;
                                            foreach ($colablist as $value) 
                                            {
                                                $cout=ltrim($value['cource_outcome'],",");
                                                $html.='<tr>';
                                                $html.='<td width=10% align=center>'.$s.'</td>';
                                                $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                                $html.='<td width=15% align=center>'.$cout.'</td>';
                                                $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                                $html.='</tr>';
                                                $s++;
                                            }

                                             $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(P):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ptot.'</b>
                                                </td>
                                            </tr>';
                                        }
                                       
                                        $html.=' <tr>
                                            <td colspan="4">
                                                <b>Text Books:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=4;$l++)
                                            {
                                                $cot='text_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        
                                       
                                         $html.='<tr>
                                            <td colspan="4">
                                                <b>Reference Books:</b>
                                            </td>
                                        </tr>';
                                       
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='reference_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       
                                       
                                        if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                        {
                                              $html.='  <tr>
                                                    <td colspan="4">
                                                        <b>Web References:</b>
                                                    </td>
                                                </tr>';

                                            for($l=1;$l<=3;$l++)
                                            {
                                                $cot='web_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       

                                        $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                        //print_r($online_reference1); exit();
                                        if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                        {
                                            
                                             $html.=' <tr>
                                                <td colspan="4">
                                                    <b>Online References:</b>
                                                </td>
                                            </tr>';

                                            for($l=1;$l<=2;$l++)
                                            {
                                                $cot='online_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }                    
                                         $html.=' </table> ';
                                        if(!empty($co_matrix))
                                        {
                                            //print_r($co_matrix); exit();
                                            $colspan=$co_matrix[0]['pso_count'];

                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                 <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                 
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 
                                           
                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value2) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                                    for ($i=1; $i <=12 ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        if($value2[$po]==0)
                                                        {
                                                            $html.='<td style="text-align: center;">-</td>';
                                                        }
                                                        else
                                                        {
                                                            $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                        }
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                            $html.=' </table><br>';
                                                 $html.=' <table border="1" width="100%"><tr>
                                                    <td width="50%" style="text-align: left;">
                                                    CO - Course Outcome<br>
                                                    PO - Programme Outcome<br>
                                                    </td>
                                                     <td width="50%" style="text-align: left;">
                                                    1 - Reasonably Agreed<br>
                                                    2 - Moderately Agreed<br>
                                                    3 - Strongly Agreed
                                                    </td>
                                                </tr></table>';
                                        }
                                        
                                            //$html.=' </table>';
                                            $html.=' <pagebreak>';
                                       $curriculumdata.=$html;
                                }
                                
                            }
                        }
                        //$curriculumdata='';
                        $curriculumdata.='<table class="table oectable" width="100%">
                                        <tr>
                                            <td>
                                                <h2><b>OPEN ELECTIVE TO OTHER DEPT</b></h2>
                                            </td>
                                        <tr>
                                        </table>';
                        $curriculumdata.='<pagebreak>';

                        $electivesubject1 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option NOT IN (192,193) AND coe_elective_option IN (191)")->queryAll();

                        $electivesubject2 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_curriculum_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_dept_ids=0 AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option NOT IN (192,193) AND B.coe_elective_option IN (191)")->queryAll();

                        if(!empty($electivesubject2))
                        {
                            $electivesubject1=array_merge($electivesubject1,$electivesubject2);
                        }
                        

                        foreach ($electivesubject1 as $value) 
                        {
                            $html='';

                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();        
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                            $ltot=0;
                            $ttot=0;
                            $ptot=0;
                            if(empty($codatalist))
                            {
                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                                if(empty($codatalist)) // regulation existing syllabus
                                {
                                   
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                    
                                    if(empty($codatalist)) // regulation existing syllabus
                                    {         
                                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                        
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                    else
                                    {
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {
                                    $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                            }
                            else
                            {
                                $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                $ltot=($codatalist['L'])*15;
                                $ttot=($codatalist['T'])*15;
                                $ptot=($codatalist['P'])*15;
                            }
                            
                            if(!empty($codatalist)) 
                            {
                                $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".$codatalist['coe_dept_id'])->queryAll();
                                                           

                                $course_categorytype='';
                                

                                if($codatalist['subject_category_type_id']=='140') //type1
                                {

                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                                }
                                else if($codatalist['subject_category_type_id']=='141') //type 2
                                {
                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                                }
                                else if($codatalist['subject_category_type_id']=='142') //type 3
                                {
                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                                } 
                                else if($codatalist['subject_category_type_id']=='144') //type 3
                                {
                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                                }    
                                else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                                {
                                    $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                                } 
                                else 
                                {
                                    $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                                }                 
                            
                                $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE (A.subject_code='".$value["subject_code"]."' OR A.subject_code_new='".$value["subject_code"]."') AND coe_elective_option IN (191)")->queryOne();               
                                
                                $sysubject_code='';
                                if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                                {
                                    $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                                }
                                else
                                {
                                    $sysubject_code=$value["subject_code"];
                                }
                                

                                $html.='<table class="table" width="100%">
                                    <tr>
                                        <td width="15%">
                                            <b>'.$sysubject_code.'</b>
                                        </td>
                                        <td width="70%" colspan="2" align=center>';
                                
                                        $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                            
                                     $html.='    </td>
                                        <td width="15%" align=center>
                                            <b>'.$codatalist["ltp"] .'/'.$codatalist["credit_point"]  .'</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4">
                                            <b>Pre-requisite(s):'.($prerequisties).'</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Course Objectives:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_objectives'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    

                                   $html.=' <tr>
                                        <td colspan="4">
                                            <b>Course Outcomes:<br>
                                            Upon completion of the course, students shall have ability to
                                            </b>

                                        </td>
                                    </tr>';

                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_outcomes'.$l;
                                            $rpt='rpt'.$l;
                                            if($codatalist[$cot]!='')
                                            {
                                                $rptdta ='';
                                                if($codatalist[$rpt]!='')
                                                {
                                                    $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                }
                                                
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                
                                    $html.=' </table><table class="table" width="100%">';
                                   
                                     
                                    if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                    {
                                         $html.='   <tr>
                                            <td colspan="4">
                                                <b>Course Content:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $module_title='module_title'.$l;
                                            $module_hr='module_hr'.$l;
                                            $module_content='cource_content_mod'.$l;
                                            if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                            {
                                                //$module_title=trim($codatalist[$module_title],"'");
                                                $html.='<tr>';
                                                $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                $html.='</tr>';

                                                $html.='<tr>';
                                                $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                $html.='</tr>';

                                               
                                            }
                                        }
                                    }

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(L):</b>
                                            </td>
                                            <td>
                                                <b>'.$ltot.'</b>
                                            </td>
                                        </tr>';
                                    }

                                    if($ttot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(T):</b>
                                            </td>
                                            <td>
                                                <b>'.$ttot.'</b>
                                            </td>
                                        </tr>';

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(LT):</b>
                                                </td>
                                                <td>
                                                    <b>'.($ttot+$ltot).'</b>
                                                </td>
                                            </tr>';
                                        }
                                    }
                                    
                                    if(!empty($colablist)) 
                                    {

                                      $html.='   <tr>
                                            <th colspan="4">
                                                <b>Lab Components:</b>
                                            </th>
                                        </tr>
                                        <tr>
                                            <th>S.No.</th>
                                            <th>List of Experiments</th>
                                            <th>CO Mapping</th>
                                            <th>RBT</th>
                                        </tr>';

                                        $s=1;
                                        foreach ($colablist as $value) 
                                        {
                                            $cout=ltrim($value['cource_outcome'],",");
                                            $html.='<tr>';
                                            $html.='<td width=10% align=center>'.$s.'</td>';
                                            $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                            $html.='<td width=15% align=center>'.$cout.'</td>';
                                            $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                            $html.='</tr>';
                                            $s++;
                                        }

                                         $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(P):</b>
                                            </td>
                                            <td>
                                                <b>'.$ptot.'</b>
                                            </td>
                                        </tr>';
                                    }
                                   
                                    $html.=' <tr>
                                        <td colspan="4">
                                            <b>Text Books:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=4;$l++)
                                        {
                                            $cot='text_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    
                                   
                                     $html.='<tr>
                                        <td colspan="4">
                                            <b>Reference Books:</b>
                                        </td>
                                    </tr>';
                                   
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='reference_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                   
                                    if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                    {
                                          $html.='  <tr>
                                                <td colspan="4">
                                                    <b>Web References:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='web_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   

                                    $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                    //print_r($online_reference1); exit();
                                    if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                    {
                                        
                                         $html.=' <tr>
                                            <td colspan="4">
                                                <b>Online References:</b>
                                            </td>
                                        </tr>';

                                        for($l=1;$l<=2;$l++)
                                        {
                                            $cot='online_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }                    
                                     $html.=' </table> ';
                                    if(!empty($co_matrix))
                                    {
                                        //print_r($co_matrix); exit();
                                        $colspan=$co_matrix[0]['pso_count'];

                                        $html.=' 

                                        <table border="1" width="100%">
                                        <tr>
                                            <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                             <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                             
                                        </tr>
                               
                                        <tr>';
                                        
                                        for ($i=1; $i <=12 ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        } 
                                        $html.= "</tr>";

                                        if(!empty($co_matrix))
                                        {
                                            foreach ($co_matrix as $value2) 
                                            {
                                                $html.='<tr>';
                                                $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                                for ($i=1; $i <=12 ; $i++) 
                                                { 
                                                    $po='po'.$i;
                                                    if($value2[$po]==0)
                                                    {
                                                        $html.='<td style="text-align: center;">-</td>';
                                                    }
                                                    else
                                                    {
                                                        $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                    }
                                                }

                                               
                                                
                                                $html.='</tr>';

                                            }
                                        }

                                        $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                    }
                                    
                                        //$html.=' </table>';
                                        $html.=' <pagebreak>';
                                   $curriculumdata.=$html;
                            }
                            
                        }

                    }

                }

                if($semcreditmc!='')          
                {
                    $semcreditmc=$semcreditmc.") ";
                }
                //print_r($semcreditmc); exit();
                if(!empty($semcreditmc)) // mc
                {

                    $mccoursesyllabus = Yii::$app->db->createCommand("SELECT subject_code FROM cur_curriculum_subject WHERE semester=0 AND coe_dept_id='8' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND coe_cur_id NOT IN (SELECT coe_cur_subid FROM cur_servicesubtodept WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."') ORDER BY subject_code ASC")->queryAll();
                    //print_r($mccoursesyllabus); exit();
                    if(!empty($mccoursesyllabus))
                    {
                        $curriculumdata.='<pagebreak>';

                        $curriculumdata.='<table class="table oectable" width="100%">
                                        <tr>
                                            <td>
                                                <h2><b>MANDATORY COURSES</b></h2>
                                            </td>
                                        <tr>
                                        </table>';
                        $curriculumdata.='<pagebreak>';

                        foreach ($mccoursesyllabus as $value) 
                        {
                            $html='';
                             $ltot=0;
                            $ttot=0;
                            $ptot=0;
                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark, C.internal_mark,B.subject_type_id FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();        
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                           

                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;
                        
                        
                            if(!empty($codatalist)) 
                            {

                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();

                                $course_categorytype='';
                                if($codatalist['internal_mark']>0)
                                {
                                    $course_categorytype=' - '.'('.$codatalist['intext_mark'].")</b>";
                                }
                                 

                                $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE A.subject_code='".$codatalist["subject_code"]."' OR A.subject_code_new='".$codatalist["subject_code"]."'")->queryOne();               
                                
                                $sysubject_code=$codatalist["subject_code"];
                                
                                $prerequisties="Nil";

                                $html.='<table class="table" width="100%">
                                    <tr>
                                        <td width="15%">
                                            <b>'.$sysubject_code.'</b>
                                        </td>
                                        <td width="70%" colspan="2" align=center>';
                                
                                        $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                            
                                     $html.='    </td>
                                        <td width="15%" align=center>
                                            <b>'.$codatalist["ltp"].'/0</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].$course_categorytype.'
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4">
                                            <b>Pre-requisite(s):'.($prerequisties).'</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Course Objectives:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_objectives'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    

                                   $html.=' <tr>
                                        <td colspan="4">
                                            <b>Course Outcomes:<br>
                                            Upon completion of the course, students shall have ability to
                                            </b>

                                        </td>
                                    </tr>';

                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_outcomes'.$l;
                                            $rpt='rpt'.$l;
                                            if($codatalist[$cot]!='')
                                            {
                                                $rptdta ='';
                                                if($codatalist[$rpt]!='')
                                                {
                                                    $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                }

                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                
                                    $html.=' </table><table class="table" width="100%">';
                                   
                                     
                                    if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                    {
                                         $html.='   <tr>
                                            <td colspan="4">
                                                <b>Course Content:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $module_title='module_title'.$l;
                                            $module_hr='module_hr'.$l;
                                            $module_content='cource_content_mod'.$l;
                                            if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                            {

                                                $html.='<tr>';
                                                $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                $html.='</tr>';

                                                $html.='<tr>';
                                                $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                $html.='</tr>';

                                               
                                            }
                                        }
                                    }

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(L):</b>
                                            </td>
                                            <td>
                                                <b>'.$ltot.'</b>
                                            </td>
                                        </tr>';
                                    }

                                    if($ttot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(T):</b>
                                            </td>
                                            <td>
                                                <b>'.$ttot.'</b>
                                            </td>
                                        </tr>';

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(LT):</b>
                                                </td>
                                                <td>
                                                    <b>'.($ttot+$ltot).'</b>
                                                </td>
                                            </tr>';
                                        }
                                    }
                                    
                                   
                                    $html.=' <tr>
                                        <td colspan="4">
                                            <b>Text Books:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=4;$l++)
                                        {
                                            $cot='text_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    
                                   
                                     $html.='<tr>
                                        <td colspan="4">
                                            <b>Reference Books:</b>
                                        </td>
                                    </tr>';
                                   
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='reference_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                   
                                    if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                    {
                                          $html.='  <tr>
                                                <td colspan="4">
                                                    <b>Web References:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='web_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   

                                    $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                    //print_r($online_reference1); exit();
                                    if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                    {
                                        
                                         $html.=' <tr>
                                            <td colspan="4">
                                                <b>Online References:</b>
                                            </td>
                                        </tr>';

                                        for($l=1;$l<=2;$l++)
                                        {
                                            $cot='online_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }                    
                                     $html.=' </table> ';
                                    if(!empty($co_matrix))
                                    {
                                        //print_r($co_matrix); exit();
                                        $colspan=$co_matrix[0]['pso_count'];

                                        $html.=' 

                                        <table border="1" width="100%">
                                        <tr>
                                            <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                             <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                              <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                        </tr>
                               
                                        <tr>';
                                        
                                        for ($i=1; $i <=12 ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        } 
                                        for ($i=1; $i <=$colspan ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        }
                                        $html.= "</tr>";

                                        if(!empty($co_matrix))
                                        {
                                            foreach ($co_matrix as $value2) 
                                            {
                                                $html.='<tr>';
                                                $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                                for ($i=1; $i <=12 ; $i++) 
                                                { 
                                                    $po='po'.$i;
                                                    if($value2[$po]==0)
                                                    {
                                                        $html.='<td style="text-align: center;">-</td>';
                                                    }
                                                    else
                                                    {
                                                        $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                    }
                                                }

                                                $pso_value=explode(",", $value2['pso_value']);
                                                for ($p=0; $p <$colspan ; $p++) 
                                                { 
                                                    if($pso_value[$p]==0)
                                                    {
                                                        $html.='<td style="text-align: center;">-</td>';
                                                    }
                                                    else
                                                    {
                                                         $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                    }
                                                }
                                                
                                                $html.='</tr>';

                                            }
                                        }

                                        $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                PSO - Programme Specific Outcomes
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                    }
                                    
                                        //$html.=' </table>';
                                        $html.=' <pagebreak>';
                                   $curriculumdata.=$html;
                            }
                        }

                    }
                    
                }

                $minorsubject1 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE  A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND coe_elective_option IN (203)")->queryAll();

                if(!empty($minorsubject1) && $sem[0]>=5)
                {
                    $curriculumdata.='<pagebreak>';

                    $curriculumdata.='<table class="table oectable" width="100%">
                                    <tr>
                                        <td>
                                            <h2><b>MINOR DEGREE COURSES</b></h2>
                                        </td>
                                    <tr>
                                    </table>';
                    $curriculumdata.='<pagebreak>';
                    //$curriculumdata='';
                    foreach ($minorsubject1 as $value) 
                    {
                        $html='';

                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                            if(empty($codatalist)) // regulation existing syllabus
                            {     
                                $qq = "SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106";

                                $codatalist = Yii::$app->db->createCommand($qq)->queryOne();
                                        
                                      
                            }

                        
                        $ltot=0;
                        $ttot=0;
                        $ptot=0;
                        if(!empty($codatalist))
                        {
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;

                            $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                            $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();
                                
                            if(empty($co_matrix))
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();
                            }

                            $course_categorytype='';
                            

                            if($codatalist['subject_category_type_id']=='140') //type1
                            {

                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='141') //type 2
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='142') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                            } 
                            else if($codatalist['subject_category_type_id']=='144') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                            }    
                            else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                            } 
                            else 
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                            }                 
                        

                            

                            $html.='<table class="table" width="100%">
                                <tr>
                                    <td width="15%">
                                        <b>'.$value["subject_code"].'</b>
                                    </td>
                                    <td width="70%" colspan="2" align=center>';
                            
                                    $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                        
                                 $html.='    </td>
                                    <td width="15%" align=center>
                                        <b>'.$codatalist["ltp"] .'/'.$codatalist["credit_point"]  .'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <b>Pre-requisite(s):'.($prerequisties).'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Course Objectives:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_objectives'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                

                               $html.=' <tr>
                                    <td colspan="4">
                                        <b>Course Outcomes:<br>
                                        Upon completion of the course, students shall have ability to
                                        </b>

                                    </td>
                                </tr>';

                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_outcomes'.$l;
                                        $rpt='rpt'.$l;
                                        if($codatalist[$cot]!='')
                                        {
                                            $rptdta ='';
                                            if($codatalist[$rpt]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                            }
                                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>CO'.$l.'</td>';
                                            $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                            $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                            
                                $html.=' </table><table class="table" width="100%">';
                               
                                 
                                if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                {
                                     $html.='   <tr>
                                        <td colspan="4">
                                            <b>Course Content:</b>
                                        </td>
                                    </tr>';
                                    for($l=1;$l<=3;$l++)
                                    {
                                        $module_title='module_title'.$l;
                                        $module_hr='module_hr'.$l;
                                        $module_content='cource_content_mod'.$l;
                                        if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                        {
                                            //$module_title=trim($codatalist[$module_title],"'");
                                            $html.='<tr>';
                                            $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                            $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                            $html.='</tr>';

                                            $html.='<tr>';
                                            $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                            $html.='</tr>';

                                           
                                        }
                                    }
                                }

                                if($ltot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(L):</b>
                                        </td>
                                        <td>
                                            <b>'.$ltot.'</b>
                                        </td>
                                    </tr>';
                                }

                                if($ttot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(T):</b>
                                        </td>
                                        <td>
                                            <b>'.$ttot.'</b>
                                        </td>
                                    </tr>';

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(LT):</b>
                                            </td>
                                            <td>
                                                <b>'.($ttot+$ltot).'</b>
                                            </td>
                                        </tr>';
                                    }
                                }
                                
                                if(!empty($colablist)) 
                                {

                                  $html.='   <tr>
                                        <th colspan="4">
                                            <b>Lab Components:</b>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>List of Experiments</th>
                                        <th>CO Mapping</th>
                                        <th>RBT</th>
                                    </tr>';

                                    $s=1;
                                    foreach ($colablist as $value) 
                                    {
                                        $cout=ltrim($value['cource_outcome'],",");
                                        $html.='<tr>';
                                        $html.='<td width=10% align=center>'.$s.'</td>';
                                        $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                        $html.='<td width=15% align=center>'.$cout.'</td>';
                                        $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                        $html.='</tr>';
                                        $s++;
                                    }

                                     $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(P):</b>
                                        </td>
                                        <td>
                                            <b>'.$ptot.'</b>
                                        </td>
                                    </tr>';
                                }
                               
                                $html.=' <tr>
                                    <td colspan="4">
                                        <b>Text Books:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=4;$l++)
                                    {
                                        $cot='text_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                
                               
                                 $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Books:</b>
                                    </td>
                                </tr>';
                               
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='reference_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               
                               
                                if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                {
                                      $html.='  <tr>
                                            <td colspan="4">
                                                <b>Web References:</b>
                                            </td>
                                        </tr>';

                                    for($l=1;$l<=3;$l++)
                                    {
                                        $cot='web_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               

                                $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                //print_r($online_reference1); exit();
                                if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                {
                                    
                                     $html.=' <tr>
                                        <td colspan="4">
                                            <b>Online References:</b>
                                        </td>
                                    </tr>';

                                    for($l=1;$l<=2;$l++)
                                    {
                                        $cot='online_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }                    
                                 $html.=' </table> ';
                                if(!empty($co_matrix))
                                {
                                    //print_r($co_matrix); exit();
                                    $colspan=$co_matrix[0]['pso_count'];

                                    $html.=' 

                                    <table border="1" width="100%">
                                    <tr>
                                        <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                         <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                          <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                    </tr>
                           
                                    <tr>';
                                    
                                    for ($i=1; $i <=12 ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    } 
                                    for ($i=1; $i <=$colspan ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    }
                                    $html.= "</tr>";

                                    if(!empty($co_matrix))
                                    {
                                        foreach ($co_matrix as $value2) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10% style="text-align: center;">'.$value2['co'].'</td>';
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $po='po'.$i;
                                                if($value2[$po]==0)
                                                {
                                                    $html.='<td style="text-align: center;">-</td>';
                                                }
                                                else
                                                {
                                                    $html.='<td style="text-align: center;">'.$value2[$po].'</td>';
                                                }
                                            }

                                            $pso_value=explode(",", $value2['pso_value']);
                                            for ($p=0; $p <$colspan ; $p++) 
                                            { 
                                                if($pso_value[$p]==0)
                                                {
                                                    $html.='<td style="text-align: center;">-</td>';
                                                }
                                                else
                                                {
                                                     $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                }
                                            }
                                            
                                            $html.='</tr>';

                                        }
                                    }

                                    $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                }
                                
                                    //$html.=' </table>';
                                    $html.=' <pagebreak>';
                               $curriculumdata.=$html;
                        }
                    }
                }
                

                $headtitle='';
                if(Yii::$app->request->post('coe_dept_id')>=9 && Yii::$app->request->post('coe_dept_id')<=15)
                {
                    $headtitle='Accredited by NBA';
                }

                $header = '<table class="table table-responsive dum_edit_table table-hover" >
                                    <tr>
                                      <td> 
                                        <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                      </td>

                                      <td align="center"> 
                                      <center><b><h4>' . $org_name . '</h4></b></center>
                                      <center> <h6>(An Autonomous Insitution, Accredited by NAAC with "A" Grade)</h6></center>
                                       <center><b><h5>Approved By AICTE and Affiliated to Anna University, Chennai</h5></b></center> 
                                         
                                      <center> <h6>' . $org_address . '</h6></center>
                                     
                                      <center><b><h6>'.$Deptname.'</h6></b></center> 
                                      <center> <h6>'.$headtitle.'</h6></center>
                                      <center> <h6>Applicable for Students Admitted from Academic Year '.$regulationyear.'-'.($regulationyear+1).'</h6></center>
                                      <center> <h6>(Choice Based Credit System)</h6></center>
                                 </td>
                                      <td align="center">  
                                        <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                      </td>
                                    </tr>                                          
                                </table>';

                if($check_bos>0 && $checksh_curriculumdata==0 && count($checkcurriculumdata)==0)
                {
                    $_SESSION['cdcfinalreport'] ='';
                    if (isset($_SESSION['cdcfinalreport1'])) 
                    {
                        unset($_SESSION['cdcfinalreport1']);
                    }
                    $_SESSION['cdcfinalreport1'] = $header.$curriculumdata;

                }
                else
                {
                    $_SESSION['cdcfinalreport1'] ='';
                    if (isset($_SESSION['cdcfinalreport'])) 
                    {
                        unset($_SESSION['cdcfinalreport']);
                    }
                    $_SESSION['cdcfinalreport'] = $header.$curriculumdata;
                }
                
                  $_SESSION['cdc_Deptname'] = $Deptname;

                  $_SESSION['cdc_regulationyear'] = $regulationyear;

                  if (isset($_SESSION['check_bos'])) 
                {
                    unset($_SESSION['check_bos']);
                }
                $_SESSION['check_bos'] = $check_bos;

                $_SESSION['acmfinalreport'] = $curriculumdata;

                $curriculumdata= $header.$curriculumdata;

                //frontpage start

                $_SESSION['matrixavg'] = $_SESSION['frontpageclg'] =$frontpage='';

                $cur_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontp_clg_list WHERE degree_type='".Yii::$app->request->post('degree_type')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $po_list = Yii::$app->db->createCommand("SELECT po_title,po FROM cur_frontp_clg_list WHERE cur_fp_id='".$cur_fp_id."' AND po!='-'")->queryAll();

                $frontpage.='<table class="table oectable" width="100%">
                                    <tr>
                                        <td>
                                            <h2><b>DEPARTMENT VISION MISSION</b></h2>
                                        </td>
                                    <tr>
                                    </table>';
                $frontpage.='<pagebreak>';

                $Deptnames = Yii::$app->db->createCommand("SELECT dept_name FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname JOIN coe_degree C ON C.coe_degree_id=A.coe_degree_id WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id." AND A.coe_programme_id=".$coe_programme_id)->queryScalar();

                $dept_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontpage_list WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $deptvision = Yii::$app->db->createCommand("SELECT vision FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."'")->queryScalar();

                $deptmissions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND mission!='-'")->queryAll();

                $deptmissions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND mission!='-'")->queryAll();

                $peo_list = Yii::$app->db->createCommand("SELECT cur_fpl_id,peo FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND peo!='-'")->queryAll();

                $pso_list = Yii::$app->db->createCommand("SELECT pso FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND pso!='-'")->queryAll();

                $frontpage.='<div align="center"><b> DEPARTMENT OF ' .strtoupper($Deptnames).'</b></div>';
                $frontpage.='<div align="left"><b>VISION</b></div><br>';
                $frontpage.='<div align="left">' . $deptvision . '</div><br><br><br>';
                $frontpage.='<div align="left"><b>MISSION</b></div><br><ul>';
                
                foreach ($deptmissions as $mvalue) 
                {
                    $frontpage.='<li>'.$mvalue['mission'].'</li>';
                }

                $frontpage.='</ul></div>';
                $frontpage.='<pagebreak>';
                $frontpage.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>PEO's, PO's & PSO's</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $frontpage.='<pagebreak>';

                $frontpage.='<div align="left"><b>PROGRAM EDUCTIONAL OBJECTIVES</b></div><ol>';
                foreach ($peo_list as $pvalue) 
                {
                    $frontpage.='<li>'.$pvalue['peo'].'</li>';
                }
                $frontpage.='</ol></div>';

                $frontpage.='<div align="left"><b>PROGRAM OUTCOMES</b></div><br>
                <p>Graduates of the '.strtoupper($Deptnames).' Program of '.strtoupper($org_name).' will have the ability to </p>
                <ol>';
                foreach ($po_list as $pvalue) 
                {
                    $frontpage.='<li><b>'.$pvalue['po_title'].'</b>: '.$pvalue['po'].'</li>';
                }
                $frontpage.='</ol></div>';
                $frontpage.='<pagebreak>';
                $frontpage.='<div align="left"><b>PROGRAM SPECIFIC OUTCOMES</b></div><br>
                <p>A graduate of the '.strtoupper($Deptnames).' Program of '.strtoupper($org_name).' will demonstrate:</p>
                <ol>';
                foreach ($pso_list as $pvalue) 
                {
                    $frontpage.='<li>'.$pvalue['pso'].'</li>';
                }
                $frontpage.='</ol></div>';
                
                $frontpage.="<div align='left'><b>PEO/PO MAPPING</b><br></div>
                <table width=100% border=1>
                <tr> <th>PEO/PO</th>";
                for ($k=1; $k <=12 ; $k++) 
                {
                    $frontpage.='<th>PO'.$k.'</th>';
                } 
                $frontpage.='</tr>';
                $jj=1; 
                foreach ($peo_list as $pvalue) 
                {
                    $frontpage.='<tr><td>PEO'.$jj.'</td>';

                    $checkpeopo =Yii::$app->db->createCommand("SELECT po_tick FROM cur_front_peo_po_mapping WHERE cur_fpl_id='".$pvalue['cur_fpl_id']."'")->queryAll();

                    foreach ($checkpeopo as $key => $ppvalue) 
                    {
                        if($ppvalue['po_tick']==0)
                        {
                            $frontpage.='<td align=center>-</td>';
                        }
                        else
                        {
                            $frontpage.="<td align=center>".$ppvalue['po_tick']."</td>"; 
                        }
                                              
                    }
                    $frontpage.='</tr>';
                    $jj++;
                }            
                $frontpage.='</table>';
                $frontpage.='<pagebreak>';
                $frontpage.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>MAPPING OF COURSE OUTCOMES WITH PROGRAM OUTCOMES</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $frontpage.='<pagebreak>';
                $frontpage.="<div align='center'><b>MAPPING OF COURSE OUTCOMES WITH PROGRAM OUTCOMES</b><br><br></div>";

                $curiculum_start='<pagebreak>';
                $curiculum_start.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>CURRICULUM</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $curiculum_start.='<pagebreak>';


                $_SESSION['matrixavg'] = $frontpage.$matrixavg."</table>".$matrixavg1.$curiculum_start;

                //front page end


                $corefromotherdept = Yii::$app->db->createCommand("SELECT A.* FROM cur_curriculum_subject A JOIN cur_electivetodept B ON B.coe_subject_id=A.coe_cur_id AND B.coe_regulation_id=A.coe_regulation_id WHERE B.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.approve_status=0")->queryAll();

                $corefromotherdept1 = Yii::$app->db->createCommand("SELECT A.* FROM cur_elective_subject A JOIN cur_electivetodept B ON B.coe_subject_id=A.coe_elective_id AND B.coe_regulation_id=A.coe_regulation_id WHERE B.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.approve_status=0")->queryAll();

                $servicecoursefromotherdept=array_merge($corefromotherdept,$corefromotherdept1);

                if (isset($_SESSION['servicecoursefromotherdept'])) 
                {
                    unset($_SESSION['servicecoursefromotherdept']);
                }
                $_SESSION['servicecoursefromotherdept'] = count($servicecoursefromotherdept);

                 $syllabusapprove = Yii::$app->db->createCommand("SELECT * FROM cur_syllabus WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='1'")->queryAll();

                 if (isset($_SESSION['syllabusapprove'])) 
                {
                    unset($_SESSION['syllabusapprove']);
                }
                $_SESSION['syllabusapprove'] = count($syllabusapprove);

                $check_bos_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_bos WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND bos_min_file!='' AND bos_attendance_file!='' AND semester='".$semester."'")->queryScalar();

                 $syllabusnoapprove = Yii::$app->db->createCommand("SELECT count(*) FROM cur_syllabus WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='0'")->queryScalar();

                $curdata[]=array('check_bos'=>$check_bos,'checksh_curriculumdata'=>$checksh_curriculumdata,'noapproved'=>count($checkcurriculumdata1),'syllabusnoapprove'=>$syllabusnoapprove,'servicecoursefromotherdept'=>count($servicecoursefromotherdept),'curriculumdata'=>$curriculumdata,'totalcredit'=>$overllcredittot,'check_bos_status'=>$check_bos_status);
            }
            else
            {
                $curdata[]=array('curriculumdata'=>$curriculumdata);
            }
        }
        else if(Yii::$app->request->post('degree_type')=='UG' && $degreetype == 'MBA')
        { 
            $check_bos = Yii::$app->db->createCommand("SELECT count(*) FROM cur_bos WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND bos_min_file!='' AND bos_attendance_file!='' AND semester='".$semester."'")->queryScalar();

            $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

            $batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();


             $coe_programme_id = Yii::$app->db->createCommand("SELECT A.coe_programme_id FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname  WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id)->queryScalar();

            $Deptname = Yii::$app->db->createCommand("SELECT dept_name FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname JOIN coe_degree C ON C.coe_degree_id=A.coe_degree_id WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id." AND A.coe_programme_id=".$coe_programme_id)->queryScalar();

            $checkcurriculumdata = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".$degreetype."' AND A.coe_elective_option IN ('216') GROUP BY A.subject_code")->queryAll();

                if(!empty($checkcurriculumdata))
                {
                    //$curriculumdata='';

                    $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                    $curriculumdata.="<tr>";
                    $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                    //$curriculumdata.="<th style='text-align:center !important;'>Category</th>";
                    $curriculumdata.="</tr>";

                     $sl=1; $electcount=0;
                    foreach ($checkcurriculumdata as $value) 
                    {
                        
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                        $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['credit_point']."</td>";
                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                        //$curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['subjectctype']."</td>";
                        $curriculumdata.="</tr>";
                       
                        $electcount=$electcount+1;
                         $sl++;
                    }


                    $curriculumdata.="</table>";
                }

                $minordegreecourse = Yii::$app->db->createCommand("SELECT * FROM cur_vertical_stream A JOIN cur_elective_subject B ON B.cur_vs_id=A.cur_vs_id WHERE B.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')."  AND B.coe_elective_option IN ('203') GROUP BY A.vertical_name ORDER BY A.cur_vs_id ASC")->queryAll(); //AND B.degree_type='".Yii::$app->request->post('degree_type')."'

                //print_r($minordegreecourse); exit;
                if(!empty($minordegreecourse))
                {
                   //$curriculumdata='';

                    $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                    $curriculumdata.="<tr>";
                    $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> MINOR DEGREE COURSES </th>";
                    $curriculumdata.="</tr>";

                    $tempname=''; $streamname='';
                    foreach ($minordegreecourse as $stream) 
                    {
                        $minor_count = Yii::$app->db->createCommand("SELECT sum(vertical_count) FROM cur_vertical_stream  WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND vertical_name='".$stream['vertical_name']."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."'")->queryScalar();

                        if($tempname!=$stream['vertical_name'])
                        {
                            
                            $streamname=$stream['vertical_name'];

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> ".$stream['vertical_name']." Course Count(".$minor_count.") </th>";
                            $curriculumdata.="</tr>";

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                            $curriculumdata.="</tr>";
                             $sl=1;
                        }
                        
                        $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_vertical_stream F ON F.cur_vs_id=A.cur_vs_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND F.vertical_name='".$stream['vertical_name']."' GROUP BY A.subject_code, F.cur_vs_id")->queryAll(); // AND A.degree_type='".Yii::$app->request->post('degree_type')."' 

                        $electcount=0;
                        foreach ($curriculumsemdata as $value) 
                        {
                            
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['credit_point']."</td>";
                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['intext_mark']."</td>";
                            $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="</tr>";
                           
                            $electcount=$electcount+1;
                            $sl++;
                        }


                        $tempname=$stream['vertical_name'];
                    }

                    $curriculumdata.="</table>";

                }

                $minorsubject1 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE  A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND coe_elective_option IN (203)")->queryAll();

                if(!empty($minorsubject1))
                {
                    $curriculumdata.='<pagebreak>';
                    //$curriculumdata='';
                    foreach ($minorsubject1 as $value) 
                    {
                        $html='';

                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                        
                        $ltot=0;
                        $ttot=0;
                        $ptot=0;
                        if(!empty($codatalist))
                        {
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;

                            $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                            $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();
                                
                            if(empty($co_matrix))
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();
                            }

                            $course_categorytype='';
                            

                            if($codatalist['subject_category_type_id']=='140') //type1
                            {

                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='141') //type 2
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='142') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                            } 
                            else if($codatalist['subject_category_type_id']=='144') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                            }    
                            else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                            } 
                            else 
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                            }                 
                        

                            $prerequisties='Nil';

                            $html.='<table class="table" width="100%">
                                <tr>
                                    <td width="15%">
                                        <b>'.$value["subject_code"].'</b>
                                    </td>
                                    <td width="70%" colspan="2" align=center>';
                            
                                    $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                        
                                 $html.='    </td>
                                    <td width="15%" align=center>
                                        <b>'.$codatalist["ltp"].'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <b>Pre-requisite(s):'.($prerequisties).'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Course Objectives:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_objectives'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                

                               $html.=' <tr>
                                    <td colspan="4">
                                        <b>Course Outcomes:<br>
                                        Upon completion of the course, students shall have ability to
                                        </b>

                                    </td>
                                </tr>';

                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_outcomes'.$l;
                                        $rpt='rpt'.$l;
                                        if($codatalist[$cot]!='')
                                        {
                                            $rptdta ='';
                                            if($codatalist[$rpt]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                            }
                                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>CO'.$l.'</td>';
                                            $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                            $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                            
                                $html.=' </table><table class="table" width="100%">';
                               
                                 
                                if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                {
                                     $html.='   <tr>
                                        <td colspan="4">
                                            <b>Course Content:</b>
                                        </td>
                                    </tr>';
                                    for($l=1;$l<=3;$l++)
                                    {
                                        $module_title='module_title'.$l;
                                        $module_hr='module_hr'.$l;
                                        $module_content='cource_content_mod'.$l;
                                        if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                        {
                                            //$module_title=trim($codatalist[$module_title],"'");
                                            $html.='<tr>';
                                            $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                            $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                            $html.='</tr>';

                                            $html.='<tr>';
                                            $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                            $html.='</tr>';

                                           
                                        }
                                    }
                                }

                                if($ltot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(L):</b>
                                        </td>
                                        <td>
                                            <b>'.$ltot.'</b>
                                        </td>
                                    </tr>';
                                }

                                if($ttot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(T):</b>
                                        </td>
                                        <td>
                                            <b>'.$ttot.'</b>
                                        </td>
                                    </tr>';

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(LT):</b>
                                            </td>
                                            <td>
                                                <b>'.($ttot+$ltot).'</b>
                                            </td>
                                        </tr>';
                                    }
                                }
                                
                                if(!empty($colablist)) 
                                {

                                  $html.='   <tr>
                                        <th colspan="4">
                                            <b>Lab Components:</b>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>List of Experiments</th>
                                        <th>CO Mapping</th>
                                        <th>RBT</th>
                                    </tr>';

                                    $s=1;
                                    foreach ($colablist as $value) 
                                    {
                                        $cout=ltrim($value['cource_outcome'],",");
                                        $html.='<tr>';
                                        $html.='<td width=10% align=center>'.$s.'</td>';
                                        $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                        $html.='<td width=15% align=center>'.$cout.'</td>';
                                        $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                        $html.='</tr>';
                                        $s++;
                                    }

                                     $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(P):</b>
                                        </td>
                                        <td>
                                            <b>'.$ptot.'</b>
                                        </td>
                                    </tr>';
                                }
                               
                                $html.=' <tr>
                                    <td colspan="4">
                                        <b>Text Books:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=4;$l++)
                                    {
                                        $cot='text_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                
                               
                                 $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Books:</b>
                                    </td>
                                </tr>';
                               
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='reference_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               
                               
                                if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                {
                                      $html.='  <tr>
                                            <td colspan="4">
                                                <b>Web References:</b>
                                            </td>
                                        </tr>';

                                    for($l=1;$l<=3;$l++)
                                    {
                                        $cot='web_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               

                                $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                //print_r($online_reference1); exit();
                                if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                {
                                    
                                     $html.=' <tr>
                                        <td colspan="4">
                                            <b>Online References:</b>
                                        </td>
                                    </tr>';

                                    for($l=1;$l<=2;$l++)
                                    {
                                        $cot='online_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }                    
                                 $html.=' </table> ';
                                if(!empty($co_matrix))
                                {
                                    //print_r($co_matrix); exit();
                                    $colspan=$co_matrix[0]['pso_count'];

                                    $html.=' 

                                    <table border="1" width="100%">
                                    <tr>
                                        <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                         <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                          <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                    </tr>
                           
                                    <tr>';
                                    
                                    for ($i=1; $i <=12 ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    } 
                                    for ($i=1; $i <=$colspan ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    }
                                    $html.= "</tr>";

                                    if(!empty($co_matrix))
                                    {
                                        foreach ($co_matrix as $value) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $po='po'.$i;
                                                $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                            }

                                            $pso_value=explode(",", $value['pso_value']);
                                            for ($p=0; $p <$colspan ; $p++) 
                                            { 
                                                $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                            }
                                            
                                            $html.='</tr>';

                                        }
                                    }

                                    $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                }
                                
                                    //$html.=' </table>';
                                    $html.=' <pagebreak>';
                               $curriculumdata.=$html;
                        }
                    }
                }
                 require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
                $header = '<table class="table table-responsive dum_edit_table table-hover" >
                                <tr>
                                  <td> 
                                    <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                  </td>

                                  <td align="center"> 
                                  <center><b><h4>' . $org_name . '</h4></b></center>
                                  <center> <h6>' . $org_address . '</h6></center>
                                  <center><b><h5>' . $org_tagline . '</h5></b></center> 
                                  <center><b><h6>'.$Deptname.'</h6></b></center>
                                      <center> <h6>Applicable for Students Admitted from Academic Year </h6></center>
                                      <center> <h6>(Choice Based Credit System)</h6></center>
                             </td>
                                  <td align="center">  
                                    <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                  </td>
                                </tr>                                          
                            </table>';

            if (isset($_SESSION['syllabusapprove'])) 
            {
                unset($_SESSION['syllabusapprove']);
            }
            
            $_SESSION['syllabusapprove'] = $header.$curriculumdata;

            $_SESSION['cdcfinalreport'] = $header.$curriculumdata;

            $_SESSION['cdc_Deptname'] = $Deptname;

            $_SESSION['cdc_regulationyear'] = $regulationyear;

            $checkcurriculumdata1 = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".$degreetype."' AND A.coe_elective_option IN ('216') AND A.approve_status=1 GROUP BY A.subject_code")->queryAll();

            $curdata[]=array('check_bos'=>$check_bos, 'noapproved'=>count($checkcurriculumdata1), 'curriculumdata'=>$curriculumdata,'totalcredit'=>$overllcredittot);
        }
        else if(Yii::$app->request->post('degree_type')=='MBA' && $degreetype == 'MBA')
        {

            $check_bos = Yii::$app->db->createCommand("SELECT count(*) FROM cur_bos WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND bos_min_file!='' AND bos_attendance_file!='' AND semester='".$semester."'")->queryScalar();

           $checkcurriculumdata = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status=1")->queryAll();

           $checkcurriculumdata1 = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status=1")->queryAll();

            $streamdata = Yii::$app->db->createCommand("SELECT *,A.coe_dept_id FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.stream_name IN ('PEC')")->queryAll();

            $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

            $batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();


             $coe_programme_id = Yii::$app->db->createCommand("SELECT A.coe_programme_id FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname  WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id)->queryScalar();

            $Deptname = Yii::$app->db->createCommand("SELECT dept_name FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname JOIN coe_degree C ON C.coe_degree_id=A.coe_degree_id WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id." AND A.coe_programme_id=".$coe_programme_id)->queryScalar();

            $output = substr($regulationyear, 2, 3);

            if(Yii::$app->request->post('coe_regulation_id')>=95)
            {
                 $electcreditpoint=3;
            }
            else 
            {
                $electcreditpoint=4; // credit point elective per paper
            }
            $header =$curriculumdata=''; $overallhrtot=$overallextinttot=$overllcredittot=0;
            require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
            if(!empty($checkcurriculumdata))
            {
                $loop_pec=$loop_eec=$loop_oec=1; $mcloop=1;
                for ($s=1; $s <=4 ; $s++) 
                { 
                    $semcredittot=$semhrtot=$semextint=0;               
                    
                    $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id,A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND semester=".$s." GROUP BY A.subject_code, A.semester")->queryAll();

                    if(!empty($curriculumsemdata))
                    {
                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=9 style='text-align:center !important;'>Semester ".$roman[$s]."</th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                        $sl=1;
                        foreach ($curriculumsemdata as $value) 
                        {
                            if($value['type_order']==1 || $value['subject_name']=='Bridge Course')
                            {
                                if($value['subject_name']=='Bridge Course')
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    
                                    $curriculumdata.="<td align=center  style='text-align:center !important;' colspan=2>10 Days</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                     $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot;//+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);

                                }
                                else
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                     $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                
                                }
                               
                                $sl++;
                            }
                        }
                       
                        $semstream="sem".$s;

                        $sc = Yii::$app->db->createCommand("SELECT prefix_name FROM cur_subject_prefix WHERE `coe_dept_id`='".Yii::$app->request->post('coe_dept_id')."' ORDER BY coe_prefix_id ASC ")->queryScalar(); 
                        
                        foreach ($streamdata as $value) 
                        {
                            $credit=round($value[$semstream]/$electcreditpoint);

                            $intpart = floor( ($value[$semstream]/$electcreditpoint) );   // results in 3
                            $fraction =($value[$semstream]/$electcreditpoint)- $intpart; // results in 0.75

                            if($fraction>0)
                            {
                                $electcreditpoint=$value[$semstream];
                            }

                            for ($st=0; $st < $credit; $st++) 
                            { 
                                $subject_type='';
                                if($value['stream_name']=='PEC')
                                {
                                    $ltp = Yii::$app->db->createCommand("SELECT concat(L,'-',T,'-',P) as LTP, contact_hrsperweek, concat(internal_mark,'/',external_mark) as intext_mark, internal_mark, external_mark, subject_type_id FROM cur_ltp WHERE credit_point=".$electcreditpoint."  AND subject_category_type_id=143")->queryOne();  

                                    $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar();  
                                }
                                


                                   //echo $loop; exit();
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                   
                                    
                                    if($value['stream_name']=='PEC')
                                    {
                                        $curriculumdata.="<td style='text-align:center !important;'>".$output.$sc."EXX</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['stream_fullname']." - ".$roman[$loop_pec]."</td>";
                                        $loop_pec++;
                                    }

                                    
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$electcreditpoint."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";


                                $semcredittot=$semcredittot+$electcreditpoint;
                                $semhrtot=$semhrtot+$ltp['contact_hrsperweek'];
                                $semextint=$semextint+($ltp['external_mark']+$ltp['internal_mark']);

                                
                                //$loop++;
                                $sl++;
                            }

                        }

                        foreach ($curriculumsemdata as $value) 
                        {
                            if($value['type_order']>=2)
                            {
                                if($value['subject_name']=='Bridge Course')
                                {
                                   
                                }
                                else if($value['internal_mark']=='100')
                                {

                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    
                                    $curriculumdata.="<td align=center  style='text-align:center !important;' colspan=2>-</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                    $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot;//+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                     $sl++;
                                }
                                else
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                     $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    $sl++;
                                }
                               
                                
                            }
                        }

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<td  align=center  colspan=4 style='text-align:center !important;'><b>Total</b> </td>";
                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$semhrtot."</td>";
                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$semcredittot."</td>";
                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$semextint."</td>";
                        $curriculumdata.="<td align=center colspan=2></td>";
                        $curriculumdata.="</tr>";

                        $overallhrtot=$overallhrtot+$semhrtot;
                        $overallextinttot=$overallextinttot+$semextint;
                        $overllcredittot=$overllcredittot+$semcredittot;
                        
                        $curriculumdata.="</table><br>";
                    }

                }

                //pec start

                $vertical_stream = Yii::$app->db->createCommand("SELECT * FROM cur_vertical_stream A JOIN cur_elective_subject B ON B.cur_vs_id=A.cur_vs_id WHERE B.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option IN ('192') GROUP BY B.cur_vs_id ORDER BY B.cur_vs_id ASC")->queryAll();

                if(!empty($vertical_stream))
                {
                    //$curriculumdata='';

                    $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                    $curriculumdata.="<tr>";
                    $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> PROFESSIONAL ELECTIVE COURSES (PEC) </th>";
                    $curriculumdata.="</tr>";

                    
                    foreach ($vertical_stream as $stream) 
                    {
                        $pec_count = Yii::$app->db->createCommand("SELECT vertical_count FROM cur_vertical_stream A JOIN cur_elective_subject B ON B.cur_vs_id=A.cur_vs_id WHERE B.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option IN ('192') AND B.cur_vs_id=".$stream['cur_vs_id'])->queryScalar();

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> ".$stream['vertical_name']." (".$pec_count.") </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                        $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_vertical_stream F ON F.cur_vs_id=A.cur_vs_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.cur_vs_id='".$stream['cur_vs_id']."' GROUP BY A.subject_code, F.cur_vs_id")->queryAll();

                        $sl=1; $electcount=0;
                        foreach ($curriculumsemdata as $value) 
                        {
                            
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="</tr>";
                           

                            $electcount=$electcount+1;
                            $sl++;
                        }

                        if($electcount!=$pec_count)
                        {
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>PEC Count Mismatch (Current Count Total: ".$electcount.")</b> </td></tr>";
                        }
                    }

                        

                    $curriculumdata.="</table>";

                }

                $vac_courses = Yii::$app->db->createCommand("SELECT A.* FROM cur_vac_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' GROUP BY A.subject_code")->queryAll();

                if(!empty($vac_courses))
                {
                    //$curriculumdata='';
                    $curriculumdata.= '<pagebreak>';
                    $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                    $curriculumdata.="<tr>";
                    $curriculumdata.="<th align=center colspan=4 style='text-align:center !important;'> VALUE ADDED COURSES</th>";
                    $curriculumdata.="</tr>";

                    $curriculumdata.="<tr>";
                    $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                    $curriculumdata.="<th style='text-align:center !important;'>Course Name</th>";
                     $curriculumdata.="<th style='text-align:center !important;'>Contact Hours</th>";
                     //$curriculumdata.="<th style='text-align:center !important;'>Credit Point</th>";
                    $curriculumdata.="</tr>";

                     $sl=1;
                    foreach ($vac_courses as $value) 
                    {
                        
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                        $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['subject_name'])."</td>";
                        $curriculumdata.="<td style='text-align:center !important;'>".$value['course_hours']."</td>";
                       // $curriculumdata.="<td style='text-align:center !important;'>".$value['credit_point']."</td>";
                        $curriculumdata.="</tr>";                   
                        $sl++;
                    }

                    $curriculumdata.="</table>";
                }

                $curi_streamdata=Yii::$app->db->createCommand("SELECT A.*,B.stream_fullname,A.aicte_norms FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' ORDER BY B.cur_an_id ASC ")->queryAll();

                $curi_stream='';

                if(!empty($curi_streamdata))
                {
                    $curi_stream.= '<pagebreak>';
                     $curi_stream.= '<div align=center> <b>CREDIT DISTRIBUTION – SUMMARY</b><br></div>';
                     $curi_stream.= '<table class="table table-responsive table-hover" width=100% border=1>
                     <thead>
                        <tr>
                            <th  align=center style="text-align: center;">S.No.</th>
                            <th  align=center style="text-align: center;">Stream</th>';
                        for ($i=1; $i <=4 ; $i++) 
                        { 
                             $curi_stream.= '<th  style="text-align: center;">Sem '.$i.'</th>';
                       }
                         $curi_stream.= ' <th  align=center style="text-align: center;">Total Credit</th>
                        </tr>
                    </thead><tbody>';

                    $sl=1; $total_credit= $total_aicte_norms=0;
                    foreach ($curi_streamdata as $value) 
                    {
                        $curi_stream.= '<tr>
                        <td  align=center style="text-align: center;">'.$sl.'</td>
                        <td  align=center style="text-align: center;">'. $value['stream_fullname'].'</td>';
                        
                        for ($s=1; $s <=4 ; $s++) 
                        { 
                            $name="sem".$s;
                            $values=$value[$name];
                        
                            $curi_stream.= '<td  align=center style="text-align: center;">'. $values.'</td>';
                        }
                        $curi_stream.= '<td  align=center style="text-align: center;">'. $value['total_credit'].'</td>
                        </tr>';
                    
                        $total_aicte_norms=$total_aicte_norms+$value['aicte_norms'];
                        $total_credit=$total_credit+$value['total_credit'];
                         $sl++;
                    }

                    $curi_stream.='<tr>
                        <td align=center colspan="2" align="right"><b>Total</b></td>';
                        
                        for ($s=1; $s <=4 ; $s++) 
                        { 
                            $semtot=0;
                            $name="sem".$s;
                            foreach ($curi_streamdata as $value) 
                            {
                                $semtot=$semtot+$value[$name];
                            }
                        $curi_stream.='<td align=center style="text-align: center;">'. $semtot.'</td>';
                        }
                        $curi_stream.='<td align=center style="text-align: center;">'. $total_credit.'</td>
                        </tr>';

                     $curi_stream.='</table>';
                }

                 $curriculumdata.=$curi_stream;

                //syllabus start

                $curriculumdata.='<pagebreak>';
                $curriculumdata.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>SYLLABUS</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $curriculumdata.='<pagebreak>';

                 $coresubject = Yii::$app->db->createCommand("SELECT A.subject_code,A.semester FROM cur_curriculum_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."'".$sem_num." ORDER BY A.semester, A.subject_code")->queryAll();

                $semcredit='';
                
                $semcolumn='';
                
                if(count($sem)>1)
                {
                    for ($ss=$sem[0]; $ss <=$sem[1] ; $ss++) 
                    { 
                        
                        $semm=" AND sem".$ss."!=''";
                        $semcolumn="sem".$ss;
                        $checksemdata = Yii::$app->db->createCommand("SELECT A.* FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('PEC')".$semm)->queryAll();

                        if(!empty($checksemdata))
                        {
                            if($semcredit=='')
                            {
                                $semcredit.=" AND (sem".$ss."!=''";
                            }
                            else if($semcredit!='')
                            {
                                $semcredit.=" OR sem".$ss."!=''";
                            }
                        }
                        
                        
                    }

                }
                else
                {
                    $semcredit=" AND sem".$sem[0]."!=''";
                }
                 
                if($semcredit!='' && (count($sem)>1))          
                {
                    $semcredit=$semcredit.") ";
                }
                
                if(!empty($coresubject))
                {
                    
                   //$curriculumdata.='<pagebreak>';

                   //$curriculumdata='';
                    $tempsem=0;
                    foreach ($coresubject as $value) 
                    {

                        if($tempsem!=$value['semester'])
                        {
                            $curriculumdata.='<table class="table oectable" width="100%">
                                                <tr>
                                                    <td>
                                                        <h2><b>SEMESTER '.$roman[$value['semester']].'</b></h2>
                                                    </td>
                                                <tr>
                                                </table>';
                            $curriculumdata.='<pagebreak>';
                        }

                        $tempsem=$value['semester'];

                        $html='';

                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();        
                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                        $ltot=0;
                        $ttot=0;
                        $ptot=0;
                        
                        if(!empty($codatalist)) 
                        {
                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;
                        
                            $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                            $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                
                            if(empty($co_matrix))
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                            }

                            $course_categorytype='';
                            

                            if($codatalist['subject_category_type_id']=='140') //type1
                            {

                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='141') //type 2
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='142') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                            } 
                            else if($codatalist['subject_category_type_id']=='144') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                            }    
                            else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                            } 
                            else 
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                            }  

                            $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE A.subject_code='".$codatalist["subject_code"]."' OR A.subject_code_new='".$codatalist["subject_code"]."'")->queryOne();               
                            
                            $sysubject_code='';
                            if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                            {
                                $sysubject_code=$samesubjectcode['subject_code_new']."/ ".$samesubjectcode['subject_code'];
                            }
                            else
                            {
                                $sysubject_code=$codatalist["subject_code"];
                            }

                            $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];

                            $ltp='';
                            if($codatalist['subject_name']=='Bridge Course')
                            {
                                $ltp='10 Days';
                            }
                            else
                            {
                                $ltp=$codatalist["ltp"];
                            }

                            $html.='<table class="table" width="100%">
                                <tr>
                                    <td width="15%">
                                        <b>'.$sysubject_code.'</b>
                                    </td>
                                    <td width="70%" colspan="2" align=center>';
                            
                                    $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                        
                                 $html.='    </td>
                                    <td width="15%" align=center>
                                        <b>'.$ltp.'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <b>Pre-requisite(s):'.($prerequisties).'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Course Objectives:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_objectives'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                

                               $html.=' <tr>
                                    <td colspan="4">
                                        <b>Course Outcomes:<br>
                                        Upon completion of the course, students shall have ability to
                                        </b>

                                    </td>
                                </tr>';

                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_outcomes'.$l;
                                        $rpt='rpt'.$l;
                                        if($codatalist[$cot]!='')
                                        {
                                            $rptdta ='';
                                            if($codatalist[$rpt]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                            }

                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>CO'.$l.'</td>';
                                            $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                            $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                            
                                $html.=' </table><table class="table" width="100%">';
                               
                                 
                                if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                {
                                     $html.='   <tr>
                                        <td colspan="4">
                                            <b>Course Content:</b>
                                        </td>
                                    </tr>';
                                    for($l=1;$l<=5;$l++)
                                    {
                                        $module_title='module_title'.$l;
                                        $module_hr='module_hr'.$l;
                                        $module_content='cource_content_mod'.$l;
                                        if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                        {

                                            $html.='<tr>';
                                            $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                            $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                            $html.='</tr>';

                                            $html.='<tr>';
                                            $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                            $html.='</tr>';

                                           
                                        }
                                    }
                                }

                                if($ltot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(L):</b>
                                        </td>
                                        <td>
                                            <b>'.$ltot.'</b>
                                        </td>
                                    </tr>';
                                }

                                if($ttot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(T):</b>
                                        </td>
                                        <td>
                                            <b>'.$ttot.'</b>
                                        </td>
                                    </tr>';

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(LT):</b>
                                            </td>
                                            <td>
                                                <b>'.($ttot+$ltot).'</b>
                                            </td>
                                        </tr>';
                                    }
                                }
                                
                                if(!empty($colablist)) 
                                {

                                  $html.='   <tr>
                                        <th colspan="4">
                                            <b>Lab Components:</b>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>List of Experiments</th>
                                        <th>CO Mapping</th>
                                        <th>RBT</th>
                                    </tr>';

                                    $s=1;
                                    foreach ($colablist as $value) 
                                    {
                                        $cout=ltrim($value['cource_outcome'],",");
                                        $html.='<tr>';
                                        $html.='<td width=10% align=center>'.$s.'</td>';
                                        $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                        $html.='<td width=15% align=center>'.$cout.'</td>';
                                        $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                        $html.='</tr>';
                                        $s++;
                                    }

                                     $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(P):</b>
                                        </td>
                                        <td>
                                            <b>'.$ptot.'</b>
                                        </td>
                                    </tr>';
                                }
                               
                                $html.=' <tr>
                                    <td colspan="4">
                                        <b>Text Books:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=4;$l++)
                                    {
                                        $cot='text_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                
                               
                                 $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Books:</b>
                                    </td>
                                </tr>';
                               
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='reference_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               
                               
                                if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                {
                                      $html.='  <tr>
                                            <td colspan="4">
                                                <b>Web References:</b>
                                            </td>
                                        </tr>';

                                    for($l=1;$l<=3;$l++)
                                    {
                                        $cot='web_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               

                                $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                //print_r($online_reference1); exit();
                                if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                {
                                    
                                     $html.=' <tr>
                                        <td colspan="4">
                                            <b>Online References:</b>
                                        </td>
                                    </tr>';

                                    for($l=1;$l<=2;$l++)
                                    {
                                        $cot='online_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }                    
                                 $html.=' </table> ';
                                if(!empty($co_matrix))
                                {
                                    //print_r($co_matrix); exit();
                                    $colspan=$co_matrix[0]['pso_count'];

                                    $html.=' 

                                    <table border="1" width="100%">
                                    <tr>
                                        <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                         <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                          <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                    </tr>
                           
                                    <tr>';
                                    
                                    for ($i=1; $i <=12 ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    } 
                                    for ($i=1; $i <=$colspan ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    }
                                    $html.= "</tr>";

                                    if(!empty($co_matrix))
                                    {
                                        foreach ($co_matrix as $value) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $po='po'.$i;
                                                $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                            }

                                            $pso_value=explode(",", $value['pso_value']);
                                            for ($p=0; $p <$colspan ; $p++) 
                                            { 
                                                $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                            }
                                            
                                            $html.='</tr>';

                                        }
                                    }

                                    $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                }
                                
                                    //$html.=' </table>';
                                    $html.=' <pagebreak>';
                               $curriculumdata.=$html;
                        }

                        //$tempsem=$value['semester'];
                    }

                    
                }
                
                //$curriculumdata='';
                //echo $semcredit; exit;
                if(!empty($semcredit))
                {
                    $getsemcredit = Yii::$app->db->createCommand("SELECT A.* FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('PEC')".$semcredit)->queryAll();

                    $curriculumdata.='<pagebreak>';
                    //$curriculumdata='';
                    $electivesubject = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option IN (192) ORDER BY A.subject_code")->queryAll();

                    foreach ($electivesubject as $value) 
                    {
                        $html='';

                        $ltot=0;
                        $ttot=0;
                        $ptot=0;
                        
                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();
                        
                        if(!empty($codatalist)) 
                        {
                            $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;

                            $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                            $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                
                            if(empty($co_matrix))
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                            }

                            $course_categorytype='';
                            

                            if($codatalist['subject_category_type_id']=='140') //type1
                            {

                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='141') //type 2
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='142') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                            } 
                            else if($codatalist['subject_category_type_id']=='144') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                            }    
                            else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                            } 
                            else 
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                            }                 
                        
                            $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE A.subject_code='".$value["subject_code"]."' OR A.subject_code_new='".$value["subject_code"]."'")->queryOne();               
                            
                            $sysubject_code='';
                            if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                            {
                                $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                            }
                            else
                            {
                                $sysubject_code=$value["subject_code"];
                            }
                            

                            $html.='<table class="table" width="100%">
                                <tr>
                                    <td width="15%">
                                        <b>'.$sysubject_code.'</b>
                                    </td>
                                    <td width="70%" colspan="2" align=center>';
                            
                                    $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                        
                                 $html.='    </td>
                                    <td width="15%" align=center>
                                        <b>'.$codatalist["ltp"].'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <b>Pre-requisite(s):'.($prerequisties).'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Course Objectives:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_objectives'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                

                               $html.=' <tr>
                                    <td colspan="4">
                                        <b>Course Outcomes:<br>
                                        Upon completion of the course, students shall have ability to
                                        </b>

                                    </td>
                                </tr>';

                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_outcomes'.$l;
                                        $rpt='rpt'.$l;
                                        if($codatalist[$cot]!='')
                                        {
                                            $rptdta ='';
                                            if($codatalist[$rpt]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                            }
                                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>CO'.$l.'</td>';
                                            $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                            $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                            
                                $html.=' </table><table class="table" width="100%">';
                               
                                 
                                if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                {
                                     $html.='   <tr>
                                        <td colspan="4">
                                            <b>Course Content:</b>
                                        </td>
                                    </tr>';
                                    for($l=1;$l<=5;$l++)
                                    {
                                        $module_title='module_title'.$l;
                                        $module_hr='module_hr'.$l;
                                        $module_content='cource_content_mod'.$l;
                                        if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                        {
                                            //$module_title=trim($codatalist[$module_title],"'");
                                            $html.='<tr>';
                                            $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                            $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                            $html.='</tr>';

                                            $html.='<tr>';
                                            $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                            $html.='</tr>';

                                           
                                        }
                                    }
                                }

                                if($ltot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(L):</b>
                                        </td>
                                        <td>
                                            <b>'.$ltot.'</b>
                                        </td>
                                    </tr>';
                                }

                                if($ttot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(T):</b>
                                        </td>
                                        <td>
                                            <b>'.$ttot.'</b>
                                        </td>
                                    </tr>';

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(LT):</b>
                                            </td>
                                            <td>
                                                <b>'.($ttot+$ltot).'</b>
                                            </td>
                                        </tr>';
                                    }
                                }
                                
                                if(!empty($colablist)) 
                                {

                                  $html.='   <tr>
                                        <th colspan="4">
                                            <b>Lab Components:</b>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>List of Experiments</th>
                                        <th>CO Mapping</th>
                                        <th>RBT</th>
                                    </tr>';

                                    $s=1;
                                    foreach ($colablist as $value) 
                                    {
                                        $cout=ltrim($value['cource_outcome'],",");
                                        $html.='<tr>';
                                        $html.='<td width=10% align=center>'.$s.'</td>';
                                        $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                        $html.='<td width=15% align=center>'.$cout.'</td>';
                                        $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                        $html.='</tr>';
                                        $s++;
                                    }

                                     $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(P):</b>
                                        </td>
                                        <td>
                                            <b>'.$ptot.'</b>
                                        </td>
                                    </tr>';
                                }
                               
                                $html.=' <tr>
                                    <td colspan="4">
                                        <b>Text Books:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=4;$l++)
                                    {
                                        $cot='text_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                
                               
                                 $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Books:</b>
                                    </td>
                                </tr>';
                               
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='reference_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               
                               
                                if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                {
                                      $html.='  <tr>
                                            <td colspan="4">
                                                <b>Web References:</b>
                                            </td>
                                        </tr>';

                                    for($l=1;$l<=3;$l++)
                                    {
                                        $cot='web_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               

                                $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                //print_r($online_reference1); exit();
                                if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                {
                                    
                                     $html.=' <tr>
                                        <td colspan="4">
                                            <b>Online References:</b>
                                        </td>
                                    </tr>';

                                    for($l=1;$l<=2;$l++)
                                    {
                                        $cot='online_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }                    
                                 $html.=' </table> ';
                                if(!empty($co_matrix))
                                {
                                    //print_r($co_matrix); exit();
                                    $colspan=$co_matrix[0]['pso_count'];

                                    $html.=' 

                                    <table border="1" width="100%">
                                    <tr>
                                        <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                         <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                          <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                    </tr>
                           
                                    <tr>';
                                    
                                    for ($i=1; $i <=12 ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    } 
                                    for ($i=1; $i <=$colspan ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    }
                                    $html.= "</tr>";

                                    if(!empty($co_matrix))
                                    {
                                        foreach ($co_matrix as $value) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $po='po'.$i;
                                                $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                            }

                                            $pso_value=explode(",", $value['pso_value']);
                                            for ($p=0; $p <$colspan ; $p++) 
                                            { 
                                                $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                            }
                                            
                                            $html.='</tr>';

                                        }
                                    }

                                    $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                }
                                
                                    //$html.=' </table>';
                                    $html.=' <pagebreak>';
                               $curriculumdata.=$html;
                        }
                        
                    }
                    $curriculumdata.='<pagebreak>';
                    

                 //print_r($curriculumdata); exit;
                }

                $vac_subjectss = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_vac_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."'")->queryAll();

                if(!empty($vac_subjectss))
                {
                    $curriculumdata.='<pagebreak>';
                    //$curriculumdata='';
                    foreach ($vac_subjectss as $value) 
                    {
                        $html='';

                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, D.category_type as subject_type, E.category_type as subject_category_type, B.subject_type_id FROM cur_syllabus A JOIN cur_vac_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();
                        
                        $ltot=0;
                        $ttot=0;
                        $ptot=0;
                        if(!empty($codatalist))
                        {
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                            
                            $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                            $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();
                                
                            if(empty($co_matrix))
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();
                            }

                            $course_categorytype='';
                            

                            $html.='<table class="table" width="100%">
                                <tr>
                                    <td width="15%">
                                        <b>'.$value["subject_code"].'</b>
                                    </td>
                                    <td width="70%" colspan="2" align=center>';
                            
                                    $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                        
                                 $html.='    </td>
                                    <td width="15%" align=center>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].'
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <b>Pre-requisite(s):'.($prerequisties).'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Course Objectives:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_objectives'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                

                               $html.=' <tr>
                                    <td colspan="4">
                                        <b>Course Outcomes:<br>
                                        Upon completion of the course, students shall have ability to
                                        </b>

                                    </td>
                                </tr>';

                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_outcomes'.$l;
                                        $rpt='rpt'.$l;
                                        if($codatalist[$cot]!='')
                                        {
                                            $rptdta ='';
                                            if($codatalist[$rpt]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                            }
                                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>CO'.$l.'</td>';
                                            $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                            $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                            
                                $html.=' </table><table class="table" width="100%">';
                               
                                 
                                if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                {
                                     $html.='   <tr>
                                        <td colspan="4">
                                            <b>Course Content:</b>
                                        </td>
                                    </tr>';
                                    for($l=1;$l<=3;$l++)
                                    {
                                        $module_title='module_title'.$l;
                                        $module_hr='module_hr'.$l;
                                        $module_content='cource_content_mod'.$l;
                                        if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                        {
                                            //$module_title=trim($codatalist[$module_title],"'");
                                            $html.='<tr>';
                                            $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                            $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                            $html.='</tr>';

                                            $html.='<tr>';
                                            $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                            $html.='</tr>';

                                           
                                        }
                                    }
                                }

                                if($ltot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(L):</b>
                                        </td>
                                        <td>
                                            <b>'.$ltot.'</b>
                                        </td>
                                    </tr>';
                                }

                                if($ttot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(T):</b>
                                        </td>
                                        <td>
                                            <b>'.$ttot.'</b>
                                        </td>
                                    </tr>';

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(LT):</b>
                                            </td>
                                            <td>
                                                <b>'.($ttot+$ltot).'</b>
                                            </td>
                                        </tr>';
                                    }
                                }
                                
                                if(!empty($colablist)) 
                                {

                                  $html.='   <tr>
                                        <th colspan="4">
                                            <b>Lab Components:</b>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>List of Experiments</th>
                                        <th>CO Mapping</th>
                                        <th>RBT</th>
                                    </tr>';

                                    $s=1;
                                    foreach ($colablist as $value) 
                                    {
                                        $cout=ltrim($value['cource_outcome'],",");
                                        $html.='<tr>';
                                        $html.='<td width=10% align=center>'.$s.'</td>';
                                        $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                        $html.='<td width=15% align=center>'.$cout.'</td>';
                                        $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                        $html.='</tr>';
                                        $s++;
                                    }

                                     $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(P):</b>
                                        </td>
                                        <td>
                                            <b>'.$ptot.'</b>
                                        </td>
                                    </tr>';
                                }
                               
                                $html.=' <tr>
                                    <td colspan="4">
                                        <b>Text Books:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=4;$l++)
                                    {
                                        $cot='text_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                
                               
                                 $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Books:</b>
                                    </td>
                                </tr>';
                               
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='reference_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               
                               
                                if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                {
                                      $html.='  <tr>
                                            <td colspan="4">
                                                <b>Web References:</b>
                                            </td>
                                        </tr>';

                                    for($l=1;$l<=3;$l++)
                                    {
                                        $cot='web_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               

                                $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                //print_r($online_reference1); exit();
                                if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                {
                                    
                                     $html.=' <tr>
                                        <td colspan="4">
                                            <b>Online References:</b>
                                        </td>
                                    </tr>';

                                    for($l=1;$l<=2;$l++)
                                    {
                                        $cot='online_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }                    
                                 $html.=' </table> ';
                                if(!empty($co_matrix))
                                {
                                    //print_r($co_matrix); exit();
                                    $colspan=$co_matrix[0]['pso_count'];

                                    $html.=' 

                                    <table border="1" width="100%">
                                    <tr>
                                        <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                         <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                          <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                    </tr>
                           
                                    <tr>';
                                    
                                    for ($i=1; $i <=12 ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    } 
                                    for ($i=1; $i <=$colspan ; $i++) 
                                    { 
                                        $html.= "<th style='text-align: center;'>".$i."</td>";
                                    }
                                    $html.= "</tr>";

                                    if(!empty($co_matrix))
                                    {
                                        foreach ($co_matrix as $value) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                            for ($i=1; $i <=12 ; $i++) 
                                            { 
                                                $po='po'.$i;
                                                $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                            }

                                            $pso_value=explode(",", $value['pso_value']);
                                            for ($p=0; $p <$colspan ; $p++) 
                                            { 
                                                $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                            }
                                            
                                            $html.='</tr>';

                                        }
                                    }

                                    $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                }
                                
                                    //$html.=' </table>';
                                    $html.=' <pagebreak>';
                               $curriculumdata.=$html;
                        }
                    }
                }

                 $header = '<table class="table table-responsive dum_edit_table table-hover" >
                                <tr>
                                  <td> 
                                    <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                  </td>

                                  <td align="center"> 
                                  <center><b><h4>' . $org_name . '</h4></b></center>
                                  <center> <h6>' . $org_address . '</h6></center>
                                  <center><b><h5>' . $org_tagline . '</h5></b></center> 
                                  <center><b><h6>'.$Deptname.'</h6></b></center>
                                      <center> <h6>Applicable for Students Admitted from Academic Year '.$regulationyear.'-'.($regulationyear+1).'</h6></center>
                                      <center> <h6>(Choice Based Credit System)</h6></center>
                             </td>
                                  <td align="center">  
                                    <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                  </td>
                                </tr>                                          
                            </table>';

                $_SESSION['matrixavg'] = $_SESSION['frontpageclg'] =$frontpage='';
                //echo "SELECT cur_fp_id FROM cur_frontp_clg_list WHERE degree_type='MBA' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'); exit();
                 $cur_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontpage WHERE degree_type='MBA' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $po_list = Yii::$app->db->createCommand("SELECT po_title,po FROM cur_frontpage_list WHERE cur_fp_id='".$cur_fp_id."' and po!='-'")->queryAll();
                //print_r($po_list); exit();
                $frontpage.='<table class="table oectable" width="100%">
                                    <tr>
                                        <td>
                                            <h2><b>DEPARTMENT VISION MISSION</b></h2>
                                        </td>
                                    <tr>
                                    </table>';
                $frontpage.='<pagebreak>';

                $Deptnames = Yii::$app->db->createCommand("SELECT dept_name FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname JOIN coe_degree C ON C.coe_degree_id=A.coe_degree_id WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id." AND A.coe_programme_id=".$coe_programme_id)->queryScalar();

                $dept_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontpage_list WHERE coe_dept_id=26 AND degree_type='MBA' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $po_count = Yii::$app->db->createCommand("SELECT po_count FROM cur_frontpage WHERE coe_dept_id=26 AND degree_type='MBA' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $deptvision = Yii::$app->db->createCommand("SELECT vision FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."'")->queryScalar();

                $deptmissions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND mission!='-'")->queryAll();

                $deptmissions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND mission!='-'")->queryAll();

                $peo_list = Yii::$app->db->createCommand("SELECT cur_fpl_id,peo FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND peo!='-'")->queryAll();

                $pso_list = Yii::$app->db->createCommand("SELECT pso FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND pso!='-'")->queryAll();

                $frontpage.='<div align="center"><b> DEPARTMENT OF ' .strtoupper($Deptnames).'</b></div>';
                $frontpage.='<div align="left"><b>VISION</b></div><br>';
                $frontpage.='<div align="left">' . $deptvision . '</div><br><br><br>';
                $frontpage.='<div align="left"><b>MISSION</b></div><br><ul>';
                
                foreach ($deptmissions as $mvalue) 
                {
                    $frontpage.='<li>'.$mvalue['mission'].'</li>';
                }

                $frontpage.='</ul></div>';
                $frontpage.='<pagebreak>';
                $frontpage.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>PEO's & PO's</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $frontpage.='<pagebreak>';

                $frontpage.='<div align="left"><b>PROGRAM EDUCTIONAL OBJECTIVES</b></div><ol>';
                foreach ($peo_list as $pvalue) 
                {
                    $frontpage.='<li>'.$pvalue['peo'].'</li>';
                }
                $frontpage.='</ol></div>';

                $frontpage.='<div align="left"><b>PROGRAM OUTCOMES</b></div><br>
                <p>Graduates of the '.strtoupper($Deptnames).' Program of '.strtoupper($org_name).' will have the ability to </p>
                <ol>';
                foreach ($po_list as $pvalue) 
                {
                    $frontpage.='<li><b>'.$pvalue['po_title'].'</b>: '.$pvalue['po'].'</li>';
                }
                $frontpage.='</ol></div>';
                //$frontpage.='<pagebreak>';
                // $frontpage.='<div align="left"><b>PROGRAM SPECIFIC OUTCOMES</b></div><br>
                // <p>A graduate of the '.strtoupper($Deptnames).' Program of '.strtoupper($org_name).' will demonstrate:</p>
                // <ol>';
                // foreach ($pso_list as $pvalue) 
                // {
                //     $frontpage.='<li>'.$pvalue['pso'].'</li>';
                // }
                // $frontpage.='</ol></div>';
                
                $frontpage.="<div align='left'><b>PEO/PO MAPPING</b><br></div>
                <table width=100% border=1>
                <tr> <th>PEO/PO</th>";
                for ($k=1; $k <=$po_count ; $k++) 
                {
                    $frontpage.='<th>PO'.$k.'</th>';
                } 
                $frontpage.='</tr>';
                $jj=1; 
                foreach ($peo_list as $pvalue) 
                {
                    $frontpage.='<tr><td>PEO'.$jj.'</td>';

                    $checkpeopo =Yii::$app->db->createCommand("SELECT po_tick FROM cur_front_peo_po_mapping WHERE cur_fpl_id='".$pvalue['cur_fpl_id']."'")->queryAll();

                    foreach ($checkpeopo as $key => $ppvalue) 
                    {
                        if($ppvalue['po_tick']==0)
                        {
                            $frontpage.='<td align=center>-</td>';
                        }
                        else
                        {
                            $frontpage.="<td align=center>".$ppvalue['po_tick']."</td>"; 
                        }
                                              
                    }
                    $frontpage.='</tr>';
                    $jj++;
                }            
                $frontpage.='</table>';
                $frontpage.='<pagebreak>';

                $curriculumdata=$curriculumdata;

                if (isset($_SESSION['syllabusapprove'])) 
                {
                    unset($_SESSION['syllabusapprove']);
                }
                $_SESSION['syllabusapprove'] = $header.$curriculumdata;

                 $_SESSION['cdcfinalreport'] = $frontpage.$header.$curriculumdata;
            }  

            $_SESSION['matrixavg'] = $frontpage;

            $_SESSION['acmfinalreport'] = $curriculumdata;

            $_SESSION['cdc_Deptname'] = $Deptname;

            $_SESSION['cdc_regulationyear'] = $regulationyear;

            if (isset($_SESSION['check_bos'])) 
            {
                unset($_SESSION['check_bos']);
            }
            $_SESSION['check_bos'] = $check_bos;

           $curdata[]=array('check_bos'=>$check_bos, 'noapproved'=>count($checkcurriculumdata1), 'curriculumdata'=>$curriculumdata,'totalcredit'=>$overllcredittot);
        }
        else if(Yii::$app->request->post('degree_type')=='PG' && $degreetype == 'PG')
        {

            $check_bos = Yii::$app->db->createCommand("SELECT count(*) FROM cur_bos WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND bos_min_file!='' AND bos_attendance_file!='' AND semester='".$semester."'")->queryScalar();
           
            $checkcurriculumdata = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."'")->queryAll();

            $streamdata = Yii::$app->db->createCommand("SELECT *,A.coe_dept_id FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.stream_name IN ('PEC','OEC')")->queryAll();

            $streamdata_mc = Yii::$app->db->createCommand("SELECT *,A.coe_dept_id FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.stream_name IN ('AC','MC')")->queryAll();

            $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

            $batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();


            $coe_programme_id = Yii::$app->db->createCommand("SELECT A.coe_programme_id FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname  WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id)->queryScalar();

            $Deptname = Yii::$app->db->createCommand("SELECT concat(C.degree_code,' ',dept_name) as dept_name FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname JOIN coe_degree C ON C.coe_degree_id=A.coe_degree_id WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id." AND A.coe_programme_id=".$coe_programme_id)->queryScalar();

            $output = substr($regulationyear, 2, 3);

            $electcreditpoint=3; // credit point elective per paper

            $header =$curriculumdata=''; $overallhrtot=$overallextinttot=$overllcredittot=0;
            require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
            if(!empty($checkcurriculumdata))
            {
                $coresubjects=array();
                if(!empty($checkcurriculumdata))
                {
                    $loop_pec=$loop_eec=$loop_oec=1; $mcloop=1; $acloop=1;
                    for ($s=1; $s <=4 ; $s++) 
                    { 
                        $semcredittot=$semhrtot=$semextint=0; 

                        $ssqry="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, C.type_order, A.special_subject FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G ON G.coe_cur_subid=A.coe_cur_id WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND G.semester=".$s."  GROUP BY A.subject_code, G.semester ORDER BY A.subject_type_id";

                        $curriculumdatasetss = Yii::$app->db->createCommand($ssqry)->queryAll();             
                        
                        $curriculumsemdata1 = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id,A.coe_dept_id, C.type_order, A.special_subject FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND semester=".$s." AND F.stream_name!='MC' GROUP BY A.subject_code, A.semester ORDER BY A.subject_type_id")->queryAll();

                        if(!empty($curriculumdatasetss))
                        {
                            $curriculumsemdata=array_merge($curriculumsemdata1,$curriculumdatasetss);
                        }

                        $sl=1;

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=9 style='text-align:center !important;'>Semester ".$roman[$s]."</th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                        if(!empty($curriculumsemdata))
                        {
                            //print_r($curriculumsemdata);exit();
                            foreach ($curriculumdatasetss as $value) 
                            {
                                if($value['type_order']==1)
                                {
                                    if($s<=$semend)
                                    {
                                        $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }
                                    if($value['special_subject']!=0)
                                    {

                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                        $curriculumdata.="<td align=center colspan=2 style='text-align:center !important;'>".$value['special_subject']." WEEKS</td>";
                                        //$curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";

                                        $semcredittot=$semcredittot+$value['credit_point'];
                                        //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    }
                                    else
                                    {
                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";

                                         $semcredittot=$semcredittot+$value['credit_point'];
                                        $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    }
                                    
                                }
                                       
                                $sl++;
                            }

                            foreach ($curriculumsemdata1 as $value) 
                            {
                                if($value['type_order']==1)
                                {
                                    if($s<=$semend)
                                    {
                                        $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }
                                    if($value['special_subject']!=0)
                                    {

                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                        $curriculumdata.="<td align=center colspan=2 style='text-align:center !important;'>".$value['special_subject']." WEEKS</td>";
                                        //$curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";

                                        $semcredittot=$semcredittot+$value['credit_point'];
                                        //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    }
                                    else
                                    {
                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";

                                         $semcredittot=$semcredittot+$value['credit_point'];
                                        $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    }
                                    
                                }
                                       
                                $sl++;
                            }

                            foreach ($curriculumsemdata1 as $value) 
                            {
                                if($value['type_order']==2)
                                {
                                    if($s<=$semend)
                                    {
                                        $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                    }

                                    if($value['special_subject']!=0)
                                    {

                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                        $curriculumdata.="<td align=center colspan=2 style='text-align:center !important;'>".$value['special_subject']." WEEKS</td>";
                                        //$curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";

                                        $semcredittot=$semcredittot+$value['credit_point'];
                                        //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    }
                                    else
                                    {
                                        $curriculumdata.="<tr>";
                                        $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                        $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                        $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                        $curriculumdata.="</tr>";

                                         $semcredittot=$semcredittot+$value['credit_point'];
                                        $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                        $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                    }
                                    
                                }
                                       
                                $sl++;
                            }
                        } 
                        
                        $semstream="sem".$s;

                        $sc = Yii::$app->db->createCommand("SELECT prefix_name FROM cur_subject_prefix WHERE `coe_dept_id`='".Yii::$app->request->post('coe_dept_id')."' ORDER BY coe_prefix_id ASC ")->queryScalar(); 
                        
                        foreach ($streamdata as $value) 
                        {
                            $electcreditpoint=3;
                            $credit=round($value[$semstream]/$electcreditpoint);

                            $intpart = floor( ($value[$semstream]/$electcreditpoint) );   // results in 3
                            $fraction =($value[$semstream]/$electcreditpoint)- $intpart; // results in 0.75

                            if($fraction>0)
                            {
                                $electcreditpoint=$value[$semstream];
                            }

                            for ($st=0; $st < $credit; $st++) 
                            { 
                                $subject_type='';
                                if($value['stream_name']=='PEC')
                                {
                                    $ltp = Yii::$app->db->createCommand("SELECT concat(L,'-',T,'-',P) as LTP, contact_hrsperweek, concat(internal_mark,'/',external_mark) as intext_mark, internal_mark, external_mark, subject_type_id FROM cur_ltp WHERE credit_point=".$electcreditpoint."  AND subject_category_type_id=143")->queryOne();  

                                    $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar();  
                                }
                                if($value['stream_name']=='OEC')
                                {
                                    $ltp = Yii::$app->db->createCommand("SELECT concat(L,'-',T,'-',P) as LTP, contact_hrsperweek, concat(internal_mark,'/',external_mark) as intext_mark, internal_mark, external_mark, subject_type_id FROM cur_ltp WHERE credit_point=".$electcreditpoint."  AND subject_category_type_id=143")->queryOne();  

                                    $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar();  
                                }


                                   //echo $loop; exit();
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                   
                                    
                                    if($value['stream_name']=='PEC')
                                    {
                                        $curriculumdata.="<td style='text-align:center !important;'>".$output.$sc."EXX</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['stream_fullname']." - ".$roman[$loop_pec]."</td>";
                                        $loop_pec++;
                                    }

                                    if($value['stream_name']=='OEC')
                                    {
                                        $curriculumdata.="<td style='text-align:center !important;'>".$output.$sc."OXX</td>";
                                        $curriculumdata.="<td style='text-align:center !important;'>".$value['stream_fullname']." - ".$roman[$loop_oec]."</td>";
                                        $loop_oec++;
                                    }

                                    
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$electcreditpoint."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";


                                $semcredittot=$semcredittot+$electcreditpoint;
                                $semhrtot=$semhrtot+$ltp['contact_hrsperweek'];
                                $semextint=$semextint+($ltp['external_mark']+$ltp['internal_mark']);

                                
                                //$loop++;
                                $sl++;
                            }

                        }

                        foreach ($curriculumsemdata1 as $value) 
                        {
                            if($value['type_order']==3)
                            {
                                if($s<=$semend)
                                {
                                    $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                }

                                if($value['special_subject']!=0)
                                {

                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    $curriculumdata.="<td align=center colspan=2 style='text-align:center !important;'>".$value['special_subject']." WEEKS</td>";
                                    //$curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                    $semcredittot=$semcredittot+$value['credit_point'];
                                    //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                }
                                else
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                     $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                }
                                
                            }
                                   
                            $sl++;
                        }

                        foreach ($curriculumsemdata1 as $value) 
                        {
                            if($value['type_order']==5)
                            {
                                if($s<=$semend)
                                {
                                    $coresubjects[]=array('sem'=>$s,'subject_code'=>$value['subject_code']);
                                }

                                if($value['special_subject']!=0)
                                {

                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    $curriculumdata.="<td align=center colspan=2 style='text-align:center !important;'>".$value['special_subject']." WEEKS</td>";
                                    //$curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                    $semcredittot=$semcredittot+$value['credit_point'];
                                    //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                }
                                else
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                    $curriculumdata.="</tr>";

                                     $semcredittot=$semcredittot+$value['credit_point'];
                                    $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                    $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                }
                                
                            }
                                   
                            $sl++;
                        }
                        
                        foreach ($streamdata_mc as $value) 
                        {
                            if($value[$semstream]==0 && $value[$semstream]!='' &&  $value['stream_name']=='MC')
                            {
                                $ltp = Yii::$app->db->createCommand("SELECT A.coe_ltp_id, concat(A.L,'-',A.T,'-',A.P) as LTP, A.contact_hrsperweek, concat(A.internal_mark,'/',A.external_mark) as intext_mark, A.internal_mark, A.external_mark, A.subject_type_id,A.credit_point FROM cur_ltp A JOIN cur_curriculum_subject B ON B.coe_ltp_id=A.coe_ltp_id WHERE A.credit_point=0 AND A.L=2 AND A.internal_mark=100 AND A.subject_type_id=106")->queryOne();  

                                $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar(); 

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$output."PMCXXX</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['stream_fullname'])." - ".$roman[$mcloop]."</td>";
                               
                                $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$ltp['credit_point']."</td>";
                                $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                $curriculumdata.="</tr>";
                           

                               //  $semcredittot=$semcredittot+$ltp['credit_point'];
                                $semhrtot=$semhrtot+$ltp['contact_hrsperweek'];
                                $semextint=$semextint+($ltp['external_mark']+$ltp['internal_mark']);

                                $mcloop++;

                                $sl++;
                            }
                            else if($value[$semstream]==0 && $value[$semstream]!='' &&  $value['stream_name']=='AC')
                            {
                                $ltp = Yii::$app->db->createCommand("SELECT concat(A.L,'-',A.T,'-',A.P) as LTP, A.contact_hrsperweek, concat(A.internal_mark,'/',A.external_mark) as intext_mark, A.internal_mark, A.external_mark, A.subject_type_id,A.credit_point FROM cur_ltp A JOIN cur_curriculum_subject B ON B.coe_ltp_id=A.coe_ltp_id WHERE A.credit_point=0 AND A.L=1 AND A.subject_type_id=122")->queryOne();  

                                $subject_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$ltp['subject_type_id'])->queryScalar(); 

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$output."PADXXX</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['stream_fullname'])." - ".$roman[$acloop]."</td>";
                               
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$ltp['LTP']."</td>";
                                $curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center colspan=2 style='text-align:center !important;'>-</td>";
                                //$curriculumdata.="<td  align=center style='text-align:center !important;'>".$ltp['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$subject_type."</td>";
                                $curriculumdata.="<td  align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                $curriculumdata.="</tr>";
                           

                               //  $semcredittot=$semcredittot+$ltp['credit_point'];
                                $semhrtot=$semhrtot+$ltp['contact_hrsperweek'];
                                $semextint=$semextint+($ltp['external_mark']+$ltp['internal_mark']);

                                $acloop++;

                                $sl++;
                            }

                        }


                        $curriculumdata.="<tr>";
                        $curriculumdata.="<td  align=center  colspan=4 style='text-align:center !important;'><b>Total</b> </td>";
                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$semhrtot."</td>";
                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$semcredittot."</td>";
                        $curriculumdata.="<td align=center style='text-align:center !important;'>".$semextint."</td>";
                        $curriculumdata.="<td align=center colspan=2></td>";
                        $curriculumdata.="</tr>";

                        $overallhrtot=$overallhrtot+$semhrtot;
                        $overallextinttot=$overallextinttot+$semextint;
                        $overllcredittot=$overllcredittot+$semcredittot;
                        
                        $curriculumdata.="</table><br>";
                        

                    }

                    $streamdatas = Yii::$app->db->createCommand("SELECT * FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND B.stream_name IN ('FC','EEC','PCC') ORDER BY B.cur_an_id ASC")->queryAll();
                     $curriculumdata.="<pagebreak>";
                    
                    foreach ($streamdatas as $stream) 
                    {
                        $check_stream_credit = Yii::$app->db->createCommand("SELECT total_credit FROM cur_credit_distribution_sem  WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND cur_stream_id='".$stream['cur_stream_id']."'")->queryScalar(); 

                        $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.semester, A.special_subject FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id  WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='".$stream['stream_name']."' AND F.stream_name!='MC' GROUP BY A.subject_code, F.stream_name")->queryAll();

                         
                         $servicecoursedeptdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,G.semester, A.special_subject FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G  ON G.coe_cur_subid=A.coe_cur_id WHERE G.coe_dept_ids = '".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='".$stream['stream_name']."' GROUP BY A.subject_code, F.stream_name")->queryAll();

                        if(!empty($servicecoursedeptdata))
                        {
                            $curriculumsemdata=array_merge($curriculumsemdata,$servicecoursedeptdata);
                        }


                        array_multisort(array_column($curriculumsemdata, 'semester'),  SORT_ASC, $curriculumsemdata);
                       
                        if(!empty($curriculumsemdata))
                        {
                            $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> ".$stream['stream_fullname']." (".$stream['stream_name'].")  Credit (".$check_stream_credit.")</th>";
                            $curriculumdata.="</tr>";

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                            $curriculumdata.="</tr>";

                            $sl=1; $semcredittot=0;
                            foreach ($curriculumsemdata as $value) 
                            {
                                if($value['special_subject']!=0)
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['subject_name'])."</td>";
                                    $curriculumdata.="<td colspan=2 style='text-align:center !important;'>".$value['special_subject']." WEEKS</td>";
                                    //$curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="</tr>";
                                }
                                else
                                {
                                    $curriculumdata.="<tr>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['subject_name'])."</td>";
                                    $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['credit_point']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                    $curriculumdata.="<td align=center  style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                    $curriculumdata.="</tr>";
                                }
                                   

                                $semcredittot=$semcredittot+$value['credit_point'];
                                //$semhrtot=$semhrtot+$value['contact_hrsperweek'];
                                //$semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                                $sl++;
                            }

                            if($semcredittot!=$check_stream_credit)
                            {
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td  align=center  colspan=8 style='text-align:center !important; color:red;'><b>".$stream['stream_name']." Credit Mismatch (Current Credit Total: ".$semcredittot.")</b> </td></tr>";
                            }
                            

                            $curriculumdata.="</table><br>";
                        }
                    }

                    //pec start

                    $vertical_stream = Yii::$app->db->createCommand("SELECT * FROM cur_elective_subject B WHERE B.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option IN ('192')")->queryAll();

                    if(!empty($vertical_stream))
                    {
                        

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> PROFESSIONAL ELECTIVE COURSES (PEC) </th>";
                        $curriculumdata.="</tr>";

                        

                            $curriculumdata.="<tr>";

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                            $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                            $curriculumdata.="</tr>";

                            $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.coe_elective_option IN ('192') GROUP BY A.subject_code")->queryAll();

                            $sl=1; $electcount=0;
                            foreach ($curriculumsemdata as $value) 
                            {
                                
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                $curriculumdata.="</tr>";
                               

                                $electcount=$electcount+1;
                                $sl++;
                            }

                         

                        $curriculumdata.="</table>";

                    }

                   $mcqry="SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,A.internal_mark,A.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='MC' GROUP BY A.subject_code";
                    $mc_courses = Yii::$app->db->createCommand($mcqry)->queryAll();

                    if(!empty($mc_courses))
                    {
                        //$curriculumdata='';
                        //$curriculumdata.= '<pagebreak>';
                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=7 style='text-align:center !important;'> MANDATORY COURSES (MC) (Non-Credits)</th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1;
                        foreach ($mc_courses as $value) 
                        {

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['subject_name'])."</td>";
                           
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                        
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                            
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="</tr>";
                               
                                                 
                            $sl++;
                        }

                        $curriculumdata.="</table><br>";
                    }

                    $oec_cource_to_otherdept = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND A.coe_elective_option IN ('191') GROUP BY A.subject_code")->queryAll();

                    if(!empty($oec_cource_to_otherdept))
                    {
                        //$curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> OPEN ELECTIVE COURSES (OEC) TO OTHER DEPT. </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; $electcount=0;
                        foreach ($oec_cource_to_otherdept as $value) 
                        {
                            
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="</tr>";
                           

                            $electcount=$electcount+1;
                            $sl++;
                        }

                      

                        $curriculumdata.="</table>";
                    }

                    $oec_from_otherdept = Yii::$app->db->createCommand("SELECT G.subject_code, G.subject_code_new FROM cur_electivetodept G WHERE G.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND G.coe_elective_option IN ('191') GROUP BY G.subject_code_new")->queryAll();

                    if(!empty($oec_from_otherdept))
                    {
                        //$curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=8 style='text-align:center !important;'> OPEN ELECTIVE COURSES (OEC) (ASSIGNED BY) OTHER DEPT.</th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; 
                        foreach ($oec_from_otherdept as $value) 
                        {
                             $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();

                            if(empty($cource_infor))
                            {
                                 $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();
                            }

                            if(!empty($cource_infor))
                            {

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code_new']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['subject_name']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['LTP']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['credit_point']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjecttype']."</td>";
                                $curriculumdata.="</tr>";
                               

                                $semcredittot=$semcredittot+$cource_infor['credit_point'];
                                $semhrtot=$semhrtot+$cource_infor['contact_hrsperweek'];
                                $semextint=$semextint+($cource_infor['external_mark']+$cource_infor['internal_mark']);
                                $sl++;
                            }
                        }

                        $curriculumdata.="</table>";
                    }

                    $oec_from_otherdept1 = Yii::$app->db->createCommand("SELECT G.subject_code FROM cur_elective_subject G WHERE  G.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND G.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND G.degree_type='".Yii::$app->request->post('degree_type')."' AND G.coe_elective_option IN (191) GROUP BY G.subject_code ORDER BY G.coe_dept_id")->queryAll();

                    //print_r($service_from_otherdept); exit;
                    if(!empty($oec_from_otherdept1))
                    {
                       // $curriculumdata='';

                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=9 style='text-align:center !important;'> OPEN ELECTIVE COURSES (OEC) FROM OTHER DEPT. </th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                         $sl=1; 
                        foreach ($oec_from_otherdept1 as $value) 
                        {
                            $cource_infor = Yii::$app->db->createCommand("SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();


                            if(!empty($cource_infor))
                            {

                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['subject_name']."</td>";
                                $curriculumdata.="<td style='text-align:center !important;'>".$cource_infor['LTP']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['credit_point']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['intext_mark']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjecttype']."</td>";
                                $curriculumdata.="<td align=center  style='text-align:center !important;'>".$cource_infor['subjectctype']."</td>";
                                $curriculumdata.="</tr>";
                               

                                $semcredittot=$semcredittot+$cource_infor['credit_point'];
                                $semhrtot=$semhrtot+$cource_infor['contact_hrsperweek'];
                                $semextint=$semextint+($cource_infor['external_mark']+$cource_infor['internal_mark']);
                                $sl++;
                            }
                        }

                        $curriculumdata.="</table>";
                    }

                    $acqry="SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,A.internal_mark,A.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='AC' GROUP BY A.subject_code";
                    $ac_courses = Yii::$app->db->createCommand($acqry)->queryAll();

                    if(!empty($ac_courses))
                    {
                        //$curriculumdata='';
                        //$curriculumdata.= '<pagebreak>';
                        $curriculumdata.="<table width=100% border=1 style='text-align:center !important;'>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=7 style='text-align:center !important;'> AUDIT COURSES (AC) (Non-Credits)</th>";
                        $curriculumdata.="</tr>";

                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="</tr>";

                         $sl=1;
                        foreach ($ac_courses as $value) 
                        {
                          
                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".strtoupper($value['subject_name'])."</td>";
                           
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";
                        
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                            
                            $curriculumdata.="<td style='text-align:center !important;' colspan=1>-</td>";
                            $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="</tr>";
                               
                                                 
                            $sl++;
                        }

                        $curriculumdata.="</table><br>";
                    }

                    $curi_streamdata=Yii::$app->db->createCommand("SELECT A.*,B.stream_fullname,A.aicte_norms FROM cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' ORDER BY B.cur_an_id ASC ")->queryAll();

                    $curi_stream='';

                    if(!empty($curi_streamdata))
                    {
                        $curi_stream.= '<pagebreak>';
                         $curi_stream.= '<div align=center> <b>CREDIT DISTRIBUTION – SUMMARY</b><br></div>';
                         $curi_stream.= '<table class="table table-responsive table-hover" width=100% border=1>
                         <thead>
                            <tr>
                                <th  align=center style="text-align: center;">S.No.</th>
                                <th  align=center style="text-align: center;">Stream</th>';
                            for ($i=1; $i <=4 ; $i++) 
                            { 
                                 $curi_stream.= '<th  style="text-align: center;">Sem '.$i.'</th>';
                           }
                             $curi_stream.= ' <th  align=center style="text-align: center;">Total Credit</th>
                            </tr>
                        </thead><tbody>';

                        $sl=1; $total_credit= $total_aicte_norms=0;
                        foreach ($curi_streamdata as $value) 
                        {
                            $curi_stream.= '<tr>
                            <td  align=center style="text-align: center;">'.$sl.'</td>
                            <td  align=center style="text-align: center;">'. $value['stream_fullname'].'</td>';
                            
                            for ($s=1; $s <=4 ; $s++) 
                            { 
                                $name="sem".$s;
                                $values=$value[$name];
                            
                                $curi_stream.= '<td  align=center style="text-align: center;">'. $values.'</td>';
                            }
                            $curi_stream.= '<td  align=center style="text-align: center;">'. $value['total_credit'].'</td>
                            </tr>';
                        
                            $total_aicte_norms=$total_aicte_norms+$value['aicte_norms'];
                            $total_credit=$total_credit+$value['total_credit'];
                             $sl++;
                        }

                        $curi_stream.='<tr>
                            <td align=center colspan="2" align="right"><b>Total</b></td>';
                            
                            for ($s=1; $s <=4 ; $s++) 
                            { 
                                $semtot=0;
                                $name="sem".$s;
                                foreach ($curi_streamdata as $value) 
                                {
                                    $semtot=$semtot+$value[$name];
                                }
                            $curi_stream.='<td align=center style="text-align: center;">'. $semtot.'</td>';
                            }
                            $curi_stream.='<td align=center style="text-align: center;">'. $total_credit.'</td>
                            </tr>';

                         $curi_stream.='</table>';
                    }

                    $curriculumdata=$curriculumdata.$curi_stream;
                }

                //syllabus start

                $curriculumdata.='<pagebreak>';
                $curriculumdata.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>SYLLABUS</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $curriculumdata.='<pagebreak>';
                
                //print_r($coresubjects); exit();
                // $curriculumdata='';
                $dupplicate=$tempsem=0; $matrixavg=''; $semhtml='';
                for ($ei=0; $ei <count($coresubjects) ; $ei++) 
                { 
                    if($tempsem!=$coresubjects[$ei]['sem'])
                    {
                        $curriculumdata.='<table class="table oectable" width="100%">
                                            <tr>
                                                <td>
                                                    <h2><b>SEMESTER '.$roman[$coresubjects[$ei]['sem']].'</b></h2>
                                                </td>
                                            <tr>
                                            </table>';
                        $curriculumdata.='<pagebreak>';
                    }

                    $subjectscodes=Yii::$app->db->createCommand("SELECT subject_code FROM cur_electivetodept WHERE semester='".$coresubjects[$ei]['sem']."' AND subject_code_new='".$coresubjects[$ei]['subject_code']."' AND coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."'")->queryScalar();
                    if(!empty($subjectscodes))
                    {
                        $subjectscode=$subjectscodes;
                    }
                    else
                    {
                       $subjectscode=$coresubjects[$ei]['subject_code']; 
                    }
                    
                    if(!empty($subjectscode))
                    {
                        $html='';

                       
                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$subjectscode."' AND B.subject_type_id!=106")->queryOne();        
                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                        $ltot=0;
                        $ttot=0;
                        $ptot=0;
                        if(empty($codatalist))
                        {
                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$subjectscode."' AND B.subject_type_id!=106")->queryOne();

                            if(empty($codatalist))
                            {
                               
                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,ED.subject_code_new as subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, ED.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_electivetodept ED ON ED.subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=ED.subject_code JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE ED.subject_code_new='".$subjectscode."' AND B.subject_type_id!=106")->queryOne();

                                if(empty($codatalist)) // regulation existing syllabus
                                {
                                   
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code
                                        JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$subjectscode."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                    
                                    if(empty($codatalist)) // regulation existing syllabus
                                    {     
                                        $qq = "SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code
                                            JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$subjectscode."' AND SE.mapping_type=1 AND B.subject_type_id!=106";

                                        $codatalist = Yii::$app->db->createCommand($qq)->queryOne();
                                        
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                    else
                                    {
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {
                                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                            }
                            else
                            {
                                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                $ltot=($codatalist['L'])*15;
                                $ttot=($codatalist['T'])*15;
                                $ptot=($codatalist['P'])*15;
                            }
                        }
                        else
                        {
                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;
                        }
                        
                        if(!empty($codatalist)) 
                        {
                            $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                            $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                            
                            $com=1;   
                            if(empty($co_matrix))
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                $com=2;
                            }

                            $course_categorytype='';
                            

                            if($codatalist['subject_category_type_id']=='140') //type1
                            {

                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='141') //type 2
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                            }
                            else if($codatalist['subject_category_type_id']=='142') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                            } 
                            else if($codatalist['subject_category_type_id']=='144') //type 3
                            {
                                $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                            }    
                            else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                            } 
                            else 
                            {
                                $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                            }  

                            $mappedsubject = Yii::$app->db->createCommand("SELECT B.subject_code,B.subject_name FROM  cur_curriculum_subject B JOIN cur_syllabus_existing C ON C.to_subject_code=B.subject_code WHERE B.subject_code='".$subjectscode."'")->queryOne();
                            
                            if(empty($mappedsubject))
                            {
                                $mappedsubject = Yii::$app->db->createCommand("SELECT B.subject_code,B.subject_name FROM  cur_elective_subject B JOIN cur_syllabus_existing C ON C.to_subject_code=B.subject_code WHERE B.subject_code='".$subjectscode."'")->queryOne();
                            }
                            

                            $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE A.subject_code='".$codatalist["subject_code"]."' AND A.subject_code_new!='".$codatalist["subject_code"]."'")->queryOne();               
                            
                            $sysubject_name=$sysubject_code='';
                            if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                            {                               

                                if(!empty($mappedsubject))
                                {
                                    $sysubject_code=$samesubjectcode['subject_code_new']."/ ".$samesubjectcode['subject_code'];
                                    $sysubject_name=$mappedsubject["subject_name"];
                                }
                                else
                                {
                                    $sysubject_code=$samesubjectcode['subject_code_new']."/ ".$samesubjectcode['subject_code'];
                                    $sysubject_name=$codatalist["subject_name"];
                                }
                            }
                            else
                            {
                                if(!empty($mappedsubject))
                                {
                                    $sysubject_code=$mappedsubject["subject_code"];
                                    $sysubject_name=$mappedsubject["subject_name"];
                                }
                                else
                                {
                                    $sysubject_code=$codatalist["subject_code"];
                                    $sysubject_name=$codatalist["subject_name"];
                                }
                                
                            }

                            $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];

                            $html.='<table class="table" width="100%">
                                <tr>
                                    <td width="15%">
                                        <b>'.$sysubject_code.'</b>
                                    </td>
                                    <td width="70%" colspan="2" align=center>';
                            
                                    $html.='<b>'.strtoupper($sysubject_name).'</b>';
                                        
                                 $html.='    </td>
                                    <td width="15%" align=center>
                                        <b>'.$codatalist["ltp"].'/'.$codatalist["credit_point"].'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <b>Pre-requisite(s):'.($prerequisties).'</b>
                                    </td>
                                </tr>
                                 <tr>
                                    <td colspan="4">
                                        <b>Course Objectives:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_objectives'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                

                               $html.=' <tr>
                                    <td colspan="4">
                                        <b>Course Outcomes:<br>
                                        Upon completion of the course, students shall have ability to
                                        </b>

                                    </td>
                                </tr>';

                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='course_outcomes'.$l;
                                        $rpt='rpt'.$l;
                                        if($codatalist[$cot]!='')
                                        {
                                            $rptdta ='';
                                            if($codatalist[$rpt]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                            }

                                            $html.='<tr>';
                                            $html.='<td width=15% align=center>CO'.$l.'</td>';
                                            $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                            $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                            
                                $html.=' </table><table class="table" width="100%">';
                               
                                 
                                if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                {
                                     $html.='   <tr>
                                        <td colspan="4">
                                            <b>Course Content:</b>
                                        </td>
                                    </tr>';
                                    for($l=1;$l<=3;$l++)
                                    {
                                        $module_title='module_title'.$l;
                                        $module_hr='module_hr'.$l;
                                        $module_content='cource_content_mod'.$l;
                                        if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                        {

                                            $html.='<tr>';
                                            $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                            $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                            $html.='</tr>';

                                            $html.='<tr>';
                                            $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                            $html.='</tr>';

                                           
                                        }
                                    }
                                }

                                if($ltot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(L):</b>
                                        </td>
                                        <td>
                                            <b>'.$ltot.'</b>
                                        </td>
                                    </tr>';
                                }

                                if($ttot!=0)
                                {
                                    $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(T):</b>
                                        </td>
                                        <td>
                                            <b>'.$ttot.'</b>
                                        </td>
                                    </tr>';

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(LT):</b>
                                            </td>
                                            <td>
                                                <b>'.($ttot+$ltot).'</b>
                                            </td>
                                        </tr>';
                                    }
                                }
                                
                                if(!empty($colablist)) 
                                {

                                  $html.='   <tr>
                                        <th colspan="4">
                                            <b>Lab Components:</b>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>List of Experiments</th>
                                        <th>CO Mapping</th>
                                        <th>RBT</th>
                                    </tr>';

                                    $s=1;
                                    foreach ($colablist as $value1) 
                                    {
                                        $cout=ltrim($value1['cource_outcome'],",");
                                        $html.='<tr>';
                                        $html.='<td width=10% align=center>'.$s.'</td>';
                                        $html.='<td width=60%>'.$value1['experiment_title'].'</td>';
                                        $html.='<td width=15% align=center>'.$cout.'</td>';
                                        $html.='<td width=15% align=center>'.$value1['rpt'].'</td>';
                                        $html.='</tr>';
                                        $s++;
                                    }

                                     $html.='   <tr>
                                        <td colspan="3" align=right>
                                            <b>Total Hours(P):</b>
                                        </td>
                                        <td>
                                            <b>'.$ptot.'</b>
                                        </td>
                                    </tr>';
                                }
                               
                                $html.=' <tr>
                                    <td colspan="4">
                                        <b>Text Books:</b>
                                    </td>
                                </tr>';
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=4;$l++)
                                    {
                                        $cot='text_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                                
                               
                                 $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Books:</b>
                                    </td>
                                </tr>';
                               
                                if(!empty($codatalist)) 
                                {
                                    
                                    for($l=1;$l<=6;$l++)
                                    {
                                        $cot='reference_book'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               
                               
                                if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                {
                                      $html.='  <tr>
                                            <td colspan="4">
                                                <b>Web References:</b>
                                            </td>
                                        </tr>';

                                    for($l=1;$l<=3;$l++)
                                    {
                                        $cot='web_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }
                               

                                $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                //print_r($online_reference1); exit();
                                if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                {
                                    
                                     $html.=' <tr>
                                        <td colspan="4">
                                            <b>Online References:</b>
                                        </td>
                                    </tr>';

                                    for($l=1;$l<=2;$l++)
                                    {
                                        $cot='online_reference'.$l;
                                        if($codatalist[$cot]!='')
                                        {                            
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$l.'</td>';
                                            $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                            $html.='</tr>';
                                        }
                                    }
                                }                    
                                 $html.=' </table> ';

                                if(!empty($co_matrix))
                                {

                                    $deptpso = Yii::$app->db->createCommand("SELECT pso_count,po_count FROM cur_frontpage WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryOne();
                                    //print_r($co_matrix); exit();
                                    $colspan=$deptpso['pso_count'];

                                    if($colspan>0)
                                    {
                                        $html.=' 

                                        <table border="1" width="100%">
                                        <tr>
                                            <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                             <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                              <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                        </tr>
                               
                                        <tr>';
                                        
                                        for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        } 
                                        for ($i=1; $i <=$colspan ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        }
                                        $html.= "</tr>";

                                        if(!empty($co_matrix))
                                        {
                                            foreach ($co_matrix as $value) 
                                            {
                                                $html.='<tr>';
                                                $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                { 
                                                    $po='po'.$i;
                                                    $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                }

                                                $pso_value=explode(",", $value['pso_value']);
                                                for ($p=0; $p <$colspan ; $p++) 
                                                { 
                                                    $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                }
                                                
                                                $html.='</tr>';

                                            }
                                        }

                                         $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            PSO - Programme Specific Outcomes
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                    }
                                    else
                                    {

                                        $html.=' 

                                        <table border="1" width="100%">
                                        <tr>
                                            <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                            <th colspan="'.$deptpso['po_count'].'" width="20%" style="text-align: center;">PO</th>
                                        </tr>
                               
                                        <tr>';
                                        
                                        for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                        { 
                                            $html.= "<th style='text-align: center;'>".$i."</td>";
                                        } 

                                        $html.= "</tr>";

                                        if(!empty($co_matrix))
                                        {
                                            foreach ($co_matrix as $value) 
                                            {
                                                $html.='<tr>';
                                                $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                { 
                                                    $po='po'.$i;
                                                    $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                }
                                                
                                                $html.='</tr>';

                                            }
                                        }

                                         $html.=' </table><br>';
                                         $html.=' <table border="1" width="100%"><tr>
                                            <td width="50%" style="text-align: left;">
                                            CO - Course Outcome<br>
                                            PO - Programme Outcome<br>
                                            </td>
                                             <td width="50%" style="text-align: left;">
                                            1 - Reasonably Agreed<br>
                                            2 - Moderately Agreed<br>
                                            3 - Strongly Agreed
                                            </td>
                                        </tr></table>';
                                    }

                                   
                                }
                               
                                    //$html.=' </table>';
                                    $html.=' <pagebreak>';
                               $curriculumdata.=$html;
                        }
                        else
                        {
                            //$curriculumdata='';
                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$subjectscode."' AND B.subject_type_id=106")->queryOne();        
                            
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];

                            if(!empty($codatalist)) 
                            {
                                $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();
                                
                                 $com=1;
                                if(empty($co_matrix))
                                {
                                    $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();

                                     $com=2;
                                }

                                $course_categorytype='('.$codatalist['intext_mark'].")";

                                $html.='<table class="table" width="100%">
                                    <tr>
                                        <td width="15%">
                                            <b>'.$codatalist["subject_code"].'</b>
                                        </td>
                                        <td width="70%" colspan="2" align=center>';
                                
                                        $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                            
                                     $html.='    </td>
                                        <td width="15%" align=center>
                                            <b>'.$codatalist["ltp"].'/0</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Nature of the Course: </b>'.$codatalist['subject_type'].' '.$course_categorytype.'
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4">
                                            <b>Pre-requisite(s):Nil</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Course Objectives:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_objectives'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    

                                   $html.=' <tr>
                                        <td colspan="4">
                                            <b>Course Outcomes:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_outcomes'.$l;
                                            $rpt='rpt'.$l;
                                            if($codatalist[$cot]!='')
                                            {
                                                $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                
                                    $html.=' </table><table class="table" width="100%">';
                                   
                                     
                                    if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                    {
                                         $html.='   <tr>
                                            <td colspan="4">
                                                <b>Course Content:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $output1 = substr($codatalist['subject_code'], 2,5); //exit;
                                            if($output1=='MC001')
                                            {
                                                 $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4><b>Module '.$l.': </b> '.$codatalist[$module_title].'</td>';
                                                    //$html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4><b>Module Content: </b><br>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                            else
                                            {
                                                $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {

                                                    $html.='<tr>';
                                                    $html.='<td width=80% colspan=2><b>Module '.$l.': </b> '.$codatalist[$module_title].'</td>';
                                                    $html.='<td width=20% colspan=2><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4><b>Module Content: </b><br>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                        }
                                    }
                                    
                                    if(!empty($colablist)) 
                                    {

                                      $html.='   <tr>
                                            <th colspan="4">
                                                <b>Lab Components:</b>
                                            </th>
                                        </tr>
                                        <tr>
                                            <th>S.No.</th>
                                            <th>List of Experiments</th>
                                            <th>CO Mapping</th>
                                            <th>RBT</th>
                                        </tr>';

                                        $s=1;
                                        foreach ($colablist as $value1) 
                                        {
                                            $html.='<tr>';
                                            $html.='<td width=10%>'.$s.'</td>';
                                            $html.='<td width=60%>'.$value1['experiment_title'].'</td>';
                                            $html.='<td width=15%>'.$value1['cource_outcome'].'</td>';
                                            $html.='<td width=15%>'.$value1['rpt'].'</td>';
                                            $html.='</tr>';
                                            $s++;
                                        }

                                    }
                                   
                                    
                                    if(!empty($codatalist['text_book1']) && $codatalist['text_book1']!=' ' && $codatalist['text_book1']!='NA' )  
                                    {
                                        $html.=' <tr>
                                                <td colspan="4">
                                                    <b>Text Books:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='text_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                    if(!empty($codatalist['reference_book1']) && $codatalist['reference_book1']!=' ' && $codatalist['reference_book1']!='NA' ) 
                                    {
                                          $html.='<tr>
                                            <td colspan="4">
                                                <b>Reference Books:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='reference_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                   
                                    if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='NA' ) 
                                    {
                                          $html.='  <tr>
                                                <td colspan="4">
                                                    <b>Web References:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='web_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   

                                    $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                    //print_r($online_reference1); exit();
                                    if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                    {
                                        
                                         $html.=' <tr>
                                            <td colspan="4">
                                                <b>Online References:</b>
                                            </td>
                                        </tr>';

                                        for($l=1;$l<=2;$l++)
                                        {
                                            $cot='online_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }                    
                                     $html.=' </table> ';
                                   
                                    if(!empty($co_matrix))
                                    {

                                        $deptpso = Yii::$app->db->createCommand("SELECT pso_count,po_count FROM cur_frontpage WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryOne();
                                        //print_r($co_matrix); exit();
                                        $colspan=$deptpso['pso_count'];

                                        if($colspan>0)
                                        {
                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                 <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                  <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 
                                            for ($i=1; $i <=$colspan ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            }
                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                    for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                    }

                                                    $pso_value=explode(",", $value['pso_value']);
                                                    for ($p=0; $p <$colspan ; $p++) 
                                                    { 
                                                        $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                             $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                PSO - Programme Specific Outcomes
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                        }
                                        else
                                        {

                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                <th colspan="'.$deptpso['po_count'].'" width="20%" style="text-align: center;">PO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 

                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                    for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                             $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                        }

                                       
                                    }
                                       
                                        $html.=' <pagebreak>';

                                   $curriculumdata.=$html;
                            }
                        }
                    }

                    $tempsem=$coresubjects[$ei]['sem'];
                }

                $semcredit='';
                
                $semcolumn='';

                $semcreditmc='';
                //echo $sem[1]; exit();
                if(count($sem)>1)
                {
                    for ($ss=1; $ss <=$sem[1] ; $ss++) 
                    { 
                        
                        $semm=" AND sem".$ss."!='0'";
                       
                        $checksemdata = Yii::$app->db->createCommand("SELECT A.* FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('PEC','OEC')".$semm)->queryAll();

                        if(!empty($checksemdata))
                        {
                            if($semcredit=='')
                            {
                                $semcredit.=" AND (sem".$ss."!=''";
                            }
                            else if($semcredit!='')
                            {
                                $semcredit.=" OR sem".$ss."!=''";
                            }

                             $semcolumn.="sem".$ss;
                        }
                        
                        
                    }

                    for ($sss=1; $sss <=$semend ; $sss++) 
                    { 
                        
                        $semms=" AND sem".$sss."='0'";
                       
                        $checksemdata = Yii::$app->db->createCommand("SELECT A.* FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('MC')".$semms)->queryAll();

                        if(!empty($checksemdata))
                        {
                            if($semcreditmc=='')
                            {
                                $semcreditmc.=" AND (sem".$sss."!=''";
                            }
                            else if($semcreditmc!='')
                            {
                                $semcreditmc.=" OR sem".$sss."!=''";
                            }
                            
                             $semcolumn.="sem".$sss;
                        }
                        
                        
                    }


                }
                else
                {
                    $semcredit=" AND sem".$sem[0]."!=''";
                }
                     
                if($semcredit!='' && (count($sem)>1))          
                {
                    $semcredit=$semcredit.") ";
                }
                $matrixavg1='';
                if(!empty($semcredit)) // elective
                {
                    $getsemcredit = Yii::$app->db->createCommand("SELECT B.stream_name FROM  cur_credit_distribution_sem A JOIN cur_aicte_norms B ON B.cur_an_id=A.cur_stream_id WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND stream_name IN ('PEC','OEC')".$semcredit)->queryAll();
                    //print_r($semcolumn); exit();
                    if(!empty($getsemcredit))
                    {
                    
                        $streamsdata=array();
                        foreach ($getsemcredit as $key => $stvalue) 
                        {
                            $streamsdata[]=$stvalue['stream_name']; //exit();
                        }                    

                        if(in_array('PEC',$streamsdata))
                        {
                            $curriculumdata.='<pagebreak>';

                            $curriculumdata.='<table class="table oectable" width="100%">
                                            <tr>
                                                <td>
                                                    <h2><b>PROFESSIONAL ELECTIVE COURSES</b></h2>
                                                </td>
                                            <tr>
                                            </table>';
                            $curriculumdata.='<pagebreak>';

                            //$curriculumdata='';
                            $electivesubject = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option IN (192) AND coe_elective_option NOT IN (191,193)")->queryAll();

                            $coreelectivesubject = Yii::$app->db->createCommand("SELECT A.subject_code as subject_code FROM  cur_electivetodept A  WHERE A.coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option IN (192) AND coe_elective_option NOT IN (191,193)")->queryAll();
                        
                            if(!empty($coreelectivesubject))
                            {
                                $electivesubject=array_merge($electivesubject,$coreelectivesubject);
                            }

                            foreach ($electivesubject as $value) 
                            {
                                $html='';

                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();        
                                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                $ltot=0;
                                $ttot=0;
                                $ptot=0;
                                if(empty($codatalist))
                                {
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                                    if(empty($codatalist)) // regulation existing syllabus
                                    {
                                       
                                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                        
                                        if(empty($codatalist)) // regulation existing syllabus
                                        {         
                                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                            
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15;
                                        }
                                        else
                                        {
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15;
                                        }
                                    }
                                    else
                                    {
                                        $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {
                                    $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                                
                                if(!empty($codatalist)) 
                                {
                                    $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                    $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll(); 

                                    $course_categorytype='';
                                    

                                    if($codatalist['subject_category_type_id']=='140') //type1
                                    {

                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='141') //type 2
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='142') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                                    } 
                                    else if($codatalist['subject_category_type_id']=='144') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                                    }    
                                    else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                                    } 
                                    else 
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                                    }                 
                                
                                    $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE (A.subject_code='".$value["subject_code"]."' AND A.subject_code_new!='".$value["subject_code"]."')")->queryOne();               
                                    
                                    $sysubject_code='';
                                    if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                                    {
                                        $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                                    }
                                    else
                                    {
                                        $sysubject_code=$value["subject_code"];
                                    }
                                    
                                    $sysubject_name=$codatalist["subject_name"];

                                    $html.='<table class="table" width="100%">
                                        <tr>
                                            <td width="15%">
                                                <b>'.$sysubject_code.'</b>
                                            </td>
                                            <td width="70%" colspan="2" align=center>';
                                    
                                            $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                                
                                         $html.='    </td>
                                            <td width="15%" align=center>
                                                <b>'.$codatalist["ltp"].'/'.$codatalist["credit_point"].'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="4">
                                                <b>Pre-requisite(s):'.($prerequisties).'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Course Objectives:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_objectives'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        

                                       $html.=' <tr>
                                            <td colspan="4">
                                                <b>Course Outcomes:<br>
                                                Upon completion of the course, students shall have ability to
                                                </b>

                                            </td>
                                        </tr>';

                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_outcomes'.$l;
                                                $rpt='rpt'.$l;
                                                if($codatalist[$cot]!='')
                                                {
                                                    $rptdta ='';
                                                    if($codatalist[$rpt]!='')
                                                    {
                                                        $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                    }
                                                    
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                    $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                    $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                    
                                        $html.=' </table><table class="table" width="100%">';
                                       
                                         
                                        if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                        {
                                             $html.='   <tr>
                                                <td colspan="4">
                                                    <b>Course Content:</b>
                                                </td>
                                            </tr>';
                                            for($l=1;$l<=3;$l++)
                                            {
                                                $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {
                                                    //$module_title=trim($codatalist[$module_title],"'");
                                                    $html.='<tr>';
                                                    $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                    $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                        }

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(L):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ltot.'</b>
                                                </td>
                                            </tr>';
                                        }

                                        if($ttot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(T):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ttot.'</b>
                                                </td>
                                            </tr>';

                                            if($ltot!=0)
                                            {
                                                $html.='   <tr>
                                                    <td colspan="3" align=right>
                                                        <b>Total Hours(LT):</b>
                                                    </td>
                                                    <td>
                                                        <b>'.($ttot+$ltot).'</b>
                                                    </td>
                                                </tr>';
                                            }
                                        }
                                        
                                        if(!empty($colablist)) 
                                        {

                                          $html.='   <tr>
                                                <th colspan="4">
                                                    <b>Lab Components:</b>
                                                </th>
                                            </tr>
                                            <tr>
                                                <th>S.No.</th>
                                                <th>List of Experiments</th>
                                                <th>CO Mapping</th>
                                                <th>RBT</th>
                                            </tr>';

                                            $s=1;
                                            foreach ($colablist as $value) 
                                            {
                                                $cout=ltrim($value['cource_outcome'],",");
                                                $html.='<tr>';
                                                $html.='<td width=10% align=center>'.$s.'</td>';
                                                $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                                $html.='<td width=15% align=center>'.$cout.'</td>';
                                                $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                                $html.='</tr>';
                                                $s++;
                                            }

                                             $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(P):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ptot.'</b>
                                                </td>
                                            </tr>';
                                        }
                                       
                                        $html.=' <tr>
                                            <td colspan="4">
                                                <b>Text Books:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=4;$l++)
                                            {
                                                $cot='text_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        
                                       
                                         $html.='<tr>
                                            <td colspan="4">
                                                <b>Reference Books:</b>
                                            </td>
                                        </tr>';
                                       
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='reference_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       
                                       
                                        if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                        {
                                              $html.='  <tr>
                                                    <td colspan="4">
                                                        <b>Web References:</b>
                                                    </td>
                                                </tr>';

                                            for($l=1;$l<=3;$l++)
                                            {
                                                $cot='web_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       

                                        $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                        //print_r($online_reference1); exit();
                                        if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                        {
                                            
                                             $html.=' <tr>
                                                <td colspan="4">
                                                    <b>Online References:</b>
                                                </td>
                                            </tr>';

                                            for($l=1;$l<=2;$l++)
                                            {
                                                $cot='online_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }                    
                                         $html.=' </table> ';
                                        
                                        if(!empty($co_matrix))
                                        {

                                            $deptpso = Yii::$app->db->createCommand("SELECT pso_count,po_count FROM cur_frontpage WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryOne();
                                            //print_r($co_matrix); exit();
                                            $colspan=$deptpso['pso_count'];

                                            if($colspan>0)
                                            {
                                                $html.=' 

                                                <table border="1" width="100%">
                                                <tr>
                                                    <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                     <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                      <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                                </tr>
                                       
                                                <tr>';
                                                
                                                for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                { 
                                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                                } 
                                                for ($i=1; $i <=$colspan ; $i++) 
                                                { 
                                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                                }
                                                $html.= "</tr>";

                                                if(!empty($co_matrix))
                                                {
                                                    foreach ($co_matrix as $value) 
                                                    {
                                                        $html.='<tr>';
                                                        $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                        for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                        { 
                                                            $po='po'.$i;
                                                            $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                        }

                                                        $pso_value=explode(",", $value['pso_value']);
                                                        for ($p=0; $p <$colspan ; $p++) 
                                                        { 
                                                            $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                        }
                                                        
                                                        $html.='</tr>';

                                                    }
                                                }

                                                 $html.=' </table><br>';
                                                 $html.=' <table border="1" width="100%"><tr>
                                                    <td width="50%" style="text-align: left;">
                                                    CO - Course Outcome<br>
                                                    PO - Programme Outcome<br>
                                                    PSO - Programme Specific Outcomes
                                                    </td>
                                                     <td width="50%" style="text-align: left;">
                                                    1 - Reasonably Agreed<br>
                                                    2 - Moderately Agreed<br>
                                                    3 - Strongly Agreed
                                                    </td>
                                                </tr></table>';
                                            }
                                            else
                                            {

                                                $html.=' 

                                                <table border="1" width="100%">
                                                <tr>
                                                    <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                    <th colspan="'.$deptpso['po_count'].'" width="20%" style="text-align: center;">PO</th>
                                                </tr>
                                       
                                                <tr>';
                                                
                                                for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                { 
                                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                                } 

                                                $html.= "</tr>";

                                                if(!empty($co_matrix))
                                                {
                                                    foreach ($co_matrix as $value) 
                                                    {
                                                        $html.='<tr>';
                                                        $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                        for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                        { 
                                                            $po='po'.$i;
                                                            $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                        }
                                                        
                                                        $html.='</tr>';

                                                    }
                                                }

                                                 $html.=' </table><br>';
                                                 $html.=' <table border="1" width="100%"><tr>
                                                    <td width="50%" style="text-align: left;">
                                                    CO - Course Outcome<br>
                                                    PO - Programme Outcome<br>
                                                    </td>
                                                     <td width="50%" style="text-align: left;">
                                                    1 - Reasonably Agreed<br>
                                                    2 - Moderately Agreed<br>
                                                    3 - Strongly Agreed
                                                    </td>
                                                </tr></table>';
                                            }

                                           
                                        }
                                        
                                            //$html.=' </table>';
                                            $html.=' <pagebreak>';
                                       $curriculumdata.=$html;
                                }
                                
                            }

                            $matrixavg1.='</table>';
                        }

                        if(in_array('OEC',$streamsdata))
                        {
                            $curriculumdata.='<pagebreak>';
                            //$curriculumdata='';
                            $curriculumdata.='<table class="table oectable" width="100%">
                                            <tr>
                                                <td>
                                                    <h2><b>OPEN ELECTIVE COURSES</b></h2>
                                                </td>
                                            <tr>
                                            </table>';
                            $curriculumdata.='<pagebreak>';

                            $electivesubject3 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option NOT IN (192,193) AND coe_elective_option IN (191)")->queryAll();

                            $electivesubject4 = Yii::$app->db->createCommand("SELECT B.subject_code_new as subject_code FROM cur_curriculum_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_dept_ids=0 AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option NOT IN (192,193) AND B.coe_elective_option IN (191) AND B.subject_code NOT IN (SELECT subject_code FROM cur_electivetodept WHERE coe_dept_ids='".Yii::$app->request->post('coe_dept_id')."' AND coe_dept_ids!=0 AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."')")->queryAll();

                            if(!empty($electivesubject3))
                            {
                                $electivesubject3=array_merge($electivesubject3,$electivesubject4);
                            }

                            $electivesubject5 = Yii::$app->db->createCommand("SELECT B.subject_code_new as subject_code FROM cur_elective_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE A.coe_dept_id!='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_dept_ids=0 AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option NOT IN (192,193) AND B.coe_elective_option IN (191)")->queryAll();

                            if(!empty($electivesubject5))
                            {
                                $electivesubject3=array_merge($electivesubject3,$electivesubject5);
                            }

                            //print_r($electivesubject4); exit();
                            foreach ($electivesubject3 as $value) 
                            {
                                $html='';

                                $ltot=0;
                                $ttot=0;
                                $ptot=0;
                                
                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                                if(empty($codatalist)) // regulation existing syllabus
                                {
                                  
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code=B.subject_code WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                 
                                    if(empty($codatalist)) // regulation existing syllabus
                                    {   

                                    
                                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                        
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;

                                        if(empty($codatalist)) // syllabus from mapped elective
                                        {         
                                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code=B.subject_code WHERE G.subject_code_new='".$value['subject_code']."'")->queryOne();
                                            
                                            $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                            $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                            $ltot=($codatalist['L'])*15;
                                            $ttot=($codatalist['T'])*15;
                                            $ptot=($codatalist['P'])*15; //exit;

                                            if(empty($codatalist)) // syllabus from core subject to elective
                                            {         
                                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code=B.subject_code WHERE G.subject_code_new='".$value['subject_code']."'")->queryOne();
                                                
                                                $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                                $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                                $ltot=($codatalist['L'])*15;
                                                $ttot=($codatalist['T'])*15;
                                                $ptot=($codatalist['P'])*15; //exit;
                                            }
                                        }
                                    }
                                    else
                                    {
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {

                                    $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                               
                                
                                if(!empty($codatalist)) 
                                {
                                    $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                    $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".$codatalist['coe_dept_id'])->queryAll();

                                    $course_categorytype='';
                                    

                                    if($codatalist['subject_category_type_id']=='140') //type1
                                    {

                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='141') //type 2
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                                    }
                                    else if($codatalist['subject_category_type_id']=='142') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                                    } 
                                    else if($codatalist['subject_category_type_id']=='144') //type 3
                                    {
                                        $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                                    }    
                                    else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                                    } 
                                    else 
                                    {
                                        $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                                    }                 
                                
                                    $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE (A.subject_code='".$value["subject_code"]."' OR A.subject_code_new='".$value["subject_code"]."') AND coe_elective_option IN (191)")->queryOne();               
                                   
                                    $sysubject_code='';
                                    if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                                    {
                                        $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                                    }
                                    else
                                    {
                                        $sysubject_code=$value["subject_code"];
                                    }
                                    

                                    $html.='<table class="table" width="100%">
                                        <tr>
                                            <td width="15%">
                                                <b>'.$sysubject_code.'</b>
                                            </td>
                                            <td width="70%" colspan="2" align=center>';
                                    
                                            $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                                
                                         $html.='    </td>
                                            <td width="15%" align=center>
                                                <b>'.$codatalist["ltp"] .'/'.$codatalist["credit_point"]  .'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="4">
                                                <b>Pre-requisite(s):'.($prerequisties).'</b>
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="4">
                                                <b>Course Objectives:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_objectives'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        

                                       $html.=' <tr>
                                            <td colspan="4">
                                                <b>Course Outcomes:<br>
                                                Upon completion of the course, students shall have ability to
                                                </b>

                                            </td>
                                        </tr>';

                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='course_outcomes'.$l;
                                                $rpt='rpt'.$l;
                                                if($codatalist[$cot]!='')
                                                {
                                                    $rptdta ='';
                                                    if($codatalist[$rpt]!='')
                                                    {
                                                        $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                    }
                                                    
                                                    $html.='<tr>';
                                                    $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                    $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                    $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                    
                                        $html.=' </table><table class="table" width="100%">';
                                       
                                         
                                        if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                        {
                                             $html.='   <tr>
                                                <td colspan="4">
                                                    <b>Course Content:</b>
                                                </td>
                                            </tr>';
                                            for($l=1;$l<=3;$l++)
                                            {
                                                $module_title='module_title'.$l;
                                                $module_hr='module_hr'.$l;
                                                $module_content='cource_content_mod'.$l;
                                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                                {
                                                    //$module_title=trim($codatalist[$module_title],"'");
                                                    $html.='<tr>';
                                                    $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                    $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                    $html.='</tr>';

                                                    $html.='<tr>';
                                                    $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                    $html.='</tr>';

                                                   
                                                }
                                            }
                                        }

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(L):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ltot.'</b>
                                                </td>
                                            </tr>';
                                        }

                                        if($ttot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(T):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ttot.'</b>
                                                </td>
                                            </tr>';

                                            if($ltot!=0)
                                            {
                                                $html.='   <tr>
                                                    <td colspan="3" align=right>
                                                        <b>Total Hours(LT):</b>
                                                    </td>
                                                    <td>
                                                        <b>'.($ttot+$ltot).'</b>
                                                    </td>
                                                </tr>';
                                            }
                                        }
                                        
                                        if(!empty($colablist)) 
                                        {

                                          $html.='   <tr>
                                                <th colspan="4">
                                                    <b>Lab Components:</b>
                                                </th>
                                            </tr>
                                            <tr>
                                                <th>S.No.</th>
                                                <th>List of Experiments</th>
                                                <th>CO Mapping</th>
                                                <th>RBT</th>
                                            </tr>';

                                            $s=1;
                                            foreach ($colablist as $value) 
                                            {
                                                $cout=ltrim($value['cource_outcome'],",");
                                                $html.='<tr>';
                                                $html.='<td width=10% align=center>'.$s.'</td>';
                                                $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                                $html.='<td width=15% align=center>'.$cout.'</td>';
                                                $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                                $html.='</tr>';
                                                $s++;
                                            }

                                             $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(P):</b>
                                                </td>
                                                <td>
                                                    <b>'.$ptot.'</b>
                                                </td>
                                            </tr>';
                                        }
                                       
                                        $html.=' <tr>
                                            <td colspan="4">
                                                <b>Text Books:</b>
                                            </td>
                                        </tr>';
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=4;$l++)
                                            {
                                                $cot='text_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                        
                                       
                                         $html.='<tr>
                                            <td colspan="4">
                                                <b>Reference Books:</b>
                                            </td>
                                        </tr>';
                                       
                                        if(!empty($codatalist)) 
                                        {
                                            
                                            for($l=1;$l<=6;$l++)
                                            {
                                                $cot='reference_book'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       
                                       
                                        if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                        {
                                              $html.='  <tr>
                                                    <td colspan="4">
                                                        <b>Web References:</b>
                                                    </td>
                                                </tr>';

                                            for($l=1;$l<=3;$l++)
                                            {
                                                $cot='web_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }
                                       

                                        $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                        //print_r($online_reference1); exit();
                                        if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                        {
                                            
                                             $html.=' <tr>
                                                <td colspan="4">
                                                    <b>Online References:</b>
                                                </td>
                                            </tr>';

                                            for($l=1;$l<=2;$l++)
                                            {
                                                $cot='online_reference'.$l;
                                                if($codatalist[$cot]!='')
                                                {                            
                                                    $html.='<tr>';
                                                    $html.='<td width=10%>'.$l.'</td>';
                                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                    $html.='</tr>';
                                                }
                                            }
                                        }                    
                                         $html.=' </table> ';
                                        
                                        if(!empty($co_matrix))
                                        {

                                            $deptpso = Yii::$app->db->createCommand("SELECT pso_count,po_count FROM cur_frontpage WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryOne();
                                            //print_r($co_matrix); exit();
                                            $colspan=$deptpso['pso_count'];

                                            if($colspan>0)
                                            {
                                                $html.=' 

                                                <table border="1" width="100%">
                                                <tr>
                                                    <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                     <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                      <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                                </tr>
                                       
                                                <tr>';
                                                
                                                for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                { 
                                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                                } 
                                                for ($i=1; $i <=$colspan ; $i++) 
                                                { 
                                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                                }
                                                $html.= "</tr>";

                                                if(!empty($co_matrix))
                                                {
                                                    foreach ($co_matrix as $value) 
                                                    {
                                                        $html.='<tr>';
                                                        $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                        for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                        { 
                                                            $po='po'.$i;
                                                            $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                        }

                                                        $pso_value=explode(",", $value['pso_value']);
                                                        for ($p=0; $p <$colspan ; $p++) 
                                                        { 
                                                            $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                        }
                                                        
                                                        $html.='</tr>';

                                                    }
                                                }

                                                 $html.=' </table><br>';
                                                 $html.=' <table border="1" width="100%"><tr>
                                                    <td width="50%" style="text-align: left;">
                                                    CO - Course Outcome<br>
                                                    PO - Programme Outcome<br>
                                                    PSO - Programme Specific Outcomes
                                                    </td>
                                                     <td width="50%" style="text-align: left;">
                                                    1 - Reasonably Agreed<br>
                                                    2 - Moderately Agreed<br>
                                                    3 - Strongly Agreed
                                                    </td>
                                                </tr></table>';
                                            }
                                            else
                                            {

                                                $html.=' 

                                                <table border="1" width="100%">
                                                <tr>
                                                    <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                    <th colspan="'.$deptpso['po_count'].'" width="20%" style="text-align: center;">PO</th>
                                                </tr>
                                       
                                                <tr>';
                                                
                                                for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                { 
                                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                                } 

                                                $html.= "</tr>";

                                                if(!empty($co_matrix))
                                                {
                                                    foreach ($co_matrix as $value) 
                                                    {
                                                        $html.='<tr>';
                                                        $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                        for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                        { 
                                                            $po='po'.$i;
                                                            $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                        }
                                                        
                                                        $html.='</tr>';

                                                    }
                                                }

                                                 $html.=' </table><br>';
                                                 $html.=' <table border="1" width="100%"><tr>
                                                    <td width="50%" style="text-align: left;">
                                                    CO - Course Outcome<br>
                                                    PO - Programme Outcome<br>
                                                    </td>
                                                     <td width="50%" style="text-align: left;">
                                                    1 - Reasonably Agreed<br>
                                                    2 - Moderately Agreed<br>
                                                    3 - Strongly Agreed
                                                    </td>
                                                </tr></table>';
                                            }

                                           
                                        }
                                        
                                            //$html.=' </table>';
                                            $html.=' <pagebreak>';
                                       $curriculumdata.=$html;
                                }
                                
                            }
                        }
                        //$curriculumdata='';
                        $curriculumdata.='<table class="table oectable" width="100%">
                                        <tr>
                                            <td>
                                                <h2><b>OPEN ELECTIVE TO OTHER DEPT</b></h2>
                                            </td>
                                        <tr>
                                        </table>';
                        $curriculumdata.='<pagebreak>';

                        $electivesubject1 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND coe_elective_option NOT IN (192,193) AND coe_elective_option IN (191)")->queryAll();

                        $electivesubject2 = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_curriculum_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE A.coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND B.coe_dept_ids=0 AND B.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND B.degree_type='".Yii::$app->request->post('degree_type')."' AND B.coe_elective_option NOT IN (192,193) AND B.coe_elective_option IN (191)")->queryAll();

                        if(!empty($electivesubject2))
                        {
                            $electivesubject1=array_merge($electivesubject1,$electivesubject2);
                        }
                        

                        foreach ($electivesubject1 as $value) 
                        {
                            $html='';

                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();        
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                            $ltot=0;
                            $ttot=0;
                            $ptot=0;
                            if(empty($codatalist))
                            {
                                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();

                                if(empty($codatalist)) // regulation existing syllabus
                                {
                                   
                                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_curriculum_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                    
                                    if(empty($codatalist)) // regulation existing syllabus
                                    {         
                                        $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark,B.subject_type_id, IF(C.credit_point>0, C.credit_point, '') as credit_point FROM cur_syllabus_existing SE JOIN cur_syllabus A ON SE.from_subject_code=A.subject_code JOIN cur_elective_subject B ON B.subject_code=SE.to_subject_code AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE SE.to_subject_code='".$value['subject_code']."' AND SE.mapping_type=1 AND B.subject_type_id!=106")->queryOne();
                                        
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                    else
                                    {
                                        $prerequisties = Yii::$app->db->createCommand("SELECT to_subject_code as subject_code FROM cur_syllabus_existing WHERE from_subject_code='".$value['subject_code']."'")->queryScalar();
                                        $prerequisties=($prerequisties=='')?"Nil":$prerequisties;
                                        $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                        $ltot=($codatalist['L'])*15;
                                        $ttot=($codatalist['T'])*15;
                                        $ptot=($codatalist['P'])*15;
                                    }
                                }
                                else
                                {
                                    $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                                    $ltot=($codatalist['L'])*15;
                                    $ttot=($codatalist['T'])*15;
                                    $ptot=($codatalist['P'])*15;
                                }
                            }
                            else
                            {
                                $prerequisties=($codatalist['prerequisties']=='')?"Nil":$codatalist['prerequisties'];
                                $ltot=($codatalist['L'])*15;
                                $ttot=($codatalist['T'])*15;
                                $ptot=($codatalist['P'])*15;
                            }
                            
                            if(!empty($codatalist)) 
                            {
                                $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_articulation_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".$codatalist['coe_dept_id'])->queryAll();
                                                           

                                $course_categorytype='';
                                

                                if($codatalist['subject_category_type_id']=='140') //type1
                                {

                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 25%), End Semester Practical Maximum Marks- 100(Weightage- 25%))</b>";
                                }
                                else if($codatalist['subject_category_type_id']=='141') //type 2
                                {
                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 35%), End Semester Practical Maximum Marks- 100(Weightage- 15%))</b>";
                                }
                                else if($codatalist['subject_category_type_id']=='142') //type 3
                                {
                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Marks- 100(Weightage- 15%), End Semester Practical Maximum Marks- 100(Weightage- 35%))</b>";
                                } 
                                else if($codatalist['subject_category_type_id']=='144') //type 3
                                {
                                    $course_categorytype ='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 50%))</b>";
                                }    
                                else if($codatalist['subject_type_id']=='10' || $codatalist['subject_type_id']=='123')
                                {
                                    $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Practical Maximum Marks- 100(Weightage- 40%))</b>";
                                } 
                                else 
                                {
                                    $course_categorytype='('.$codatalist['intext_mark'].") <br> End Semester Mark Splitup:<b> (End Semester Theory Maximum Marks- 100(Weightage- 60%))</b>";
                                }                 
                            
                                $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE (A.subject_code='".$value["subject_code"]."' OR A.subject_code_new='".$value["subject_code"]."') AND coe_elective_option IN (191)")->queryOne();               
                                
                                $sysubject_code='';
                                if(!empty($samesubjectcode) && $samesubjectcode['subject_code_new']!=$samesubjectcode['subject_code'])
                                {
                                    $sysubject_code=$samesubjectcode['subject_code']."/ ".$samesubjectcode['subject_code_new'];
                                }
                                else
                                {
                                    $sysubject_code=$value["subject_code"];
                                }
                                

                                $html.='<table class="table" width="100%">
                                    <tr>
                                        <td width="15%">
                                            <b>'.$sysubject_code.'</b>
                                        </td>
                                        <td width="70%" colspan="2" align=center>';
                                
                                        $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                            
                                     $html.='    </td>
                                        <td width="15%" align=center>
                                            <b>'.$codatalist["ltp"] .'/'.$codatalist["credit_point"]  .'</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].' - '.$course_categorytype.'
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4">
                                            <b>Pre-requisite(s):'.($prerequisties).'</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Course Objectives:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_objectives'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    

                                   $html.=' <tr>
                                        <td colspan="4">
                                            <b>Course Outcomes:<br>
                                            Upon completion of the course, students shall have ability to
                                            </b>

                                        </td>
                                    </tr>';

                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_outcomes'.$l;
                                            $rpt='rpt'.$l;
                                            if($codatalist[$cot]!='')
                                            {
                                                $rptdta ='';
                                                if($codatalist[$rpt]!='')
                                                {
                                                    $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                }
                                                
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                
                                    $html.=' </table><table class="table" width="100%">';
                                   
                                     
                                    if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                    {
                                         $html.='   <tr>
                                            <td colspan="4">
                                                <b>Course Content:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $module_title='module_title'.$l;
                                            $module_hr='module_hr'.$l;
                                            $module_content='cource_content_mod'.$l;
                                            if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                            {
                                                //$module_title=trim($codatalist[$module_title],"'");
                                                $html.='<tr>';
                                                $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                $html.='</tr>';

                                                $html.='<tr>';
                                                $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                $html.='</tr>';

                                               
                                            }
                                        }
                                    }

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(L):</b>
                                            </td>
                                            <td>
                                                <b>'.$ltot.'</b>
                                            </td>
                                        </tr>';
                                    }

                                    if($ttot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(T):</b>
                                            </td>
                                            <td>
                                                <b>'.$ttot.'</b>
                                            </td>
                                        </tr>';

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(LT):</b>
                                                </td>
                                                <td>
                                                    <b>'.($ttot+$ltot).'</b>
                                                </td>
                                            </tr>';
                                        }
                                    }
                                    
                                    if(!empty($colablist)) 
                                    {

                                      $html.='   <tr>
                                            <th colspan="4">
                                                <b>Lab Components:</b>
                                            </th>
                                        </tr>
                                        <tr>
                                            <th>S.No.</th>
                                            <th>List of Experiments</th>
                                            <th>CO Mapping</th>
                                            <th>RBT</th>
                                        </tr>';

                                        $s=1;
                                        foreach ($colablist as $value) 
                                        {
                                            $cout=ltrim($value['cource_outcome'],",");
                                            $html.='<tr>';
                                            $html.='<td width=10% align=center>'.$s.'</td>';
                                            $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                            $html.='<td width=15% align=center>'.$cout.'</td>';
                                            $html.='<td width=15% align=center>'.$value['rpt'].'</td>';
                                            $html.='</tr>';
                                            $s++;
                                        }

                                         $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(P):</b>
                                            </td>
                                            <td>
                                                <b>'.$ptot.'</b>
                                            </td>
                                        </tr>';
                                    }
                                   
                                    $html.=' <tr>
                                        <td colspan="4">
                                            <b>Text Books:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=4;$l++)
                                        {
                                            $cot='text_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    
                                   
                                     $html.='<tr>
                                        <td colspan="4">
                                            <b>Reference Books:</b>
                                        </td>
                                    </tr>';
                                   
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='reference_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                   
                                    if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                    {
                                          $html.='  <tr>
                                                <td colspan="4">
                                                    <b>Web References:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='web_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   

                                    $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                    //print_r($online_reference1); exit();
                                    if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                    {
                                        
                                         $html.=' <tr>
                                            <td colspan="4">
                                                <b>Online References:</b>
                                            </td>
                                        </tr>';

                                        for($l=1;$l<=2;$l++)
                                        {
                                            $cot='online_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }                    
                                    
                                    $html.=' </table> ';

                                    if(!empty($co_matrix))
                                    {

                                        $deptpso = Yii::$app->db->createCommand("SELECT pso_count,po_count FROM cur_frontpage WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryOne();
                                        //print_r($co_matrix); exit();
                                        $colspan=$deptpso['pso_count'];

                                        if($colspan>0)
                                        {
                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                 <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                  <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 
                                            for ($i=1; $i <=$colspan ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            }
                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                    for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                    }

                                                    $pso_value=explode(",", $value['pso_value']);
                                                    for ($p=0; $p <$colspan ; $p++) 
                                                    { 
                                                        $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                             $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                PSO - Programme Specific Outcomes
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                        }
                                        else
                                        {

                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                <th colspan="'.$deptpso['po_count'].'" width="20%" style="text-align: center;">PO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 

                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                    for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                             $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                        }

                                       
                                    }
                                    
                                        //$html.=' </table>';
                                        $html.=' <pagebreak>';
                                   $curriculumdata.=$html;
                            }
                            
                        }

                    }

                }

                if($semcreditmc!='')          
                {
                    $semcreditmc=$semcreditmc.") ";
                }
                //print_r($semcreditmc); exit();
                if(!empty($semcreditmc)) // mc
                {

                    $mccoursesyllabus = Yii::$app->db->createCommand("SELECT subject_code FROM cur_curriculum_subject WHERE semester=0 AND coe_dept_id='8' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND coe_cur_id NOT IN (SELECT coe_cur_subid FROM cur_servicesubtodept WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."') ORDER BY subject_code ASC")->queryAll();
                    //print_r($mccoursesyllabus); exit();
                    if(!empty($mccoursesyllabus))
                    {
                        $curriculumdata.='<pagebreak>';

                        $curriculumdata.='<table class="table oectable" width="100%">
                                        <tr>
                                            <td>
                                                <h2><b>MANDATORY COURSES</b></h2>
                                            </td>
                                        <tr>
                                        </table>';
                        $curriculumdata.='<pagebreak>';

                        foreach ($mccoursesyllabus as $value) 
                        {
                            $html='';
                             $ltot=0;
                            $ttot=0;
                            $ptot=0;
                            $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, concat('External Mark: ',C.external_mark,'/ Internal Mark: ',C.internal_mark) as intext_mark, C.internal_mark,B.subject_type_id FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."'")->queryOne();        
                            $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                           

                            $ltot=($codatalist['L'])*15;
                            $ttot=($codatalist['T'])*15;
                            $ptot=($codatalist['P'])*15;
                        
                        
                            if(!empty($codatalist)) 
                            {

                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".Yii::$app->request->post('coe_dept_id'))->queryAll();

                                $course_categorytype='';
                                if($codatalist['internal_mark']>0)
                                {
                                    $course_categorytype=' - '.'('.$codatalist['intext_mark'].")</b>";
                                }
                                 

                                $samesubjectcode = Yii::$app->db->createCommand("SELECT A.subject_code_new, A.subject_code FROM  cur_electivetodept A  WHERE A.subject_code='".$codatalist["subject_code"]."' OR A.subject_code_new='".$codatalist["subject_code"]."'")->queryOne();               
                                
                                $sysubject_code=$codatalist["subject_code"];
                                
                                $prerequisties="Nil";

                                $html.='<table class="table" width="100%">
                                    <tr>
                                        <td width="15%">
                                            <b>'.$sysubject_code.'</b>
                                        </td>
                                        <td width="70%" colspan="2" align=center>';
                                
                                        $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                            
                                     $html.='    </td>
                                        <td width="15%" align=center>
                                            <b>'.$codatalist["ltp"].'/0</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Nature of the Course: </b><br>'.$codatalist['subject_type'].$course_categorytype.'
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4">
                                            <b>Pre-requisite(s):'.($prerequisties).'</b>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td colspan="4">
                                            <b>Course Objectives:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_objectives'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    

                                   $html.=' <tr>
                                        <td colspan="4">
                                            <b>Course Outcomes:<br>
                                            Upon completion of the course, students shall have ability to
                                            </b>

                                        </td>
                                    </tr>';

                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='course_outcomes'.$l;
                                            $rpt='rpt'.$l;
                                            if($codatalist[$cot]!='')
                                            {
                                                $rptdta ='';
                                                if($codatalist[$rpt]!='')
                                                {
                                                    $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                                }

                                                $html.='<tr>';
                                                $html.='<td width=15% align=center>CO'.$l.'</td>';
                                                $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                                $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                
                                    $html.=' </table><table class="table" width="100%">';
                                   
                                     
                                    if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                                    {
                                         $html.='   <tr>
                                            <td colspan="4">
                                                <b>Course Content:</b>
                                            </td>
                                        </tr>';
                                        for($l=1;$l<=3;$l++)
                                        {
                                            $module_title='module_title'.$l;
                                            $module_hr='module_hr'.$l;
                                            $module_content='cource_content_mod'.$l;
                                            if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                            {

                                                $html.='<tr>';
                                                $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                                $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                                $html.='</tr>';

                                                $html.='<tr>';
                                                $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                                $html.='</tr>';

                                               
                                            }
                                        }
                                    }

                                    if($ltot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(L):</b>
                                            </td>
                                            <td>
                                                <b>'.$ltot.'</b>
                                            </td>
                                        </tr>';
                                    }

                                    if($ttot!=0)
                                    {
                                        $html.='   <tr>
                                            <td colspan="3" align=right>
                                                <b>Total Hours(T):</b>
                                            </td>
                                            <td>
                                                <b>'.$ttot.'</b>
                                            </td>
                                        </tr>';

                                        if($ltot!=0)
                                        {
                                            $html.='   <tr>
                                                <td colspan="3" align=right>
                                                    <b>Total Hours(LT):</b>
                                                </td>
                                                <td>
                                                    <b>'.($ttot+$ltot).'</b>
                                                </td>
                                            </tr>';
                                        }
                                    }
                                    
                                   
                                    $html.=' <tr>
                                        <td colspan="4">
                                            <b>Text Books:</b>
                                        </td>
                                    </tr>';
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=4;$l++)
                                        {
                                            $cot='text_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                    
                                   
                                     $html.='<tr>
                                        <td colspan="4">
                                            <b>Reference Books:</b>
                                        </td>
                                    </tr>';
                                   
                                    if(!empty($codatalist)) 
                                    {
                                        
                                        for($l=1;$l<=6;$l++)
                                        {
                                            $cot='reference_book'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   
                                   
                                    if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='' && $codatalist['web_reference1']!='NA' ) 
                                    {
                                          $html.='  <tr>
                                                <td colspan="4">
                                                    <b>Web References:</b>
                                                </td>
                                            </tr>';

                                        for($l=1;$l<=3;$l++)
                                        {
                                            $cot='web_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }
                                   

                                    $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                                    //print_r($online_reference1); exit();
                                    if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                                    {
                                        
                                         $html.=' <tr>
                                            <td colspan="4">
                                                <b>Online References:</b>
                                            </td>
                                        </tr>';

                                        for($l=1;$l<=2;$l++)
                                        {
                                            $cot='online_reference'.$l;
                                            if($codatalist[$cot]!='')
                                            {                            
                                                $html.='<tr>';
                                                $html.='<td width=10%>'.$l.'</td>';
                                                $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                                $html.='</tr>';
                                            }
                                        }
                                    }                    
                                     $html.=' </table> ';
                                    
                                    if(!empty($co_matrix))
                                    {

                                        $deptpso = Yii::$app->db->createCommand("SELECT pso_count,po_count FROM cur_frontpage WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryOne();
                                        //print_r($co_matrix); exit();
                                        $colspan=$deptpso['pso_count'];

                                        if($colspan>0)
                                        {
                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                 <th colspan="12" width="70%" style="text-align: center;">PO</th>
                                                  <th colspan="'.$colspan.'" width="20%" style="text-align: center;">PSO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 
                                            for ($i=1; $i <=$colspan ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            }
                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                    for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                    }

                                                    $pso_value=explode(",", $value['pso_value']);
                                                    for ($p=0; $p <$colspan ; $p++) 
                                                    { 
                                                        $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                             $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                PSO - Programme Specific Outcomes
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                        }
                                        else
                                        {

                                            $html.=' 

                                            <table border="1" width="100%">
                                            <tr>
                                                <th rowspan="2" width="10%" style="text-align: center;">CO</th>
                                                <th colspan="'.$deptpso['po_count'].'" width="20%" style="text-align: center;">PO</th>
                                            </tr>
                                   
                                            <tr>';
                                            
                                            for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                            { 
                                                $html.= "<th style='text-align: center;'>".$i."</td>";
                                            } 

                                            $html.= "</tr>";

                                            if(!empty($co_matrix))
                                            {
                                                foreach ($co_matrix as $value) 
                                                {
                                                    $html.='<tr>';
                                                    $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                                    for ($i=1; $i <=$deptpso['po_count'] ; $i++) 
                                                    { 
                                                        $po='po'.$i;
                                                        $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                                    }
                                                    
                                                    $html.='</tr>';

                                                }
                                            }

                                             $html.=' </table><br>';
                                             $html.=' <table border="1" width="100%"><tr>
                                                <td width="50%" style="text-align: left;">
                                                CO - Course Outcome<br>
                                                PO - Programme Outcome<br>
                                                </td>
                                                 <td width="50%" style="text-align: left;">
                                                1 - Reasonably Agreed<br>
                                                2 - Moderately Agreed<br>
                                                3 - Strongly Agreed
                                                </td>
                                            </tr></table>';
                                        }

                                       
                                    }
                                    
                                        //$html.=' </table>';
                                        $html.=' <pagebreak>';
                                   $curriculumdata.=$html;
                            }
                        }

                    }
                    
                }
            } 

            if (isset($_SESSION['syllabusapprove'])) 
            {
                unset($_SESSION['syllabusapprove']);
            }

            $headtitle='';
                
            if(Yii::$app->request->post('coe_dept_id')>=9 && Yii::$app->request->post('coe_dept_id')<=15)
            {
                $headtitle='Accredited by NBA';
            }

            $header = '<table class="table table-responsive dum_edit_table table-hover" >
                                    <tr>
                                      <td> 
                                        <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                      </td>

                                      <td align="center"> 
                                      <center><b><h4>' . $org_name . '</h4></b></center>
                                      <center> <h6>(An Autonomous Insitution, Accredited by NAAC with "A" Grade)</h6></center>
                                       <center><b><h5>Approved By AICTE and Affiliated to Anna University, Chennai</h5></b></center> 
                                         
                                      <center> <h6>' . $org_address . '</h6></center>
                                     
                                      <center><b><h6>'.$Deptname.'</h6></b></center> 
                                      <center> <h6>'.$headtitle.'</h6></center>
                                      <center> <h6>Applicable for Students Admitted from Academic Year '.$regulationyear.'-'.($regulationyear+1).'</h6></center>
                                      <center> <h6>(Choice Based Credit System)</h6></center>
                                 </td>
                                      <td align="center">  
                                        <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                      </td>
                                    </tr>                                          
                                </table>';

            $_SESSION['matrixavg'] = $_SESSION['frontpageclg'] =$frontpage='';
                //echo "SELECT cur_fp_id FROM cur_frontp_clg_list WHERE degree_type='MBA' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'); exit();
                 $cur_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontpage WHERE degree_type='MBA' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $po_list = Yii::$app->db->createCommand("SELECT po_title,po FROM cur_frontpage_list WHERE cur_fp_id='".$cur_fp_id."' and po!='-'")->queryAll();
                //print_r($po_list); exit();
                $frontpage.='<table class="table oectable" width="100%">
                                    <tr>
                                        <td>
                                            <h2><b>DEPARTMENT VISION MISSION</b></h2>
                                        </td>
                                    <tr>
                                    </table>';
                $frontpage.='<pagebreak>';

                $Deptnames = Yii::$app->db->createCommand("SELECT dept_name FROM coe_bat_deg_reg A JOIN coe_programme B on B.coe_programme_id=A.coe_programme_id JOIN cur_department D ON D.dept_code=B.programme_shortname JOIN coe_degree C ON C.coe_degree_id=A.coe_degree_id WHERE D.coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND A.coe_batch_id=".$batch_id." AND A.coe_programme_id=".$coe_programme_id)->queryScalar();

                $dept_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontpage_list WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND degree_type='PG' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $po_count = Yii::$app->db->createCommand("SELECT po_count FROM cur_frontpage WHERE coe_dept_id=".Yii::$app->request->post('coe_dept_id')." AND degree_type='PG' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

                $deptvision = Yii::$app->db->createCommand("SELECT vision FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."'")->queryScalar();

                $deptmissions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND mission!='-'")->queryAll();

                $deptmissions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND mission!='-'")->queryAll();

                $peo_list = Yii::$app->db->createCommand("SELECT cur_fpl_id,peo FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND peo!='-'")->queryAll();

                $pso_list = Yii::$app->db->createCommand("SELECT pso FROM cur_frontpage_list WHERE cur_fp_id='".$dept_fp_id."' AND pso!='-'")->queryAll();

                $frontpage.='<div align="center"><b> DEPARTMENT OF ' .strtoupper($Deptnames).'</b></div>';
                $frontpage.='<div align="left"><b>VISION</b></div><br>';
                $frontpage.='<div align="left">' . $deptvision . '</div><br><br><br>';
                $frontpage.='<div align="left"><b>MISSION</b></div><br><ul>';
                
                foreach ($deptmissions as $mvalue) 
                {
                    $frontpage.='<li>'.$mvalue['mission'].'</li>';
                }

                $frontpage.='</ul></div>';
                $frontpage.='<pagebreak>';
                $frontpage.="<table class='table oectable' width=100%>
                                    <tr>
                                        <td>
                                            <h2><b>PEO's & PO's</b></h2>
                                        </td>
                                    <tr>
                                    </table>";
                $frontpage.='<pagebreak>';

                $frontpage.='<div align="left"><b>PROGRAM EDUCTIONAL OBJECTIVES</b></div><ol>';
                foreach ($peo_list as $pvalue) 
                {
                    $frontpage.='<li>'.$pvalue['peo'].'</li>';
                }
                $frontpage.='</ol></div>';

                $frontpage.='<div align="left"><b>PROGRAM OUTCOMES</b></div><br>
                <p>Graduates of the '.strtoupper($Deptnames).' Program of '.strtoupper($org_name).' will have the ability to </p>
                <ol>';
                foreach ($po_list as $pvalue) 
                {
                    $frontpage.='<li><b>'.$pvalue['po_title'].'</b>: '.$pvalue['po'].'</li>';
                }
                $frontpage.='</ol></div>';
                
                
                $frontpage.="<div align='left'><b>PEO/PO MAPPING</b><br></div>
                <table width=100% border=1>
                <tr> <th>PEO/PO</th>";
                for ($k=1; $k <=$po_count ; $k++) 
                {
                    $frontpage.='<th>PO'.$k.'</th>';
                } 
                $frontpage.='</tr>';
                $jj=1; 
                foreach ($peo_list as $pvalue) 
                {
                    $frontpage.='<tr><td>PEO'.$jj.'</td>';

                    $checkpeopo =Yii::$app->db->createCommand("SELECT po_tick FROM cur_front_peo_po_mapping WHERE cur_fpl_id='".$pvalue['cur_fpl_id']."'")->queryAll();

                    foreach ($checkpeopo as $key => $ppvalue) 
                    {
                        if($ppvalue['po_tick']==0)
                        {
                            $frontpage.='<td align=center>-</td>';
                        }
                        else
                        {
                            $frontpage.="<td align=center>".$ppvalue['po_tick']."</td>"; 
                        }
                                              
                    }
                    $frontpage.='</tr>';
                    $jj++;
                }            
                $frontpage.='</table>';
                $frontpage.='<pagebreak>';
            
            $_SESSION['syllabusapprove'] = $header.$curriculumdata;

            $_SESSION['cdcfinalreport'] = $header.$curriculumdata;
            
            $_SESSION['acmfinalreport'] = $header.$curriculumdata;

             if (isset($_SESSION['check_bos'])) 
                {
                    unset($_SESSION['check_bos']);
                }
                $_SESSION['check_bos'] = $check_bos;

            $_SESSION['cdc_Deptname'] = $Deptname;

            $_SESSION['cdc_regulationyear'] = $regulationyear;

            $_SESSION['matrixavg'] = $frontpage;

            $syllabusnoapprove = Yii::$app->db->createCommand("SELECT count(*) FROM cur_syllabus WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='0'")->queryScalar();

            $checkcurriculumdata1 = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='".Yii::$app->request->post('coe_dept_id')."' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='0'")->queryAll();

           $curdata[]=array('check_bos'=>$check_bos, 'noapproved'=>count($checkcurriculumdata1),'syllabusnoapprove'=>$syllabusnoapprove, 'curriculumdata'=>$curriculumdata,'totalcredit'=>$overllcredittot);
        }
        else
        {
            $curdata[]=array('curriculumdata'=>$curriculumdata);
        }

        return Json::encode($curdata);

    }

    public function actionCdcFinalreportPdf()
    {
        require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
        $content = $_SESSION['cdcfinalreport'];
        $header=$footer= $watermark='';

        $checkservice = Yii::$app->db->createCommand("SELECT count(*) FROM cur_service_count C JOIN cur_department B ON B.coe_dept_id=C.to_dept_id WHERE C.to_dept_id='".$_SESSION['logindeptid']."' AND C.coe_regulation_id=".$_SESSION['loginregulation_id']." AND C.degree_type='".$_SESSION['logindegree']."' AND approve_status=0")->queryScalar(); 

        $check_bos_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_bos WHERE coe_dept_id='".$_SESSION['logindeptid']."' AND coe_regulation_id=".$_SESSION['loginregulation_id']." AND degree_type='".$_SESSION['logindegree']."' AND bos_min_file!='' AND bos_attendance_file!='' AND semester='".$_SESSION['cdcsemester']."'")->queryScalar();

       
        if($content=='' && $_SESSION['check_bos']!=0 && $_SESSION['check_bos']!='' && $_SESSION['servicecoursefromotherdept'] !=0 && $checkservice==0)
        {
            $content = $_SESSION['cdcfinalreport1'];
            $watermark='RECMD';
            $footer=strtoupper('Applicable for Students Admitted from AY').($_SESSION['cdc_regulationyear']).'-'.($_SESSION['cdc_regulationyear']+1).'* ';
        }
        else if($content=='' && $_SESSION['check_bos']!=0 && $_SESSION['check_bos']!='' && $_SESSION['servicecoursefromotherdept'] ==0 && $checkservice==0)
        {
            $content = $_SESSION['cdcfinalreport1'];
            $watermark='RECMD';
            $footer=strtoupper('Applicable for Students Admitted from AY').($_SESSION['cdc_regulationyear']).'-'.($_SESSION['cdc_regulationyear']+1).'* ';
        }
        else
        {
            $watermark='DRAFT';
            $footer=strtoupper('Applicable for Students Admitted from AY').($_SESSION['cdc_regulationyear']).'-'.($_SESSION['cdc_regulationyear']+1).'* ';
        }
        $cdc_Deptname = $_SESSION['cdc_Deptname'];

        $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year_from FROM cur_regulation_mapping WHERE regulation_year=".$_SESSION['cdc_regulationyear'])->queryScalar();

        if($regulationyear!='')
        {
            $header='REGULATION '.$regulationyear.' '.$cdc_Deptname;
        }
        else
        {
            $header=$cdc_Deptname;
        }

        $checkservicecourse = Yii::$app->db->createCommand("SELECT count(*) FROM cur_electivetodept C JOIN cur_syllabus B ON B.subject_code=C.subject_code AND C.coe_dept_id=B.coe_dept_id WHERE C.coe_dept_ids='".$_SESSION['logindeptid']."' AND C.coe_regulation_id=".$_SESSION['loginregulation_id']." AND C.degree_type='".$_SESSION['logindegree']."' AND B.approve_status=0")->queryScalar(); 
      
        if(($_SESSION['syllabusapprove']>0 || $check_bos_status==1) && $checkservicecourse==0)
        {
            $watermark='RECOMMEND BY BOS';
        }
        else
        {
            $watermark='DRAFT';
        }

        $cur_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontp_clg_list WHERE degree_type='".$_SESSION['logindegree']."' AND coe_regulation_id=".$_SESSION['loginregulation_id'])->queryScalar();

        $clgfrontpage= '';
       
        if(!empty($cur_fp_id))
        {
            $vision = Yii::$app->db->createCommand("SELECT vision FROM cur_frontp_clg_list WHERE cur_fp_id='".$cur_fp_id."'")->queryScalar();

            $missions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontp_clg_list WHERE cur_fp_id='".$cur_fp_id."' AND mission!='-'")->queryAll();

            $headtitle='';
            if($_SESSION['logindeptid']>=9 && $_SESSION['logindeptid']<=15)
            {
                $headtitle='Accredited by NBA';
            }

            $clgfrontpage.= '
                    <htmlpageheader name="firstpageheader"><p class="headerpage">'.$header.'</p></htmlpageheader>
                    <htmlpagefooter name="firstpage"><p class="footerpage">'.$footer.' PRINTED ON : {DATE d-m-Y H:i:s:A}  PAGE :{PAGENO}</p></htmlpagefooter>
                   
                    <sethtmlpageheader name="firstpageheader" page="E"/>
                    <sethtmlpagefooter name="firstpage" page="E"/> ';

            $clgfrontpage.= '  <br> <br>
                                <div align="center">  
                                        <img width="150" height="150" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                </div>
                                <br>
                                <div align="center"> 
                                      <h4 align="center">CURRICULUM & SYLLABUS</h4>
                                       <h6 align="center"></h6>
                                        <h6 align="center">CHOICE BASED CREDIT SYSTEM</h6>
                                        <h6 align="center"></h6>
                                       <h5 align="center"><b>UG REGULATION '.$regulationyear.'</b></h5>
                                 </div>

                                  <div align="center">
                                          <h6 align="center">Applicable for Students Admitted from Academic Year '.$_SESSION['cdc_regulationyear'].'-'.($_SESSION['cdc_regulationyear']+1).'</h6>
                                  </div>

                                  <div align="center">
                                      <h4 align="center"><b> '.$cdc_Deptname.'</b> </h4>
                                      <h4 align="center">'.$_SESSION['semender'].'</h4> 
                                    </div>
                                    <br>
                                <div align="center"> 
                                        <img class="img-responsive" width="150" height="150" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                </div>
                                <br>
                                <div align="center"> 
                                      <h2 align="center"><b>' . $org_name . '</b></h2>
                                       <h6 align="center">An Autonomous Insitution, Accredited by NAAC with "A" Grade</h6>
                                       <h5 align="center">(Approved By AICTE and Affiliated to Anna University, Chennai)</h5> 
                                       <h6 align="center">'.$headtitle.'</h6>
                                      <h6 align="center">' . ucfirst($org_address) . '</h6>
                                 </div>';

            $clgfrontpage.='<pagebreak>';
            
            $clgfrontpage.='<table class="table oectable" width="100%">
                                <tr>
                                    <td>
                                        <h2><b>COLLEGE VISION MISSION</b></h2>
                                    </td>
                                <tr>
                                </table>';
            $clgfrontpage.='<pagebreak>';

            $clgfrontpage.='<div align="center"><b>' . $org_name . '</b></div><br><br><br><br>';
            $clgfrontpage.='<div align="left"><b>VISION</b></div><br>';
            $clgfrontpage.='<div align="left">' . $vision . '</div><br><br><br>';
            $clgfrontpage.='<div align="left"><b>MISSION</b></div><br><ul>';
            
            foreach ($missions as $mvalue) 
            {
                $clgfrontpage.='<li>'.$mvalue['mission'].'</li>';
            }

            $clgfrontpage.='</ul></div>';
            $clgfrontpage.= '<pagebreak resetpagenum="1" pagenumstyle="1" suppress="" />
                    <sethtmlpageheader name="firstpageheader" page="O" value="on" show-this-page="1" />
                    
                    <sethtmlpagefooter name="firstpage" page="O" value="on" />';
        }

         $content = $clgfrontpage.$_SESSION['matrixavg'].$_SESSION['cdcfinalreport'];

        $filename='Curriculum_and_Syllabus.pdf';
        $pdf = new Pdf([
            'mode' => Pdf::MODE_UTF8,
            'filename' =>$filename,   
            'format' => Pdf::FORMAT_A4,
            'orientation' => Pdf::ORIENT_PORTRAIT,
            //'destination' => Pdf::DEST_DOWNLOAD,
            'content' => $content,
            'cssInline' => ' @media all{
                        table{border-collapse: collapse; font-family:"Roboto, sans-serif"; width:100%; font-size: 14px; } 
                        div{ 
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: justify;
                            text-justify: inter-word;
                            padding:2px !important;
                            font-size: 14px;
                        }
                        li{ 
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: justify;
                            text-justify: inter-word;
                            padding:2px !important;
                            font-size: 14px;
                        }
                        table td{
                            border: 1px solid #000;                            
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: justify;
                            text-justify: inter-word;
                            padding:2px !important;
                            font-size: 14px;
                        }
                        table th{
                            border: 1px solid #000;                           
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: center;
                            font-size: 14px;
                           
                        }

                        .oectable td
                        {
                            text-align: center;
                            vertical-align: middle;
                             border: 0px; 
                             height: 800px !important;
                        }

                        .footerpage{
                            text-align:right; 
                            border-top: 1px solid #000; 
                            font-size: 9px;
                            font-style: italic;
                            font-weight: bold;
                        }
                        .headerpage{
                            text-align:right; 
                            border-bottom: 1px solid #000; 
                            font-size: 9px;
                            font-style: italic;
                            font-weight: bold;
                        }
                    }   
                ',
            'options' => ['title' => 'Curriculum and Syllabus','showWatermarkText' => true,],
            'methods' => [ 
                    //'SetHeader'=>[$header], 
                    //'SetFooter'=>[$footer.' PRINTED ON : {DATE d-m-Y H:i:s:A}  PAGE :{PAGENO}'],
                    'SetWatermarkText' => [$watermark,0.050],
                ],
        ]);
        Yii::$app->response->format = \yii\web\Response::FORMAT_RAW;
        $headers = Yii::$app->response->headers;
        $headers->add('Content-Type', 'application/pdf');

        
        return $pdf->render();
    }

    public function actionAcmFinalreport()
    {
        $model = new CurriculumSubject();
        
        return $this->render('acm_finalreport', [
                'model' => $model,
            ]);

    }

    public function actionAcmCdcFinalreport()
    {
        $model = new CurriculumSubject();
        
        return $this->render('acm_cdcfinalreport', [
                'model' => $model,
            ]);
    }

    public function actionCurriculumAcPdf()
    {
        require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
        $content = $_SESSION['curriculumdatasession'];
       
        $checkservice = Yii::$app->db->createCommand("SELECT count(*) FROM cur_service_count C JOIN cur_department B ON B.coe_dept_id=C.to_dept_id WHERE C.to_dept_id='".$_SESSION['logindeptid']."' AND C.coe_regulation_id=".$_SESSION['loginregulation_id']." AND C.degree_type='".$_SESSION['logindegree']."' AND approve_status=0")->queryScalar(); //exit;

        $check_bos_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_bos WHERE coe_dept_id='".$_SESSION['logindeptid']."' AND coe_regulation_id=".$_SESSION['loginregulation_id']." AND degree_type='".$_SESSION['logindegree']."' AND bos_min_file!='' AND bos_attendance_file!=''")->queryScalar();

        $checkacm = Yii::$app->db->createCommand("SELECT count(*) FROM cur_acm WHERE coe_regulation_id=".$_SESSION['loginregulation_id']." AND degree_type='".$_SESSION['logindegree']."'")->queryScalar();

        $watermark=''; $footer='';

        if(($_SESSION['recommendcurriculum']=='approved' && $checkservice==0) && $checkacm>0 && $check_bos_status==1)
        {
             $watermark='APPROVED BY ACADEMIC COUNCIL';
             $footer='CURRICULUM COURSE LIST PRINTED ON : {DATE d-m-Y H:i:s:A}#  PAGE :{PAGENO}';
        }
        else if(($_SESSION['recommendcurriculum']=='approved' && $checkservice==0) && $checkacm==0 && $check_bos_status==1)
        {
             $watermark='RECOMMEND BY BOS';
             $footer='CURRICULUM COURSE LIST PRINTED ON : {DATE d-m-Y H:i:s:A}#  PAGE :{PAGENO}';
        }
        else
        {
            $watermark='DRAFT';
            Yii::$app->ShowFlashMessages->setMsg('Error', "ACM Not Upload or BOS Not Upload! Please Check");
            $footer='CURRICULUM COURSE LIST PRINTED ON : {DATE d-m-Y H:i:s:A}*  PAGE :{PAGENO}';
        }

        $filename=$_SESSION['cdc_Deptname'].".pdf";

        $pdf = new Pdf([
            'mode' => Pdf::DEST_BROWSER,
            'filename' =>$filename,   
            'format' => Pdf::FORMAT_A4,
            'orientation' => Pdf::ORIENT_PORTRAIT,
            'content' => $content,
            //'cssFile' => '@vendor/kartik-v/yii2-mpdf/assets/kv-mpdf-bootstrap.min.css',
            'cssInline' => ' @media all{
                        table{border-collapse: collapse;  text-align: center;  font-family:"Roboto, sans-serif"; width:100%; font-size: 13px; } 
                        
                        table td{
                            border: 1px solid #000;                            
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: center;
                            font-family:"tamil"; 
                        }
                        table th{
                            border: 1px solid #000;
                           
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: center;
                           
                        }
                    }   
                ',
            'options' => ['title' => 'Curriculum Course List','showWatermarkText' => true,],
            'methods' => [ 
                    'SetHeader'=>[$filename], 
                    'SetFooter'=>[$footer],
                    'SetWatermarkText' => [$watermark],
                ],
        ]);

         Yii::$app->response->format = \yii\web\Response::FORMAT_RAW;
        $headers = Yii::$app->response->headers;
        $headers->add('Content-Type', 'application/pdf');
       
        return $pdf->render();
    }

    public function actionAcmFinalreportPdf()
    {
        require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
        $content = $_SESSION['matrixavg'].$_SESSION['acmfinalreport'];
        $header=$footer= $watermark='';

        $checkservice = Yii::$app->db->createCommand("SELECT count(*) FROM cur_service_count C JOIN cur_department B ON B.coe_dept_id=C.to_dept_id WHERE C.to_dept_id='".$_SESSION['logindeptid']."' AND C.coe_regulation_id=".$_SESSION['loginregulation_id']." AND C.degree_type='".$_SESSION['logindegree']."' AND approve_status=0")->queryScalar(); 

        $check_bos_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_bos WHERE coe_dept_id='".$_SESSION['logindeptid']."' AND coe_regulation_id=".$_SESSION['loginregulation_id']." AND degree_type='".$_SESSION['logindegree']."' AND bos_min_file!='' AND bos_attendance_file!='' AND semester='".$_SESSION['cdcsemester']."'")->queryScalar();
        
        $footer=strtoupper('Applicable for Students Admitted from AY').($_SESSION['cdc_regulationyear']).'-'.($_SESSION['cdc_regulationyear']+1).'# ';
        
        $cdc_Deptname = $_SESSION['cdc_Deptname'];

        $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year_from FROM cur_regulation_mapping WHERE regulation_year=".$_SESSION['cdc_regulationyear'])->queryScalar();

        $stud_regulationyear = Yii::$app->db->createCommand("SELECT regulation_year FROM cur_regulation_mapping WHERE regulation_year=".$_SESSION['cdc_regulationyear'])->queryScalar();

        if($regulationyear!='')
        {
            $header='REGULATION '.$regulationyear.' '.$cdc_Deptname;
        }
        else
        {
            $header=$cdc_Deptname;
        }

        $checkacm = Yii::$app->db->createCommand("SELECT count(*) FROM cur_acm WHERE coe_regulation_id=".$_SESSION['loginregulation_id']." AND degree_type='".$_SESSION['logindegree']."' AND semester='".$_SESSION['cdcsemester']."'")->queryScalar(); 

        if($_SESSION['check_bos']>0 && $checkacm>0 && $check_bos_status==1)
        {
             $watermark='APPROVED BY ACADEMIC COUNCIL';
        }
        else if($_SESSION['check_bos']>0 && $checkacm==0 && $check_bos_status==1)
        {
             $watermark='RECOMMEND BY BOS';
        }
        else
        {
            $watermark='DRAFT';
            Yii::$app->ShowFlashMessages->setMsg('Error', "ACM Not Upload or BOS Not Upload! Please Check");
            //return $this->redirect(['acm-finalreport']);
        }
        
        $cur_fp_id = Yii::$app->db->createCommand("SELECT cur_fp_id FROM cur_frontp_clg_list WHERE degree_type='".$_SESSION['logindegree']."' AND coe_regulation_id=".$_SESSION['loginregulation_id'])->queryScalar();
        
        $clgfrontpage= '';
       
        if(!empty($cur_fp_id))
        {
            $vision = Yii::$app->db->createCommand("SELECT vision FROM cur_frontp_clg_list WHERE cur_fp_id='".$cur_fp_id."'")->queryScalar();

            $missions = Yii::$app->db->createCommand("SELECT mission FROM cur_frontp_clg_list WHERE cur_fp_id='".$cur_fp_id."' AND mission!='-'")->queryAll();

            $headtitle='';
            if($_SESSION['logindeptid']>=9 && $_SESSION['logindeptid']<=15)
            {
                $headtitle='Accredited by NBA';
            }

            $clgfrontpage.= '
                    <htmlpageheader name="firstpageheader"><p class="headerpage">'.$header.'</p></htmlpageheader>
                    <htmlpagefooter name="firstpage"><p class="footerpage">'.$footer.' PRINTED ON : {DATE d-m-Y H:i:s:A}  PAGE :{PAGENO}</p></htmlpagefooter>
                   
                    <sethtmlpageheader name="firstpageheader" page="E"/>
                    <sethtmlpagefooter name="firstpage" page="E"/> ';

            $clgfrontpage.= '  <br> <br>
                                <div align="center">  
                                        <img width="150" height="150" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                </div>
                                <br>
                                <div align="center"> 
                                      <h4 align="center">CURRICULUM & SYLLABUS</h4>
                                       
                                        <h6 align="center">(CHOICE BASED CREDIT SYSTEM)</h6>
                                        <h6 align="center"></h6>
                                       <h4 align="center"><b>'.$_SESSION['logindegree'].' REGULATION '.$regulationyear.'</b></h4>
                                 </div>

                                  <div align="center">
                                          <h6 align="center">Applicable for Students Admitted from Academic Year '.$stud_regulationyear.'-'.($stud_regulationyear+1).'</h6>
                                  </div>

                                  <div align="center">
                                      <h4 align="center"><b> '.$cdc_Deptname.'</b> </h4>
                                      <h4 align="center">'.$_SESSION['semender'].'</h4> 
                                    </div>
                                    <br> <br>
                                <div align="center"> 
                                        <img class="img-responsive" width="150" height="150" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                </div>
                                <br>
                                <div align="center"> 
                                      <h2 align="center"><b>' . $org_name . '</b></h2>
                                       <h6 align="center">An Autonomous Insitution, Accredited by NAAC with "A" Grade</h6>
                                       <h5 align="center">(Approved By AICTE and Affiliated to Anna University, Chennai)</h5> 
                                       <h6 align="center">'.$headtitle.'</h6>
                                      <h6 align="center">' . ucfirst($org_address) . '</h6>
                                 </div>';

            $clgfrontpage.='<pagebreak>';
            
            $clgfrontpage.='<table class="table oectable" width="100%">
                                <tr>
                                    <td>
                                        <h2><b>COLLEGE VISION MISSION</b></h2>
                                    </td>
                                <tr>
                                </table>';
            $clgfrontpage.='<pagebreak>';

            $clgfrontpage.='<div align="center"><b>' . $org_name . '</b></div><br><br><br><br>';
            $clgfrontpage.='<div align="left"><b>VISION</b></div><br>';
            $clgfrontpage.='<div align="left">' . $vision . '</div><br><br><br>';
            $clgfrontpage.='<div align="left"><b>MISSION</b></div><br><ul>';
            
            foreach ($missions as $mvalue) 
            {
                $clgfrontpage.='<li>'.$mvalue['mission'].'</li>';
            }

            $clgfrontpage.='</ul></div>';
            $clgfrontpage.= '<pagebreak resetpagenum="1" pagenumstyle="1" suppress="" />
                    <sethtmlpageheader name="firstpageheader" page="O" value="on" show-this-page="1" />
                    
                    <sethtmlpagefooter name="firstpage" page="O" value="on" />';
        }

        $content = $clgfrontpage.$_SESSION['matrixavg'].$_SESSION['acmfinalreport'];

        $filename=$cdc_Deptname.' CDC.pdf';
        $pdf = new Pdf([
            'mode' => Pdf::MODE_UTF8,
            'filename' =>$filename,   
            'format' => Pdf::FORMAT_A4,
            'orientation' => Pdf::ORIENT_PORTRAIT,
            'destination' => Pdf::DEST_DOWNLOAD,
            'content' => $content,
            'cssInline' => ' @media all{
                        table{border-collapse: collapse; font-family:"Roboto, sans-serif"; width:100%; font-size: 14px; } 
                        div{ 
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: justify;
                            text-justify: inter-word;
                            padding:2px !important;
                            font-size: 14px;
                        }
                        li{ 
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: justify;
                            text-justify: inter-word;
                            padding:2px !important;
                            font-size: 14px;
                        }
                        table td{
                            border: 1px solid #000;                            
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: justify;
                            text-justify: inter-word;
                            padding:2px !important;
                            font-size: 14px;
                        }
                        table th{
                            border: 1px solid #000;                           
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: center;
                            font-size: 14px;
                           
                        }

                        .oectable td
                        {
                            text-align: center;
                            vertical-align: middle;
                             border: 0px; 
                             height: 800px !important;
                        }

                         .footerpage{
                            text-align:right; 
                            border-top: 1px solid #000; 
                            font-size: 9px;
                            font-style: italic;
                            font-weight: bold;
                        }
                        .headerpage{
                            text-align:right; 
                            border-bottom: 1px solid #000; 
                            font-size: 9px;
                            font-style: italic;
                            font-weight: bold;
                        }
                    }   
                ',
            'options' => ['title' => $cdc_Deptname.' Curriculum and Syllabus','showWatermarkText' => true,],
            'methods' => [ 
                    //'SetHeader'=>[$header], 
                    //'SetFooter'=>[$footer.' PRINTED ON : {DATE d-m-Y H:i:s:A}  PAGE :{PAGENO}'],
                    'SetWatermarkText' => [$watermark,  0.040],
                ],
        ]);
        Yii::$app->response->format = \yii\web\Response::FORMAT_RAW;
        $headers = Yii::$app->response->headers;
        $headers->add('Content-Type', 'application/pdf');

        
        return $pdf->render();
    }

    public function actionCdcServicereport()
    {
        $model = new CurriculumSubject();

        $cursubdata ='';
        if(Yii::$app->request->post())
        {
            $cursub=$_POST['cursub'];

            $coe_regulation_id=$_POST['coe_regulation_id'];
            $coe_dept_id=$_POST['coe_dept_id'];
            $degree_type=$_POST['degree_type'];

            $error=$successful=0;

            if(count($cursub)>0)
            {
                $approved_core = Yii::$app->db->createCommand("UPDATE cur_curriculum_subject SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id='" . $coe_dept_id . "' AND coe_dept_id=8")->execute();                   

                $approved_SandH = Yii::$app->db->createCommand("UPDATE cur_servicesubtodept SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "'")->execute();

                $approved_syllabus = Yii::$app->db->createCommand("UPDATE cur_syllabus SET approve_status  ='1' WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . "' AND coe_dept_id=8")->execute();

                if($approved_core)
                {
                    if($approved_SandH)
                    {
                        if($approved_syllabus)
                        {
                            $successful++;
                        }
                        else
                        {
                            $error++;
                        }
                        
                    }
                    else
                    {
                        $error++;
                    }
                }
                else
                {
                    $error++;
                }
                   
                //$approved_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_servicesubtodept WHERE degree_type='" . $degree_type . "' AND coe_regulation_id='" . $coe_regulation_id . " AND 'approve_status  ='1'")->queryScalar();
                
                if($successful>0)
                {
                    Yii::$app->ShowFlashMessages->setMsg('Success', $successful."Course Successfully approved ".$error." Error");
                    return $this->redirect(['cdc-servicereport']);
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Something missing for Approve! Please Check");
                    return $this->redirect(['cdc-servicereport']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Something error! Please Check");
                    return $this->redirect(['cdc-servicereport']);
            }

        } else 
        {
       
            return $this->render('cdc_servicereport', [
                    'model' => $model,
                ]);
        }

    }

    public function actionCdcshreportdata()
    {

        $semester=Yii::$app->request->post('semester');

        $sem_num='';
        if(!empty($semester)) 
        {
            $sem=explode("-",  Yii::$app->request->post('semester'));

            $sem_num=" AND (1<= A.semester AND A.semester<=".$sem[1].")";



            $sem=explode("-",  Yii::$app->request->post('semester'));
        }

        $checkcurriculumdata = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='8' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='1'")->queryAll();               
        $checkcurriculumdata1 = Yii::$app->db->createCommand("SELECT * FROM cur_curriculum_subject WHERE coe_dept_id='8' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND approve_status  ='1'")->queryAll();

        $check_bos = Yii::$app->db->createCommand("SELECT count(*) FROM cur_bos WHERE coe_dept_id='8' AND coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND degree_type='".Yii::$app->request->post('degree_type')."' AND bos_min_file!='' AND bos_attendance_file!=''")->queryScalar(); 

        $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year FROM coe_regulation WHERE coe_regulation_id=".Yii::$app->request->post('coe_regulation_id'))->queryScalar();

        $userid = Yii::$app->user->getId();

        $output = substr($regulationyear, 2, 3);

        $roman = ['1'=>'I','2'=>'II','3'=>'III','4'=>'IV','5'=>'V','6'=>'VI','7'=>'VII','8'=>'VIII'];

        $electcreditpoint=3; // credit point elective per paper

        $header =$curriculumdata=''; $overallhrtot=$overallextinttot=$overllcredittot=0;
        if(!empty($checkcurriculumdata))
        {
           
            require(Yii::getAlias('@webroot/includes/use_institute_info.php'));

            $header = '<table class="table table-responsive dum_edit_table table-hover" >
                        <tr>
                          <td> 
                            <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                          </td>

                          <td align="center"> 
                              <center><b><h4>' . $org_name . '</h4></b></center>
                              <center> <h6>' . $org_address . '</h6></center>
                              <center><b><h5>' . $org_tagline . '</h5></b></center> 
                              <center><b><h6>Curriculum Course List For Approve
                            <br>Regulation: '.$regulationyear.'</h6></b></center> 
                         </td>
                          <td align="center">  
                            <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                          </td>
                        </tr>                                          
                    </table>';

            if(Yii::$app->request->post('degree_type')=='UG')
            {
                $semcredittot=$semhrtot=$semextint=0;

                for ($s=1; $s <=8 ; $s++)
                { 
                   
                    $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, DT.dept_code FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept SS ON SS.coe_cur_subid=A.coe_cur_id JOIN cur_department DT ON DT.coe_dept_id=SS.coe_dept_ids WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND SS.semester=".$s." GROUP BY A.subject_code,SS.semester")->queryAll();
                    
                   
                    if(!empty($curriculumsemdata))
                    {
                        $curriculumdata.="<table align=center width=100% border=1 style='text-align:center !important;'>";        
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=10 style='text-align:center !important;'>Semester ".$roman[$s]."</th>";
                        $curriculumdata.="</tr>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Name</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Dept.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                        $sl=1;
                        foreach ($curriculumsemdata as $value) 
                        {
                            $deptlist = Yii::$app->db->createCommand("SELECT DT.dept_code FROM cur_curriculum_subject A  JOIN cur_servicesubtodept SS ON SS.coe_cur_subid=A.coe_cur_id JOIN cur_department DT ON DT.coe_dept_id=SS.coe_dept_ids WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND SS.semester=".$s." AND A.subject_code='".$value['subject_code']."'")->queryAll();

                            $depts=array();
                            if(count($deptlist)>0)
                            {
                              
                                foreach ($deptlist as $val) 
                                {
                                    $depts[]=$val['dept_code'];
                                }
                                $depts=implode(",", $depts);
                                //print_r($depts); exit();
                            }

                            
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subject_name']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$depts."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['LTP']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                $curriculumdata.="</tr>";
                            

                            $semcredittot=$semcredittot+$value['credit_point'];
                            $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                            $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                            $sl++;
                        }                   
                        
                        $curriculumdata.="</table><br>";


                    }
                }

                    $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='MC' GROUP BY A.subject_code ORDER BY A.subject_code ASC")->queryAll();

                     if(!empty($curriculumsemdata))
                    {
                        $curriculumdata.="<table align=center width=100% border=1 style='text-align:center !important;'>";        
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=9 style='text-align:center !important;'>Mandatory Courses</th>";
                        $curriculumdata.="</tr>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Name</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                        $sl=1;
                        foreach ($curriculumsemdata as $value) 
                        {

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                           
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";

                            if($value['internal_mark']=='100')
                            {
                                 $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                
                            }
                            else
                            {
                                 $curriculumdata.="<td style='text-align:center !important;' colspan=3>3 Weeks</td>";
                            }
                           

                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['stream_name']."</td>";
                            $curriculumdata.="</tr>";

                             $sl++;

                        }
                        
                         $curriculumdata.="</table><br>";
                    }

                $curriculumdata=$header.$curriculumdata;
            }
            else if(Yii::$app->request->post('degree_type')=='PG')
            {

                $semcredittot=$semhrtot=$semextint=0;

                for ($s=1; $s <=4 ; $s++)
                { 
                   
                    $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, DT.dept_code FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept SS ON SS.coe_cur_subid=A.coe_cur_id JOIN cur_department DT ON DT.coe_dept_id=SS.coe_dept_ids WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND SS.semester=".$s." GROUP BY A.subject_code,SS.semester")->queryAll();
                    
                   
                    if(!empty($curriculumsemdata))
                    {
                        $curriculumdata.="<table align=center width=100% border=1 style='text-align:center !important;'>";        
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=10 style='text-align:center !important;'>Semester ".$roman[$s]."</th>";
                        $curriculumdata.="</tr>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Name</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Dept.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                        $sl=1;
                        foreach ($curriculumsemdata as $value) 
                        {
                            $deptlist = Yii::$app->db->createCommand("SELECT DT.dept_code FROM cur_curriculum_subject A  JOIN cur_servicesubtodept SS ON SS.coe_cur_subid=A.coe_cur_id JOIN cur_department DT ON DT.coe_dept_id=SS.coe_dept_ids WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND SS.semester=".$s." AND A.subject_code='".$value['subject_code']."'")->queryAll();

                            $depts=array();
                            if(count($deptlist)>0)
                            {
                              
                                foreach ($deptlist as $val) 
                                {
                                    $depts[]=$val['dept_code'];
                                }
                                $depts=implode(",", $depts);
                                //print_r($depts); exit();
                            }

                            
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subject_name']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$depts."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['LTP']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                $curriculumdata.="</tr>";
                            

                            $semcredittot=$semcredittot+$value['credit_point'];
                            $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                            $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                            $sl++;
                        }                   
                        
                        $curriculumdata.="</table><br>";


                    }
                }

                $curriculumdata=$header.$curriculumdata;
            }
        } 
        else if(!empty($checkcurriculumdata1))
        {
           
            require(Yii::getAlias('@webroot/includes/use_institute_info.php'));

            $header = '<table class="table table-responsive dum_edit_table table-hover" >
                        <tr>
                          <td> 
                            <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                          </td>

                          <td align="center"> 
                              <center><b><h4>' . $org_name . '</h4></b></center>
                              <center> <h6>' . $org_address . '</h6></center>
                              <center><b><h5>' . $org_tagline . '</h5></b></center> 
                              <center><b><h6>Curriculum Course List For Approve
                            <br>Regulation: '.$regulationyear.'</h6></b></center> 
                         </td>
                          <td align="center">  
                            <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                          </td>
                        </tr>                                          
                    </table>';

            if(Yii::$app->request->post('degree_type')=='UG')
            {
                $semcredittot=$semhrtot=$semextint=0;

                for ($s=1; $s <=8 ; $s++)
                { 
                   
                    $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, DT.dept_code FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept SS ON SS.coe_cur_subid=A.coe_cur_id JOIN cur_department DT ON DT.coe_dept_id=SS.coe_dept_ids WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND SS.semester=".$s." GROUP BY A.subject_code,SS.semester")->queryAll();
                    
                   
                    if(!empty($curriculumsemdata))
                    {
                        $curriculumdata.="<table align=center width=100% border=1 style='text-align:center !important;'>";        
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=10 style='text-align:center !important;'>Semester ".$roman[$s]."</th>";
                        $curriculumdata.="</tr>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Name</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Dept.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                        $sl=1;
                        foreach ($curriculumsemdata as $value) 
                        {
                            $deptlist = Yii::$app->db->createCommand("SELECT DT.dept_code FROM cur_curriculum_subject A  JOIN cur_servicesubtodept SS ON SS.coe_cur_subid=A.coe_cur_id JOIN cur_department DT ON DT.coe_dept_id=SS.coe_dept_ids WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND SS.semester=".$s." AND A.subject_code='".$value['subject_code']."'")->queryAll();

                            $depts=array();
                            if(count($deptlist)>0)
                            {
                              
                                foreach ($deptlist as $val) 
                                {
                                    $depts[]=$val['dept_code'];
                                }
                                $depts=implode(",", $depts);
                                //print_r($depts); exit();
                            }

                            
                                $curriculumdata.="<tr>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subject_code']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subject_name']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$depts."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['LTP']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['subjecttype']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['stream_name']."</td>";
                                $curriculumdata.="</tr>";
                            

                            $semcredittot=$semcredittot+$value['credit_point'];
                            $semhrtot=$semhrtot+$value['contact_hrsperweek'];
                            $semextint=$semextint+($value['external_mark']+$value['internal_mark']);
                            $sl++;
                        }                   
                        
                        $curriculumdata.="</table><br>";


                    }
                }

                    $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."' AND F.stream_name='MC' GROUP BY A.subject_code ORDER BY A.subject_code ASC")->queryAll();

                     if(!empty($curriculumsemdata))
                    {
                        $curriculumdata.="<table align=center width=100% border=1 style='text-align:center !important;'>";        
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center colspan=9 style='text-align:center !important;'>Mandatory Courses</th>";
                        $curriculumdata.="</tr>";
                        $curriculumdata.="<tr>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>S.No.</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Code</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Name</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>LTP</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Contact Hrs/Wk</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Credit</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Int./Ext. Mark</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Course Type</th>";
                        $curriculumdata.="<th align=center style='text-align:center !important;'>Category</th>";
                        $curriculumdata.="</tr>";

                        $sl=1;
                        foreach ($curriculumsemdata as $value) 
                        {

                            $curriculumdata.="<tr>";
                            $curriculumdata.="<td style='text-align:center !important;'><input type='hidden' name='cursub[]' value='".$value['coe_cur_id']."'>".$sl."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_code']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subject_name']."</td>";
                           
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['LTP']."</td>";

                            if($value['internal_mark']=='100')
                            {
                                 $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['contact_hrsperweek']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['credit_point']."</td>";
                                $curriculumdata.="<td align=center style='text-align:center !important;'>".$value['intext_mark']."</td>";
                                
                            }
                            else
                            {
                                 $curriculumdata.="<td style='text-align:center !important;' colspan=3>3 Weeks</td>";
                            }
                           

                            $curriculumdata.="<td style='text-align:center !important;'>".$value['subjecttype']."</td>";
                            $curriculumdata.="<td style='text-align:center !important;'>".$value['stream_name']."</td>";
                            $curriculumdata.="</tr>";
                             $sl++;
                        }
                        
                         $curriculumdata.="</table><br>";
                    }

                $curriculumdata=$header.$curriculumdata;
            }
            else if(Yii::$app->request->post('degree_type')=='PG')
            {

            }
            else if(Yii::$app->request->post('degree_type')=='MBA')
            {

            }
        }

         $coresubject = Yii::$app->db->createCommand("SELECT B.subject_code,A.semester,A.coe_dept_ids FROM cur_curriculum_subject B JOIN cur_servicesubtodept A ON A.coe_cur_subid=B.coe_cur_id AND A.coe_regulation_id=B.coe_regulation_id WHERE A.coe_dept_id='8' AND A.coe_regulation_id=".Yii::$app->request->post('coe_regulation_id')." AND A.degree_type='".Yii::$app->request->post('degree_type')."'".$sem_num." GROUP BY B.subject_code")->queryAll();
        
        array_multisort(array_column($coresubject, 'semester'),  SORT_ASC, $coresubject);
        

        if(!empty($coresubject))
        {
            $curriculumdata.='<pagebreak>';
            foreach ($coresubject as $value) 
            {
                $html='';

                $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();  

                $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                $ltot=0;
                $ttot=0;
                $ptot=0;
                if(empty($codatalist))
                {
                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type, B.coe_elective_option  FROM cur_syllabus A JOIN cur_elective_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id!=106")->queryOne();
                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];
                    $ltot=($codatalist['L'])*15;
                    $ttot=($codatalist['T'])*15;
                    $ptot=($codatalist['P'])*15;
                }
                else
                {
                    $ltot=($codatalist['L'])*15;
                    $ttot=($codatalist['T'])*15;
                    $ptot=($codatalist['P'])*15;
                }
                
                if(!empty($codatalist)) 
                {
                    $colablist = Yii::$app->db->createCommand("SELECT * FROM cur_lab_component WHERE cur_syllabus_id=".$cur_syllabus_id)->queryAll();

                   
                    $html.='<table class="table" width="100%">
                        <tr>
                            <td width="15%">
                                <b>'.$codatalist["subject_code"].'</b>
                            </td>
                            <td width="70%" colspan="2" align=center>';
                    
                            $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                
                         $html.='    </td>
                            <td width="15%" align=center>
                                <b>'.$codatalist["ltp"].'</b>
                            </td>
                        </tr>
                         <tr>
                            <td colspan="4">
                                <b>Nature of the Course: </b>'.$codatalist['subject_type'].' ('.$codatalist['subject_category_type'].')
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <b>Pre-requisite(s):'.$codatalist['prerequisties'].'</b>
                            </td>
                        </tr>
                         <tr>
                            <td colspan="4">
                                <b>Course Objectives:</b>
                            </td>
                        </tr>';
                        if(!empty($codatalist)) 
                        {
                            
                            for($l=1;$l<=6;$l++)
                            {
                                $cot='course_objectives'.$l;
                                if($codatalist[$cot]!='')
                                {                            
                                    $html.='<tr>';
                                    $html.='<td width=15% align=center>'.$l.'</td>';
                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                    $html.='</tr>';
                                }
                            }
                        }
                        

                       $html.=' <tr>
                            <td colspan="4">
                                <b>Course Outcomes:</b>
                            </td>
                        </tr>';
                        if(!empty($codatalist)) 
                        {
                            
                            for($l=1;$l<=6;$l++)
                            {
                                $cot='course_outcomes'.$l;
                                $rpt='rpt'.$l;
                                if($codatalist[$cot]!='')
                                {
                                    if($codatalist[$rpt]!='')
                                    {
                                        $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                    }
                                    else
                                    {
                                        $rptdta ='NO RBT';
                                    }
                                    
                                    $html.='<tr>';
                                    $html.='<td width=15% align=center>CO'.$l.'</td>';
                                    $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                    $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                    $html.='</tr>';
                                }
                            }
                        }
                    
                        $html.=' </table><table class="table" width="100%">';
                       
                         
                        if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                        {
                             $html.='   <tr>
                                <td colspan="4">
                                    <b>Course Content:</b>
                                </td>
                            </tr>';
                            for($l=1;$l<=3;$l++)
                            {
                                $module_title='module_title'.$l;
                                $module_hr='module_hr'.$l;
                                $module_content='cource_content_mod'.$l;
                                if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                {

                                    $html.='<tr>';
                                    $html.='<td width=80% colspan=3><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                    $html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                    $html.='</tr>';

                                    $html.='<tr>';
                                    $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                    $html.='</tr>';

                                   
                                }
                            }
                        }

                        if($ltot!=0)
                        {
                            $html.='   <tr>
                                <td colspan="3" align=right>
                                    <b>Total Hours(L):</b>
                                </td>
                                <td>
                                    <b>'.$ltot.'</b>
                                </td>
                            </tr>';
                        }

                        if($ttot!=0)
                        {
                            $html.='   <tr>
                                <td colspan="3" align=right>
                                    <b>Total Hours(T):</b>
                                </td>
                                <td>
                                    <b>'.$ttot.'</b>
                                </td>
                            </tr>';

                            if($ltot!=0)
                            {
                                $html.='   <tr>
                                    <td colspan="3" align=right>
                                        <b>Total Hours(LT):</b>
                                    </td>
                                    <td>
                                        <b>'.($ttot+$ltot).'</b>
                                    </td>
                                </tr>';
                            }
                        }
                        
                        
                        if(!empty($colablist)) 
                        {

                          $html.='   <tr>
                                <th colspan="4">
                                    <b>Lab Components:</b>
                                </th>
                            </tr>
                            <tr>
                                <th>S.No.</th>
                                <th>List of Experiments</th>
                                <th>CO Mapping</th>
                                <th>RBT</th>
                            </tr>';

                            $s=1;
                            foreach ($colablist as $value) 
                            {
                                $html.='<tr>';
                                $html.='<td width=10%>'.$s.'</td>';
                                $html.='<td width=60%>'.$value['experiment_title'].'</td>';
                                $html.='<td width=15%>'.$value['cource_outcome'].'</td>';
                                $html.='<td width=15%>'.$value['rpt'].'</td>';
                                $html.='</tr>';
                                $s++;
                            }

                            $html.='   <tr>
                                <td colspan="3" align=right>
                                    <b>Total Hours(P):</b>
                                </td>
                                <td>
                                    <b>'.$ptot.'</b>
                                </td>
                            </tr>';
                        }
                       
                        $html.=' <tr>
                            <td colspan="4">
                                <b>Text Book:</b>
                            </td>
                        </tr>';
                        if(!empty($codatalist)) 
                        {
                            
                            for($l=1;$l<=3;$l++)
                            {
                                $cot='text_book'.$l;
                                if($codatalist[$cot]!='')
                                {                            
                                    $html.='<tr>';
                                    $html.='<td width=10%>'.$l.'</td>';
                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                    $html.='</tr>';
                                }
                            }
                        }
                        
                       
                         $html.='<tr>
                            <td colspan="4">
                                <b>Reference Book:</b>
                            </td>
                        </tr>';
                       
                        if(!empty($codatalist)) 
                        {
                            
                            for($l=1;$l<=3;$l++)
                            {
                                $cot='reference_book'.$l;
                                if($codatalist[$cot]!='')
                                {                            
                                    $html.='<tr>';
                                    $html.='<td width=10%>'.$l.'</td>';
                                    $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                    $html.='</tr>';
                                }
                            }
                        }
                       
                        $web_reference1 = str_replace(' ', '', $codatalist['web_reference1']);
                       
                        if(!empty($web_reference1) && $web_reference1!=' ' && $web_reference1!=''  && $web_reference1!='NA') 
                        {
                              $html.='  <tr>
                                    <td colspan="4">
                                        <b>Web Reference:</b>
                                    </td>
                                </tr>';

                            for($l=1;$l<=3;$l++)
                            {
                                $cot='web_reference'.$l;
                                if($codatalist[$cot]!='')
                                {                            
                                    $html.='<tr>';
                                    $html.='<td width=10%>'.$l.'</td>';
                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                    $html.='</tr>';
                                }
                            }
                        }
                       

                        $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                            //print_r($online_reference1); exit();
                        if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                        {
                            
                             $html.=' <tr>
                                <td colspan="4">
                                    <b>Online Reference:</b>
                                </td>
                            </tr>';

                            for($l=1;$l<=2;$l++)
                            {
                                $cot='online_reference'.$l;
                                if($codatalist[$cot]!='')
                                {                            
                                    $html.='<tr>';
                                    $html.='<td width=10%>'.$l.'</td>';
                                    $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                    $html.='</tr>';
                                }
                            }
                        }                    
                         $html.=' </table> ';

                        $co_matrix_dept = Yii::$app->db->createCommand("SELECT A.coe_dept_id,B.dept_name FROM cur_course_service_matrix A JOIN cur_department B ON B.coe_dept_id=A.coe_dept_id WHERE cur_syllabus_id=".$cur_syllabus_id." GROUP BY A.coe_dept_id")->queryAll();

                        //print_r($co_matrix_dept); exit;

                        if(!empty($co_matrix_dept))
                        {
                            foreach ($co_matrix_dept as $dept) 
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".$dept['coe_dept_id'])->queryAll();

                                $colspan=$co_matrix[0]['pso_count'];

                                $html.=' 

                                <table border="1" width="100%">
                                <tr>                                    
                                      <th colspan="'.($colspan+13).'" width="10%" style="text-align: center;">'.$dept['dept_name'].'</th>
                                </tr>
                                <tr>
                                    <th rowspan="2" width="10%" style="text-align: center;">Course Outcome (CO)</th>
                                     <th colspan="12" width="75%" style="text-align: center;">Programme Outcomes (PO)</th>
                                      <th colspan="'.$colspan.'" width="20%" style="text-align: center;">Programme Specific Outcomes (PSO)</th>
                                </tr>
                       
                                <tr>';
                                
                                for ($i=1; $i <=12 ; $i++) 
                                { 
                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                } 
                                for ($i=1; $i <=$colspan ; $i++) 
                                { 
                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                }
                                $html.= "</tr>";

                                if(!empty($co_matrix))
                                {
                                    foreach ($co_matrix as $value) 
                                    {
                                        $html.='<tr>';
                                        $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                        for ($i=1; $i <=12 ; $i++) 
                                        { 
                                            $po='po'.$i;
                                            $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                        }

                                        $pso_value=explode(",", $value['pso_value']);
                                        for ($p=0; $p <$colspan ; $p++) 
                                        { 
                                            $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                        }
                                        
                                        $html.='</tr>';

                                    }
                                }

                                $html.=' </table><br>';
                            }
                        }
                        
                            
                            $html.=' <pagebreak>';
                       $curriculumdata.=$html;
                }
                else
                {
                    $codatalist = Yii::$app->db->createCommand("SELECT A.*,B.subject_code,B.subject_name,B.subject_category_type_id, L, T, P, concat(L,'/',T,'/',P)as ltp, D.category_type as subject_type, E.category_type as subject_category_type FROM cur_syllabus A JOIN cur_curriculum_subject B ON B.subject_code=A.subject_code AND B.coe_batch_id=A.coe_batch_id AND B.coe_dept_id=A.coe_dept_id JOIN cur_ltp C ON C.coe_ltp_id=B.coe_ltp_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_type_id JOIN coe_category_type E ON E.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code='".$value['subject_code']."' AND B.subject_type_id=106")->queryOne();        
                    
                    $cur_syllabus_id=$codatalist['cur_syllabus_id'];

                    if(!empty($codatalist)) 
                    {

                        $html.='<table class="table" width="100%">
                            <tr>
                                <td width="15%">
                                    <b>'.$codatalist["subject_code"].'</b>
                                </td>
                                <td width="70%" colspan="2" align=center>';
                        
                                $html.='<b>'.strtoupper($codatalist["subject_name"]).'</b>';
                                    
                             $html.='    </td>
                                <td width="15%" align=center>
                                    <b>'.$codatalist["ltp"].'</b>
                                </td>
                            </tr>
                             <tr>
                                <td colspan="4">
                                    <b>Nature of the Course: </b>'.$codatalist['subject_type'].' ('.$codatalist['subject_category_type'].')
                                </td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <b>Pre-requisite(s):'.$codatalist['prerequisties'].'</b>
                                </td>
                            </tr>
                             <tr>
                                <td colspan="4">
                                    <b>Course Objectives:</b>
                                </td>
                            </tr>';
                            if(!empty($codatalist)) 
                            {
                                
                                for($l=1;$l<=6;$l++)
                                {
                                    $cot='course_objectives'.$l;
                                    if($codatalist[$cot]!='')
                                    {                            
                                        $html.='<tr>';
                                        $html.='<td width=15% align=center>'.$l.'</td>';
                                        $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                        $html.='</tr>';
                                    }
                                }
                            }
                            

                           $html.=' <tr>
                                <td colspan="4">
                                    <b>Course Outcomes:</b>
                                </td>
                            </tr>';
                            if(!empty($codatalist)) 
                            {
                                
                                for($l=1;$l<=6;$l++)
                                {
                                    $cot='course_outcomes'.$l;
                                    $rpt='rpt'.$l;
                                    if($codatalist[$cot]!='')
                                    {
                                        $rptdta = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id=".$codatalist[$rpt])->queryScalar();
                                        $html.='<tr>';
                                        $html.='<td width=15% align=center>CO'.$l.'</td>';
                                        $html.='<td width=75% colspan=2>'.$codatalist[$cot].'</td>';
                                        $html.='<td width=10% align=center>'.$rptdta.'</td>';
                                        $html.='</tr>';
                                    }
                                }
                            }
                        
                            $html.=' </table><table class="table" width="100%">';
                           
                             
                            if(!empty($codatalist['module_title1']) && $codatalist['module_title1']!=' ' && $codatalist['module_title1']!='' ) 
                            {
                                 $html.='   <tr>
                                    <td colspan="4">
                                        <b>Course Content:</b>
                                    </td>
                                </tr>';
                                for($l=1;$l<=3;$l++)
                                {
                                    $module_title='module_title'.$l;
                                    $module_hr='module_hr'.$l;
                                    $module_content='cource_content_mod'.$l;
                                    if($codatalist[$module_title]!='' && $codatalist[$module_hr]!='' && $codatalist[$module_content]!='')
                                    {

                                        $html.='<tr>';
                                        $html.='<td width=100% colspan=4><b>Module '.$l.': '.$codatalist[$module_title].'</b></td>';
                                        //$html.='<td width=20%><b>'.$codatalist[$module_hr].' Hrs</b></td>';
                                        $html.='</tr>';

                                        $html.='<tr>';
                                        $html.='<td width=100% colspan=4>'.$codatalist[$module_content].'</td>';
                                        $html.='</tr>';

                                       
                                    }
                                }
                            }
                            
                            
                            if(!empty($codatalist['text_book1']) && $codatalist['text_book1']!=' ' && $codatalist['text_book1']!='NA'  && $codatalist['text_book1']!='na' )  
                            {
                                $html.=' <tr>
                                        <td colspan="4">
                                            <b>Text Book:</b>
                                        </td>
                                    </tr>';

                                for($l=1;$l<=3;$l++)
                                {
                                    $cot='text_book'.$l;
                                    if($codatalist[$cot]!='')
                                    {                            
                                        $html.='<tr>';
                                        $html.='<td width=10%>'.$l.'</td>';
                                        $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                        $html.='</tr>';
                                    }
                                }
                            }
                           
                            if(!empty($codatalist['reference_book1']) && $codatalist['reference_book1']!=' ' && $codatalist['reference_book1']!='NA' ) 
                            {
                                  $html.='<tr>
                                    <td colspan="4">
                                        <b>Reference Book:</b>
                                    </td>
                                </tr>';
                                for($l=1;$l<=3;$l++)
                                {
                                    $cot='reference_book'.$l;
                                    if($codatalist[$cot]!='')
                                    {                            
                                        $html.='<tr>';
                                        $html.='<td width=10%>'.$l.'</td>';
                                        $html.='<td width=90%  colspan="3">'.$codatalist[$cot].'</td>';
                                        $html.='</tr>';
                                    }
                                }
                            }
                           
                           
                            if(!empty($codatalist['web_reference1']) && $codatalist['web_reference1']!=' ' && $codatalist['web_reference1']!='NA' ) 
                            {
                                  $html.='  <tr>
                                        <td colspan="4">
                                            <b>Web Reference:</b>
                                        </td>
                                    </tr>';

                                for($l=1;$l<=3;$l++)
                                {
                                    $cot='web_reference'.$l;
                                    if($codatalist[$cot]!='')
                                    {                            
                                        $html.='<tr>';
                                        $html.='<td width=10%>'.$l.'</td>';
                                        $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                        $html.='</tr>';
                                    }
                                }
                            }
                           

                            $online_reference1 = str_replace(' ', '', $codatalist['online_reference1']);
                            //print_r($online_reference1); exit();
                            if(!empty($codatalist['online_reference1']) && $online_reference1!='' && $online_reference1!='NA') 
                            {
                                
                                 $html.=' <tr>
                                    <td colspan="4">
                                        <b>Online Reference:</b>
                                    </td>
                                </tr>';

                                for($l=1;$l<=2;$l++)
                                {
                                    $cot='online_reference'.$l;
                                    if($codatalist[$cot]!='')
                                    {                            
                                        $html.='<tr>';
                                        $html.='<td width=10%>'.$l.'</td>';
                                        $html.='<td width=90% colspan="3">'.$codatalist[$cot].'</td>';
                                        $html.='</tr>';
                                    }
                                }
                            }                    
                             $html.=' </table> ';

                            $co_matrix_dept = Yii::$app->db->createCommand("SELECT A.coe_dept_id,B.dept_name FROM cur_course_service_matrix A JOIN cur_department B ON B.coe_dept_id=A.coe_dept_id WHERE cur_syllabus_id=".$cur_syllabus_id." GROUP BY A.coe_dept_id")->queryAll();

                        //print_r($co_matrix_dept); exit;

                        if(!empty($co_matrix_dept))
                        {
                            foreach ($co_matrix_dept as $dept) 
                            {
                                $co_matrix = Yii::$app->db->createCommand("SELECT * FROM cur_course_service_matrix WHERE cur_syllabus_id=".$cur_syllabus_id." AND coe_dept_id=".$dept['coe_dept_id'])->queryAll();

                                $colspan=$co_matrix[0]['pso_count'];

                                $html.=' 

                                <table border="1" width="100%">
                                <tr>                                    
                                      <th colspan="'.($colspan+13).'" width="10%" style="text-align: center;">'.$dept['dept_name'].'</th>
                                </tr>
                                <tr>
                                    <th rowspan="2" width="10%" style="text-align: center;">Course Outcome (CO)</th>
                                     <th colspan="12" width="70%" style="text-align: center;">Programme Outcomes (PO)</th>
                                      <th colspan="'.$colspan.'" width="20%" style="text-align: center;">Programme Specific Outcomes (PSO)</th>
                                </tr>
                       
                                <tr>';
                                
                                for ($i=1; $i <=12 ; $i++) 
                                { 
                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                } 
                                for ($i=1; $i <=$colspan ; $i++) 
                                { 
                                    $html.= "<th style='text-align: center;'>".$i."</td>";
                                }
                                $html.= "</tr>";

                                if(!empty($co_matrix))
                                {
                                    foreach ($co_matrix as $value) 
                                    {
                                        $html.='<tr>';
                                        $html.='<td width=10% style="text-align: center;">'.$value['co'].'</td>';
                                        for ($i=1; $i <=12 ; $i++) 
                                        { 
                                            $po='po'.$i;
                                            $html.='<td style="text-align: center;">'.$value[$po].'</td>';
                                        }

                                        $pso_value=explode(",", $value['pso_value']);
                                        for ($p=0; $p <$colspan ; $p++) 
                                        { 
                                            $html.='<td width=5% style="text-align: center;">'.$pso_value[$p].'</td>';
                                        }
                                        
                                        $html.='</tr>';

                                    }
                                }

                                $html.=' </table><br>';
                            }
                        }
                            
                               
                                $html.=' <pagebreak>';

                           $curriculumdata.=$html;
                    }
                }

            }

            
        }

        if (isset($_SESSION['cdcshreportsession'])) 
        {
            unset($_SESSION['cdcshreportsession']);
        }
        $_SESSION['cdcshreportsession'] = $curriculumdata;

        if (isset($_SESSION['check_bos'])) 
        {
            unset($_SESSION['check_bos']);
        }
        $_SESSION['check_bos'] = $check_bos;

        $curdata[]=array('check_bos'=>$check_bos,'userid'=>$userid,'approved'=>count($checkcurriculumdata1),'noapproved'=>count($checkcurriculumdata),'curriculumdata'=>$curriculumdata,'totalcredit'=>$overllcredittot);
        return Json::encode($curdata);
    }

    public function actionCdcshreportPdf()
    {
        require(Yii::getAlias('@webroot/includes/use_institute_info.php'));

        $watermark='';
        if($_SESSION['check_bos']!=0 && $_SESSION['check_bos']!='')
        {
            $watermark='RECMD';
        }
        else
        {
            $watermark='DRAFT';
        }

        $content = $_SESSION['cdcshreportsession'];
        $pdf = new Pdf([
            'mode' => Pdf::MODE_CORE,
            'filename' =>'S&H Curriculum_and_Syllabus.pdf',   
            'format' => Pdf::FORMAT_A4,
            'orientation' => Pdf::ORIENT_PORTRAIT,
            'content' => $content,
            'cssInline' => ' @media all{
                        table{border-collapse: collapse; font-family:"Roboto, sans-serif"; width:100%; font-size: 13px; } 
                        
                        table td{
                            border: 1px solid #000;                            
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: justify;
                            text-justify: inter-word;
                            padding:2px !important;
                        }
                        table th{
                            border: 1px solid #000;
                           
                            overflow: hidden;
                            text-overflow: ellipsis;
                            text-align: center;
                           
                        }
                    }   
                ',
            'options' => ['title' => 'S&H CURRICULUM AND SYLLABUS','showWatermarkText' => true,],
            'methods' => [ 
                    'SetHeader'=>['S&H CURRICULUM AND SYLLABUS'], 
                    'SetFooter'=>['CURRICULUM AND SYLLABUS ON : {DATE d-m-Y H:i:s:A}  PAGE :{PAGENO}'],
                    'SetWatermarkText' => [$watermark],
                ],
        ]);
        Yii::$app->response->format = \yii\web\Response::FORMAT_RAW;
        $headers = Yii::$app->response->headers;
        $headers->add('Content-Type', 'application/pdf');
        return $pdf->render();
    }

    public function actionBosUpload()
    {
        $model = new CurriculumSubject();

        if (Yii::$app->request->post()) 
        {
            if($_POST['uploaded_bosminfile']!=""  && $_POST['uploaded_bosattendfile']!="" )
            {
                $bos_min_filename = $_POST['uploaded_bosminfile'];
                $file_parts = pathinfo($bos_min_filename);
                $maxsize    = 2097152;
                $uploaded_file = $_FILES["uploaded_bosminfile"]["name"];
                $save_folder = Yii::getAlias('@webroot').'/resources/curriculum_bos/';
                $saving_file_name = date('d-m-Y-H-i-s')."-".str_replace(" ", "-", $uploaded_file);
                $save_in_folder = $save_folder.$saving_file_name;   

                $bos_attend_filename = $_POST['uploaded_bosattendfile'];
                $file_parts1 = pathinfo($bos_attend_filename);
                $uploaded_file1 = $_FILES["uploaded_bosattendfile"]["name"];
                $save_folder1 = Yii::getAlias('@webroot').'/resources/curriculum_bos/';
                $saving_file_name1 = date('d-m-Y-H-i-s')."-".str_replace(" ", "-", $uploaded_file1);
                $save_in_folder1 = $save_folder1.$saving_file_name1;

                $bosminsize=$_FILES['uploaded_bosminfile']['size'];

                $bosattendsize=$_FILES['uploaded_bosattendfile']['size']; 

                $semester = $_POST['CurriculumSubject']['semester'];

                $bos_date = date("Y-m-d",strtotime($_POST['bos_date']));

                $created_at = date("Y-m-d H:i:s");
                $userid = Yii::$app->user->getId();

                 $checkbos = Yii::$app->db->createCommand("SELECT count(coe_regulation_id) FROM cur_bos WHERE coe_regulation_id=".$_POST['coe_regulation_id']." AND coe_dept_id=".$_POST['coe_dept_id']." AND degree_type='".$_POST['degree_type']."' AND semester='".$semester."'")->queryScalar();
                 //echo $checkbos; exit();
                if($checkbos>0)
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Choosen Regulation Already BOS Uploaded, Please Check BOS View!");
                    return $this->redirect(['bos-upload']);
                }
                else if($file_parts['extension']=='pdf' && $file_parts1['extension']=='pdf' && $bosminsize<=$maxsize && $bosattendsize<=$maxsize)
                {
                    if(move_uploaded_file($_FILES["uploaded_bosminfile"]["tmp_name"], $save_in_folder))
                    {
                        if(move_uploaded_file($_FILES["uploaded_bosattendfile"]["tmp_name"],$save_in_folder1))
                        {                           

                             $insert = Yii::$app->db->createCommand('INSERT into cur_bos(coe_regulation_id,coe_dept_id,degree_type,bos_min_file,bos_attendance_file,created_by,created_at,semester,bos_date) values("'.$_POST['coe_regulation_id'].'","'.$_POST['coe_dept_id'].'","'.$_POST['degree_type'].'","'.$saving_file_name.'","'.$saving_file_name1.'","'.$userid.'","'.$created_at.'","'.$semester.'","'.$bos_date.'") ')->execute();

                            if($insert)
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Success',"Files successfully uploaded");
                                return $this->redirect(['bos-upload']);
                            }
                            else
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Error',"Please Check! Unable to Uploaded Files");
                                return $this->redirect(['bos-upload']);
                            }

                            
                        }
                        
                    }
                    else
                    {
                        //echo echo "Not uploaded because of error #".$_FILES["uploaded_bosattendfile"]["error"]; exit;
                        Yii::$app->ShowFlashMessages->setMsg('Error',"Please Check! Unable to Uploaded File Size in 2MB");
                        return $this->redirect(['bos-upload']);
                    }
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error',"PDF file Only can allowed and Maximum File Size 2 MB");
                        return $this->redirect(['bos-upload']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Please Check! Uploaded Files");
                return $this->redirect(['bos-upload']);
            }
             

        }
        else
        {
            return $this->render('bos_import', [
                'model' => $model,
            ]);
        }
        

    }

    public function actionBosView()
    {
        $model = new CurriculumSubject();

        if(Yii::$app->request->post()) 
        {
            $semester = $_POST['CurriculumSubject']['semester'];
            
            $checkbos = Yii::$app->db->createCommand("SELECT coe_regulation_id FROM cur_bos WHERE coe_regulation_id=".$_POST['coe_regulation_id']." AND coe_dept_id=".$_POST['coe_dept_id']." AND degree_type='".$_POST['degree_type']."' AND semester='".$semester."'")->queryScalar();

            if($checkbos==0)
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Choosen Regulation No BOS Uploaded, Please Check!");
                return $this->redirect(['bos-view']);
            }
            else
            {
                $checkbosdata = Yii::$app->db->createCommand("SELECT * FROM cur_bos WHERE coe_regulation_id=".$_POST['coe_regulation_id']." AND coe_dept_id=".$_POST['coe_dept_id']." AND degree_type='".$_POST['degree_type']."' AND semester='".$semester."'")->queryOne();

                return $this->render('bos_view', [
                'model' => $model,
                'checkbosdata'=>$checkbosdata
                ]);
            }
        }
        else
        {
            return $this->render('bos_view', [
                'model' => $model,
                'checkbosdata'=>''
            ]);
        }
    }

    public function actionAcmUpload()
    {
        $model = new CurriculumSubject();

        if (Yii::$app->request->post()) 
        {
            $deptall = Yii::$app->db->createCommand("SELECT * FROM cur_department WHERE degree_type='".$_POST['degree_type']."'")->queryAll();

            $cdcapprovedcount=0; $notdept='';
            foreach ($deptall as $value) 
            {
                $cdcapproved = Yii::$app->db->createCommand("SELECT count(coe_dept_id) FROM cur_syllabus WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$_POST['coe_regulation_id']." AND degree_type='".$_POST['degree_type']."' AND approve_status=0")->queryScalar();

                if($cdcapproved>0)
                {
                    $cdcapprovedcount++;

                    $notdept.=$value['dept_code'].", ";
                }


            }
            
            //echo count($deptall)."-".$cdcapprovedcount; exit;
            if($cdcapprovedcount!=0)
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Please Check! ".$notdept." Department Not Approved Syllabus");
                return $this->redirect(['acm-upload']);
            }
            else 
            {

                $acm_min_filename = $_POST['uploaded_acmminfile'];
                $file_parts = pathinfo($acm_min_filename);
                $maxsize    = 2097152;
                $uploaded_file = $_FILES["uploaded_acmminfile"]["name"];
                $save_folder = Yii::getAlias('@webroot').'/resources/regulation/';
                $saving_file_name = date('d-m-Y-H-i-s')."-".str_replace(" ", "-", $uploaded_file);
                $save_in_folder = $save_folder.$saving_file_name;   


                $acmminsize=$_FILES['uploaded_acmminfile']['size'];
                
                $acm_date = date("Y-m-d",strtotime($_POST['acm_date']));

                $semester = $_POST['CurriculumSubject']['semester'];

                $created_at = date("Y-m-d H:i:s");
                $userid = Yii::$app->user->getId();

                 $checkbos = Yii::$app->db->createCommand("SELECT count(coe_regulation_id) FROM cur_acm WHERE coe_regulation_id=".$_POST['coe_regulation_id']." AND degree_type='".$_POST['degree_type']."' AND semester='".$semester."' AND acm_date='".$acm_date."'")->queryScalar();
                 //echo $checkbos; exit();
                if($checkbos>0)
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Choosen Regulation Already ACM Uploaded, Please Check!");
                    return $this->redirect(['acm-upload']);
                }
                else if(!empty($acm_min_filename))
                {
                    if($file_parts['extension']=='pdf' && $acmminsize<=$maxsize)
                    {
                        if(move_uploaded_file($_FILES["uploaded_acmminfile"]["tmp_name"], $save_in_folder))
                        {
                                $insert = Yii::$app->db->createCommand('INSERT into cur_acm(coe_regulation_id,degree_type,created_by,created_at,acm_date,semester,acm_min_file) values("'.$_POST['coe_regulation_id'].'","'.$_POST['degree_type'].'","'.$userid.'","'.$created_at.'","'.$acm_date.'","'.$semester.'","'.$saving_file_name.'") ')->execute();

                                if($insert)
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Success',"ACM successfully created");
                                    return $this->redirect(['acm-upload']);
                                }
                                else
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Error',"Please Check! Unable to Create");
                                    return $this->redirect(['acm-upload']);
                                }
                        }
                        else
                        {
                            Yii::$app->ShowFlashMessages->setMsg('Error',"PDF file Not Uploaded Please Check");
                                return $this->redirect(['acm-upload']);
                        }
                    }
                    else
                    {
                        Yii::$app->ShowFlashMessages->setMsg('Error',"PDF file Only can allowed and Maximum File Size 2 MB");
                            return $this->redirect(['acm-upload']);
                    }
                }
                else
                {
                    $insert = Yii::$app->db->createCommand('INSERT into cur_acm(coe_regulation_id, degree_type, created_by, created_at, acm_date, semester) values("'.$_POST['coe_regulation_id'].'","'.$_POST['degree_type'].'","'.$userid.'","'.$created_at.'","'.$acm_date.'","'.$semester.'") ')->execute();

                    if($insert)
                    {
                        Yii::$app->ShowFlashMessages->setMsg('Success',"ACM successfully created");
                        return $this->redirect(['acm-upload']);
                    }
                    else
                    {
                        Yii::$app->ShowFlashMessages->setMsg('Error',"Please Check! Unable to Create");
                        return $this->redirect(['acm-upload']);
                    }
                }
            }
             

        }
        else
        {
            return $this->render('acm_upload', [
                'model' => $model,
            ]);
        }
        

    }


    public function actionAcmView()
    {
        $model = new CurriculumSubject();

        $acmdata = Yii::$app->db->createCommand("SELECT B.regulation_year, A.degree_type, A.semester, A.acm_min_file FROM cur_acm A JOIN coe_regulation B ON B.coe_regulation_id=A.coe_regulation_id GROUP BY A.coe_regulation_id")->queryAll();

        return $this->render('acm_view', [
            'model' => $model,
            'acmdata'=>$acmdata
        ]);
        
    }


    public function actionCurMigrate()
    {
        $model = new SubjectsMapping();
        $subjects = new Subjects();
        $batch_id_value ='';

        if(Yii::$app->request->post()) 
        {
            $batch = $_POST['bat_val'];
            $programme =$_POST['bat_map_val'];
            $semester = $_POST['sem'];           
            
            $getBatchDetails = CoeBatDegReg::find()->where(['coe_batch_id'=>$_POST['bat_val'],'coe_programme_id'=>$_POST['bat_map_val']])->all();

            $subject_code =$_POST['subject_code'];

            $subject_name =$_POST['subject_name'];

            $subject_types =$_POST['course_type']; // subject type

            $category_type =$_POST['category_type']; // course type

            $post_text =$_POST['post_text'];

            //print_r($course_type); exit;
            $missingsubject=''; $successmigrate=0;
            for ($i=0; $i <count($subject_code) ; $i++) 
            { 
                
                $q1= "SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id,A.stream_id, B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code = '".$subject_code[$i]."'";

                $subject_details = Yii::$app->db->createCommand($q1)->queryOne();

                if(empty($subject_details))
                {
                    $q1= "SELECT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id,A.stream_id, B.subject_category_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id WHERE A.subject_code = '".$subject_code[$i]."'";

                    $subject_details = Yii::$app->db->createCommand($q1)->queryOne();

                    if(empty($subject_details))
                    {
                        $q1= "SELECT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id,A.stream_id, B.subject_category_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code =A.subject_code WHERE G.subject_code_new = '".$subject_code[$i]."'";

                        $subject_details = Yii::$app->db->createCommand($q1)->queryOne();

                        if(empty($subject_details))
                        {
                            $q1= "SELECT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id,A.stream_id, B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_electivetodept G ON G.subject_code =A.subject_code WHERE G.subject_code_new = '".$subject_code[$i]."'";

                            $subject_details = Yii::$app->db->createCommand($q1)->queryOne();
                        }
                    }
                }

                //print_r($subject_details); exit();

                if(!empty($subject_details))
                {
                    $rows=Yii::$app->db->createCommand('SELECT subject_code,coe_subjects_id FROM coe_subjects WHERE subject_code="'.$subject_code[$i].'"')->queryOne();

                    $output1 = substr($subject_code[$i], 2,5); //exit;

                    $ciamax=0;
                    if($output1!='MC001')
                    {
                        $ciamax=$subject_details['internal_mark'];
                    }

                    $cia_min=0;
                    $ese_min=$subject_details['external_mark']*0.45;
                  

                    $type=$subject_types[$i]; 

                    $total_minimum=50;
                    $created_at = ConfigUtilities::getCreatedTime();
                    $created_by = ConfigUtilities::getCreatedUser();
                    $updated_at = ConfigUtilities::getCreatedTime();
                    $updated_by = ConfigUtilities::getCreatedUser();
                        
                    if(empty($rows))
                    {
                        $insert = Yii::$app->db->createCommand()->insert('coe_subjects',
                        [
                          
                          'subject_code' =>$subject_details['subject_code'],
                          'subject_name' =>$subject_name[$i],
                          'subject_fee' =>700,
                           'CIA_min' =>$cia_min,
                           'CIA_max' =>$ciamax,
                           'ESE_min' =>$ese_min,
                           'ESE_max' =>$subject_details['external_mark'],
                           'total_minimum_pass' =>$total_minimum,
                           'credit_points' => $subject_details['credit_point'],
                           'part_no' =>$post_text[$i],
                           'end_semester_exam_value_mark' =>'100',
                           'created_by'=>$created_by,
                           'created_at' => $created_at,
                           'updated_by' =>$updated_by,
                           'updated_at' =>$updated_at,
                            ])->execute();
                    }
                    
                    $rows=Yii::$app->db->createCommand('SELECT subject_code,coe_subjects_id FROM coe_subjects WHERE subject_code="'.$subject_code[$i].'"')->queryOne();

                    if(count($rows)>0)
                    {
                        $sub_id=$rows['coe_subjects_id'];
                    }
                 
                    $subject_type=Yii::$app->db->createCommand("SELECT coe_category_type_id FROM coe_category_type WHERE category_type='" . $type. "' ")->queryScalar();

                    $course_type = Yii::$app->db->createCommand("SELECT coe_category_type_id FROM coe_category_type WHERE category_type='" .  $category_type[$i] . "'")->queryScalar();

                    $submapcheck=Yii::$app->db->createCommand('SELECT * FROM coe_subjects_mapping WHERE subject_id="'.$sub_id.'" AND batch_mapping_id='.$programme." AND semester=".$semester)->queryAll();

                    if(empty($submapcheck))
                    {
                        $insert = Yii::$app->db->createCommand()->insert('coe_subjects_mapping',
                            [
                                    
                                    'batch_mapping_id' => $programme ,
                                    'subject_id' =>$sub_id,
                                    'semester' =>$semester,
                                    'paper_type_id' =>$subject_details['subject_type_id'],
                                    'subject_type_id' =>$subject_type,
                                    'course_type_id' =>$course_type,
                                    'type_id' => $subject_details['subject_category_type_id'],
                                    'Migration_status' =>'YES',
                                     'paper_no' =>$post_text[$i],
                                     'created_by'=>$created_by,
                                     'created_at' => $created_at,
                                     'updated_by' =>$updated_by,
                                     'updated_at' =>$updated_at,
                            ])->execute();

                        if($insert)
                        {
                            $successmigrate++;
                        }
                    }
                }
                else
                {
                    $missingsubject.=$subject_code[$i].", ";
                }
            }

            if($successmigrate>0)
            {
                Yii::$app->ShowFlashMessages->setMsg('Success', "Course ".$successmigrate."/".count($subject_code)." Migrate Successfully! Please Check");
                return $this->redirect(['cur-migrate']);
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Not Migrate Successfully! Please Check");
                return $this->redirect(['cur-migrate']);
            }
        }
        else
        {
            Yii::$app->ShowFlashMessages->setMsg('Welcome', 'Welcome to ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Information');
            return $this->render('cur-migrate', [
                'model' => $model, 'subjects' => $subjects,'batch_id_value'=>$batch_id_value
            ]);
        }
       
    }

    public function actionCurmigratedata()
    {

        $batch = Yii::$app->request->post('batch');
        $batchmapid = Yii::$app->request->post('programme');
        $semester = Yii::$app->request->post('sem');
        
        $batch_semname = Yii::$app->db->createCommand("select batch_name from coe_batch where coe_batch_id='" . $batch . "'")->queryScalar();
         
        $reg = Regulation::find()->where(['coe_batch_id'=>$batch])->one();
         
        $coe_programme_id=Yii::$app->db->createCommand("SELECT coe_programme_id FROM coe_bat_deg_reg WHERE coe_bat_deg_reg_id='".$batchmapid."' AND coe_batch_id='".$batch."'")->queryScalar();

        $programme = Yii::$app->db->createCommand("select programme_shortname,B.coe_dept_id, A.coe_programme_id, B.degree_type  from coe_programme  as A  join cur_department as B ON A.programme_shortname=B.dept_code   where coe_programme_id='" . $coe_programme_id . "'")->queryAll();

        $semcolumn='sem'.$semester;
        $semcredit=Yii::$app->db->createCommand("SELECT sum(".$semcolumn.") FROM cur_credit_distribution_sem WHERE coe_regulation_id='".$reg['coe_regulation_id']."' AND coe_dept_id='".$programme[0]['coe_dept_id']."'")->queryScalar();

        $paperno_start=Yii::$app->db->createCommand("SELECT paper_no FROM coe_subjects_mapping WHERE batch_mapping_id='".$batchmapid."' ORDER BY paper_no DESC LIMIT 1")->queryScalar(); //exit;

        if($paperno_start!='' && $paperno_start!=0)
        {
            $paperno_start=$paperno_start+1;
        }
        else
        {
            $paperno_start=1;
        }

        $checkapprove=array(); $electsubject=array(); $checkhonourapprove=array();
        $checkac_approve=array(); $electivepapar=array(); $ac=$honours=array();
        $semsubjectcredit=0;
        $table=$table1='';
        $getelectcountmba =0;
        $getelectcountpg =0;
        if($programme[0]['coe_dept_id']=='26') // mba
        {
            for ($ap=0; $ap <=1; $ap++) 
            { 
               
                
                $curriculumdataset = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id,A.coe_dept_id, SUBSTRING(A.subject_code, 3, 3) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE A.coe_dept_id='".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND semester=".$semester." AND F.stream_name!='MC' AND A.approve_status=".$ap." GROUP BY A.subject_code, A.semester ORDER BY A.subject_type_id")->queryAll();
 

                $checkapprove[] =count($curriculumdataset);

            }

            
            for ($ap=0; $ap <=1; $ap++) 
            { 

               $electivepapar = Yii::$app->db->createCommand("SELECT DISTINCT ES.subject_code, ES.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.stream_name, ES.coe_elective_option FROM cur_elective_nominal A JOIN cur_elective_subject ES ON ES.subject_code=A.subject_code AND ES.coe_regulation_id=A.coe_regulation_id JOIN cur_ltp B ON B.coe_ltp_id=ES.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_aicte_norms F ON F.cur_an_id=ES.stream_id WHERE A.coe_dept_id='26' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND A.semester=".$semester." AND A.coe_elective_option='192' AND A.approve_status=".$ap." ORDER BY A.subject_code ASC")->queryAll();

               $electivestureg = Yii::$app->db->createCommand("SELECT DISTINCT A.register_number FROM cur_elective_nominal A WHERE A.coe_dept_id='26' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND A.semester=".$semester." AND A.coe_elective_option='192' AND A.approve_status=".$ap." ORDER BY A.subject_code LIMIT 1")->queryScalar();

                
                $checkapprove[] =count($curriculumdataset);

                $electsubject[] =count($electivepapar);

                if(count($electivepapar)>0)
                {
                   $getelectcountmba = Yii::$app->db->createCommand("SELECT count(A.subject_code) FROM cur_elective_nominal A  WHERE A.register_number='".$electivestureg."' AND A.coe_dept_id='26' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND A.semester=".$semester." AND A.coe_elective_option='192' AND A.approve_status=1")->queryScalar();
                }
                    
            }

            

            //print_r(count($electivepapar)); exit();

            array_multisort(array_column($curriculumdataset, 'subject_code'),  SORT_ASC, $curriculumdataset);

            $sn = 1; $table =''; $table1 =''; $migrated=0; $semsubjectcredit=0; $semelectivesubjectcredit=0;
            if (count($curriculumdataset) > 0 || count($electivepapar) > 0) 
            {


                require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
                $table = '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" ><tbody align="center">';
                $table .= '
                            <tr>
                                <th colspan=2> 
                                    <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                </th>
                                <th colspan=10 align="center"> 
                                    <center><b><font size="6px">' . $org_name . '</font></b></center>
                                    <center>' . $org_address . '</center>
                                    
                                    <center>' . $org_tagline . '</center> 
                                </th>
                                <th  colspan=2 align="center">  
                                    <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                </th>
                                
                            </tr>
                            <tr>
                            <td colspan=13> <b>'.strtoupper($programme[0]['programme_shortname']).' SEMESTER - '.$semester.'  </b> </td>
                            </tr>';


                $table .= '<tr>
                            <td><b> S.NO </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Code </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Name </b></td>
                            <td><b>Credits</b></td>
                            <td><b> CIA Min </b></td>
                            <td><b> CIA Max </b></td>
                            <td><b> ESE Min </b></td>
                            <td><b> ESE Max </b></td>
                            <td><b> Total Min</b> </td>
                            <td><b> Paper Type</b> </td>
                            <td><b> Course Type </b></td>
                             <td><b> Category </b></td>
                               <td><b> Assessment Type</b></td>
                            <td><b> Paper No</b> </td>
                        </tr>';
                
                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']==1)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            $migrated++;
                        }
                        else
                        {
                            $papernos=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 

                            $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$papernos.' Migrated</td>
                                
                            </tr>';

                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }

                $electivecount=0; $temppaperno=''; $el=0;
                foreach ($electivepapar as $subject1) 
                {   
                    
                    if($subject1['type_order']==1)
                    {

                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Elective";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                        if($el<$getelectcountmba)
                        {
                            $semelectivesubjectcredit=$semelectivesubjectcredit+$subject1['credit_point']; 
                        }

                        $prename='';
                        
                        $prename='PROFESSIONAL ELECTIVE: ';



                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $prename.$subject1['subject_name'] . '">' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             
                             $electivecount++;
                            $migrated++;
                        }
                        else
                        {
                              $papernos=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar();

                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td>  ' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$papernos.'</td>
                                
                            </tr>';
                             
                            
                        }
                        $sn++;
                        
                        $paperno_start++;

                        $el++;
                    }
                }


                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']>2 && $subject1['type_order']<=6)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;
                        $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                        $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' .$subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            $migrated++;
                        }
                        else
                        {

                             $papernos=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar();
                             $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$papernos.'" Migrated </td>
                                
                            </tr>';
                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                        }

                        $sn++;
                        $paperno_start++;
                    }
                }

                 $table .= '</table>';
                if($semelectivesubjectcredit>0 && $semsubjectcredit>0 && $electivecount>0)
                {
                    //echo $semelectivesubjectcredit; exit;
                    //$semelectivesubjectcredit=$semelectivesubjectcredit/$electivecount; 
                    $semsubjectcredit=$semsubjectcredit+$semelectivesubjectcredit;
                }
                
            } 
        }
        else if($programme[0]['degree_type']=='PG') // PG
        {
            for ($ap=0; $ap <=1; $ap++) 
            { 
                
                $curriculumdataset = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id,A.coe_dept_id, SUBSTRING(A.subject_code, 3, 3) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE A.coe_dept_id='".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND semester=".$semester." AND F.stream_name!='MC' AND A.approve_status=".$ap." GROUP BY A.subject_code, A.semester ORDER BY A.subject_type_id")->queryAll();

                $mcqry1="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_elective_register_subject G  ON G.subject_code=A.subject_code JOIN cur_subject_prefix SP ON (SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester." AND F.stream_name='MC' AND G.approve_status=".$ap." GROUP BY A.subject_code, G.semester ORDER BY A.subject_type_id";
                //print_r($mcqry1); exit();
                $servicecoursedeptdata_mc = Yii::$app->db->createCommand($mcqry1)->queryAll();

                if(!empty($servicecoursedeptdata_mc))
                {
                    $curriculumdataset=array_merge($curriculumdataset,$servicecoursedeptdata_mc);
                }

                $acqry1="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_elective_register_subject G  ON G.subject_code=A.subject_code JOIN cur_subject_prefix SP ON (SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester." AND F.stream_name='AC' AND G.approve_status=".$ap." GROUP BY A.subject_code, G.semester ORDER BY A.subject_type_id";
                //print_r($acqry1); exit();
                $servicecoursedeptdata_ac = Yii::$app->db->createCommand($acqry1)->queryAll();

                if(!empty($servicecoursedeptdata_ac))
                {
                    $curriculumdataset=array_merge($curriculumdataset,$servicecoursedeptdata_ac);
                }

                 $ssqry="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id,SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G ON G.coe_cur_subid=A.coe_cur_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_ids = '".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester." AND F.stream_name='FC' AND A.approve_status=".$ap." GROUP BY A.subject_code, G.semester ORDER BY A.subject_type_id";

                $curriculumdataset_sh = Yii::$app->db->createCommand($ssqry)->queryAll();
                
                if(!empty($curriculumdataset_sh))
                {
                    $curriculumdataset=array_merge($curriculumdataset,$curriculumdataset_sh);
                }

                $checkapprove[] =count($curriculumdataset);

            }

            

            for ($ap=0; $ap <=1; $ap++) 
            { 

               $electivepapar = Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.stream_name, E.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code AND E.coe_dept_id=A.coe_dept_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id WHERE E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='192' AND E.approve_status=".$ap." ORDER BY A.subject_type_id")->queryAll();

               $electivepapar_oec = Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.stream_name, E.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id WHERE E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='191' AND E.approve_status=".$ap." ORDER BY A.subject_type_id")->queryAll();

               $electivepapar=array_merge($electivepapar,$electivepapar_oec);

               $electivestureg = Yii::$app->db->createCommand("SELECT DISTINCT A.register_number FROM cur_elective_nominal A WHERE A.coe_dept_id='".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND A.semester=".$semester." AND A.approve_status=".$ap." ORDER BY A.subject_code LIMIT 1")->queryScalar();

                
                $checkapprove[] =count($curriculumdataset);

                $electsubject[] =count($electivepapar);

                if(count($electivepapar)>0)
                {
                   $getelectcountpg = Yii::$app->db->createCommand("SELECT count(A.subject_code) FROM cur_elective_nominal A  WHERE A.register_number='".$electivestureg."' AND A.coe_dept_id='".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND A.semester=".$semester." AND A.approve_status=1")->queryScalar();
                }
                    
            }


            //print_r($electivepapar_oec); exit();

            array_multisort(array_column($curriculumdataset, 'subject_code'),  SORT_ASC, $curriculumdataset);

            $sn = 1; $table =''; $table1 =''; $migrated=0; $semsubjectcredit=0; $semelectivesubjectcredit=0;
            if (count($curriculumdataset) > 0 || count($electivepapar) > 0) 
            {


                require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
                $table = '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" ><tbody align="center">';
                $table .= '
                            <tr>
                                <th colspan=2> 
                                    <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                </th>
                                <th colspan=10 align="center"> 
                                    <center><b><font size="6px">' . $org_name . '</font></b></center>
                                    <center>' . $org_address . '</center>
                                    
                                    <center>' . $org_tagline . '</center> 
                                </th>
                                <th  colspan=2 align="center">  
                                    <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                </th>
                                
                            </tr>
                            <tr>
                            <td colspan=13> <b>'.strtoupper($programme[0]['programme_shortname']).' SEMESTER - '.$semester.'  </b> </td>
                            </tr>';


                $table .= '<tr>
                            <td><b> S.NO </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Code </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Name </b></td>
                            <td><b>Credits</b></td>
                            <td><b> CIA Min </b></td>
                            <td><b> CIA Max </b></td>
                            <td><b> ESE Min </b></td>
                            <td><b> ESE Max </b></td>
                            <td><b> Total Min</b> </td>
                            <td><b> Paper Type</b> </td>
                            <td><b> Course Type </b></td>
                             <td><b> Category </b></td>
                               <td><b> Assessment Type</b></td>
                            <td><b> Paper No</b> </td>
                        </tr>';
                
                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']==1)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            $migrated++;
                        }
                        else
                        {
                            $papernos=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 

                            $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$papernos.' Migrated</td>
                                
                            </tr>';

                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }

                 $electivecount=0; $temppaperno='';
                foreach ($electivepapar as $subject1) 
                {   
                    
                    if($subject1['type_order']==1)
                    {

                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Elective";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            if($temppaperno!=$subject1['elective_paper'] && $electivecount!=0)
                            {
                                $paperno_start=$paperno_start+1;                            
                            }
                            else
                            {
                                $paperno_start=$paperno_start;
                            }
                            
                        }

                        if($temppaperno!=$subject1['elective_paper'])
                        {
                            $semelectivesubjectcredit=$semelectivesubjectcredit+$subject1['credit_point'];
                        }

                        $prename='';
                        if($subject1['coe_elective_option']==192)
                        {
                            $prename='PROFESSIONAL ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==191)
                        {
                            $prename='OPEN ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==193)
                        {
                            $prename='EMERGING ELECTIVE: ';
                        }


                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $prename.$subject1['subject_name'] . '">' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             
                             $electivecount++;
                            $migrated++;
                        }
                        else
                        {
                             
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td>  ' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';
                             
                            
                        }
                        $sn++;
                       $temppaperno=$subject1['elective_paper'];
                    }
                }

                foreach ($electivepapar as $subject1) 
                {   
                    
                    if($subject1['type_order']==2)
                    {

                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Elective";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            if($temppaperno!=$subject1['elective_paper'] && $electivecount!=0)
                            {
                                $paperno_start=$paperno_start+1;                            
                            }
                            else
                            {
                                $paperno_start=$paperno_start;
                            }
                            
                        }

                        if($temppaperno!=$subject1['elective_paper'])
                        {
                            $semelectivesubjectcredit=$semelectivesubjectcredit+$subject1['credit_point'];
                        }

                        $prename='';
                        if($subject1['coe_elective_option']==192)
                        {
                            $prename='PROFESSIONAL ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==191)
                        {
                            $prename='OPEN ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==193)
                        {
                            $prename='EMERGING ELECTIVE: ';
                        }


                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $prename.$subject1['subject_name'] . '">' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             
                             $electivecount++;
                            $migrated++;
                        }
                        else
                        {
                             
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td>  ' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';
                             
                            
                        }
                        $sn++;
                       $temppaperno=$subject1['elective_paper'];
                    }
                }
                //echo $semelectivesubjectcredit; exit;
                $temppaperno='';
                foreach ($electivepapar as $subject1) 
                {   
                    
                    if($subject1['type_order']==5)
                    {

                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Elective";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            if($temppaperno!=$subject1['elective_paper'])
                            {
                                $paperno_start=$paperno_start+1;                            
                            }
                            else
                            {
                                $paperno_start=$paperno_start;
                            }
                            
                        }

                        if($temppaperno!=$subject1['elective_paper'])
                        {
                            $semelectivesubjectcredit=$semelectivesubjectcredit+$subject1['credit_point'];
                        }

                        $prename='';
                        if($subject1['coe_elective_option']==192)
                        {
                            $prename='PROFESSIONAL ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==191)
                        {
                            $prename='OPEN ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==193)
                        {
                            $prename='EMERGING ELECTIVE: ';
                        }


                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $prename.$subject1['subject_name'] . '">' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             
                             $electivecount++;
                            $migrated++;
                        }
                        else
                        {
                            $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td>  ' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                       $temppaperno=$subject1['elective_paper'];
                    }
                }

                if(count($electivepapar)>0)
                {
                    $paperno_start++;
                }


                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']>2 && $subject1['type_order']<6)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;
                        $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                        $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' .$subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            $migrated++;
                        }
                        else
                        {
                             $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';
                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                        }

                        $sn++;
                        $paperno_start++;
                    }
                }

                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']>=6 && $subject1['type_order']<=7)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;                      

                        $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                        $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                        $total_minimum=($subject1['internal_mark']>0)?$total_minimum:0;

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value=" MANDATORY COURSE: ' .$subject1['subject_name'] . '"> MANDATORY COURSE: ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';

                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                             $migrated++;
                        }
                        else
                        {
                             $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                        }

                        $sn++;
                        $paperno_start++;
                    }

                    if($subject1['type_order']==8)
                    {
                        $cia_min=0;
                        $ese_min=0;
                        $type="Common";

                        $total_minimum=0;                      

                        $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                        $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND batch_mapping_id='.$batchmapid)->queryScalar();

                        $total_minimum=($subject1['internal_mark']>0)?$total_minimum:0;

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value=" AUDIT COURSE: ' .$subject1['subject_name'] . '"> AUDIT COURSE: ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';

                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                             $migrated++;
                        }
                        else
                        {
                             $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                        }

                        $sn++;
                        $paperno_start++;
                    }
                }

                 $table .= '</table>';
                if($semelectivesubjectcredit>0 && $semsubjectcredit>0)
                {
                    //echo $semelectivesubjectcredit; exit;
                    //$semelectivesubjectcredit=$semelectivesubjectcredit/$electivecount; 
                    $semsubjectcredit=$semsubjectcredit+$semelectivesubjectcredit;
                }
                
            } 
        }
        else if($programme[0]['degree_type']=='UG')
        {
            for ($ap=0; $ap <=1; $ap++) 
            { 
               
                $ssqry="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id,SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G ON G.coe_cur_subid=A.coe_cur_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_ids = '".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester." AND F.stream_name!='MC' AND A.approve_status=".$ap." GROUP BY A.subject_code, G.semester ORDER BY A.subject_type_id";

                $curriculumdataset = Yii::$app->db->createCommand($ssqry)->queryAll();
              
                $coreservice_fromotherdept= Yii::$app->db->createCommand("SELECT A.coe_elective_id as coe_cur_id, G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE G.coe_dept_ids = '".$programme[0]['coe_dept_id']."' AND B.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester." AND G.coe_elective_option IN (200,202,225) AND A.approve_status=".$ap." GROUP BY G.subject_code,G.semester ORDER BY A.subject_type_id")->queryAll();

                if(!empty($coreservice_fromotherdept)) //service from other dept1
                {
                    $curriculumdataset=array_merge($curriculumdataset,$coreservice_fromotherdept); 
                }
                

                $coreservice_fromotherdept1= Yii::$app->db->createCommand("SELECT A.coe_elective_id as coe_cur_id, G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE G.coe_dept_ids = '".$programme[0]['coe_dept_id']."' AND B.coe_regulation_id=".$reg['coe_regulation_id']." AND A.degree_type='MBA' AND G.semester=".$semester." AND G.coe_elective_option IN (216) AND A.approve_status=".$ap." GROUP BY G.subject_code,G.semester ORDER BY A.subject_type_id")->queryAll();

                if(!empty($coreservice_fromotherdept1)) //service from other dept2
                {
                    $curriculumdataset=array_merge($curriculumdataset,$coreservice_fromotherdept1);

                }

                
                $curriculumsemdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id,A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE A.coe_dept_id='".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND semester=".$semester." AND F.stream_name!='MC' AND A.approve_status=".$ap." GROUP BY A.subject_code, A.semester ORDER BY A.subject_type_id")->queryAll();

                if(!empty($curriculumsemdata)) //core subject
                {

                    $curriculumdataset=array_merge($curriculumdataset,$curriculumsemdata);
                }  

                $corefromotherdeptdata = Yii::$app->db->createCommand("SELECT A.coe_cur_id,G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_cur_id AND G.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) WHERE G.coe_dept_ids = '".$programme[0]['coe_dept_id']."' AND B.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester."  AND A.approve_status=".$ap." GROUP BY G.subject_code,G.semester ORDER BY A.subject_type_id")->queryAll();

                if(!empty($corefromotherdeptdata))
                {
                    $curriculumdataset=array_merge($curriculumdataset,$corefromotherdeptdata);
                }

                $mcqry1="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id,SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_servicesubtodept G  ON G.coe_cur_subid=A.coe_cur_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_ids = '".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester." AND F.stream_name='MC' AND A.approve_status=".$ap." GROUP BY A.subject_code, G.semester ORDER BY A.subject_type_id";

                $servicecoursedeptdata_mc = Yii::$app->db->createCommand($mcqry1)->queryAll();

                if(empty($servicecoursedeptdata_mc))
                {
                    $mcqry1="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id JOIN cur_elective_register_subject G  ON G.subject_code=A.subject_code JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) WHERE G.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND G.semester=".$semester." AND F.stream_name='MC' AND G.approve_status=".$ap." GROUP BY A.subject_code, G.semester ORDER BY A.subject_type_id";

                    $servicecoursedeptdata_mc = Yii::$app->db->createCommand($mcqry1)->queryAll();
                }
                //print_r($servicecoursedeptdata_mc); exit;
                if(!empty($servicecoursedeptdata_mc))
                {
                    $curriculumdataset=array_merge($curriculumdataset,$servicecoursedeptdata_mc);
                } 

                $electivepapar=array();

                $pecdata = Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.stream_name, E.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code AND E.coe_dept_id=A.coe_dept_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id WHERE E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='192' AND E.approve_status=".$ap." ORDER BY E.elective_paper")->queryAll();

                //print_r(expression)

                $pecdata1 = Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.description as stream_name, G.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_electivetodept G on G.subject_code_new=E.subject_code AND G.coe_dept_ids=".$programme[0]['coe_dept_id']." JOIN coe_category_type F ON F.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids='".$programme[0]['coe_dept_id']."' AND E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='192' AND E.approve_status=".$ap." ORDER BY E.elective_paper")->queryAll();

                if(!empty($pecdata1))
                {
                    $pecdata=array_merge($pecdata,$pecdata1);
                }

                $pecdata2 = Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.description as stream_name, G.coe_elective_option, E.elective_paper FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_electivetodept G on G.subject_code_new=E.subject_code AND G.coe_dept_ids=".$programme[0]['coe_dept_id']." JOIN coe_category_type F ON F.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids='".$programme[0]['coe_dept_id']."' AND E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='192' AND E.approve_status=".$ap." ORDER BY E.elective_paper")->queryAll();

                if(!empty($pecdata2))
                {
                    $pecdata=array_merge($pecdata,$pecdata2);
                }

                if(!empty($pecdata))
                {
                    $electivepapar=array_merge($electivepapar,$pecdata);
                }

                $oecdata = Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.stream_name, E.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='191' AND E.approve_status=".$ap." ORDER BY  E.elective_paper")->queryAll();

                $oecdata1 = Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code, A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.description as stream_name, G.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name)  JOIN cur_electivetodept G on G.subject_code=A.subject_code JOIN cur_elective_stu_subject E ON E.subject_code=G.subject_code_new JOIN coe_category_type F ON F.coe_category_type_id=G.coe_elective_option WHERE E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='191' AND G.coe_elective_option='191' AND E.approve_status=".$ap." ORDER BY E.elective_paper")->queryAll();
                  //print_r($oecdata1); exit;
                if(!empty($oecdata1))
                {
                    $oecdata=array_merge($oecdata,$oecdata1);
                }

                $oecdata11 = Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code, A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.description as stream_name, A.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code JOIN coe_category_type F ON F.coe_category_type_id=A.coe_elective_option WHERE E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='191' AND A.coe_elective_option='191' AND E.approve_status=".$ap." ORDER BY E.elective_paper")->queryAll();
                  //print_r($oecdata11); exit;
                if(!empty($oecdata11))
                {
                    $oecdata=array_merge($oecdata,$oecdata11);
                }

                $oecdata2 = Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.description as stream_name, G.coe_elective_option, E.elective_paper FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_electivetodept G on G.subject_code=A.subject_code JOIN cur_elective_stu_subject E ON E.subject_code=G.subject_code_new JOIN coe_category_type F ON F.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids='".$programme[0]['coe_dept_id']."' AND E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='191' AND E.approve_status=".$ap." ORDER BY E.elective_paper")->queryAll();

                if(!empty($oecdata2))
                {
                    $oecdata=array_merge($oecdata,$oecdata2);
                }

                if(!empty($oecdata))
                {
                    $electivepapar=array_merge($electivepapar,$oecdata);
                }

                $qryeec="SELECT DISTINCT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.stream_name, E.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code AND E.coe_dept_id=A.coe_dept_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id WHERE E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='193' AND E.approve_status=".$ap." GROUP BY A.subject_code ORDER BY E.elective_paper";

                $eecdata = Yii::$app->db->createCommand($qryeec)->queryAll();

                $ecc_qry="SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.description as stream_name, G.coe_elective_option, E.elective_paper FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_electivetodept G on G.subject_code_new=E.subject_code JOIN coe_category_type F ON F.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids='".$programme[0]['coe_dept_id']."' AND E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='193' AND E.approve_status=".$ap." GROUP BY G.subject_code ORDER BY E.elective_paper";

                $eecdata1 = Yii::$app->db->createCommand($ecc_qry)->queryAll();

                if(!empty($eecdata1))
                {
                    $eecdata=array_merge($eecdata,$eecdata1);
                }

                $eecdata2 = Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code, A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, B.subject_type_id, SP.subject_order, C.type_order,B.subject_category_type_id, F.description as stream_name, G.coe_elective_option, E.elective_paper FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_elective_stu_subject E ON E.subject_code=A.subject_code JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name OR SUBSTRING(A.subject_code, 3, 3)=SP.prefix_name) JOIN cur_electivetodept G on G.subject_code_new=E.subject_code JOIN coe_category_type F ON F.coe_category_type_id=G.coe_elective_option WHERE G.coe_dept_ids='".$programme[0]['coe_dept_id']."' AND E.coe_dept_id='".$programme[0]['coe_dept_id']."' AND E.coe_regulation_id=".$reg['coe_regulation_id']." AND E.semester=".$semester." AND E.coe_elective_option='193' AND E.approve_status=".$ap." GROUP BY G.subject_code_new ORDER BY E.elective_paper")->queryAll();

                if(!empty($eecdata2))
                {
                    $eecdata=array_merge($eecdata,$eecdata2);
                }

                if(!empty($eecdata))
                {
                    $electivepapar=array_merge($electivepapar,$eecdata);
                }

                $checkapprove[] =count($curriculumdataset);

                $electsubject[] =count($electivepapar);
            }
            //print_r(count($eecdata)); exit();
            //print_r($electivepapar); exit();

            
            $ipqry1="SELECT A.coe_cur_id,A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, C.type_order as subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=B.subject_category_type_id JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id AND F.coe_regulation_id=A.coe_regulation_id WHERE (SUBSTRING(A.subject_code, 3, 2)='IP') AND A.coe_dept_id=0 AND A.coe_dept_ids like '%".$programme[0]['coe_dept_id']."%' AND A.coe_regulation_id=".$reg['coe_regulation_id']." AND A.semester=".$semester." AND F.stream_name='PWC' AND A.approve_status=1 GROUP BY A.subject_code, A.semester ORDER BY A.subject_type_id";

            $servicecoursedeptdata_ip = Yii::$app->db->createCommand($ipqry1)->queryAll();

            if(!empty($servicecoursedeptdata_ip))
            {
                $curriculumdataset=array_merge($curriculumdataset,$servicecoursedeptdata_ip);
            }

            array_multisort(array_column($curriculumdataset, 'subject_order'),  SORT_ASC, $curriculumdataset);

             
            for ($ap=0; $ap <=1; $ap++) 
            {
                $honours= Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id, H.honours_type FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_honours_subject_list H ON H.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=A.coe_elective_option WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.honours_type IN (230,231,232) AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_code")->queryAll();

                $honours1= Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id, H.honours_type FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_honours_subject_list H ON H.subject_code=G.subject_code_new  AND G.coe_dept_ids=H.coe_dept_id  WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.honours_type IN (230,231,232) AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_code")->queryAll();

                $honours2= Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id, H.honours_type FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G ON G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_honours_subject_list H ON H.subject_code=G.subject_code_new  AND G.coe_dept_ids=H.coe_dept_id  WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.honours_type IN (230,231,232) AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_code")->queryAll();

                if(!empty($honours1))
                {
                    //$honours=array_merge($honours,$honours1);
                }

                if(!empty($honours2))
                {
                    $honours=array_merge($honours,$honours2);
                }

                $honours1 = array_unique($honours);

                $checkhonourapprove[] =count($honours);

            }
            //print_r($honours1); exit();
            
            for ($ap=0; $ap <=1; $ap++) 
            {
                
                $ac= Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_additional_course_rejoin_list H ON H.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=A.coe_elective_option WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_type_id")->queryAll();

                $ac1= Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G  ON G.coe_subject_id=A.coe_elective_id AND G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_additional_course_rejoin_list H ON H.subject_code=G.subject_code_new WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_type_id")->queryAll();

                $ac2= Yii::$app->db->createCommand("SELECT DISTINCT G.subject_code_new as subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype,D.category_type as stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_electivetodept G ON G.coe_regulation_id=A.coe_regulation_id AND G.subject_code=A.subject_code JOIN coe_category_type D ON D.coe_category_type_id=G.coe_elective_option JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_additional_course_rejoin_list H ON H.subject_code=G.subject_code_new WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_type_id")->queryAll();

                if(!empty($ac1))
                {
                    $ac=array_merge($ac,$ac1);
                }

                if(!empty($ac2))
                {
                    $ac=array_merge($ac,$ac2);
                }

                $ac3= Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, G.coe_dept_ids as coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, SP.subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN cur_servicesubtodept G ON G.coe_regulation_id=A.coe_regulation_id AND G.coe_cur_subid=A.coe_cur_id JOIN coe_category_type D ON D.coe_category_type_id=A.subject_category_type_id JOIN cur_subject_prefix SP ON SP.coe_dept_id=A.coe_dept_id AND (SUBSTRING(A.subject_code, 3, 2)=SP.prefix_name) JOIN cur_additional_course_rejoin_list H ON H.subject_code=A.subject_code JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_type_id")->queryAll();

                if(!empty($ac3))
                {
                    $ac=array_merge($ac,$ac3);
                }

                $ac4= Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code,A.subject_name,concat(B.L,'-',B.T,'-',B.P) as LTP,B.contact_hrsperweek,B.credit_point,B.internal_mark,B.external_mark,concat(B.internal_mark,'/',B.external_mark) as intext_mark,C.category_type as subjecttype, D.category_type as subjectctype, F.stream_name,B.subject_type_id,A.stream_id, A.coe_dept_id, SUBSTRING(A.subject_code, 3, 2) AS prefix, C.type_order as subject_order, C.type_order,B.subject_category_type_id FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id AND B.coe_regulation_id=A.coe_regulation_id JOIN coe_category_type C ON C.coe_category_type_id=B.subject_type_id JOIN coe_category_type D ON D.coe_category_type_id=A.subject_category_type_id JOIN cur_additional_course_rejoin_list H ON H.subject_code=A.subject_code JOIN cur_aicte_norms F ON F.cur_an_id=A.stream_id WHERE H.coe_dept_id = '".$programme[0]['coe_dept_id']."' AND H.coe_regulation_id=".$reg['coe_regulation_id']." AND H.semester=".$semester." AND H.approve_status=".$ap." GROUP BY H.subject_code,H.semester ORDER BY A.subject_type_id")->queryAll();

                if(!empty($ac4))
                {
                    $ac=array_merge($ac,$ac4);
                }

                $checkac_approve[] =count($ac);

            }
            //print_r($ac); exit();
           // print_r($ac4); exit();

             $sn = 1; $table =''; $table1 =''; $migrated=0; $semsubjectcredit=0; $semelectivesubjectcredit=0;
            if (count($curriculumdataset) > 0) 
            {


                require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
                $table = '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" ><tbody align="center">';
                $table .= '
                            <tr>
                                <th colspan=2> 
                                    <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                                </th>
                                <th colspan=10 align="center"> 
                                    <center><b><font size="6px">' . $org_name . '</font></b></center>
                                    <center>' . $org_address . '</center>
                                    
                                    <center>' . $org_tagline . '</center> 
                                </th>
                                <th  colspan=2 align="center">  
                                    <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                                </th>
                                
                            </tr>
                            <tr>
                            <td colspan=13> <b>'.strtoupper($programme[0]['programme_shortname']).' SEMESTER - '.$semester.'  </b> </td>
                            </tr>';


                $table .= '<tr>
                            <td><b> S.NO </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Code </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Name </b></td>
                            <td><b>Credits</b></td>
                            <td><b> CIA Min </b></td>
                            <td><b> CIA Max </b></td>
                            <td><b> ESE Min </b></td>
                            <td><b> ESE Max </b></td>
                            <td><b> Total Min</b> </td>
                            <td><b> Paper Type</b> </td>
                            <td><b> Course Type </b></td>
                             <td><b> Category </b></td>
                               <td><b> Assessment Type</b></td>
                            <td><b> Paper No</b> </td>
                        </tr>';
                
                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']==1)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            $migrated++;
                        }
                        else
                        {
                            $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 

                            $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.' Migrated</td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }

                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']==2)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;
                        $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                             $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                        }

                        $sn++;
                        $paperno_start++;
                    }
                }

                $electivecount=0; $temppaperno='';
                foreach ($electivepapar as $subject1) 
                {   
                    
                    if($subject1['type_order']==1)
                    {

                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Elective";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            if($temppaperno!=$subject1['elective_paper'] && $electivecount!=0)
                            {
                                $paperno_start=$paperno_start+1;                            
                            }
                            else
                            {
                                $paperno_start=$paperno_start;
                            }
                            
                        }

                        if($temppaperno!=$subject1['elective_paper'])
                        {
                            $semelectivesubjectcredit=$semelectivesubjectcredit+$subject1['credit_point'];
                        }

                        $prename='';
                        if($subject1['coe_elective_option']==192)
                        {
                            $prename='PROFESSIONAL ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==191)
                        {
                            $prename='OPEN ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==193)
                        {
                            $prename='EMERGING ELECTIVE: ';
                        }


                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $prename.$subject1['subject_name'] . '">' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             
                             $electivecount++;
                            $migrated++;
                        }
                        else
                        {
                              $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td>  ' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';
                             
                            
                        }
                        $sn++;
                       $temppaperno=$subject1['elective_paper'];
                    }
                }

                foreach ($electivepapar as $subject1) 
                {   
                    
                    if($subject1['type_order']==2)
                    {

                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Elective";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            if($temppaperno!=$subject1['elective_paper'] && $electivecount!=0)
                            {
                                $paperno_start=$paperno_start+1;                            
                            }
                            else
                            {
                                $paperno_start=$paperno_start;
                            }
                            
                        }

                        if($temppaperno!=$subject1['elective_paper'])
                        {
                            $semelectivesubjectcredit=$semelectivesubjectcredit+$subject1['credit_point'];
                        }

                        $prename='';
                        if($subject1['coe_elective_option']==192)
                        {
                            $prename='PROFESSIONAL ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==191)
                        {
                            $prename='OPEN ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==193)
                        {
                            $prename='EMERGING ELECTIVE: ';
                        }


                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $prename.$subject1['subject_name'] . '">' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             
                             $electivecount++;
                            $migrated++;
                        }
                        else
                        {
                              $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td>  ' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';
                             
                            
                        }
                        $sn++;
                       $temppaperno=$subject1['elective_paper'];
                    }
                }
                //echo $semelectivesubjectcredit; exit;
                $temppaperno='';
                foreach ($electivepapar as $subject1) 
                {   
                    
                    if($subject1['type_order']==5)
                    {

                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Elective";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            if($temppaperno!=$subject1['elective_paper'])
                            {
                                $paperno_start=$paperno_start+1;                            
                            }
                            else
                            {
                                $paperno_start=$paperno_start;
                            }
                            
                        }

                        if($temppaperno!=$subject1['elective_paper'])
                        {
                            $semelectivesubjectcredit=$semelectivesubjectcredit+$subject1['credit_point'];
                        }

                        $prename='';
                        if($subject1['coe_elective_option']==192)
                        {
                            $prename='PROFESSIONAL ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==191)
                        {
                            $prename='OPEN ELECTIVE: ';
                        }
                        else if($subject1['coe_elective_option']==193)
                        {
                            $prename='EMERGING ELECTIVE: ';
                        }


                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td>  <input type="hidden" name="subject_name[]" value="' . $prename.$subject1['subject_name'] . '">' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             
                             $electivecount++;
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                            $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td>  ' . $prename.$subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                       $temppaperno=$subject1['elective_paper'];
                    }
                }

                if(count($electivepapar)>0)
                {
                    $paperno_start++;
                }

                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']>2 && $subject1['type_order']<6)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;
                        $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                        $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' .$subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                             $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                        }

                        $sn++;
                        $paperno_start++;
                    }
                }

                foreach ($curriculumdataset as $subject1) 
                {
                    if($subject1['type_order']>=6 && $subject1['type_order']<=7)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Common";

                        $total_minimum=50;

                        $output1 = substr($subject1['subject_code'], 2,5); //exit;

                        if($output1=='MC001')
                        {
                            $total_minimum=0;
                        }

                        $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                        $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                        $total_minimum=($subject1['internal_mark']>0)?$total_minimum:0;

                        if($migratecheck==0)
                        {
                           $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>';

                            if($subject1['subject_type_id']==106)
                            {
                                $table .= '<td> <input type="hidden" name="subject_name[]" value=" MANDATORY COURSE: ' .$subject1['subject_name'] . '"> MANDATORY COURSE: ' . $subject1['subject_name'] . ' </td>';
                            }
                            else
                            {
                                $table .= '<td> <input type="hidden" name="subject_name[]" value="'.$subject1['subject_name'].'">'.$subject1['subject_name'].' </td>';
                            }


                            $table .= '<td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';

                             $semsubjectcredit=$semsubjectcredit+$subject1['credit_point'];
                             $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                             $table .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';
                        }

                        $sn++;
                        $paperno_start++;
                    }
                }

                $table .= '</table>';
                
            } 

            if (count($honours) > 0) 
            {
                //$paperno_start=1;

                 $table1.= '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" ><tbody align="center">';
                 $table1.= '<tr><td colspan=14><b> Additional Course Honours / Minors </b></td></tr>';
                  $table1.= '<tr>
                            <td><b> S.NO </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Code </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Name </b></td>
                            <td><b>Credits</b></td>
                            <td><b> CIA Min </b></td>
                            <td><b> CIA Max </b></td>
                            <td><b> ESE Min </b></td>
                            <td><b> ESE Max </b></td>
                            <td><b> Total Min</b> </td>
                            <td><b> Paper Type</b> </td>
                            <td><b> Course Type </b></td>
                             <td><b> Category </b></td>
                               <td><b> Assessment Type </b></td>
                            <td><b> Paper No</b> </td>
                        </tr>';

                foreach ($honours as $subject1) 
                {
                    if($subject1['type_order']==1)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Additional Course";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $honours_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id='" .  $subject1['honours_type'] . "'")->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $honours_type . '"> ' . $honours_type. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                             $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td>  ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $honours_type. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }

                foreach ($honours as $subject1) 
                {
                    if($subject1['type_order']==2)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Additional Course";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $honours_type = Yii::$app->db->createCommand("SELECT category_type FROM coe_category_type WHERE coe_category_type_id='" .  $subject1['honours_type'] . "'")->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $honours_type . '"> ' . $honours_type. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                             $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td> ' . $honours_type. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td>'.$paperno_start.'</td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }


                $table1.= '</table>';
                $checkhonourapprove=$checkhonourapprove[0];
            }

            if (count($ac) > 0) 
            {
                //$paperno_start=1;

                 $table1.= '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" ><tbody align="center">';
                 $table1.= '<tr><td colspan=14><b> Additional Course Rejoin </b></td></tr>';
                  $table1.= '<tr>
                            <td><b> S.NO </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Code </b></td>
                            <td><b> ' . ConfigUtilities::getConfigValue(ConfigConstants::CONFIG_SUBJECT) . ' Name </b></td>
                            <td><b>Credits</b></td>
                            <td><b> CIA Min </b></td>
                            <td><b> CIA Max </b></td>
                            <td><b> ESE Min </b></td>
                            <td><b> ESE Max </b></td>
                            <td><b> Total Min</b> </td>
                            <td><b> Paper Type</b> </td>
                            <td><b> Course Type </b></td>
                             <td><b> Category </b></td>
                               <td><b> Assessment Type </b></td>
                            <td><b> Paper No</b> </td>
                        </tr>';

                foreach ($ac as $subject1) 
                {
                    if($subject1['type_order']==1)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Additional Course";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND B.semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();
                      
                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 
                             $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }

                foreach ($ac as $subject1) 
                {
                    if($subject1['type_order']==2)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Additional Course";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND B.semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 

                             $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }

                foreach ($ac as $subject1) 
                {
                    if($subject1['type_order']==3)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Additional Course";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND B.semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 

                             $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }


                foreach ($ac as $subject1) 
                {
                    if($subject1['type_order']==7)
                    {
                        $cia_min=0;
                        $ese_min=$subject1['external_mark']*0.45;
                        $type="Additional Course";

                        $total_minimum=50;
                         $subject_type_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_type_id'] . "'")->queryScalar();

                        $subject_ctype_name = Yii::$app->db->createCommand("select description from coe_category_type where coe_category_type_id='" .  $subject1['subject_category_type_id'] . "'")->queryScalar();

                       $migratecheck=Yii::$app->db->createCommand('SELECT count(A.coe_subjects_id) FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code="'. $subject1['subject_code'].'" AND B.semester='.$semester.' AND batch_mapping_id='.$batchmapid)->queryScalar();

                       $paperno_start1=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid)->queryScalar(); //exit;

                        if($paperno_start1!='' && $paperno_start1==0)
                        {
                            $paperno_start=1;
                        }
                        else 
                        {
                            $paperno_start=$paperno_start;
                        }

                        if($migratecheck==0)
                        {
                           $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> <input type="hidden" name="subject_code[]" value="' . $subject1['subject_code'] . '"> ' . $subject1['subject_code'] . ' </td>
                                <td> <input type="hidden" name="subject_name[]" value="' . $subject1['subject_name'] . '">' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> <input type="hidden" name="course_type[]" value="' . $type . '">'.$type.' </td>
                                   <td> <input type="hidden" name="category_type[]" value="' . $subject1['stream_name'] . '"> ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> <input type="text" name="post_text[]" id="post_text" value="'.$paperno_start.'"> </td>
                                
                            </tr>';
                            
                            $migrated++;
                        }
                        else
                        {
                             $paperno_start=Yii::$app->db->createCommand("SELECT B.paper_no FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE A.subject_code='". $subject1['subject_code']."' AND batch_mapping_id=".$batchmapid." AND B.semester=".$semester)->queryScalar(); 

                             $table1 .= '
                            <tr>
                                <td> ' . $sn . ' </td>
                                <td> ' . $subject1['subject_code'] . ' </td>
                                <td> ' . $subject1['subject_name'] . ' </td>
                                <td> ' . $subject1['credit_point'] . ' </td>
                                <td> ' . $cia_min. ' </td>
                                <td> ' . $subject1['internal_mark'] . ' </td>
                                <td> ' . $ese_min. ' </td>
                                <td> ' . $subject1['external_mark']. ' </td>
                                <td> ' . $total_minimum. ' </td>
                                 <td> ' . $subject_type_name. ' </td>
                                  <td> '.$type.' </td>
                                   <td>  ' . $subject1['stream_name']. '  </td>
                                 <td> ' . $subject_ctype_name. ' </td>
                                  <td> "'.$paperno_start.'" Migrated </td>
                                
                            </tr>';

                            
                        }
                        $sn++;
                        $paperno_start++;
                    }
                }

                $table1.= '</table>';
            }

            if($semelectivesubjectcredit>0 || $semsubjectcredit>0 || $electivecount>0)
            {
                //echo $semelectivesubjectcredit; exit;
                //$semelectivesubjectcredit=$semelectivesubjectcredit/$electivecount; 
                $semsubjectcredit=$semsubjectcredit+$semelectivesubjectcredit;
            }
            else
            {
               
                $semsubjectcredit2=Yii::$app->db->createCommand("SELECT DISTINCT paper_no, credit_points FROM coe_subjects A JOIN coe_subjects_mapping B ON B.subject_id=A.coe_subjects_id WHERE batch_mapping_id=".$batchmapid." AND B.semester=".$semester." AND B.subject_type_id!=233")->queryAll(); 

                //print_r(array_sum(array_column($semsubjectcredit2,'credit_points'))); exit;

                $semsubjectcredit=array_sum(array_column($semsubjectcredit2,'credit_points'));
            }
        }
        

        if($semsubjectcredit>0)
        {

            $table.= '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" ><tbody align="center">';
            $table .= '
                        <tr>
                            <td colspan=3> Total Credit: ' . $semsubjectcredit . ' </td>
                            
                        </tr>';

            $table.= '</table>';
        }
       

        $html=$table.$table1;
        $dataset[]=array('semelectivesubjectcredit'=>$semelectivesubjectcredit,'checkhonourapprove'=>$checkhonourapprove,'semsubjectcredit'=>$semsubjectcredit,'semcredit'=>$semcredit,'checkapprovezero'=>$checkapprove[0],'migratedcount'=>$migrated,'migratedata'=>$html);
        
        return Json::encode($dataset);
        
        //print_r($curriculumsemdata);exit;
    }

    public function actionCdcNominalMigrate()
    {
        $model = new SubjectsMapping();
        $subjects = new Subjects();
        $batch_id_value ='';

        if(Yii::$app->request->post()) 
        {
            $batch = $_POST['bat_val'];
            $batchmapid =$_POST['bat_map_val']; 
            $semester = $_POST['sem'];

            $checksubjectmigrate = Yii::$app->db->createCommand("SELECT count(subject_id) FROM coe_subjects_mapping WHERE batch_mapping_id=".$batchmapid." AND semester=".$semester)->queryScalar();

            $checknominal = Yii::$app->db->createCommand("SELECT count(coe_subjects_id) FROM coe_nominal WHERE course_batch_mapping_id=".$batchmapid." AND semester=".$semester)->queryScalar();

            $nominalelectivestudent = Yii::$app->db->createCommand("SELECT count(register_number) FROM cur_elective_nominal WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryScalar();

            $nominalhonoursstudent = Yii::$app->db->createCommand("SELECT count(register_number) FROM cur_honours_subject_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryScalar();

            $nominaladditionalcoursestudent = Yii::$app->db->createCommand("SELECT count(register_number) FROM cur_additional_course_rejoin_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryScalar();

            $total_nominalcdc=$nominalelectivestudent+$nominalhonoursstudent+$nominaladditionalcoursestudent;

            if(!empty($checksubjectmigrate) && (empty($checknominal) || $total_nominalcdc!=$checknominal))
            {
                $nominalstudentelective = Yii::$app->db->createCommand("SELECT register_number, subject_code, semester FROM cur_elective_nominal WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryAll();

                $nominalstudenthonours = Yii::$app->db->createCommand("SELECT register_number, subject_code, semester FROM cur_honours_subject_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryAll();

                $electivestudent=array_merge($nominalstudentelective,$nominalstudenthonours);

                $nominalstudentac = Yii::$app->db->createCommand("SELECT register_number, subject_code, semester FROM cur_additional_course_rejoin_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryAll();

                $electivestudent=array_merge($electivestudent,$nominalstudentac);

                $Success=0; $error=0; $error1=0;
                foreach ($electivestudent as $value) 
                {
                    $studentdetails = StuInfo::findOne(['reg_num'=>$value['register_number']]);
                    $subjectdetails = Subjects::findOne(['subject_code'=>$value['subject_code']]);

                    if(!empty($subjectdetails['coe_subjects_id']))
                    {

                        $checknominalstudent = Yii::$app->db->createCommand("SELECT count(coe_subjects_id) FROM coe_nominal WHERE course_batch_mapping_id=".$batchmapid." AND semester=".$semester." AND coe_student_id=".$studentdetails['stu_id']." AND coe_subjects_id=".$subjectdetails['coe_subjects_id'])->queryScalar();

                        if($checknominalstudent==0)
                        {
                            $model1 = new Nominal();
                            $model1->course_batch_mapping_id=$batchmapid;
                            $model1->coe_student_id = $studentdetails['stu_id'];
                            $model1->section_name = $studentdetails['sec_name'];
                            $model1->semester = $semester;
                            $model1->coe_subjects_id = $subjectdetails['coe_subjects_id'];
                            $model1->created_at = new \yii\db\Expression('NOW()');
                            $model1->created_by = Yii::$app->user->getId();
                            $model1->updated_at = new \yii\db\Expression('NOW()');
                            $model1->updated_by = Yii::$app->user->getId();
                            //echo "<pre>";
                            //print_r($model1); exit;
                            if($model1->save(false))
                            {
                                $Success++;
                            }
                            else
                            {
                                $error++;
                            }
                        }
                        else
                        {
                            $error++;
                        }
                    }
                    else
                    {
                        $error1++;
                    }
                    
                }

                if($Success>0)
                {
                    Yii::$app->ShowFlashMessages->setMsg('Success', "Success: ".$Success." Error in subject: ".$error1." Students Nominal migrated Successfully ".$error." Students Not Migrated");
                    return $this->redirect(['cdc-nominal-migrate']);
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', $error." Students Not Migrated! Please Check");
                    return $this->redirect(['cdc-nominal-migrate']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Course Not found or Nominal Already migrated! Please Check");
                return $this->redirect(['cdc-nominal-migrate']);
            }
        }
        else
        {
            Yii::$app->ShowFlashMessages->setMsg('Welcome', 'Welcome to CDC Nominal Migrate');
            return $this->render('cdc-nominal-migrate', [
                'model' => $model, 'subjects' => $subjects,'batch_id_value'=>$batch_id_value
            ]);
        }
       
    }

    public function actionCdcnominalmigratedata()
    {
        $batch = Yii::$app->request->post('batch');
        $batchmapid = Yii::$app->request->post('programme');
        $semester = Yii::$app->request->post('sem');
        
        $checknominalmigrate = Yii::$app->db->createCommand("SELECT count(coe_student_id) FROM coe_nominal WHERE course_batch_mapping_id=".$batchmapid." AND semester=".$semester)->queryScalar();

        $checksubjectmigrate = Yii::$app->db->createCommand("SELECT count(subject_id) FROM coe_subjects_mapping WHERE batch_mapping_id=".$batchmapid." AND semester=".$semester)->queryScalar();

        $nominalstudentelective = Yii::$app->db->createCommand("SELECT register_number, subject_code, semester FROM cur_elective_nominal WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=0")->queryAll();

        $nominalstudenthonours = Yii::$app->db->createCommand("SELECT register_number, subject_code, semester FROM cur_honours_subject_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=0")->queryAll();

         $nominalelectivestudent = Yii::$app->db->createCommand("SELECT count(register_number) FROM cur_elective_nominal WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryScalar();

        $nominalhonoursstudent = Yii::$app->db->createCommand("SELECT count(register_number) FROM cur_honours_subject_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryScalar();

        $nominaladditionalcoursestudent = Yii::$app->db->createCommand("SELECT count(register_number) FROM cur_additional_course_rejoin_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryScalar();

        //print_r(($nominalstudentelective)); exit;

        $electivestudent=array_merge($nominalstudentelective,$nominalstudenthonours);

        $total_nominalcdc=$nominalelectivestudent+$nominalhonoursstudent+$nominaladditionalcoursestudent;

        $table1=$html='';

        if($checksubjectmigrate!=0)
        {
            $nominalstudentelective = Yii::$app->db->createCommand("SELECT * FROM cur_elective_nominal WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryAll();

            $table1.= '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" width=100%><tbody align="center">';
            $table1.= '<tr><td colspan=4><b> Elective Nominal </b></td></tr>';
            $table1.= '<tr>
                        <td><b> S.NO </b></td>
                        <td><b> Register Number </b></td>
                        <td><b> Subject Code </b></td>
                        <td><b> Semester </b></td>
                    </tr>';

            $sno=1;
            foreach ($nominalstudentelective as $value) 
            {
               $table1.= '<tr>
                        <td>'.$sno.'</td>
                        <td>'.$value['register_number'].'</td>
                        <td>'.$value['subject_code'].'</td>
                        <td>'.$value['semester'].'</td>
                    </tr>';

                $sno++;
            }

            $table1.= '</table>';

            $nominalstudenthonours = Yii::$app->db->createCommand("SELECT * FROM cur_honours_subject_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryAll();

            if(!empty($nominalstudenthonours))
            {
                $table1.= '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" width=100%><tbody align="center">';
                $table1.= '<tr><td colspan=4><b> Honours Nominal </b></td></tr>';
                $table1.= '<tr>
                        <td><b> S.NO </b></td>
                        <td><b> Register Number </b></td>
                        <td><b> Subject Code </b></td>
                        <td><b> Semester </b></td>
                    </tr>';

                $sno=1;
                foreach ($nominalstudenthonours as $value) 
                {
                   $table1.= '<tr>
                            <td>'.$sno.'</td>
                            <td>'.$value['register_number'].'</td>
                            <td>'.$value['subject_code'].'</td>
                            <td>'.$value['semester'].'</td>
                        </tr>';

                    $sno++;
                }

                $table1.= '</table>';
            }

            $nominalstudentac = Yii::$app->db->createCommand("SELECT * FROM cur_additional_course_rejoin_list WHERE batch_map_id=".$batchmapid." AND semester=".$semester." AND approve_status=1")->queryAll();

            if(!empty($nominalstudentac))
            {
                $table1.= '<table id="checkAllFeet" class="table table-responsive table-striped" align="center" width=100%><tbody align="center">';
                $table1.= '<tr><td colspan=4><b> Additional Course Rejoin Nominal </b></td></tr>';
                $table1.= '<tr>
                        <td><b> S.NO </b></td>
                        <td><b> Register Number </b></td>
                        <td><b> Subject Code </b></td>
                        <td><b> Semester </b></td>
                    </tr>';

                $sno=1;
                foreach ($nominalstudentac as $value) 
                {
                   $table1.= '<tr>
                            <td>'.$sno.'</td>
                            <td>'.$value['register_number'].'</td>
                            <td>'.$value['subject_code'].'</td>
                            <td>'.$value['semester'].'</td>
                        </tr>';

                    $sno++;
                }

                $table1.= '</table>';
            }
        }
        $html=$table1;
         $dataset[]=array('total_nominalcdc'=>$total_nominalcdc,'checknominalmigrate'=>$checknominalmigrate,'notapproved'=>count($electivestudent),'checksubjectmigrate'=>$checksubjectmigrate,'migratedata'=>$html);
        
        return Json::encode($dataset);
    }


    public function actionCdcStatus()
    {
        $model = new CurriculumSubject();
        $model1 = new Department();
        
        if(Yii::$app->request->post()) 
        {
           
        }
        else
        {
            return $this->render('cdc_status', [
                'model' => $model,
                'checkbosdata'=>''
            ]);
        }
    }

    public function actionCdcstatusdata()
    {
        $coe_regulation_id = Yii::$app->request->post('coe_regulation_id');

        $deptall = Yii::$app->db->createCommand("SELECT * FROM cur_department")->queryAll();

        require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
        $header = '<table class="table table-responsive dum_edit_table table-hover" >
                        <tr>
                          <td> 
                            <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                          </td>

                          <td align="center"> 
                              <center><b><h4>' . $org_name . '</h4></b></center>
                              <center> <h6>' . $org_address . '</h6></center>
                              <center><b><h5>' . $org_tagline . '</h5></b></center> 
                              <center><b><h6>Curriculum Status Report</h6></b></center> 
                         </td>
                          <td align="center">  
                            <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                          </td>
                        </tr>                                          
                    </table>';

        $curriculumdata='<table class="table table-responsive dum_edit_table table-hover" >
        <thead>
        <tr>
            <th>S.no</th>
            <th>Department</th>
            <th>Curriculum Approved</th>
            <th>Syllabus Approved</th>
        </tr>
        </thead>
        <tbody>';

        $sno=1;
        foreach ($deptall as $value) 
        {
            $cdcapproved = Yii::$app->db->createCommand("SELECT count(*) FROM cur_curriculum_subject WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status=1")->queryScalar();

            $cdcnotapprove = Yii::$app->db->createCommand("SELECT count(*) FROM cur_curriculum_subject WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status  ='0'")->queryScalar();

            $syapproved = Yii::$app->db->createCommand("SELECT count(*) FROM cur_syllabus WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status  ='1'")->queryScalar();

            $synotapprove = Yii::$app->db->createCommand("SELECT count(*) FROM cur_syllabus WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status  ='0'")->queryScalar();

            $cdcdata = Yii::$app->db->createCommand("SELECT count(*) FROM cur_curriculum_subject WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."'")->queryScalar();

            $check_bos_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_bos WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND bos_min_file!='' AND bos_attendance_file!=''")->queryScalar();
            
            if($cdcdata!=0)
            {
                $curriculumdata.='<tr>';
                $curriculumdata.='<td>'.$sno.'</td>';
                $curriculumdata.='<td>'.$value['dept_code'].'</td>';
                
                if($cdcapproved>0 && $cdcnotapprove==0)
                {
                    $curriculumdata.='<td>Approved</td>';
                }
                else
                {
                    $curriculumdata.='<td>Not Approved</td>';
                }

                if(($syapproved>0 && $synotapprove==0) || ($check_bos_status==1))
                {
                    $curriculumdata.='<td>Approved</td>';
                }
                else
                {
                    $curriculumdata.='<td>Not Approved</td>';
                }
                $curriculumdata.='</tr>';

                $sno++;
            }
        }
        $curriculumdata.='</tbody></table>';
        $curdata[]=array('curriculumdata'=>$curriculumdata);

        return Json::encode($curdata);

    }

    public function actionGetcdcsyllbus()
    {
        $model = new CurriculumSubject();
        $model1 = new Department();
        
        if(Yii::$app->request->post()) 
        {
            $regulationyear = Yii::$app->db->createCommand("SELECT regulation_year FROM coe_regulation WHERE coe_regulation_id=".$_POST['coe_regulation_id'])->queryScalar();

            $batch_id = Yii::$app->db->createCommand("SELECT coe_batch_id FROM coe_regulation WHERE coe_regulation_id=".$_POST['coe_regulation_id'])->queryScalar();
           
            $syapproved = Yii::$app->db->createCommand("SELECT DISTINCT A.subject_code FROM cur_syllabus A JOIN coe_regulation B ON B.coe_regulation_id=A.coe_regulation_id JOIN coe_bat_deg_reg C ON C.regulation_year=B.regulation_year JOIN coe_subjects_mapping D ON D.batch_mapping_id=C.coe_bat_deg_reg_id JOIN coe_subjects E ON E.subject_code=A.subject_code AND E.coe_subjects_id=D.subject_id WHERE C.coe_batch_id=".$batch_id." AND A.degree_type='".$_POST['degree_type']."' AND D.semester  ='".$_POST['semester']."' AND D.paper_type_id IN (8,121)")->queryAll();

            //print_r(count($syapproved)); exit();
        }
        else
        {
            return $this->render('cdc_getsyllabus', [
                'model' => $model,
                'checkbosdata'=>''
            ]);
        }
    }

    public function actionCdcVersionDownload()
    {
        $model = new CurriculumSubject();
        $model1 = new Department();
        
        if(Yii::$app->request->post()) 
        {
           
        }
        else
        {
            return $this->render('cdc_version_download', [
                'model' => $model,
            ]);
        }
    }


    public function actionAcmfinalcdcreport()
    {
        $coe_regulation_id = Yii::$app->request->post('coe_regulation_id');
        $degree_type = Yii::$app->request->post('degree_type');

        $deptall = Yii::$app->db->createCommand("SELECT * FROM cur_department WHERE coe_dept_id!=8  AND degree_type='".$degree_type."'")->queryAll();

        require(Yii::getAlias('@webroot/includes/use_institute_info.php'));
        $header = '<table class="table table-responsive dum_edit_table table-hover" >
                        <tr>
                          <td> 
                            <img class="img-responsive" width="100" height="100" src="' . Yii::getAlias("@web") . '/images/main_logo.png" alt="College Logo">
                          </td>

                          <td align="center"> 
                              <center><b><h4>' . $org_name . '</h4></b></center>
                              <center> <h6>' . $org_address . '</h6></center>
                              <center><b><h5>' . $org_tagline . '</h5></b></center> 
                              <center><b><h6>CURRICULUM & SYLLABUS DOWNLOAD</h6></b></center> 
                         </td>
                          <td align="center">  
                            <img width="100" height="100" class="img-responsive" src="' . Yii::getAlias("@web") . '/images/skacas.png" alt="College Logo 2">
                          </td>
                        </tr>                                          
                    </table>';

        $reg = Regulation::find()->where(['coe_regulation_id'=>$coe_regulation_id])->one();

        $get_regulation = Yii::$app->db->createCommand("SELECT acm_min_file FROM cur_acm WHERE coe_regulation_id=".$coe_regulation_id." AND degree_type='".$degree_type."' AND acm_min_file!='' ORDER BY cur_acm_id DESC LIMIT 1")->queryScalar(); 

        $versions = Yii::$app->db->createCommand("SELECT semester,version,approve_status FROM cur_acm WHERE coe_regulation_id=".$coe_regulation_id." AND degree_type='".$degree_type."'")->queryAll();

        $colspan=count($versions);

        $curriculumdata='<table class="table table-responsive dum_edit_table table-hover" >
        <thead>
        <tr>
            <th rowspan=2 style="vertical-align:top">S.no</th>
            <th rowspan=2 style="vertical-align:top">Department</th>
            <th rowspan=2 style="vertical-align:top">Regulation</th>
            <th rowspan=2 style="vertical-align:top">Curriculum</th>
            <th colspan='.$colspan.' style="vertical-align:top">Syllabus</th>
        </tr>
        <tr>';

        foreach ($versions as $vson) 
        {
            $curriculumdata.=' <th>Version '.$vson['version'].'</th>';
        }
           
           
       $curriculumdata.=' </tr>
        </thead>
        <tbody>';

        $sno=1; $action=0;

        if(count($versions)>0)
        {
            foreach ($deptall as $value) 
            {
                $cdcapproved = Yii::$app->db->createCommand("SELECT count(*) FROM cur_curriculum_subject WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status=1")->queryScalar();

                $cdcnotapprove = Yii::$app->db->createCommand("SELECT count(*) FROM cur_curriculum_subject WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status  ='0'")->queryScalar();

                $syapproved = Yii::$app->db->createCommand("SELECT count(*) FROM cur_syllabus WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status  ='1'")->queryScalar();

                $synotapprove = Yii::$app->db->createCommand("SELECT count(*) FROM cur_syllabus WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND approve_status  ='0'")->queryScalar();

                $cdcdata = Yii::$app->db->createCommand("SELECT count(*) FROM cur_curriculum_subject WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."'")->queryScalar();
                $regulation_year=$reg['regulation_year'];

                $check_bos_status = Yii::$app->db->createCommand("SELECT approve_status FROM cur_bos WHERE coe_dept_id='".$value['coe_dept_id']."' AND coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND bos_min_file!='' AND bos_attendance_file!=''")->queryScalar();
                

                $file_path_regulation = Url::home(true).'/resources/regulation/'.$get_regulation;

                $loguserid=  Yii::$app->user->getId(); 

                $depts=Yii::$app->user->getDeptId();
                
                if($cdcdata!=0)
                {
                    if(($loguserid==1 || $loguserid==11 || $loguserid==924) || $value['coe_dept_id']==$depts)
                    {
                        $curriculumdata.='<tr>';
                        $curriculumdata.='<td>'.$sno.'</td>';
                        $curriculumdata.='<td>'.$value['dept_code'].'</td>';
                        
                        if($cdcapproved>0 && $cdcnotapprove==0)
                        {
                            $checkregulation=Yii::getAlias('@webroot').'/resources/regulation/'.$get_regulation;
                            if(is_readable($checkregulation))
                            {
                               $curriculumdata.='<td><a href="'.$file_path_regulation.'" target="_blank" download>Download</a></td>';
                            }
                            else
                            {
                                $curriculumdata.='<td>No File found</td>';
                            }
                        }

                        $versionname1='V1';

                        $cdcname=$value['dept_code'].'_CDC.pdf';

                        $checkcdc=Yii::getAlias('@webroot').'/resources/cdc_sy_version/'.$regulation_year.'/'.$versionname1.'/'.$cdcname; 

                        if(is_readable($checkcdc))
                        {
                            $checkcdc=Url::home(true).'/resources/cdc_sy_version/'.$regulation_year.'/'.$versionname1.'/'.$cdcname; 

                            $curriculumdata.='<td><a href="'.$checkcdc.'" target="_blank" download>Download Curriculum</a></td>';
                        }
                        else
                        {
                            $curriculumdata.='<td>No File found</td>';
                        }

                        

                        if($check_bos_status ==1)
                        {
                            $v=1;
                            foreach($versions as $vervalue)
                            { 
                                $semexpo=explode('-', $vervalue['semester']);
                                $versionname='V'.$vervalue['version'];
                                $file_path = Url::home(true).'/resources/cdc_sy_version/'.$regulation_year.'/'.$versionname.'/';
                                $sname='_1_'.$semexpo[1].'.pdf';
                                $check_cdc=$file_path.$value['dept_code'].$sname;
                                $checkregulation=Yii::getAlias('@webroot').'/resources/cdc_sy_version/'.$regulation_year.'/'.$versionname.'/'.$value['dept_code'].$sname;
                                
                                if(is_readable($checkregulation))
                                {
                                     $check_acm = Yii::$app->db->createCommand("SELECT count(cur_acm_id) FROM cur_acm WHERE  coe_regulation_id=".$coe_regulation_id." AND degree_type='".$value['degree_type']."' AND semester='".$vervalue['semester']."' AND version='".$vervalue['version']."'")->queryScalar();

                                    if($vervalue['approve_status']==0)
                                    {
                                        $curriculumdata.='<td>Version Updated</td>';
                                    }
                                    else if(($check_acm==1) && ($check_bos_status ==1))
                                    {
                                        $curriculumdata.='<td><a href="'.$check_cdc.'" target="_blank" download>Download (Sem 1-'.$semexpo[1].')</a></td>';
                                    }
                                    else
                                    {
                                        $curriculumdata.='<td>N/A Download AC Approve Pending</td>';
                                    }
                                    
                                }
                                else
                                {
                                    $curriculumdata.='<td>No File found</td>';
                                }

                                $v++;
                            }
                        }
                        else
                        {
                            $curriculumdata.='<td>N/A Download BOS Pending</td>';
                        }

                        $curriculumdata.='</tr>';
                         $sno++;
                         $action++;
                    }
                   
                }
            }

            $curriculumdata.='</tbody></table>';
        }
        else
        {
            $curriculumdata='';
        }
        $curdata[]=array('curriculumdata'=>$curriculumdata,'action'=>$action);

        return Json::encode($curdata);

    }

    public function actionCdcUpdateDelete()
    {
        $model = new CurriculumSubject();

        if(Yii::$app->request->post()) 
        {
            $updateoption=Yii::$app->request->post('updateoption');
            $updatecdcoptiontype=Yii::$app->request->post('updatecdcoptiontype');

            $cdcsubject_code=Yii::$app->request->post('cdcsubject_code');
            $coe_regulation_id=Yii::$app->request->post('coe_regulation_id');
            $update_reason=Yii::$app->request->post('update_reason');
            $subject_name_new=Yii::$app->request->post('subject_name_new');
            $subject_code_new=Yii::$app->request->post('subject_code_new');

            $sem_new=Yii::$app->request->post('sem_new'); //exit;

            $deletedsub=Yii::$app->request->post('deletedsub');

            if(empty($updatecdcoptiontype))
            {
                $updatecdcoptiontype=Yii::$app->request->post('deletecdcoptiontype');
            }
            

            $ltp_new=Yii::$app->request->post('ltp_new');

            if(!empty($update_reason))
            {
                $created_at = date("Y-m-d H:i:s");
                $userid = Yii::$app->user->getId();

                $degree_type = Yii::$app->db->createCommand("SELECT degree_type FROM cur_curriculum_subject WHERE subject_code='".$cdcsubject_code."'")->queryScalar();

                $elect=0;
                if(empty($degree_type))
                {
                    $degree_type = Yii::$app->db->createCommand("SELECT degree_type FROM cur_elective_subject WHERE subject_code='".$cdcsubject_code."'")->queryScalar();
                    $elect=1;
                }

                if(empty($degree_type))
                {
                    $degree_type = Yii::$app->db->createCommand("SELECT degree_type FROM cur_electivetodept WHERE subject_code_new='".$cdcsubject_code."'")->queryScalar();
                    $elect=2;
                }

                if(!empty($degree_type))
                {


                    if($updateoption==2)
                    {
                        if($elect==2)
                        {
                            $assigncode=$cdcsubject_code;
                            $cdcsubject_code = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_curriculum_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE B.subject_code_new='".$assigncode."'")->queryScalar();

                            if(empty($cdcsubject_code))
                            {
                                $cdcsubject_code = Yii::$app->db->createCommand("SELECT A.subject_code FROM cur_elective_subject A JOIN cur_electivetodept B ON B.subject_code=A.subject_code WHERE B.subject_code_new='".$assigncode."'")->queryScalar();
                            }

                            $cur_syllabus_id = Yii::$app->db->createCommand("SELECT cur_syllabus_id FROM cur_syllabus WHERE subject_code='".$cdcsubject_code."'")->queryScalar(); 
                        }
                        else
                        {
                             $cur_syllabus_id = Yii::$app->db->createCommand("SELECT cur_syllabus_id FROM cur_syllabus WHERE subject_code='".$cdcsubject_code."'")->queryScalar(); 
                        }

                       //echo $updatecdcoptiontype; exit();

                        if($updatecdcoptiontype==1)
                        {
                            $deletesuccess=0;
                            for ($c=0; $c <count($deletedsub) ; $c++) 
                            { 
                                $delete_assigned=Yii::$app->db->createCommand('DELETE FROM cur_electivetodept WHERE subject_code="'.$cdcsubject_code.'" AND coe_dept_ids='.$deletedsub[$c])->execute();

                                $delete_cam=Yii::$app->db->createCommand('DELETE FROM cur_course_articulation_matrix WHERE cur_syllabus_id="'.$cur_syllabus_id.'" AND coe_dept_id='.$deletedsub[$c])->execute();

                                if($delete_assigned)
                                {
                                    $deletesuccess++;
                                }
                            }
                            
                            if($deletesuccess>0)
                            {
                                if($elect==2)
                                {
                                    $cdcsubject_code=$assigncode;
                                }

                                $qry='INSERT into cur_cdc_update_status(coe_regulation_id, subject_code, update_option, update_option_type, update_reason, updated_by, updated_at) values("'.$coe_regulation_id.'","'.$cdcsubject_code.'","'.$updateoption.'","'.$updatecdcoptiontype.'","'.$update_reason.'","'.$userid.'","'.$created_at.'") '; 
                                $insert = Yii::$app->db->createCommand($qry)->execute();

                                if($insert)
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Success', "Assigned Course Deleted successfully..");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                                else
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 1! Please Check");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                                
                            }
                            else
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Error', "Nothing to delete 1! Please Check");
                                return $this->redirect(['cdc-update-delete']);
                            }
                            
                        }
                        else if($updatecdcoptiontype==2)
                        {
                            $delete_cam=Yii::$app->db->createCommand('DELETE FROM cur_course_articulation_matrix WHERE cur_syllabus_id="'.$cur_syllabus_id.'"')->execute();

                            $delete_syall=Yii::$app->db->createCommand('DELETE FROM cur_syllabus WHERE subject_code="'.$cdcsubject_code.'"')->execute();

                            $delete_syllabus_existing=Yii::$app->db->createCommand('DELETE FROM cur_syllabus_existing WHERE to_subject_code="'.$cdcsubject_code.'"')->execute();

                            $delete_assigned=Yii::$app->db->createCommand('DELETE FROM cur_electivetodept WHERE subject_code="'.$cdcsubject_code.'"')->execute();

                            $delete_core=Yii::$app->db->createCommand('DELETE FROM cur_curriculum_subject WHERE subject_code="'.$cdcsubject_code.'"')->execute();

                            $delete_elect=Yii::$app->db->createCommand('DELETE FROM cur_elective_subject WHERE subject_code="'.$cdcsubject_code.'"')->execute();

                            $sub_id = Yii::$app->db->createCommand("SELECT coe_cur_id FROM cur_curriculum_subject WHERE subject_code='".$cdcsubject_code."' and coe_dept_id=8")->queryScalar();

                            $delete_shassigned=Yii::$app->db->createCommand('DELETE FROM cur_servicesubtodept WHERE coe_cur_subid="'.$sub_id.'" and coe_dept_id=8')->execute();

                            $qry='INSERT into cur_cdc_update_status(coe_regulation_id, subject_code, update_option, update_option_type, update_reason, updated_by, updated_at) values("'.$coe_regulation_id.'","'.$cdcsubject_code.'","'.$updateoption.'","'.$updatecdcoptiontype.'","'.$update_reason.'","'.$userid.'","'.$created_at.'") '; 
                            $insert = Yii::$app->db->createCommand($qry)->execute();

                            if($insert)
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Success', "Course Deleted successfully..");
                                return $this->redirect(['cdc-update-delete']);
                            }
                            else
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 1! Please Check");
                                return $this->redirect(['cdc-update-delete']);
                            }
                        }
                        else
                        {
                            Yii::$app->ShowFlashMessages->setMsg('Error', "Nothing to delete 2! Please Check");
                            return $this->redirect(['cdc-update-delete']);
                        }
                    }
                    else if($updateoption==1)
                    {
                        if($updatecdcoptiontype==1)
                        {
                            $query = new Query();           
                            $query->select('subject_name')->from('cur_curriculum_subject')->where(['subject_code' =>$subject_code_new,'semester'=>$sem_new]);
                            $subjectcode_check = $query->createCommand()->queryAll();

                            $query = new Query();           
                            $query->select('subject_name')->from('cur_elective_subject')->where(['subject_code' =>$subject_code_new]);
                            $subjectcode_check1 = $query->createCommand()->queryAll();   

                            $query = new Query();           
                            $query->select('subject_code_new')->from('cur_electivetodept')->where(['subject_code_new' =>$subject_code_new]);
                            $subjectcode_check2 = $query->createCommand()->queryAll();                          

                            if(!empty($subjectcode_check) || !empty($subjectcode_check1) || !empty($subjectcode_check2))
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Error',"Course Code Already Exist! Please Check");
                                return $this->redirect(['cdc-update-delete']);
                            }
                            else
                            {
                                if($elect==0)
                                {

                                    $updatesubjectname = Yii::$app->db->createCommand("UPDATE cur_curriculum_subject SET subject_code  ='" . $subject_code_new . "', semester='".$sem_new."' WHERE subject_code='" . $cdcsubject_code . "'")->execute();                                    
                                }
                                else
                                {
                                    $updatesubjectname = Yii::$app->db->createCommand("UPDATE cur_elective_subject SET subject_code  ='" . $subject_code_new . "' WHERE subject_code='" . $cdcsubject_code . "'")->execute();
                                }

                                $electiveassigned = Yii::$app->db->createCommand("SELECT dept_code FROM cur_electivetodept A JOIN cur_department B ON B.coe_dept_id=A.coe_dept_ids WHERE subject_code='".$cdcsubject_code."'")->queryAll();
                                
                                if(!empty($electiveassigned))
                                {
                                    $updateelective_assign = Yii::$app->db->createCommand("UPDATE cur_electivetodept SET subject_code  ='" . $subject_code_new . "' WHERE subject_code='" . $cdcsubject_code . "'")->execute();
                                }
                                

                                if($updatesubjectname)
                                {

                                    $qry='INSERT into cur_cdc_update_status(coe_regulation_id, subject_code, update_option, update_option_type, update_reason, updated_by, updated_at) values("'.$coe_regulation_id.'","'.$cdcsubject_code.'","'.$updateoption.'","'.$updatecdcoptiontype.'","'.$update_reason.'","'.$userid.'","'.$created_at.'") '; 
                                    $insert = Yii::$app->db->createCommand($qry)->execute();

                                    if($insert)
                                    {
                                        Yii::$app->ShowFlashMessages->setMsg('Success',"Course Code Updated successfully..");
                                    return $this->redirect(['cdc-update-delete']);
                                    }
                                    else
                                    {
                                        Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 1! Please Check");
                                        return $this->redirect(['cdc-update-delete']);
                                    }
                                }
                                else
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Error',"Course Code Not Updated successfully! Please Check");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                            }
                        }
                        else if($updatecdcoptiontype==2)
                        {

                            $query1 = new Query();           
                            $query1->select('subject_code,subject_name')->from('cur_curriculum_subject')->where(['!=','subject_type_id',123])->andWhere(['!=','subject_name','Mini Project'])->andWhere(['coe_regulation_id'=>$coe_regulation_id])->andWhere(['degree_type'=>$degree_type ]);
                            $pgmdata1 = $query1->createCommand()->queryAll();

                            $query2 = new Query();           
                            $query2->select('subject_code,subject_name')->from('cur_elective_subject')->andWhere(['coe_regulation_id'=>$coe_regulation_id])->andWhere(['degree_type'=>$degree_type])->andWhere(['<>','coe_elective_option',203]);
                            $pgmdata2 = $query2->createCommand()->queryAll();

                            $subjmerge=array_merge($pgmdata1,$pgmdata2);
                            $checksubject_name=0;
                            foreach ($subjmerge as $value) 
                            {
                                $existname = str_replace(' ', '-', strtolower($value['subject_name']));
                                $newname = str_replace(' ', '-', strtolower($subject_name_new));
                                $existname=preg_replace('/[^A-Za-z\-]/', '',$existname);
                                $newname=preg_replace('/[^A-Za-z\-]/', '',$newname );
                                if($existname==$newname)
                                {
                                    $checksubject_name=1;

                                }
                            }

                            if($checksubject_name==1)
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Error',"Course Name Already Exist! Please Check");
                                return $this->redirect(['cdc-update-delete']);
                            }
                            else
                            {
                                if($elect==0)
                                {
                                    $updatesubjectname = Yii::$app->db->createCommand("UPDATE cur_curriculum_subject SET subject_name  ='" . $subject_name_new . "' WHERE subject_code='" . $cdcsubject_code . "'")->execute();
                                }
                                else
                                {
                                    $updatesubjectname = Yii::$app->db->createCommand("UPDATE cur_elective_subject SET subject_name  ='" . $subject_name_new . "' WHERE subject_code='" . $cdcsubject_code . "'")->execute();
                                }
                                

                                if($updatesubjectname)
                                {                                     
                                    $qry='INSERT into cur_cdc_update_status(coe_regulation_id, subject_code, update_option, update_option_type, update_reason, updated_by, updated_at) values("'.$coe_regulation_id.'","'.$cdcsubject_code.'","'.$updateoption.'","'.$updatecdcoptiontype.'","'.$update_reason.'","'.$userid.'","'.$created_at.'") '; 
                                    $insert = Yii::$app->db->createCommand($qry)->execute();

                                    if($insert)
                                    {
                                        Yii::$app->ShowFlashMessages->setMsg('Success',"Course Name Updated successfully..");
                                    return $this->redirect(['cdc-update-delete']);
                                    }
                                    else
                                    {
                                        Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 1! Please Check");
                                        return $this->redirect(['cdc-update-delete']);
                                    }
                                }
                                else
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Error', "Course Name Not Updated successfully! Please Check");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                            }
                        }
                        else if($updatecdcoptiontype==3)
                        {
                            $ltp = Yii::$app->db->createCommand("SELECT * FROM cur_ltp WHERE coe_ltp_id='".$ltp_new."'")->queryOne();

                            if($elect==0)
                            {
                                $updatesubjectname = Yii::$app->db->createCommand("UPDATE cur_curriculum_subject SET coe_ltp_id  ='" . $ltp_new . "', subject_type_id=".$ltp['subject_type_id'].", subject_category_type_id=".$ltp['subject_category_type_id'].", internal_mark=".$ltp['internal_mark'].", external_mark=".$ltp['external_mark']." WHERE subject_code='" . $cdcsubject_code . "'")->execute();
                            }
                            else
                            {
                                $updatesubjectname = Yii::$app->db->createCommand("UPDATE cur_elective_subject SET coe_ltp_id  ='" . $ltp_new . "', subject_type_id=".$ltp['subject_type_id'].", subject_category_type_id=".$ltp['subject_category_type_id'].", internal_mark=".$ltp['internal_mark'].", external_mark=".$ltp['external_mark']." WHERE subject_code='" . $cdcsubject_code . "'")->execute();
                            }
                            

                            if($updatesubjectname)
                            {

                                $qry='INSERT into cur_cdc_update_status(coe_regulation_id, subject_code, update_option, update_option_type, update_reason, updated_by, updated_at) values("'.$coe_regulation_id.'","'.$cdcsubject_code.'","'.$updateoption.'","'.$updatecdcoptiontype.'","'.$update_reason.'","'.$userid.'","'.$created_at.'") '; 
                                    $insert = Yii::$app->db->createCommand($qry)->execute();

                                if($insert)
                                {
                                     Yii::$app->ShowFlashMessages->setMsg('Success', "Course LTP Updated successfully..");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                                else
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 1! Please Check");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                            }
                            else
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Error', "Course LTP Not Updated successfully! Please Check");
                                return $this->redirect(['cdc-update-delete']);
                            }
                            
                        }
                        else if($updatecdcoptiontype==4)
                        {
                            $course_new_sem=Yii::$app->request->post('course_new_sem');

                             $coe_cur_id = Yii::$app->db->createCommand("SELECT coe_cur_id FROM cur_curriculum_subject WHERE subject_code='".$cdcsubject_code."'")->queryScalar();

                            $deletesuccess=0;
                            for ($c=0; $c <count($deletedsub) ; $c++) 
                            { 
                                $updatedsem = Yii::$app->db->createCommand("UPDATE cur_servicesubtodept SET semester  ='" . $course_new_sem . "' WHERE coe_cur_subid='" . $coe_cur_id . "' AND coe_dept_ids='".$deletedsub[$c]."'")->execute();

                                if($updatedsem)
                                {
                                    $deletesuccess++;
                                }
                            }
                            
                            if($deletesuccess>0)
                            {

                                $qry='INSERT into cur_cdc_update_status(coe_regulation_id, subject_code, update_option, update_option_type, update_reason, updated_by, updated_at) values("'.$coe_regulation_id.'","'.$cdcsubject_code.'","'.$updateoption.'","'.$updatecdcoptiontype.'","'.$update_reason.'","'.$userid.'","'.$created_at.'") '; 
                                $insert = Yii::$app->db->createCommand($qry)->execute();

                                if($insert)
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Success', "Assigned Course Updated successfully..");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                                else
                                {
                                    Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 1! Please Check");
                                    return $this->redirect(['cdc-update-delete']);
                                }
                                
                            }
                            else
                            {
                                Yii::$app->ShowFlashMessages->setMsg('Error', "Nothing to Updated 4! Please Check");
                                return $this->redirect(['cdc-update-delete']);
                            }
                        }
                        else
                        {
                            Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 3! Please Check");
                            return $this->redirect(['cdc-update-delete']);
                        }
                        
                    }
                    else
                    {
                        Yii::$app->ShowFlashMessages->setMsg('Error', "Something Error 2! Please Check");
                        return $this->redirect(['cdc-update-delete']);
                    }
                    
                }
                else
                {
                    Yii::$app->ShowFlashMessages->setMsg('Error', "Subject Not Found! Please Check");
                        return $this->redirect(['cdc-update-delete']);
                }
            }
            else
            {
                Yii::$app->ShowFlashMessages->setMsg('Error', "Please Fill Reason..");
                return $this->redirect(['cdc-update-delete']);
            }
           
            
        }
        else
        {

            return $this->render('cdc_update_delete', [
                'model' => $model,
            ]);
        }
        
    }

     public function actionGetregulationallsubjects()
    {
        $coe_regulation_id=Yii::$app->request->post('coe_regulation_id');

        $coresubjects = Yii::$app->db->createCommand("SELECT subject_code FROM cur_curriculum_subject WHERE  coe_regulation_id='".$coe_regulation_id."' AND subject_code NOT IN (SELECT subject_code FROM coe_subjects) ORDER BY subject_code")->queryAll();
        
        $electivesubjects = Yii::$app->db->createCommand("SELECT subject_code FROM cur_elective_subject WHERE  coe_regulation_id='".$coe_regulation_id."' AND subject_code NOT IN (SELECT subject_code FROM coe_subjects) ORDER BY subject_code")->queryAll();

        $assigned_subject_newcode = Yii::$app->db->createCommand("SELECT subject_code_new as subject_code FROM cur_electivetodept WHERE  coe_regulation_id='".$coe_regulation_id."' AND subject_code_new NOT IN (SELECT subject_code FROM coe_subjects) ORDER BY subject_code_new")->queryAll();

        //print_r($assigned_subject_newcode); exit;

        $subjectdata=array_merge($coresubjects,$electivesubjects);
         $subjectdata=array_merge($coresubjects,$assigned_subject_newcode);
        
        $result = array();
        foreach ($subjectdata as $key => $value){
          if(!in_array($value, $result))
            $result[$key]=$value;
        }
        //print_r($result); exit;
        return Json::encode($result);
    }

    public function actionGetcdcsubjectsdetails()
    {
        $updateoption=Yii::$app->request->post('updateoption');
        $updatecdcoptiontype=Yii::$app->request->post('updatecdcoptiontype');
        $cdcsubject_code=Yii::$app->request->post('cdcsubject_code');

        $checkcdcsubject = Yii::$app->db->createCommand("SELECT subject_code, subject_name, concat(B.L,'/',B.T,'/',B.P,'/',B.credit_point) as LTPC, semester FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id WHERE subject_code='".$cdcsubject_code."'")->queryOne();

        //print_r($checkcdcsubject); exit;

        if(empty($checkcdcsubject))
        {
            $checkcdcsubject = Yii::$app->db->createCommand("SELECT subject_code, subject_name, concat(B.L,'/',B.T,'/',B.P,'/',B.credit_point) as LTPC, A.semester FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id WHERE subject_code='".$cdcsubject_code."'")->queryOne();
        }

        $electiveassigned = Yii::$app->db->createCommand("SELECT concat(dept_code,' - ',subject_code_new) as dept_code,A.coe_dept_ids FROM cur_electivetodept A JOIN cur_department B ON B.coe_dept_id=A.coe_dept_ids WHERE subject_code='".$cdcsubject_code."'")->queryAll();
        //print_r($electiveassigned); exit;
        if(($updateoption==2 && empty($electiveassigned)) && $updatecdcoptiontype!=4)
        {
            $checkcdcsubject = Yii::$app->db->createCommand("SELECT A.subject_code, A.subject_name, concat(B.L,'/',B.T,'/',B.P,'/',B.credit_point) as LTPC, A.semester FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id JOIN cur_electivetodept C ON C.subject_code=A.subject_code WHERE C.subject_code_new='".$cdcsubject_code."'")->queryOne();

            if(empty($checkcdcsubject))
            {
                $checkcdcsubject = Yii::$app->db->createCommand("SELECT A.subject_code, A.subject_name, concat(B.L,'/',B.T,'/',B.P,'/',B.credit_point) as LTPC, C.semester FROM cur_elective_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id JOIN cur_electivetodept C ON C.subject_code=A.subject_code WHERE subject_code_new='".$cdcsubject_code."'")->queryOne();
            }

             $electiveassigned = Yii::$app->db->createCommand("SELECT concat(dept_code,' - ',subject_code_new) as dept_code,A.coe_dept_ids FROM cur_electivetodept A JOIN cur_department B ON B.coe_dept_id=A.coe_dept_ids WHERE subject_code_new='".$cdcsubject_code."'")->queryAll();

            if(empty($checkcdcsubject))
            {
                $checkcdcsubject = Yii::$app->db->createCommand("SELECT subject_code, subject_name, concat(B.L,'/',B.T,'/',B.P,'/',B.credit_point) as LTPC, A.semester FROM cur_curriculum_subject A JOIN cur_ltp B ON B.coe_ltp_id=A.coe_ltp_id WHERE subject_code='".$cdcsubject_code."'")->queryOne();
            }

        }
        else if(empty($electiveassigned))
        {

            $electiveassigned = Yii::$app->db->createCommand("SELECT concat(B.dept_code,' - ',C.subject_code) as dept_code,A.coe_dept_ids, A.semester FROM cur_servicesubtodept A JOIN cur_curriculum_subject C ON C.coe_cur_id=A.coe_cur_subid JOIN cur_department B ON B.coe_dept_id=A.coe_dept_ids WHERE C.subject_code='".$cdcsubject_code."'")->queryAll();
            
        }

        $implodedept='';

        if(!empty($electiveassigned))
        {
            if($updatecdcoptiontype==4)
            {
                foreach($electiveassigned as $eval)
                {
                    $implodedept.='<label><input type="checkbox" name="deletedsub[]" value='.$eval['coe_dept_ids'].'> '.$eval['dept_code'].'</label> Semester:'.$eval['semester'].' <br>';
                }
            }
            else
            {
                foreach($electiveassigned as $eval)
                {
                    $implodedept.='<label><input type="checkbox" name="deletedsub[]" value='.$eval['coe_dept_ids'].'> '.$eval['dept_code'].'</label><br>';
                }
            }
            //$implodedept=rtrim($implodedept,', ');
        }

        //print_r($implodedept); exit;

        $syllabuscheck = Yii::$app->db->createCommand("SELECT subject_code FROM cur_syllabus WHERE  subject_code='".$cdcsubject_code."'")->queryScalar();

        $curriculumdata='';
        if($updateoption==2)
        {
            if(!empty($checkcdcsubject))
            {
                $curriculumdata='<table class="table table-responsive dum_edit_table table-hover" width=100%><tbody>';
                $curriculumdata.='<tr>';
                $curriculumdata.='<td>Course: <b>'.$checkcdcsubject['subject_code'].' - '.$checkcdcsubject['subject_name'].'</b></td>';
                $curriculumdata.='</tr>';
                $curriculumdata.='<tr>';
                $curriculumdata.='<td>LTPC: <b>'.$checkcdcsubject['LTPC'].'</b> </td>';
                $curriculumdata.='</tr>';
                
                if(!empty($electiveassigned))
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>Assigned to Dept.:<br> <b>'.$implodedept.'</b> </td>';
                    $curriculumdata.='</tr>';
                }
                else
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td><input type="hidden" name="deletedsub[]"></td>';
                    $curriculumdata.='</tr>';
                }

                if(!empty($syllabuscheck))
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>Syllabus Created</td>';
                    $curriculumdata.='</tr>';
                }

                $curriculumdata.='<tr>';
                $curriculumdata.='<td>Reason for Delete <b>(Enter valid reason)</b>:<br>
                                    <textarea cols=100 rows=6 name="update_reason" required></textarea></td>';
                $curriculumdata.='</tr>';
                $curriculumdata.='</tbody></table>';
            }
            
        }
        else if($updateoption==1)
        {

            if(!empty($checkcdcsubject))
            {
                $curriculumdata='<table class="table table-responsive dum_edit_table table-hover" width=100%><tbody>';
                $curriculumdata.='<tr>';
                $curriculumdata.='<td>Course: <b>'.$checkcdcsubject['subject_code'].' - '.$checkcdcsubject['subject_name'].'</b></td>';
                $curriculumdata.='</tr>';
                $curriculumdata.='<tr>';
                $curriculumdata.='<td>LTPC: <b>'.$checkcdcsubject['LTPC'].'</b> </td>';
                $curriculumdata.='</tr>';
                
                if(!empty($electiveassigned))
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>Assigned to Dept.:<br> <b>'.$implodedept.'</b> </td>';
                    $curriculumdata.='</tr>';
                }
                if(!empty($syllabuscheck))
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>Syllabus Created</td>';
                    $curriculumdata.='</tr>';
                }

                if($updatecdcoptiontype==1)
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>New Semester:<br>
                                        <input style="width:25% !important;" class="form-control" name="sem_new" value="'.$checkcdcsubject['semester'].'" required/></td>';
                    $curriculumdata.='</tr>';

                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>Course Code New:<br>
                                        <input style="width:25% !important;" width=25% class="form-control" name="subject_code_new" value="'.$checkcdcsubject['subject_code'].'" required/></td>';
                    $curriculumdata.='</tr>';
                }
                else if($updatecdcoptiontype==2)
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>Course Name New:<br>
                                        <input class="form-control" name="subject_name_new" required/></td>';
                    $curriculumdata.='</tr>';
                }
                else if($updatecdcoptiontype==4)
                {
                    $curriculumdata.='<tr>';
                    $curriculumdata.='<td>Assign Sem to Sem:<br>
                                        <input class="form-control" name="course_new_sem" required/></td>';
                    $curriculumdata.='</tr>';
                }

                $curriculumdata.='<tr>';
                $curriculumdata.='<td>Reason for Update <b>(Enter valid reason)</b>:<br>
                                    <textarea class="form-control" cols=100 rows=6 name="update_reason" required></textarea></td>';
                $curriculumdata.='</tr>';
                $curriculumdata.='</tbody></table>';
            }
            else
            {
                $curriculumdata='';
            }
        }
        else
        {
            $curriculumdata='';
        }

        $curdata[]=array('curriculumdata'=>$curriculumdata);

        return Json::encode($curdata);
    }


    public function actionCdcDeleteAll()
    {
       $coresubjects= Yii::$app->db->createCommand('SELECT B.coe_cur_subid,A.subject_code, B.semester FROM cur_curriculum_subject A JOIN cur_servicesubtodept B ON B.coe_cur_subid=A.coe_cur_id WHERE A.coe_regulation_id=95 AND A.coe_batch_id=14 AND A.coe_dept_id=8 AND B.semester>2')->queryAll();

       //echo "<pre>";
       //print_r($coresubjects); exit;
       $deleted=0;
       foreach ($coresubjects as$value) 
       {
            $subject_code=$value['subject_code'];

            // $cur_syllabus_id = Yii::$app->db->createCommand("SELECT cur_syllabus_id FROM cur_syllabus WHERE subject_code='".$subject_code."'")->queryScalar(); 

            // $delete_cam=Yii::$app->db->createCommand('DELETE FROM cur_course_service_matrix WHERE cur_syllabus_id="'.$cur_syllabus_id.'"')->execute();

            // $delete_lab=Yii::$app->db->createCommand('DELETE FROM cur_lab_component WHERE cur_syllabus_id="'.$cur_syllabus_id.'"')->execute();
            
            // $delete_syllabus_existing=Yii::$app->db->createCommand('DELETE FROM cur_syllabus_existing WHERE to_subject_code="'.$subject_code.'"')->execute();

            // $delete_cam=Yii::$app->db->createCommand('DELETE FROM cur_servicesubtodept WHERE coe_cur_subid="'.$value['coe_cur_subid'].'"')->execute();

            // $delete_syall=Yii::$app->db->createCommand('DELETE FROM cur_syllabus WHERE subject_code="'.$subject_code.'"')->execute();

            //  $delete_coresubjects=Yii::$app->db->createCommand('DELETE FROM cur_curriculum_subject WHERE subject_code="'.$subject_code.'"')->execute();

             $deleted++;
       }
       
       echo $deleted; exit;
    
    }

}
